#!/bin/sh

#alias gawk="gawk --posix"

if [ "$SRB2BLDDEBUG" = "1" ]; then

    set -e -x +f

else

    set -e +f

fi

# Set environment variables.
ARGS="$*"
ARCH=$(uname -m)
OS=$(uname)

if [ "$OS" = "Darwin" ]; then

    NCPU=$(sysctl -n hw.logicalcpu)
    PRINTF="printf"

else

    NCPU=$(nproc)
    PRINTF=$(which -a printf 2> /dev/null | gawk '/bin/ {print}' | head -n1)

fi

if [ -n "$SRB2BLDNCPU" ]; then

    NCPU="$SRB2BLDNCPU"

fi

COMPTABLEURL="https://gist.githubusercontent.com/Bijman/dae1e123800af25ef28689bd644a4516/raw"
FAILURE="\e[1;91m"
SUCCESS="\e[1;92m"
NOTICE="\e[1;93m"
MESSAGE="\e[1;94m"
PROMPT="\e[1;97m"

# Linux specific environment variables for compatibility reasons.
if [ "$OS" = "Linux" ]; then

    LNXOSNAME=$(gawk -F'=' '/^NAME=/ {gsub("\"",""); print $NF}' /etc/os-release)
    ISREADONLY=$(
        LANG=en_US gawk '{if(($2 == "/" || $2 == "/sysroot") && $0 ~ / ro,/) {print; exit} else if($0 ~ /Read-only/) {print; exit}}' /proc/mounts /dev/fd/3 3<<- EOF 2> /dev/null
	$(LANG=en_US touch /testfile 2>&1 | gawk '/Read-only/ {print}')
	EOF
    )
    ISPASSWORDLESS=$(passwd -S "$USER" | gawk '$2 != "P" {print $2}')

fi

IS64=$($PRINTF "%s\n" "$ARCH" | gawk 'match($0, /64/) {print substr($0, RSTART, RLENGTH)}')
USER=$(whoami)

# Set root directory for builds, assets, libraies etc.
if [ "$OS" = "Darwin" ]; then

    SRB2BLDROOT="$HOME/Library/srb2bld"

elif [ "$($PRINTF "%s\n" "$OS" | gawk -F'_' '{print $1}')" = "MINGW64" ] || [ "$($PRINTF "%s\n" "$OS" | gawk -F'_' '{print $1}')" = "MINGW32" ] || [ "$($PRINTF "%s\n" "$OS" | gawk -F'_' '{print $1}')" = "MSYS" ]; then

    OS="Windows"
    WINOS="1"
    USER=$(whoami)
    HOME=$($PRINTF "%s\n" "$USERPROFILE" | gawk '{gsub("\\\\","/"); gsub(":/Users","/Users"); gsub("^","/"); print}')
    SRB2BLDROOT="$HOME/AppData/Roaming/srb2bld"

else

    SRB2BLDROOT="$HOME/.local/share/srb2bld"

fi

# Determine installation prefix from user's input.
if [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u -| -u$| --user -| --user$/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$ISREADONLY" ]; then

    if [ "$OS" = "Linux" ]; then

        SRB2BLDPREFIX="$HOME/.local"

    elif [ "$OS" = "Darwin" ]; then

        SRB2BLDPREFIX="$HOME/Local"

    else

        SRB2BLDPREFIX="/usr/local"

        # Create prefix path.
        if [ ! -d "$SRB2BLDPREFIX" ] && [ "$OS" != "Windows" ]; then

            if [ "$SRB2BLDPREFIX" != "/usr/local" ]; then

                mkdir -p "$SRB2BLDPREFIX"

            else

                if [ -x "$(command -v doas 2> /dev/null)" ]; then

                    SUDO="doas"

                else

                    SUDO="sudo"

                fi

                $SUDO mkdir -p "$SRB2BLDPREFIX"

            fi

        fi

    fi

else

    if [ "$OS" = "Darwin" ]; then

        SRB2BLDPREFIX="/usr/local/opt/srb2-apps"

    else

        SRB2BLDPREFIX="/usr/local"

    fi

    # Create prefix path.
    if [ ! -d "$SRB2BLDPREFIX" ] && [ "$OS" != "Windows" ] && [ "$OS" != "Darwin" ]; then

        if [ "$SRB2BLDPREFIX" != "/usr/local" ]; then

            mkdir -p "$SRB2BLDPREFIX"

        else

            if [ -x "$(command -v doas 2> /dev/null)" ]; then

                SUDO="doas"

            else

                SUDO="sudo"

            fi

            $SUDO mkdir -p "$SRB2BLDPREFIX"

        fi

    fi

fi

# Change permissions for path $HOME/.local in order to write data to $HOME/.local/share/srb2bld within container. Fix for Fedora Atomic desktops.
if [ "$OS" = "Linux" ] && [ -d "$HOME/.local" ] && ([ "$(stat -c %a "$HOME/.local" | gawk 'match($0, /755/) {print substr($0, RSTART, RLENGTH)}')" != "755" ] || [ "$(stat -c %a "$HOME/.local/share" | gawk 'match($0, /755/) {print substr($0, RSTART, RLENGTH)}')" != "755" ]); then

    chmod 755 "$HOME/.local" "$HOME/.local/share"

fi

BUILDPATH="$SRB2BLDROOT/builds"
GITOPTS="-j $NCPU -c https.postBuffer=1048576000"
OSVIRTOPTS="--rm -it --network host --add-host $(hostname):127.0.0.1 --security-opt label=disable --security-opt seccomp=unconfined --cap-add CAP_DAC_OVERRIDE --cap-add CAP_FOWNER --cap-add CAP_AUDIT_WRITE"
UBUVER="bionic"    # Ubuntu 18.04 LTS
UBUSOFTVER="jammy" # Ubuntu 22.04 LTS
UBUUZBVER="bionic" # Ubuntu 18.04 LTS
SRB2ASSETURL="https://api.github.com/repos/STJr/SRB2/releases"
SRB2CLASSICASSETURL="https://codeberg.org/srb2classic/srb2classic-assets/archive/master.zip"
SRB2BETAASSETURL="https://api.github.com/repos/xdf22/SRB2-2.2-Beta6/releases"
SRB2NETPLUSASSETURL="https://github.com/STJr/SRB2/releases/download/SRB2_release_2.2.9/SRB2-v229-Patch.zip"
SRB2REVERIESASSETURL="https://codeberg.org/api/v1/repos/cande/cherry/releases"
#SRB2TSOURDT3RDASSETURL="https://mb.srb2.org/addons/the-story-of-uncapped-revengence-discord-the-3rd.4932/download"
SRB2GGJASSETURL="https://git.do.srb2.org/chaoloveicemdboy/srb2ggj-assets-public.git"
SRB2DESTRUCTIVEILLUSIONASSETURL="https://srb2workshop.org/resources/destructive-illusion-re-upload.110/download"
SRB2VRASSETURL="https://github.com/STJr/SRB2/releases/download/SRB2_release_2.2.9/SRB2-v229-Patch.zip"
SRB2LEGACYASSETURL="https://github.com/STJr/SRB2/releases/download/SRB2_release_2.1.25/SRB2-v2125-Installer.exe"
SRB2THOKKERASSETURL="https://mega.nz/folder/V1NiFTgY#gx8Nk7Smj8kBYzq_QVez-Q/file/B8EEQSiY"
SRB2TOPDOWNASSET1URL="https://mb.srb2.org/attachments/srb2td-zip-001.4670"
SRB2TOPDOWNASSET2URL="https://mb.srb2.org/attachments/srb2td-zip-002.4671"
SONICSMASHBRAWLASSET1URL="https://files.catbox.moe/zkk1fe.001"
SONICSMASHBRAWLASSET2URL="https://files.catbox.moe/6s84t1.002"
SRB220ASSETURL="https://archive.org/download/srb20ya-v20/SRB2_v206.exe"
SRB2CBASSETURL="https://mb.srb2.org/attachments/srb2cbwin32a-zip.1000"
SRB2RIDERSMUSICASSETURL="https://mb.srb2.org/attachments/music-zip.1004"
SUPERSRB2KARTZASSETURL="https://archive.org/download/srb2kart_20_indev/v2.zip"
SRB2FINALDEMOASSETURL="https://archive.org/download/srb20ya-finaldemo/FinalDemo1094-2008.exe"
SRB21095ASSETURL="https://api.github.com/repos/CG64-2021/SRB2-1095/releases"
SRB2JTEASSETURL="https://archive.org/download/SRB2JTE-69-1/srb2jte.zip"
NEWMILLENNIUMASSETURL="https://api.github.com/repos/freedoom/freedoom/releases"
SRB2PERSONAASSETURL="https://mb.srb2.org/addons/166/download"
SRB2KARTASSETURL="https://api.github.com/repos/STJr/Kart-Public/releases"
SRB2KARTHEPASSETURL="https://mb.srb2.org/addons/5254/download"
SRB2KARTSATURNASSETURL="https://api.github.com/repos/Indev450/SRB2Kart-Saturn/releases"
SRB2KARTNEPTUNEASSETURL="https://api.github.com/repos/NepDisk/srb2k-neptune/releases"
BLANKARTASSETURL="https://codeberg.org/NepDisk/blankart-assets/archive/main.zip"
RINGRACERSASSETURL="https://api.github.com/repos/KartKrewDev/RingRacers/releases"
RADIORACERSASSETURL="https://api.github.com/repos/blondedradio/RadioRacers/releases"
MINGWCCVER="gcc"
MINGWCXXVER="g++"
MINGWOLDCCVER="gcc-4.9-win32"
ANDROIDSDKVER="jdk17"
VCPKG_ROOT="/tmp/vcpkg"
CMAKEPOLVER="3.5"

# If you set CCACHE_DIR, this path will be used for cache from previous compilations and speed up recompilation.
if [ -d "$CCACHE_DIR" ]; then

    CCACHE_DIR="$CCACHE_DIR"

elif [ -n "$CCACHE_DIR" ]; then

    CCACHE_DIR="$CCACHE_DIR"
    mkdir -p "$CCACHE_DIR"

else

    CCACHE_DIR="$HOME/.cache/ccache"
    mkdir -p "$CCACHE_DIR"

fi

if [ "$OS" = "Windows" ]; then

    if [ -d "$VCPKG_CACHE_DIR" ]; then

        VCPKG_CACHE_DIR="$HOME/.cache/vcpkg"
        mkdir -p "$VCPKG_CACHE_DIR"

    elif [ -n "$VCPKG_CACHE_DIR" ]; then

        VCPKG_CACHE_DIR="$VCPKG_CACHE_DIR"
        mkdir -p "$VCPKG_CACHE_DIR"

    else

        VCPKG_CACHE_DIR="$HOME/.cache/vcpkg"
        mkdir -p "$VCPKG_CACHE_DIR"

    fi

fi

if [ "$(ldd --version 2>&1 | gawk 'match($0, /musl/) {print substr($0, RSTART, RLENGTH)}' | gawk '!a[$0]++ {print}')" = "musl" ]; then

    GCCVER="gcc"
    GCCOLDVER="gcc-6"
    GXXVER="g++"
    LIBC="musl"

else

    GCCVER="gcc-13"
    GCCOLDVER="gcc-5"
    GXXOLDVER="g++-5"
    GXXVER="g++-13"
    RINGRACERSGCCVER="gcc-10"
    RINGRACERSGXXVER="g++-10"
    SLADEGCCOLDVER="gcc-9"
    SLADEGXXOLDVER="g++-9"

fi

LNXFMODVER="fmodapi375linux"
LNXBACKTRACEVER="master"
LNXPNGVER="master"
LNXPNG12VER="libpng12"
LNXSNDFILEVER="1.2.2"
LNXSDL2VER="release-2.0.18"
LNXSDL3VER="release-3.2.x"
LNXSDL2MIXERXVER="master"
LNXOPENMPTVER="libopenmpt-0.6.12"
LNXGMEVER="0.6.3"
LNXFLUIDSYNTHVER="2.2.0"
LNXDISCORDRPCVER="master"
LNXOPENVRVER="1.10.30"
LNXLZFVER="master"
LNXWXGTKVER="3.2.7"
LNXWEBPVER="main"
LNXZDBSPVER="master"
LNXMONOVER="6.6.0"
LNXMONOUBUVER="18.04"
LNXWXGTK30PKG="libwxgtk3.0-gtk3-dev libwxgtk-media3.0-gtk3-dev libwxgtk-webview3.0-gtk3-dev"

if [ "$ARCH" != "x86_64" ]; then

    LNXWXGTKPKG=""

else

    LNXWXGTKPKG="libwxbase3.2-0-unofficial libwxbase3.2unofficial-dev libwxgtk3.2-0-unofficial libwxgtk3.2unofficial-dev wx3.2-headers wx-common libwxgtk-media3.2-0-unofficial libwxgtk-media3.2unofficial-dev libwxgtk-webview3.2-0-unofficial libwxgtk-webview3.2unofficial-dev libwxgtk-webview3.2-0-unofficial-dbg libwxbase3.2-0-unofficial-dbg libwxgtk3.2-0-unofficial-dbg libwxgtk-media3.2-0-unofficial-dbg wx3.2-i18n wx3.2-examples"

fi

LNXDEPOTTOOLSVER="main"
LNXSKIAVER="aseprite-m124"
LNXVCPKGVER="master"

if [ "$OS" = "Darwin" ]; then

    MACOSVER="10.9"
    MACOSVERSLADE="11"
    MACOSPNGVER="1.6.41"
    MACOSOGGVER="1.3.5"
    MACOSVORBISVER="1.3.7"
    MACOSMPG123VER="master"
    MACOSMODPLUGVER="master"
    MACOSSDL2VER="release-2.32.x"
    MACOSSDL3VER="release-3.2.x"
    MACOSSDL2MIXERVER="release-2.6.0"
    MACOSSDL2MIXERXVER="2.6.0"
    MACOSOPENMPTVER="0.4.12"
    MACOSGMEVER="0.6.2"
    MACOSSNDFILEVER="master"
    MACOSFLUIDSYNTHVER="master"
    MACOSOPENALVER="master"
    MACOSDISCORDRPCVER="master"
    MACOSOPENVRVER="1.10.30"
    MACOSMINIUPNPCVER="master"
    MACOSLZFVER="master"
    MACOSDEPOTTOOLSVER="main"
    MACOSSKIAVER="aseprite-m124"
    MACOSVCPKGVER="master"

    if [ -x "$(command -v brew 2> /dev/null)" ]; then

        HOMEBREWPREFIX=$(brew --prefix)

    fi

    MACPORTPREFIX="/opt/local"

    # Alias for curl with set GITHUB_TOKEN, if you encounter rate limiting after some amount using GitHub's API requests.
    if [ -n "$GITHUB_TOKEN" ]; then

        alias curl="curl -u :$GITHUB_TOKEN"

    else

        alias curl="curl"

    fi

fi

checkuseropt() {
    # Blocking access to option -u/--user for building bundles in Linux.
    if ([ -n "$ANDROID" ] || [ -n "$APPBUNDLE" ] || [ -z "$APPIMAGE" ] || [ -n "$FLATPAK" ] || [ -n "$UPGRADE" ]) && [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u$| --user$/) {print substr($0, RSTART, RLENGTH)}')" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Currently building with option $($PRINTF "%s\n" "$ARGS" | gawk '{print $1}') is not supported with -u/--user. Exiting."
        exit

    fi
}

checkuserid() {
    # Check id of login running this script.
    if [ "$(id -u)" -eq 0 ]; then

        $PRINTF "$NOTICE%s\n\e\n[0m" "WARNING: It is not recommended to run srb2bld as root. Press ctrl+c to quit and run again script as user in \"docker\" group or continue."

    fi
}

checkreadonly() {
    # Check if root filesystem is mounted read-only.
    if [ "$OS" = "Linux" ] && [ -n "$ISREADONLY" ]; then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e\n[0m" "Detected read-only root filesystem. Assuming \"$SRB2BLDPREFIX\" as install path to builds, assets and storage to containers."

    fi
}

android() {
    clear

    # Blocking access to this option for users that have OS other than Linux and Windows.
    if [ "$OS" != "Linux" ] && [ "$OS" != "Windows" ] && [ -z "$(ldd --version 2>&1 | gawk '/Free Software Foundation/ {print}')" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Currently building APKs is only available for Linux and Windows. Exiting."
        exit

    fi

    # We have to set this in order to make APK in Docker/Podman container.
    ANDROID=1

    checkuseropt

    # Set current working directory.
    ANDPWD="$(pwd)"

    # If you set GRADLE_USER_HOME, this path will be used for cache from previous compilations and speed up recompilation.
    if [ -d "$GRADLE_USER_HOME" ]; then

        GRADLE_USER_HOME="$GRADLE_USER_HOME"

    elif [ -n "$GRADLE_USER_HOME" ] && [ ! -d "$GRADLE_USER_HOME" ]; then

        GRADLE_USER_HOME="$GRADLE_USER_HOME"
        mkdir -p "$GRADLE_USER_HOME"

    else

        GRADLE_USER_HOME="$HOME/.cache/gradle"
        mkdir -p "$GRADLE_USER_HOME"

    fi

    chooseandroidbuild

    buildvar

    fetchupdatebuild

    choosebranchcommit

    if [ ! -x "$BUILD/android/gradlew" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Couldn't find gradlew script at path \"$BUILD/android\". Exiting."
        exit

    fi

    preparebuild

    setsudo

    preparecontainer

    containerentry

    if [ "$OS" = "Linux" ]; then

        sudo_ping

    fi

    settrap

    containerrun

    # Set name of APK in message.
    APKPATH=$(find "$BUILD/android/app/build/outputs/apk/gameFull/debug" "$BUILD/android/app/build/outputs/apk/debug" -name "*.apk" 2> /dev/null || true)
    APKNAME=$($PRINTF "%s\n" "$APKPATH" | gawk -F'/' '{print $NF}')

    # Move created APK to working directory.
    mv -f "$APKPATH" "$ANDPWD" 2> /dev/null
    $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Android APK for $BUILDNAME is done. Look for \"$APKNAME\" in \"$ANDPWD\" path."
}

appbundle() {
    clear

    # Blocking access to this option for users that uses OS other than macOS since App Bundles are macOS exclusive.
    if [ "$OS" != "Darwin" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Currently building App Bundles is only available for macOS. Exiting."
        exit

    fi

    # We have to set this in order to make App Bundle in installtomacos function.
    APPBUNDLE=1

    checkuseropt

    # Set current working directory.
    MACOSPWD="$(pwd)"

    choosebuild

    buildvar

    fetchupdatebuild

    choosebranchcommit

    preparebuild

    setsudo

    settrap

    installtomacos

    # Set name of App Bundle in message.
    APPBUNDLENAME=$(find "$BUILD/build" -name "*.dmg" 2> /dev/null | gawk -F'/' '{print $NF}' | sort | head -n1)

    # Rename App Bundle and move it to working directory.
    if [ -d "$BUILD/build/package" ]; then

        mv -f "$BUILD/build/package/$APPBUNDLENAME" "$MACOSPWD/$($PRINTF "%s\n" "$BUILDNAME" | gawk '{gsub(" ","_"); print}')-$GITVER-$COMREV.dmg"

    else

        mv -f "$BUILD/build/$APPBUNDLENAME" "$MACOSPWD/$($PRINTF "%s\n" "$BUILDNAME" | gawk '{gsub(" ","_"); print}')-$GITVER-$COMREV.dmg"

    fi

    $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "App Bundle for $BUILDNAME is done. Look for \"$($PRINTF "%s\n" "$BUILDNAME" | gawk '{gsub(" ","_"); print}')-$GITVER-$COMREV.dmg\" in \"$MACOSPWD\" path."
}

appimage() {
    clear

    # Blocking access to this option for users that have OS other than Linux since AppImages are Linux exclusive.
    if [ "$OS" != "Linux" ] || [ -z "$(ldd --version 2>&1 | gawk '/Free Software Foundation/ {print}')" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Currently building AppImages is only available for Linux with glibc. Exiting."
        exit

    fi

    # We have to set this in order to make AppImage in Docker/Podman container.
    APPIMAGE=1

    checkuseropt

    # Set current working directory.
    LNXPWD="$(pwd)"

    choosebuild

    buildvar

    fetchupdatebuild

    choosebranchcommit

    preparebuild

    setsudo

    preparecontainer

    containerentry

    sudo_ping

    settrap

    containerrun

    cd "$BUILD/build/AppDir" || exit

    ICONSIZE=$(find "$BUILD/build/AppDir/usr/share/icons/hicolor" -mindepth 1 -maxdepth 1 2> /dev/null | gawk -F'/' '!/scalable/ {print $NF}' | head -n1)

    # Create symlinks that are specific for AppDir's structure.
    ln -sf "icon.png" ".DirIcon"
    ln -sf "usr/share/icons/hicolor/$ICONSIZE/apps/icon.png" "icon.png"
    ln -sf "usr/share/applications/app.desktop" "app.desktop"
    cd "$BUILD/build/AppDir/usr" || exit
    ln -sf "lib" "lib32"
    cd "$BUILD/build" || exit
    # Export commit revision name before creating AppImage.
    export VERSION="$GITVER-$(git -C "$BUILD" rev-parse --short HEAD)"

    # Build AppImageTool for NixOS
    if [ "$LNXOSNAME" = "NixOS" ]; then

        if [ "$BUILD" = "$BUILDPATH/srb2-2.0" ] || [ "$BUILD" = "$BUILDPATH/srb2-cb" ] || [ "$BUILD" = "$BUILDPATH/xsrb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ] || [ "$BUILD" = "$BUILDPATH/srb2-riders" ] || [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ] || [ "$BUILD" = "$BUILDPATH/sbb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-final-demo" ] || [ "$BUILD" = "$BUILDPATH/srb2-1095" ] || [ "$BUILD" = "$BUILDPATH/srb2-jte" ] || [ "$BUILD" = "$BUILDPATH/shufflarb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-live" ] || [ "$BUILD" = "$BUILDPATH/srb2-loz" ] || [ "$BUILD" = "$BUILDPATH/ssbss" ] || [ "$BUILD" = "$BUILDPATH/newmillennium" ]; then

            cat > "$BUILD/appimagetool.nix" << NIX
{ pkgs ? import <nixpkgs> { system = builtins.currentSystem; }
, appimageTools ? pkgs.appimageTools
}:
let
  pname = "appimagetool";
  version = "1.0";  # Replace with actual version
  src = ./appimagetool;  # Path to your AppImage file
in
appimageTools.wrapType2 {
  inherit pname version src;
  multiArch = true;  # Enable 32-bit support
  extraPkgs = pkgs: with pkgs; [
    pkgsi686Linux.zlib
  ];
}
NIX

        else

            cat > "$BUILD/appimagetool.nix" << NIX
{ pkgs ? import <nixpkgs> { system = builtins.currentSystem; }
, appimageTools ? pkgs.appimageTools
}:
let
  pname = "appimagetool";
  version = "1.0";  # Replace with your AppImage's actual version
  src = ./appimagetool;  # Path to your AppImage file
in
appimageTools.wrapType2 {
  inherit pname version src;
}
NIX

        fi

        nix build -vv --extra-experimental-features 'nix-command flakes' -f "$BUILD/appimagetool.nix"

        # Create AppImage from prepared AppDir.
        cd "$BUILD" || exit
        "$BUILD/build/result/bin/appimagetool" -n "$BUILD/build/AppDir"

    else

        # Create AppImage from prepared AppDir (package file is required to work).
        cd "$BUILD" || exit
        "$BUILD/appimagetool" -n "$BUILD/build/AppDir" 2> /dev/null

    fi

    # Set name of AppImage in message.
    APPIMAGENAME=$(find "$BUILD" -name "*.AppImage" 2> /dev/null | gawk -F'/' '{print $NF}')

    # Move created AppImage to working directory.
    mv -f "$BUILD/$APPIMAGENAME" "$LNXPWD" 2> /dev/null

    $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "AppImage for $BUILDNAME is done. Look for \"$APPIMAGENAME\" in \"$LNXPWD\" path. For NixOS users, please install appimage-run and use command \"appimage-run $APPIMAGENAME\"."
}

buildvar() {
    # Setting variables for build.
    if [ "$BUILD" = "$BUILDPATH/srb2" ]; then

        BUILDNAME="Sonic Robo Blast 2"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/STJr/SRB2.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-android" ]; then

        BUILDNAME="Sonic Robo Blast 2"
        GITDEFVER="android-port"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/SRB2-Mobile/SRB2-Android.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-android-bitten" ]; then

        BUILDNAME="Sonic Robo Blast 2 bitten"
        GITDEFVER="bitten-master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/bitten2up/SRB2-Android.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.2-classic" ]; then

        BUILDNAME="Sonic Robo Blast 2 v2.2 Classic"
        GITDEFVER="next"
        GITVER="$GITDEFVER"
        GITURL="https://codeberg.org/srb2classic/srb2classic.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.2-beta6" ]; then

        BUILDNAME="Sonic Robo Blast 2 v2.2 Beta 6"
        GITDEFVER="main"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/xdf22/SRB2-2.2-Beta6.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-uncapped-plus" ]; then

        BUILDNAME="Sonic Robo Blast 2 Uncapped PLUS"
        GITDEFVER="uncapped-plus"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/X.organic/SRB2-modified.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-netplus" ]; then

        BUILDNAME="Sonic Robo Blast 2 NetPlus"
        GITDEFVER="netplus"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/bitten2up/SRB2.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-reveries" ] || [ "$BUILD" = "$BUILDPATH/srb2-android-reveries" ]; then

        BUILDNAME="Sonic Robo Blast 2 Reveries"

        if [ "$BUILD" = "$BUILDPATH/srb2-android-reveries" ]; then

            GITDEFVER="reveries-mini"

        else

            GITDEFVER="cherry"

        fi

        GITVER="$GITDEFVER"
        GITURL="https://codeberg.org/cande/cherry.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-tsourdt3rd" ]; then

        BUILDNAME="Sonic Robo Blast 2 TSoURDt3rd"
        GITDEFVER="main"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/StarManiaKG/The-Story-of-Uncapped-Revengence-Discord-the-3rd.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-edit" ]; then

        BUILDNAME="Sonic Robo Blast 2 Edit"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/luigi-budd/SRB2-edit.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-ggj" ]; then

        BUILDNAME="Sonic Robo Blast 2 The Great Galactic Journey"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/chaoloveicemdboy/srb2ggj-public.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-destructive-illusion" ]; then

        BUILDNAME="Sonic Robo Blast 2 Destructive Illusion"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/manimi/SRB2.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-vr" ]; then

        BUILDNAME="Sonic Robo Blast 2 VR"
        GITDEFVER="vrmaster"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/chreas/srb-2-vr.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.1-legacy" ]; then

        BUILDNAME="Sonic Robo Blast 2 v2.1 Legacy"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/P-AS/srb2-legacy.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-fusion-advance" ]; then

        BUILDNAME="Sonic Robo Blast 2 Fusion Advance"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/SuperSRB2GamesZ/SRB2FusionAdvance.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-thokker" ]; then

        BUILDNAME="Sonic Robo Blast 2 Thokker"
        GITDEFVER="thokker"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/STJr/SRB2.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-top-down" ]; then

        BUILDNAME="Sonic Robo Blast 2 Top Down"
        GITDEFVER="mac"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/KartKrew/TD.git"

    elif [ "$BUILD" = "$BUILDPATH/sonic-smash-brawl" ]; then

        BUILDNAME="Sonic Smash Brawl"
        GITDEFVER="SONICSMASHBRAWL"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/Bijman/SRB2-Archive.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.0" ]; then

        BUILDNAME="Sonic Robo Blast 2 v2.0"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/STJr/SRB2-Public.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-cb" ]; then

        BUILDNAME="Sonic Robo Blast 2 Community Build"
        GITDEFVER="SRB2CB"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/Bijman/SRB2-Archive.git"

    elif [ "$BUILD" = "$BUILDPATH/xsrb2" ]; then

        BUILDNAME="X Sonic Robo Blast 2"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/Golden/SRB2SVN.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ]; then

        BUILDNAME="Sonic Robo Blast 2 SF94-Serv"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/Golden/SRB2SVN.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-riders" ]; then

        BUILDNAME="Sonic Robo Blast 2 Riders"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/Golden/SRB2SVN.git"

    elif [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ]; then

        BUILDNAME="Super Sonic Robo Blast 2 Kart Z"
        GITDEFVER="SUPERSRB2KARTZ"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/Bijman/SRB2-Archive.git"

    elif [ "$BUILD" = "$BUILDPATH/sbb2" ]; then

        BUILDNAME="Super Bomberman Blast 2"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/Golden/SRB2SVN.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-final-demo" ]; then

        BUILDNAME="Sonic Robo Blast 2 Final Demo"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/SteelT/SRB2-OLD.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-1095" ]; then

        BUILDNAME="Sonic Robo Blast 2 1095"
        GITDEFVER="main"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/CG64-2021/SRB2-1095.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-jte" ]; then

        BUILDNAME="Sonic Robo Blast 2 JTE"
        GITDEFVER="SRB2JTE"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/Bijman/SRB2-Archive.git"

    elif [ "$BUILD" = "$BUILDPATH/shufflarb2" ]; then

        BUILDNAME="ShufflarB2"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/Golden/SRB2SVN.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-live" ]; then

        BUILDNAME="Sonic Robo Blast 2 Live"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/Golden/SRB2SVN.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-loz" ]; then

        BUILDNAME="Sonic Robo Blast 2 LoZ"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/Golden/SRB2SVN.git"

    elif [ "$BUILD" = "$BUILDPATH/ssbss" ]; then

        BUILDNAME="Super Smash Bros Sonic Showdown"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/Golden/SRB2SVN.git"

    elif [ "$BUILD" = "$BUILDPATH/newmillennium" ]; then

        BUILDNAME="NewMillennium"
        GITDEFVER="main"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/saveas446/NewMillennium.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-persona" ]; then

        BUILDNAME="Sonic Robo Blast 2 Persona"
        GITDEFVER="srb2p_22"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/SinnamonLat/SRB2.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart" ]; then

        BUILDNAME="Sonic Robo Blast 2 Kart"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/KartKrew/Kart-Public.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-android" ]; then

        BUILDNAME="Sonic Robo Blast 2 Kart"
        GITDEFVER="android"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/bitten2up/Kart-Public.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-galaxy" ]; then

        BUILDNAME="Sonic Robo Blast 2 Kart Galaxy"
        GITDEFVER="Galaxy-Redux"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/Galactice/Kart-Public.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-hep" ]; then

        BUILDNAME="Sonic Robo Blast 2 Kart HEP"
        GITDEFVER="Glalxy"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/haya_/Kart-Public.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-saturn" ]; then

        BUILDNAME="Sonic Robo Blast 2 Kart Saturn"
        GITDEFVER="Saturn"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/Indev450/SRB2Kart-Saturn.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-neptune" ]; then

        BUILDNAME="Sonic Robo Blast 2 Kart Neptune"
        GITDEFVER="stacking"
        GITVER="$GITDEFVER"
        GITURL="https://codeberg.org/NepDisk/srb2k-neptune.git"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-vr" ]; then

        BUILDNAME="Sonic Robo Blast 2 Kart VR"
        GITDEFVER="openvr"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/chreas/kart-public-vr.git"

    elif [ "$BUILD" = "$BUILDPATH/blankart" ]; then

        BUILDNAME="BlanKart"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://codeberg.org/NepDisk/blankart.git"

    elif [ "$BUILD" = "$BUILDPATH/ring-racers" ]; then

        BUILDNAME="Ring Racers"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://gitlab.com/kart-krew-dev/ring-racers.git"

    elif [ "$BUILD" = "$BUILDPATH/ring-racers-android" ]; then

        BUILDNAME="Ring Racers"
        GITDEFVER="android"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/bitten2up/RingRacers.git"

    elif [ "$BUILD" = "$BUILDPATH/ring-racers-noire" ]; then

        BUILDNAME="Ring Racers Noire"
        GITDEFVER="Noire-Stable"
        GITVER="$GITDEFVER"
        GITURL="https://codeberg.org/NepDisk/RingRacers-Noire.git"

    elif [ "$BUILD" = "$BUILDPATH/ring-racers-hep" ]; then

        BUILDNAME="Ring Racers HEP"
        GITDEFVER="hep4"
        GITVER="$GITDEFVER"
        GITURL="https://gitlab.com/hayaunderscore/ring-racers.git"

    elif [ "$BUILD" = "$BUILDPATH/ring-racers-freaky-build" ]; then

        BUILDNAME="Ring Racers Freaky Build"
        GITDEFVER="freaky-build"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/FreakyMutantMan/RingRacers.git"

    elif [ "$BUILD" = "$BUILDPATH/radio-racers" ]; then

        BUILDNAME="Radio Racers"
        GITDEFVER="radioracers"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/blondedradio/RadioRacers.git"

    elif [ "$(dirname $BUILD)" = "$BUILDPATH/srb2-custom" ]; then

        BUILDNAME="Sonic Robo Blast 2 Custom $CUSTOMDIR"

    elif [ "$BUILD" = "$BUILDPATH/wadcli" ]; then

        BUILDNAME="wadcli"
        GITDEFVER="main"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/JugadorXEI/wadcli.git"

    elif [ "$BUILD" = "$BUILDPATH/kartmaker" ]; then

        BUILDNAME="kartmaker (SRB2 Kart)"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/BombchuLink/kartmaker.git"

    elif [ "$BUILD" = "$BUILDPATH/neptunefm" ]; then

        BUILDNAME="NeptuneFM (SRB2 Kart)"
        GITDEFVER="main"
        GITVER="$GITDEFVER"
        GITURL="https://codeberg.org/NepDisk/NeptuneFM.git"

    elif [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ]; then

        BUILDNAME="kartmaker (Ring Racers)"
        GITDEFVER="main"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/KartKrew/kartmaker.git"

    elif [ "$BUILD" = "$BUILDPATH/followermaker" ]; then

        BUILDNAME="followermaker (Ring Racers)"
        GITDEFVER="main"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/Superstarxalien/followermaker.git"

    elif [ "$BUILD" = "$BUILDPATH/slade" ]; then

        BUILDNAME="SLADE"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/sirjuddington/SLADE.git"

    elif [ "$BUILD" = "$BUILDPATH/ultimate-zone-builder" ]; then

        BUILDNAME="Ultimate Zone Builder"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/STJr/UltimateZoneBuilder.git"

    elif [ "$BUILD" = "$BUILDPATH/ultimate-gksz-builder" ]; then

        BUILDNAME="Ultimate GKSZ Builder"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/GLideKS/UltimateGKSZBuilder.git"

    elif [ "$BUILD" = "$BUILDPATH/ultimate-lowee-builder" ]; then

        BUILDNAME="Ultimate Lowee Builder"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://codeberg.org/NepDisk/UltimateLoweeBuilder.git"

    elif [ "$BUILD" = "$BUILDPATH/high-voltage-ring" ]; then

        BUILDNAME="High Voltage Ring"
        GITDEFVER="master"
        GITVER="$GITDEFVER"
        GITURL="https://git.do.srb2.org/KartKrew/high-voltage-ring.git"

    elif [ "$BUILD" = "$BUILDPATH/aseprite" ]; then

        BUILDNAME="Aseprite"
        GITDEFVER="main"
        GITVER="$GITDEFVER"
        GITURL="https://github.com/aseprite/aseprite.git"

    fi
}

choosebranchcommit() {
    GITDEFVER=$($PRINTF "%s\n" "$GITVER" | gawk '{print $NF}')

    if [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -t -| -t$| --tag -| --tag$/) {print substr($0, RSTART, RLENGTH)}')" ]; then

        GITVER=$(git -C "$BUILD" tag | tail -n1)

    else

        GITVER="$GITDEFVER"

    fi

    # Choose Git branch.
    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose branch by typing number and then pressing enter, or just press enter to continue with default branch, which is \"$GITVER\". To quit, press ctrl+c."
    $PRINTF "$NOTICE%s\n\e[0m" "WARNING: By choosing different branch other than default, compilation or running compiled build may fail."

    if [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -t -| -t$| --tag -| --tag$/) {print substr($0, RSTART, RLENGTH)}')" ]; then

        array=$(git -C "$BUILD" tag | gawk '!/^ |^'$(git -C "$BUILD" rev-parse --abbrev-ref HEAD)'$/ {gsub("^ |^* ",""); print}' | sort -V)
        arrayname=$($PRINTF "$(git -C "$BUILD" tag | gawk '!/^ |^'$(git -C "$BUILD" rev-parse --abbrev-ref HEAD)'$/ {gsub("^ ","\\e[1;92m* \\e[0m"); print}')\n" | sort -V)
        GITTYPE="tag"

    else

        array=$(git -C "$BUILD" branch -a | gawk -F'/' '!/->/ {print $NF}' | gawk '!/^ |^'$(git -C "$BUILD" rev-parse --abbrev-ref HEAD)'$/ {gsub("^ |^* ",""); print}')
        arrayname=$($PRINTF "$(git -C "$BUILD" branch -a | gawk -F'/' '!/->/ {print $NF}' | gawk '!/^ |^'$(git -C "$BUILD" rev-parse --abbrev-ref HEAD)'$/ {gsub("^ ","\\e[1;92m* \\e[0m"); print}')\n")
        GITTYPE="branch"
        COMMIT=1

    fi

    count="$($PRINTF "%s\n" "$array" | wc -l)"
    n=""
    $PRINTF "%s\n" "$arrayname" | gawk '{print NR")", $0}'
    while true; do

        $PRINTF "#? "
        read -r n

        if [ -n "$n" ] && [ "$n" -eq "$n" ] && [ "$n" -gt 0 ] && [ "$n" -le "$count" ]; then

            GITVER=$($PRINTF "%s\n" "$array" | gawk NR=="${n}")
            if [ -d "$BUILD/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Switching to $GITTYPE \"$GITVER\"."

                if [ -n "$GITVER" ]; then

                    git -C "$BUILD" checkout -q "$GITVER" --

                fi

            fi
            break

        else

            if [ -d "$BUILD/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Switching to $GITTYPE \"$GITVER\"."

                if [ -n "$GITVER" ]; then

                    git -C "$BUILD" checkout -q "$GITVER" --

                fi

            fi
            break

        fi

    done

    if [ "$COMMIT" = "1" ]; then

        # Choose Git commit.
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose commit by typing number and then pressing enter, or just press enter to continue with the latest commit, which is $(git -C $BUILD log --format=%h | head -n1). To quit, press ctrl+c."
        $PRINTF "$NOTICE%s\n\e[0m" "WARNING: By choosing different commit other than default, compilation or running compiled build may fail."
        sleep 2
        array="$(git -C "$BUILD" log --format="%h")"
        arrayname="$(GIT_PAGER="" git -C "$BUILD" log --format="%h (%s, %ad)")"
        count="$(echo "$array" | wc -l)"
        n=""
        echo "$arrayname" | gawk '{print NR")", $0}'
        while true; do

            $PRINTF "#? "
            read -r n

            if [ -n "$n" ] && [ "$n" -eq "$n" ] && [ "$n" -gt 0 ] && [ "$n" -le "$count" ]; then

                COMREV=$(echo "$array" | gawk NR=="${n}")
                if [ -d "$BUILD/.git" ]; then

                    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Switching to commit \"$COMREV\"."

                    if [ -n "$GITVER" ]; then

                        git -C "$BUILD" checkout -q "$COMREV"

                    fi

                fi
                break

            else

                if [ -d "$BUILD/.git" ]; then

                    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Switching to the latest commit on the branch \"$GITVER\"."

                    if [ -n "$GITVER" ]; then

                        git -C "$BUILD" checkout -q "$GITVER" --

                    fi

                fi
                break

            fi

        done

    fi
}

choosebuild() {
    clear

    checkuserid

    checkreadonly

    # Choose and download build.
    while

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose by typing number and then pressing enter. Press enter or ctrl+c to quit."
        for loop in "Build SRB2" "Build SRB2 v2.2 Classic" "Build SRB2 v2.2 Beta 6" "Build SRB2 Uncapped Plus" "Build SRB2 NetPlus" "Build SRB2 Reveries" "Build SRB2 TSoURDt3rd" "Build SRB2 Edit" "Build SRB2: The Great Galactic Journey" "Build SRB2 Destructive Illusion" "Build SRB2 VR" "Build SRB2 v2.1 Legacy" "Build SRB2 Fusion Advance" "Build SRB2 Thokker" "Build SRB2 Top Down" "Build Sonic Smash Brawl" "Build SRB2 v2.0" "Build SRB2 Community Build" "Build XSRB2" "Build SRB2 SF94-Serv" "Build SRB2 Riders" "Build Super SRB2 Kart Z" "Build Super Bomberman Blast 2" "Build SRB2 Final Demo" "Build SRB2 1095" "Build SRB2 JTE" "Build ShufflarB2" "Build SRB2 Live" "Build SRB2 LoZ" "Build Super Smash Bros: Sonic Showdown" "Build NewMillennium" "Build SRB2 Persona" "Build SRB2 Kart" "Build SRB2 Kart Galaxy" "Build SRB2 Kart HEP" "Build SRB2 Kart Saturn" "Build SRB2 Kart Neptune" "Build SRB2 Kart VR" "Build BlanKart" "Build Ring Racers" "Build Ring Racers Noire" "Build Ring Racers HEP" "Build Ring Racers Freaky Build" "Build Radio Racers" "Build SRB2 Custom" "Build wadcli" "Build kartmaker (SRB2 Kart)" "Build NeptuneFM (SRB2 Kart)" "Build kartmaker (Ring Racers)" "Build followermaker (Ring Racers)" "Build SLADE" "Build Ultimate Zone Builder" "Build Ultimate GKSZ Builder" "Build Ultimate Lowee Builder" "Build High Voltage Ring" "Build Aseprite with Kart Builder"; do $PRINTF "%s\n" "$((i += 1))) $loop"; done
        $PRINTF "#? "
        read -r choose
    do

        unset i
        case "$choose" in

            "1")

                BUILD="$BUILDPATH/srb2"
                break

                ;;

            "2")

                BUILD="$BUILDPATH/srb2-2.2-classic"
                break

                ;;

            "3")

                BUILD="$BUILDPATH/srb2-2.2-beta6"
                break

                ;;

            "4")

                BUILD="$BUILDPATH/srb2-uncapped-plus"
                break

                ;;

            "5")

                BUILD="$BUILDPATH/srb2-netplus"
                break

                ;;

            "6")

                BUILD="$BUILDPATH/srb2-reveries"
                break

                ;;

            "7")

                BUILD="$BUILDPATH/srb2-tsourdt3rd"
                break

                ;;

            "8")

                BUILD="$BUILDPATH/srb2-edit"
                break

                ;;

            "9")

                BUILD="$BUILDPATH/srb2-ggj"
                break

                ;;

            "10")

                BUILD="$BUILDPATH/srb2-destructive-illusion"
                break

                ;;

            "11")

                BUILD="$BUILDPATH/srb2-vr"
                break

                ;;

            "12")

                BUILD="$BUILDPATH/srb2-2.1-legacy"
                break

                ;;

            "13")

                BUILD="$BUILDPATH/srb2-fusion-advance"
                break

                ;;

            "14")

                BUILD="$BUILDPATH/srb2-thokker"
                break

                ;;

            "15")

                BUILD="$BUILDPATH/srb2-top-down"
                break

                ;;

            "16")

                BUILD="$BUILDPATH/sonic-smash-brawl"
                break

                ;;

            "17")

                BUILD="$BUILDPATH/srb2-2.0"
                break

                ;;

            "18")

                BUILD="$BUILDPATH/srb2-cb"
                break

                ;;

            "19")

                BUILD="$BUILDPATH/xsrb2"
                break

                ;;

            "20")

                BUILD="$BUILDPATH/srb2-sf94-serv"
                break

                ;;

            "21")

                BUILD="$BUILDPATH/srb2-riders"
                break

                ;;

            "22")

                BUILD="$BUILDPATH/super-srb2-kart-z"
                break

                ;;

            "23")

                BUILD="$BUILDPATH/sbb2"
                break

                ;;

            "24")

                BUILD="$BUILDPATH/srb2-final-demo"
                break

                ;;

            "25")

                BUILD="$BUILDPATH/srb2-1095"
                break

                ;;

            "26")

                BUILD="$BUILDPATH/srb2-jte"
                break

                ;;

            "27")

                BUILD="$BUILDPATH/shufflarb2"
                break

                ;;

            "28")

                BUILD="$BUILDPATH/srb2-live"
                break

                ;;

            "29")

                BUILD="$BUILDPATH/srb2-loz"
                break

                ;;

            "30")

                BUILD="$BUILDPATH/ssbss"
                break

                ;;

            "31")

                BUILD="$BUILDPATH/newmillennium"
                break

                ;;

            "32")

                BUILD="$BUILDPATH/srb2-persona"
                break

                ;;

            "33")

                BUILD="$BUILDPATH/srb2-kart"
                break

                ;;

            "34")

                BUILD="$BUILDPATH/srb2-kart-galaxy"
                break

                ;;

            "35")

                BUILD="$BUILDPATH/srb2-kart-hep"
                break

                ;;

            "36")

                BUILD="$BUILDPATH/srb2-kart-saturn"
                break

                ;;

            "37")

                BUILD="$BUILDPATH/srb2-kart-neptune"
                break

                ;;

            "38")

                BUILD="$BUILDPATH/srb2-kart-vr"
                break

                ;;

            "39")

                BUILD="$BUILDPATH/blankart"
                break

                ;;

            "40")

                BUILD="$BUILDPATH/ring-racers"
                break

                ;;

            "41")

                BUILD="$BUILDPATH/ring-racers-noire"
                break

                ;;

            "42")

                BUILD="$BUILDPATH/ring-racers-hep"
                break

                ;;

            "43")

                BUILD="$BUILDPATH/ring-racers-freaky-build"
                break

                ;;

            "44")

                BUILD="$BUILDPATH/radio-racers"
                break

                ;;

            "45")

                custombuild
                break

                ;;

            "46")

                BUILD="$BUILDPATH/wadcli"
                break

                ;;

            "47")

                BUILD="$BUILDPATH/kartmaker"
                break

                ;;

            "48")

                BUILD="$BUILDPATH/neptunefm"
                break

                ;;

            "49")

                BUILD="$BUILDPATH/kartmaker-ring-racers"
                break

                ;;

            "50")

                BUILD="$BUILDPATH/followermaker"
                break

                ;;

            "51")

                BUILD="$BUILDPATH/slade"
                break

                ;;

            "52")

                BUILD="$BUILDPATH/ultimate-zone-builder"
                break

                ;;

            "53")

                BUILD="$BUILDPATH/ultimate-gksz-builder"
                break

                ;;

            "54")

                BUILD="$BUILDPATH/ultimate-lowee-builder"
                break

                ;;

            "55")

                BUILD="$BUILDPATH/high-voltage-ring"
                break

                ;;

            "56")

                BUILD="$BUILDPATH/aseprite"
                break

                ;;

            *)

                $PRINTF "$NOTICE\n%s\n\e[0m" "No option has been chosen."
                exit

                ;;

        esac

    done
}

chooseandroidbuild() {
    clear

    checkuserid

    checkreadonly

    # Choose and download build.
    while

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose by typing number and then pressing enter. Press enter or ctrl+c to quit."
        for loop in "Build SRB2" "Build SRB2 bitten" "Build SRB2 Reveries" "Build SRB2 Kart" "Build Ring Racers" "Build SRB2 Custom"; do $PRINTF "%s\n" "$((i += 1))) $loop"; done
        $PRINTF "#? "
        read -r choose
    do

        unset i
        case "$choose" in

            "1")

                BUILD="$BUILDPATH/srb2-android"
                break

                ;;

            "2")

                BUILD="$BUILDPATH/srb2-android-bitten"
                break

                ;;

            "3")

                BUILD="$BUILDPATH/srb2-android-reveries"
                break

                ;;

            "4")

                BUILD="$BUILDPATH/srb2-kart-android"
                break

                ;;

            "5")

                BUILD="$BUILDPATH/ring-racers-android"
                break

                ;;

            "6")

                custombuild
                break
                ;;

            *)

                $PRINTF "$NOTICE\n%s\n\e[0m" "No option has been chosen."
                exit

                ;;

        esac

    done
}

chooseinstall() {
    clear

    # Install build.
    if [ "$OS" != "Linux" ] && [ "$OS" != "Darwin" ] && [ "$OS" != "Windows" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Currently building and installing is only available for Linux, macOS and Windows. Exiting."
        exit

    fi

    choosebuild

    buildvar

    fetchupdatebuild

    choosebranchcommit

    preparebuild

    setsudo

    settrap

    # Check whether SDKROOT environment variable is set or not.
    if [ "$OS" = "Darwin" ]; then

        if [ -z "$SDKROOT" ]; then

            $PRINTF "$FAILURE%s\n\e[0m" "ERROR: No SDKROOT is set. Add SDKROOT environment variable to macOS SDK full path. Usually macOS .sdk file is located in /Library/Developer/CommandLineTools/SDKs path, if you installed Homebrew. Exiting."
            exit

        fi

        installtomacos

        installtolist

    else

        preparecontainer

        containerentry

        if [ "$OS" = "Linux" ]; then

            sudo_ping

        fi

        containerrun

    fi

    if [ "$OS" = "Windows" ]; then

        installtowindows

        installtolist

    elif [ "$OS" = "Linux" ]; then

        installtolinux

    fi
}

chooseremoveasset() {
    if [ -z "$(find "$SRB2BLDROOT/assets" -mindepth 1 -type f 2> /dev/null)" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Can't find assets."
        exit

    fi

    # Remove asset.
    while true; do

        clear
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose asset by typing number and then pressing enter. Press enter or ctrl+c to quit."
        array=$(find "$SRB2BLDROOT/assets" -mindepth 1 -maxdepth 1 -type f 2> /dev/null | sort)
        arrayname=$($PRINTF "%s\n" "$array" | gawk -F'/' '{print $NF}')
        count="$($PRINTF "%s\n" "$array" | wc -l)"
        n=""
        $PRINTF "%s\n" "$arrayname" | gawk '{print NR")", $0}'
        $PRINTF "#? "
        read -r n

        if [ -n "$n" ] && [ "$n" -eq "$n" ] && [ "$n" -gt 0 ] && [ "$n" -le "$count" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Are you sure you want to remove this asset? Enter \"yes/Yes\" or \"no/No\" (\"y/Y\" or \"n/N\")."
            $PRINTF "$PROMPT\n%s\e[0m" "> "
            read -r CONFIRM

            if [ "$CONFIRM" = y ] || [ "$CONFIRM" = Y ] || [ "$CONFIRM" = yes ] || [ "$CONFIRM" = Yes ]; then

                SRB2ASSETLNXPATH=$($PRINTF "%s\n" "$array" | gawk NR=="${n}")
                SRB2ASSETLNXNAME=$($PRINTF "%s\n" "$arrayname" | gawk NR=="${n}")
                rm -fv "$SRB2ASSETLNXPATH"
                $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Removing $SRB2ASSETLNXNAME is successful."

            fi

            exec "$0" --removeasset

        else

            $PRINTF "$NOTICE\n%s\n\e[0m" "No option has been chosen."
            exit

        fi

    done
}

chooseremovebuild() {
    if [ -z "$(find "$SRB2BLDROOT/builds" -mindepth 1 -maxdepth 1 -type d 2> /dev/null)" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Can't find builds."
        exit

    fi

    # Remove build.
    while true; do

        clear
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose build by typing number and then pressing enter. Press enter or ctrl+c to quit."
        array=$(find "$SRB2BLDROOT/builds" -mindepth 1 -maxdepth 1 -type d 2> /dev/null | sort)
        arrayname=$($PRINTF "%s\n" "$array" | gawk -F'/' '{print $NF}')
        count="$($PRINTF "%s\n" "$array" | wc -l)"
        n=""
        $PRINTF "%s\n" "$arrayname" | gawk '{print NR")", $0}'
        $PRINTF "#? "
        read -r n

        if [ -n "$n" ] && [ "$n" -eq "$n" ] && [ "$n" -gt 0 ] && [ "$n" -le "$count" ]; then

            if [ "$($PRINTF "%s\n" "$array" | gawk NR=="${n}" | gawk -F'/' '{print $NF}')" = "srb2-custom" ]; then

                while true; do

                    clear
                    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose custom build by typing number and then pressing enter. Press enter or ctrl+c to quit."
                    array=$($PRINTF "$(find "$SRB2BLDROOT/builds/srb2-custom" -mindepth 1 -maxdepth 1 -type d 2> /dev/null | sort)\nBack" | gawk 'NF{print}')
                    arrayname=$($PRINTF "$array" | gawk -F'/' '{print $NF}')
                    count="$($PRINTF "%s\n" "$array" | wc -l)"
                    n=""
                    $PRINTF "%s\n" "$arrayname" | gawk '{print NR")", $0}'
                    $PRINTF "#? "
                    read -r n

                    if [ -n "$n" ] && [ "$n" -eq "$n" ] && [ "$n" -gt 0 ] && [ "$n" -le "$count" ]; then

                        if [ "$($PRINTF "%s\n" "$array" | gawk NR=="${n}" | gawk -F'/' '{print $NF}')" = "Back" ]; then

                            exec "$0" --removebuild

                        fi

                        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Are you sure you want to remove this build's directory? Enter \"yes/Yes\" or \"no/No\" (\"y/Y\" or \"n/N\")."
                        $PRINTF "$PROMPT\n%s\e[0m" "> "
                        read -r CONFIRM

                        if [ "$CONFIRM" = y ] || [ "$CONFIRM" = Y ] || [ "$CONFIRM" = yes ] || [ "$CONFIRM" = Yes ]; then

                            BUILDPATH=$($PRINTF "%s\n" "$array" | gawk NR=="${n}")
                            BUILDNAME=$($PRINTF "%s\n" "$arrayname" | gawk NR=="${n}")
                            rm -rfv "$BUILDPATH"
                            unset BUILDPATH

                            if [ -z "$(find "$SRB2BLDROOT/builds/srb2-custom" -mindepth 1 -maxdepth 1 -type d 2> /dev/null)" ]; then

                                rm -rfv "$SRB2BLDROOT/builds/srb2-custom"

                            fi

                            $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Removing $BUILDNAME is successful."

                        fi

                    else

                        $PRINTF "$NOTICE\n%s\n\e[0m" "No option has been chosen."
                        exit

                    fi

                done

            fi

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Are you sure you want to remove this build? Enter \"yes/Yes\" or \"no/No\" (\"y/Y\" or \"n/N\")."
            $PRINTF "$PROMPT\n%s\e[0m" "> "
            read -r CONFIRM

            if [ "$CONFIRM" = y ] || [ "$CONFIRM" = Y ] || [ "$CONFIRM" = yes ] || [ "$CONFIRM" = Yes ]; then

                BUILDPATH=$($PRINTF "%s\n" "$array" | gawk NR=="${n}")
                BUILDNAME=$($PRINTF "%s\n" "$arrayname" | gawk NR=="${n}")
                rm -rfv "$BUILDPATH"
                $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Removing $BUILDNAME is successful."

            fi

            exec "$0" --removebuild

        else

            $PRINTF "$NOTICE\n%s\n\e[0m" "No option has been chosen."
            exit

        fi

    done
}

chooseremovedep() {
    setsudo

    if [ -z "$(find "$SRB2BLDROOT/libraries" -mindepth 1 -maxdepth 1 -type d 2> /dev/null)" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Can't find dependencies."
        exit

    fi

    # Remove dependencies for build, which were compiled from Docker/Podman container.
    while true; do

        clear
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose asset by typing number and then pressing enter. Press enter or ctrl+c to quit."
        array=$(find "$SRB2BLDROOT/libraries" -mindepth 1 -maxdepth 1 2> /dev/null | gawk -F'/' '{print $NF}' | sort)
        arrayname="$array"
        count="$($PRINTF "%s\n" "$array" | wc -l)"
        n=""
        $PRINTF "%s\n" "$arrayname" | gawk '{print NR")", $0}'
        $PRINTF "#? "
        read -r n

        if [ -n "$n" ] && [ "$n" -eq "$n" ] && [ "$n" -gt 0 ] && [ "$n" -le "$count" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Are you sure you want to remove this dependency? Enter \"yes/Yes\" or \"no/No\" (\"y/Y\" or \"n/N\")."
            $PRINTF "$PROMPT\n%s\e[0m" "> "
            read -r CONFIRM

            if [ "$CONFIRM" = y ] || [ "$CONFIRM" = Y ] || [ "$CONFIRM" = yes ] || [ "$CONFIRM" = Yes ]; then

                SRB2DEPLNXNAME=$($PRINTF "%s\n" "$arrayname" | gawk NR=="${n}")

                if [ -d "$SRB2BLDPREFIX/stow/$SRB2DEPLNXNAME" ]; then

                    cd "$SRB2BLDPREFIX/stow" || exit
                    $SUDO stow -Dv "$SRB2DEPLNXNAME"

                fi

                if [ "$OS" = "Windows" ]; then

                    rm -rfv "$SRB2BLDPREFIX/stow/$SRB2DEPLNXNAME" "$SRB2BLDROOT/libraries/$SRB2DEPLNXNAME"

                else

                    $SUDO rm -rfv "$SRB2BLDPREFIX/stow/$SRB2DEPLNXNAME" "$SRB2BLDROOT/libraries/$SRB2DEPLNXNAME"

                fi

                $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Removing $SRB2DEPLNXNAME is successful."

            fi

            exec "$0" --removedep

        else

            $PRINTF "$NOTICE\n%s\n\e[0m" "No option has been chosen."
            exit

        fi

    done
}

uninstall() {
    if [ "$OS" = "Windows" ]; then

        gawk -i inplace -v RS= '{gsub("---------------\n.*|---------------",""); print}' "$BUILDINSTALLED"

        while read -r FILE; do
            rm -rfv "$FILE"
        done < "$BUILDINSTALLED"

        rm -f "$BUILDINSTALLED"

        if [ -z "$(find "$HOME/SRB2 Games" -mindepth 1 -maxdepth 1 2> /dev/null | head -n1)" ]; then

            rm -rfv "$HOME/SRB2 Games"

        elif [ -z "$(find "$HOME/SRB2 Software" -mindepth 1 -maxdepth 1 2> /dev/null | head -n1)" ]; then

            rm -rfv "$HOME/SRB2 Software"

        fi

        $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Uninstallation of $($PRINTF "%s\n" "$BUILDINSTALLED" | gawk -F'/' '{print $NF}') is successful."

    else

        SRB2BLDPREFIX="$(gawk 'match($0, /\/nix\/store|\/usr\/local|\/home\/'$USER'\/.local|\/home\/'$USER'\/Local|\/home\/'$USER'\/SRB2 Games|\/home\/'$USER'\/SRB2 Software/) {print substr($0, RSTART, RLENGTH)}' "$BUILDINSTALLED" | head -n1)"

        gawk -i inplace -v RS= '{gsub("---------------\n.*|---------------",""); print}' "$BUILDINSTALLED"

        setsudo

        if [ "$LNXOSNAME" = "NixOS" ]; then

            if [ "$($SUDO nix profile list --extra-experimental-features 'nix-command flakes' | gawk '/'$(head -n1 "$BUILDINSTALLED" | gawk '{gsub("/","\\/"); print}')'/ {print $NF}')" ]; then

                $SUDO nix profile remove $(head -n1 "$BUILDINSTALLED") --extra-experimental-features 'nix-command flakes'

            else

                nix profile remove $(head -n1 "$BUILDINSTALLED") --extra-experimental-features 'nix-command flakes'

            fi

        else

            while read -r FILE; do
                $SUDO rm -rfv "$FILE"
            done < "$BUILDINSTALLED"

        fi

        rm -f "$BUILDINSTALLED"

        if [ -z "$(find $SRB2BLDPREFIX -mindepth 1 -maxdepth 1 2> /dev/null | head -n1)" ]; then

            $SUDO rm -rfv "$SRB2BLDPREFIX"

        fi

        # Refreshing menu icons.
        if [ "$OS" = "Linux" ] || [ "$LNXOSNAME" != "NixOS" ]; then

            if [ -x "$(command -v gtk-update-icon-cache 2> /dev/null)" ]; then

                $SUDO gtk-update-icon-cache -qft "$SRB2BLDPREFIX/share/icons/hicolor"

            elif [ -x "$(find /usr/bin -name "kbuildsycoca*" -mindepth 1 -maxdepth 1 2> /dev/null | head -n1)" ]; then

                $SUDO "$(find /usr/bin -name "kbuildsycoca*" -mindepth 1 -maxdepth 1 2> /dev/null | head -n1)" --noincremental

            fi

        fi

        $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Uninstallation of $($PRINTF "%s\n" "$BUILDINSTALLED" | gawk -F'/' '{print $NF}') is successful."

    fi
}

chooseuninstall() {
    if [ -z "$(find "$SRB2BLDROOT/installed" -mindepth 1 -type f 2> /dev/null)" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Can't find installed builds."
        exit

    fi

    # Uninstall build from the system.
    while true; do

        clear
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose installed package by typing number and then pressing enter. Press enter or ctrl+c to quit."
        array=$(find "$SRB2BLDROOT/installed" -mindepth 1 -maxdepth 1 2> /dev/null | sort)
        arrayname=$($PRINTF "%s\n" "$array" | gawk -F'/' '{print $NF}')
        count="$($PRINTF "%s\n" "$array" | wc -l)"
        n=""
        $PRINTF "%s\n" "$arrayname" | gawk '{print NR")", $0}'
        $PRINTF "#? "
        read -r n

        if [ -n "$n" ] && [ "$n" -eq "$n" ] && [ "$n" -gt 0 ] && [ "$n" -le "$count" ]; then

            if [ "$($PRINTF "%s\n" "$array" | gawk NR=="${n}" | gawk -F'/' '{print $NF}')" = "srb2-custom" ]; then

                while true; do

                    clear
                    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose custom build by typing number and then pressing enter. Press enter or ctrl+c to quit."
                    array=$($PRINTF "$(find "$SRB2BLDROOT/installed/srb2-custom" -mindepth 1 -maxdepth 1 -type f 2> /dev/null | sort)\nBack" | gawk 'NF{print}')
                    arrayname=$($PRINTF "$array" | gawk -F'/' '{print $NF}')
                    count="$($PRINTF "%s\n" "$array" | wc -l)"
                    n=""
                    $PRINTF "%s\n" "$arrayname" | gawk '{print NR")", $0}'
                    $PRINTF "#? "
                    read -r n

                    if [ -n "$n" ] && [ "$n" -eq "$n" ] && [ "$n" -gt 0 ] && [ "$n" -le "$count" ]; then

                        if [ "$($PRINTF "%s\n" "$array" | gawk NR=="${n}" | gawk -F'/' '{print $NF}')" = "Back" ]; then

                            exec "$0" --uninstall

                        fi

                        BUILDINSTALLED=$($PRINTF "%s\n" "$array" | gawk NR=="${n}")
                        INSTALLEDFILES=$(gawk '/\/nix\/store|\/usr\/local|\/home\/'$USER'\/.local|\/home\/'$USER'\/Local|\/home\/'$USER'\/SRB2 Games|\/home\/'$USER'\/SRB2 Software|\/Start Menu\/Programs/ {print}' "$BUILDINSTALLED")
                        $PRINTF "$PROMPT\n%s\n\e[0m" "$INSTALLEDFILES"
                        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Above files will be uninstalled. Are you sure you want to that? Enter \"yes/Yes\" or \"no/No\" (\"y/Y\" or \"n/N\")."
                        $PRINTF "$PROMPT\n%s\e[0m" "> "
                        read -r CONFIRM

                        if [ "$CONFIRM" = y ] || [ "$CONFIRM" = Y ] || [ "$CONFIRM" = yes ] || [ "$CONFIRM" = Yes ]; then

                            uninstall

                            if [ -z "$(find "$SRB2BLDROOT/installed/srb2-custom" -mindepth 1 -maxdepth 1 -type f 2> /dev/null)" ]; then

                                rm -rfv "$SRB2BLDROOT/installed/srb2-custom"

                            fi

                            $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Removing $BUILDNAME is successful."

                        fi

                    else

                        $PRINTF "$NOTICE\n%s\n\e[0m" "No option has been chosen."
                        exit

                    fi

                done

            fi

            BUILDINSTALLED=$($PRINTF "%s\n" "$array" | gawk NR=="${n}")
            INSTALLEDFILES=$(gawk '/\/nix\/store|\/usr\/local|\/home\/'$USER'\/.local|\/home\/'$USER'\/Local|\/home\/'$USER'\/SRB2 Games|\/home\/'$USER'\/SRB2 Software|\/Start Menu\/Programs/ {print}' "$BUILDINSTALLED")
            $PRINTF "$PROMPT\n%s\n\e[0m" "$INSTALLEDFILES"
            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Above files will be uninstalled. Are you sure you want to that? Enter \"yes/Yes\" or \"no/No\" (\"y/Y\" or \"n/N\")."
            $PRINTF "$PROMPT\n%s\e[0m" "> "
            read -r CONFIRM

            uninstall

            exec "$0" --uninstall

        else

            $PRINTF "$NOTICE\n%s\n\e[0m" "No option has been chosen."
            exit

        fi

    done
}

cleansource() {
    # Clean build's directory after compiling.
    git -C "$BUILD" submodule foreach --recursive git clean -qdffx -e .comrev
    git -C "$BUILD" submodule foreach --recursive git reset -q --hard
    git -C "$BUILD" clean -qdffx -e .comrev
    git -C "$BUILD" reset -q --hard

    if [ "$LNXOSNAME" = "NixOS" ]; then

        rm -rf "$NIXOSFLAKEBUILDPATH"

    fi
}

compatibility() {
    clear

    # Show compatibility table for compiling SRB2 builds for each OS.
    curl -sL "$COMPTABLEURL"
    $PRINTF "%s\n"
}

containerentry() {
    # Prepare containers path.
    if [ ! -d "$SRB2BLDROOT/containers/srb2-games-linux-glibc-container" ]; then

        mkdir -p "$SRB2BLDROOT/containers/srb2-games-linux-glibc-container"

    fi

    # Create entrypoint shell script for Docker/Podman container.
    cat > "$SRB2BLDROOT/containers/srb2-games-linux-glibc-container/Entrypoint" << ENTRYPOINT
#!/bin/sh

    if [ "$SRB2BLDDEBUG" = "1" ]; then

        set -e -x +f

    else

        set -e +f

    fi

    # Added environment variables for Docker/Podman container.
    export HOSTUSER="$USER"
    export ARGS="$ARGS"
    export PRINTF=\$(which -a printf 2> /dev/null | gawk '/bin/ {print}' | head -n1)
    export ARCH="$ARCH"
    export OS="$OS"
    export WINOS="$WINOS"
    export NCPU="$NCPU"
    export LNXOSNAME="$LNXOSNAME"
    export IS64="$IS64"
    export ISREADONLY="$ISREADONLY"
    export ISNET="$ISNET"
    export LIBC="$LIBC"
    export CONFIG_SHELL="/bin/bash"
    export OSVIRT=\$(\$PRINTF "%s\n" "$OSVIRT" | gawk 'match(\$0, /docker|podman/) {print substr(\$0, RSTART, RLENGTH)}')
    export SRB2BLDROOT="$SRB2BLDROOT"
    export HOSTUSERID=\$(ls -ld "\$SRB2BLDROOT" | gawk '{print \$3}')
    export BUILDPATH="$BUILDPATH"
    export BUILD="$BUILD"
    export BUILDMAIN="$BUILD"
    export CUSTOMDIR="$CUSTOMDIR"
    export GITOPTS="$GITOPTS"
    export GITVERCONF="$GITVERCONF"
    export GITVER="$GITVER"
    export GITDEFVER="$GITDEFVER"
    export GITHUB_TOKEN="$GITHUB_TOKEN"
    export FILETYPE="$FILETYPE"
    export SRB2ASSETURL="$SRB2ASSETURL"
    export SRB2CLASSICASSETURL="$SRB2CLASSICASSETURL"
    export SRB2BETAASSETURL="$SRB2BETAASSETURL"
    export SRB2REVERIESASSETURL="$SRB2REVERIESASSETURL"
    export SRB2TSOURDT3RDASSETURL="$SRB2TSOURDT3RDASSETURL"
    export SRB2GGJASSETURL="$SRB2GGJASSETURL"
    export SRB2DESTRUCTIVEILLUSIONASSETURL="$SRB2DESTRUCTIVEILLUSIONASSETURL"
    export SRB2VRASSETURL="$SRB2VRASSETURL"
    export SRB2LEGACYASSETURL="$SRB2LEGACYASSETURL"
    export SRB2THOKKERASSETURL="$SRB2THOKKERASSETURL"
    export SRB2TOPDOWNASSET1URL="$SRB2TOPDOWNASSET1URL"
    export SRB2TOPDOWNASSET2URL="$SRB2TOPDOWNASSET2URL"
    export SONICSMASHBRAWLASSET1URL="$SONICSMASHBRAWLASSET1URL"
    export SONICSMASHBRAWLASSET2URL="$SONICSMASHBRAWLASSET2URL"
    export SRB220ASSETURL="$SRB220ASSETURL"
    export SRB2CBASSETURL="$SRB2CBASSETURL"
    export SRB2RIDERSMUSICASSETURL="$SRB2RIDERSMUSICASSETURL"
    export SUPERSRB2KARTZASSETURL="$SUPERSRB2KARTZASSETURL"
    export SRB2FINALDEMOASSETURL="$SRB2FINALDEMOASSETURL"
    export SRB21095ASSETURL="$SRB21095ASSETURL"
    export SRB2JTEASSETURL="$SRB2JTEASSETURL"
    export NEWMILLENNIUMASSETURL="$NEWMILLENNIUMASSETURL"
    export SRB2PERSONAASSETURL="$SRB2PERSONAASSETURL"
    export SRB2KARTASSETURL="$SRB2KARTASSETURL"
    export SRB2KARTHEPASSETURL="$SRB2KARTHEPASSETURL"
    export SRB2KARTSATURNASSETURL="$SRB2KARTSATURNASSETURL"
    export SRB2KARTNEPTUNEASSETURL="$SRB2KARTNEPTUNEASSETURL"
    export BLANKARTASSETURL="$BLANKARTASSETURL"
    export RINGRACERSASSETURL="$RINGRACERSASSETURL"
    export RADIORACERSASSETURL="$RADIORACERSASSETURL"
    export SRB2BLDDEVMODE="$SRB2BLDDEVMODE"
    export SRB2BLDGITVER="$SRB2BLDGITVER"
    export SRB2BLDASSETPATH="$SRB2BLDASSETPATH"
    export SRB2BLDEXTRAASSETPATH="$SRB2BLDEXTRAASSETPATH"
    export ASSETAPPDIR="$ASSETAPPDIR"
    export ANDROID="$ANDROID"
    export APPIMAGE="$APPIMAGE"
    export FLATPAK="$FLATPAK"
    export CROSS="$CROSS"
    export WINPORTABLE="$WINPORTABLE"
    export COMMIT="$COMMIT"
    export UPGRADEBUILD="$UPGRADEBUILD"
    export GCCVER="$GCCVER"
    export GXXVER="$GXXVER"
    export GCCOLDVER="$GCCOLDVER"
    export GXXOLDVER="$GXXOLDVER"
    export RINGRACERSGCCVER="$RINGRACERSGCCVER"
    export RINGRACERSGXXVER="$RINGRACERSGXXVER"
    export SLADEGCCOLDVER="$SLADEGCCOLDVER"
    export SLADEGXXOLDVER="$SLADEGXXOLDVER"
    export MINGWCCVER="$MINGWCCVER"
    export MINGWCXXVER="$MINGWCXXVER"
    export MINGWOLDCCVER="$MINGWOLDCCVER"
    export MINGWOLDCXXVER="$MINGWOLDCXXVER"
    export STOW_DIR="$SRB2BLDPREFIX/stow"
    export CCACHE_DIR="$CCACHE_DIR"
    export GRADLE_USER_HOME="$GRADLE_USER_HOME"
    export VCPKG_ROOT="$VCPKG_ROOT"
    export CMAKEPOLVER="$CMAKEPOLVER"

    # Set prefix path to /usr to make sure files within AppImage can be found.
    if [ "\$APPIMAGE" = "1" ] || [ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ] || [ "\$WINPORTABLE" = "1" ] || [ "\$LNXOSNAME" = "NixOS" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ] || [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

        export SRB2BLDPREFIX="/usr"

    else

        export SRB2BLDPREFIX="$SRB2BLDPREFIX"

    fi

    export LIBRARY_PATH="\$SRB2BLDPREFIX/lib"
    export PKG_CONFIG_PATH="\$SRB2BLDPREFIX/lib/pkgconfig"
    export PATH="\$SRB2BLDROOT/libraries/depot_tools:\$SRB2BLDPREFIX/bin:\$PATH"
    export DEBIAN_FRONTEND="noninteractive"
    export SRB2BLDNOCCACHE="$SRB2BLDNOCCACHE"

    # Remove musl variable for Ultimate Zone Builder and High Voltage Ring to compile in glibc environment.
    if [ "\$LIBC" = "musl" ] && ([ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ] || [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]); then

        unset LIBC

    fi

    # Add -lexecinfo to LDFLAGS for musl based Linux OS to make building successful.
    if [ "\$LIBC" = "musl" ]; then

        export LDFLAGS="\$LDFLAGS -lexecinfo"

    fi

    # Some old Docker/Podman images don't have up-to-date SSL certifications, so this is workaround.
    # export GIT_SSL_NO_VERIFY=1

    # Fixes issue "method https has died unexpectedly", when installing package from https repository.
    export GNUTLS_CPUID_OVERRIDE="0x1"

    if [ "\$SRB2BLDNOCCACHE" != "1" ]; then

        # Setting paths to ccache compilers, in order to speed up compiling.
        if [ "\$LIBC" = "musl" ]; then

            export CCACHE_BIN_PATH="/usr/lib/ccache/bin/"

        else

            export CCACHE_BIN_PATH="/usr/lib/ccache/"

        fi

    fi

    # Alias for curl with set GITHUB_TOKEN, if you encounter rate limiting after some amount using GitHub's API requests.
    if [ -n "\$GITHUB_TOKEN" ]; then

        alias curl="curl -u :\$GITHUB_TOKEN"

    else

        alias curl="curl"

    fi

    # Correcting compiled library permissions when running -u/--user or having read-only filesystem.
    if [ "\$WINOS" != "1" ]; then

        if [ "\$OSVIRT" = "podman" ] && ([ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDPREFIX" | gawk 'match(\$0, /\/home\/'\$HOSTUSER'\/.local/) {print substr(\$0, RSTART, RLENGTH)}')" ] || [ -n "\$ISREADONLY" ]) && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$ANDROID" != "1" ]); then

            sudo find -L "\$SRB2BLDPREFIX/bin" "\$SRB2BLDPREFIX/include" "\$SRB2BLDPREFIX/lib" "\$SRB2BLDROOT/libraries" "$HOME/.cache/ccache" ! -group root -exec chown -R root:root {} \; 2> /dev/null || true

        elif [ "\$OSVIRT" = "docker" ] && ([ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDPREFIX" | gawk 'match(\$0, /\/home\/'\$HOSTUSER'\/.local/) {print substr(\$0, RSTART, RLENGTH)}')" ] || [ -n "\$ISREADONLY" ]) && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$ANDROID" != "1" ]); then

            sudo find -L "\$SRB2BLDPREFIX/bin" "\$SRB2BLDPREFIX/include" "\$SRB2BLDPREFIX/lib" "\$SRB2BLDROOT/libraries" "$HOME/.cache/ccache" -group root -exec chown -R srb2bld:srb2bld {} \; 2> /dev/null || true

        else

            sudo find -L "\$SRB2BLDROOT/libraries" "$HOME/.cache/ccache" -group root -exec chown -R srb2bld:srb2bld {} \; 2> /dev/null || true

        fi

        # Setting trap signal for correcting compiled build's source code, libraries etc. permissions when running -u/--user or having read-only filesystem.
        if [ "\$OSVIRT" = "podman" ] && ([ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDPREFIX" | gawk 'match(\$0, /\/home\/'\$HOSTUSER'\/.local/) {print substr(\$0, RSTART, RLENGTH)}')" ] || [ -n "\$ISREADONLY" ]) && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$ANDROID" != "1" ]); then

            trap '[ $? = 0 ] && \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Correcting permissions to $BUILDNAME'\''s source code. Please wait..." && [ "\$(basename \$BUILD)" = "ring-racers" ] && export BUILD="\$BUILDMAIN" ; sudo find -L "\$BUILD" "\$SRB2BLDPREFIX/stow" "\$SRB2BLDPREFIX/bin" "\$SRB2BLDPREFIX/include" "\$SRB2BLDPREFIX/lib" "\$SRB2BLDROOT/libraries" "$HOME/.cache/ccache" ! -group root -exec chown -R root:root {} \; 2> /dev/null || true && \$PRINTF "\n$PROMPT==> $FAILURE%s\n\e[0m" "ERROR: Build didn'\''t finish due to error or cancelling process. Try \"srb2bld -i -t\" to compile and install tagged/release version of build." ; exit 1' 0 1 2 3 6 15

        elif [ "\$OSVIRT" = "docker" ] && ([ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDPREFIX" | gawk 'match(\$0, /\/home\/'\$HOSTUSER'\/.local/) {print substr(\$0, RSTART, RLENGTH)}')" ] || [ -n "\$ISREADONLY" ]) && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$ANDROID" != "1" ]); then

            trap '[ $? = 0 ] && \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Correcting permissions to $BUILDNAME'\''s source code. Please wait..." && [ "\$(basename \$BUILD)" = "ring-racers" ] && export BUILD="\$BUILDMAIN" ; sudo find -L "\$BUILD" "\$SRB2BLDPREFIX/stow" "\$SRB2BLDPREFIX/bin" "\$SRB2BLDPREFIX/include" "\$SRB2BLDPREFIX/lib" "\$SRB2BLDROOT/libraries" "$HOME/.cache/ccache" -group root -exec chown -R srb2bld:srb2bld {} \; 2> /dev/null || true && \$PRINTF "\n$PROMPT==> $FAILURE%s\n\e[0m" "ERROR: Build didn'\''t finish due to error or cancelling process. Try \"srb2bld -i -t\" to compile and install tagged/release version of build." ; exit 1' 0 1 2 3 6 15

        else

            trap '[ $? = 0 ] && \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Correcting permissions to $BUILDNAME'\''s source code. Please wait..." && [ "\$(basename \$BUILD)" = "ring-racers" ] && export BUILD="\$BUILDMAIN" ; sudo find -L "\$BUILD" "\$SRB2BLDROOT/libraries" "$HOME/.cache/ccache" ! -group \$HOSTUSERID -exec chown -R \$HOSTUSERID:\$HOSTUSERID {} \; 2> /dev/null || true && \$PRINTF "\n$PROMPT==> $FAILURE%s\n\e[0m" "ERROR: Build didn'\''t finish due to error or cancelling process. Try \"srb2bld -i -t\" to compile and install tagged/release version of build." ; exit 1' 0 1 2 3 6 15

        fi

    fi

    # Added repositories to safe directories since Git v2.35.
    git config --global --add safe.directory "*"

    # Added this git config to avoid errors "Filename too long", while cleaning up source code.
    git -C "\$BUILD" config core.longpaths true
    git -C "\$BUILD" config advice.nameTooLong false

    extractassets() {
        if [ "\$BUILD" = "\$BUILDPATH/srb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-android" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-android-bitten" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-reveries" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-uncapped-plus" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-netplus" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-reveries" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-android-reveries" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-tsourdt3rd" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-edit" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-ggj" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-persona" ]; then

            if [ "\$BUILD" = "\$BUILDPATH/srb2-reveries" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-android-reveries" ]; then

                if [ -n "\$ISNET" ]; then

                    SRB2REVERIESASSETURL=\$(/usr/bin/curl -sL "\$SRB2REVERIESASSETURL" | gawk '{gsub(",","\n"); print}' | gawk -F'"' '/browser_download_url.*.zip/ {print \$4}' | head -n1)
                    if [ "\$(/usr/bin/curl -X GET -sLI "\$SRB2REVERIESASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/SRB2Reveries.zip" 2> /dev/null)" ]; then

                        rm -f "\$SRB2BLDROOT/assets/SRB2Reveries.zip"
                        /usr/bin/curl -RL "\$SRB2REVERIESASSETURL" -o "\$SRB2BLDROOT/assets/SRB2Reveries.zip"

                    fi

                fi

                if [ "\$ANDROID" = "1" ]; then

                    7z x -y "\$SRB2BLDROOT/assets/SRB2Reveries.zip" "*.pk3" "*.wad" -o"\$BUILD/android/app/src/main/assets"

                else

                    7z x -y "\$SRB2BLDROOT/assets/SRB2Reveries.zip" "*.pk3" "*.wad" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

                fi

            elif [ "\$BUILD" = "\$BUILDPATH/srb2-tsourdt3rd" ]; then

                if [ -n "\$ISNET" ] && [ "\$(curl -X GET -LI "https://git.do.srb2.org/StarManiaKG/tsourdt3rd-assets/-/raw/main/releases/$(curl -sL "https://git.do.srb2.org/api/v4/projects/435/repository/tree?path=releases" | gawk '{gsub(",","\n"); print}' | gawk -F'releases/' '/path/ {gsub("\"","");gsub(" ","%20"); print $2}' | tail -n1)/tsourdt3rd.pk3" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/tsourdt3rd.pk3" 2> /dev/null)" ]; then

                    rm -f "\$SRB2BLDROOT/assets/tsourdt3rd.pk3"
                    curl -RL "https://git.do.srb2.org/StarManiaKG/tsourdt3rd-assets/-/raw/main/releases/$(curl -sL "https://git.do.srb2.org/api/v4/projects/435/repository/tree?path=releases" | gawk '{gsub(",","\n"); print}' | gawk -F'releases/' '/path/ {gsub("\"","");gsub(" ","%20"); print $2}' | tail -n1)/tsourdt3rd.pk3" -o "\$SRB2BLDROOT/assets/tsourdt3rd.pk3"

                fi

                cp -f "\$SRB2BLDROOT/assets/tsourdt3rd.pk3" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

                if [ -n "\$ISNET" ] && [ "\$(curl -X GET -sLI "https://git.do.srb2.org/StarManiaKG/tsourdt3rd-assets/-/raw/main/extras/jukebox.pk3" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/jukebox.pk3" 2> /dev/null)" ]; then

                    rm -f "\$SRB2BLDROOT/assets/jukebox.pk3"
                    curl -RL "https://git.do.srb2.org/StarManiaKG/tsourdt3rd-assets/-/raw/main/extras/jukebox.pk3" -o "\$SRB2BLDROOT/assets/jukebox.pk3"

                fi

                cp -f "\$SRB2BLDROOT/assets/jukebox.pk3" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/srb2-ggj" ]; then

                git -C "\$BUILD/build" clone "\$SRB2GGJASSETURL" "srb2ggj-assets"
                7z a -y -tzip -mx=0 "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/srb2ggj.pk3" "\$BUILD/build/srb2ggj-assets/"*

            elif [ "\$BUILD" = "\$BUILDPATH/srb2-persona" ]; then

                if [ -n "\$ISNET" ]; then

                    SRB2ASSETETAG=\$(curl -X GET -sLI "\$SRB2PERSONAASSETURL" | gawk -F'etag: ' '{IGNORECASE=1} /etag/ {gsub("\r|\\"",""); print \$NF}' 2> /dev/null | tail -n1)
                    if [ "\$SRB2ASSETETAG" != "\$(7z l "\$SRB2BLDROOT/assets/SRB2P_MP.zip" 2> /dev/null | gawk '/Comment/ {print \$NF}')" ]; then

                        rm -f "\$SRB2BLDROOT/assets/SRB2P_MP.zip"
                        curl -RL "\$SRB2PERSONAASSETURL" -o "\$SRB2BLDROOT/assets/SRB2P_MP.zip"
                        zip -z "\$SRB2BLDROOT/assets/SRB2P_MP.zip" << EOF
\$SRB2ASSETETAG
EOF

                    fi

                fi

                7z x -y "\$SRB2BLDROOT/assets/SRB2P_MP.zip" "*.pk3" "*.wad" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            fi

            if [ "\$GITVER" = "\$GITDEFVER" ]; then

                extractsrb2assets

            fi

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ]; then

            if [ -n "\$ISNET" ] && [ "\$(curl -X GET -sLI "\$SRB2CLASSICASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/SRB2Classic.zip" 2> /dev/null)" ]; then

                rm -f "\$SRB2BLDROOT/assets/SRB2Classic.zip"
                curl -RL "\$SRB2CLASSICASSETURL" -o "\$SRB2BLDROOT/assets/SRB2Classic.zip"

            fi

            # Create assets using srb2classic-assets repository for SRB2 Classic.
            7z x -y "\$SRB2BLDROOT/assets/SRB2Classic.zip" -o"\$BUILD/build"

            cd "\$BUILD/build/srb2classic-assets"

            for a in \$(ls -d "\$BUILD/build/srb2classic-assets/"*.pk3dir | gawk -F'/' '{gsub(".pk3dir",".pk3"); print \$NF}'); do

                "\$BUILD/build/srb2classic-assets/assemble.py" "\$a"

            done

            cp -f "\$BUILD/build/srb2classic-assets/"*.pk3 "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-beta6" ]; then

            SRB2BETAASSETURL=\$(curl -sL "\$SRB2BETAASSETURL" | gawk -F'"' '/browser_download_url.*srb2-windowsx86.zip/ {print \$4}' | head -n1)
            if [ -n "\$ISNET" ] && [ "\$(curl -X GET -sLI "\$SRB2BETAASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/SRB2Beta.zip" 2> /dev/null)" ]; then

                rm -f "\$SRB2BLDROOT/assets/SRB2Beta.zip"
                curl -RL "\$SRB2BETAASSETURL" -o "\$SRB2BLDROOT/assets/SRB2Beta.zip"

            fi

            7z e -y "\$SRB2BLDROOT/assets/SRB2Beta.zip" "*/*.pk3" "*/*.dta" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-destructive-illusion" ]; then

            if [ -n "\$ISNET" ]; then

                SRB2ASSETETAG=\$(curl -X GET -sLI "\$SRB2DESTRUCTIVEILLUSIONASSETURL" | gawk -F'etag: ' '{IGNORECASE=1} /etag/ {gsub("\r|\\"",""); print \$NF}' 2> /dev/null | tail -n1)
                if [ "\$SRB2ASSETETAG" != "\$(7z l "\$SRB2BLDROOT/assets/SRB2DI.zip" 2> /dev/null | gawk '/Comment/ {print \$NF}')" ]; then

                    rm -f "\$SRB2BLDROOT/assets/SRB2DI.zip"
                    curl -RL "\$SRB2DESTRUCTIVEILLUSIONASSETURL" -o "\$SRB2BLDROOT/assets/SRB2DI.zip"
                    zip -z "\$SRB2BLDROOT/assets/SRB2DI.zip" << EOF
\$SRB2ASSETETAG
EOF

                fi

            fi

            7z e -y "\$SRB2BLDROOT/assets/SRB2DI.zip" "*/*.pk3" "*/*.dta" "*/*.lua" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.1-legacy" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-fusion-advance" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ] || [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ]; then

            if [ -n "\$ISNET" ]; then

                curl -RLC - "\$SRB2LEGACYASSETURL" -o "\$SRB2BLDROOT/assets/SRB2-2.1.exe"

            fi

            7z x -y "\$SRB2BLDROOT/assets/SRB2-2.1.exe" "*.srb" "*.dta" "*.dat" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            if [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ]; then

                if [ -n "\$ISNET" ]; then

                    megatools dl "\$SRB2THOKKERASSETURL" --path "/tmp"
                    mv -f "/tmp/Thokker-1-0-1.zip" "\$SRB2BLDROOT/assets/SRB2Thokker.zip"

                fi

                7z x -y "\$SRB2BLDROOT/assets/SRB2Thokker.zip" "*.thk" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ]; then

                if [ -n "\$ISNET" ]; then

                    rm -f "\$SRB2BLDROOT/assets/SRB2TD.zip"*
                    curl -RL "\$SRB2TOPDOWNASSET1URL" -o "\$SRB2BLDROOT/assets/SRB2TD.zip.001"
                    curl -RL "\$SRB2TOPDOWNASSET2URL" -o "\$SRB2BLDROOT/assets/SRB2TD.zip.002"

                fi

                7z x -y "\$SRB2BLDROOT/assets/SRB2TD.zip.001" "*.td" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ]; then

                if [ -n "\$ISNET" ]; then

                    if [ "\$(curl -X GET -sLI "\$SONICSMASHBRAWLASSET1URL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/SSB.zip.001" 2> /dev/null)" ]; then

                        rm -f "\$SRB2BLDROOT/assets/SSB.zip"*
                        curl -RL "\$SONICSMASHBRAWLASSET1URL" -o "\$SRB2BLDROOT/assets/SSB.zip.001"
                        curl -RL "\$SONICSMASHBRAWLASSET2URL" -o "\$SRB2BLDROOT/assets/SSB.zip.002"

                    fi

                fi

                7z e -y "\$SRB2BLDROOT/assets/SSB.zip.001" "*/*.ssb" "*/*.dta" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            fi

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ]; then

            if [ -n "\$ISNET" ]; then

                curl -RLC - "\$SRB220ASSETURL" -o "\$SRB2BLDROOT/assets/SRB2-2.0.exe"

            fi

            unrar x -y "\$SRB2BLDROOT/assets/SRB2-2.0.exe" "*.plr" "*.dta" "*.wpn" "*.srb" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            if [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ]; then

                if [ -n "\$ISNET" ]; then

                    SRB2ASSETETAG=\$(curl -X GET -sLI "\$SRB2CBASSETURL" | gawk -F'etag: ' '{IGNORECASE=1} /etag/ {gsub("\r|\\"",""); print \$NF}' 2> /dev/null | tail -n1)
                    if [ "\$SRB2ASSETETAG" != "\$(7z l "\$SRB2BLDROOT/assets/SRB2CB.zip" 2> /dev/null | gawk '/Comment/ {print \$NF}')" ]; then

                        rm -f "\$SRB2BLDROOT/assets/SRB2CB.zip"
                        curl -RL "\$SRB2CBASSETURL" -o "\$SRB2BLDROOT/assets/SRB2CB.zip"
                        zip -z "\$SRB2BLDROOT/assets/SRB2CB.zip" << EOF
\$SRB2ASSETETAG
EOF

                    fi

                fi

                7z x -y "\$SRB2BLDROOT/assets/SRB2CB.zip" "*.wad" "*.dta" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/xsrb2" ]; then

                cp -f "\$BUILD/SRB2/branches/XMOD/bin/Resources/"* "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ]; then

                if [ -n "\$ISNET" ]; then

                    SRB2ASSETETAG=\$(curl -X GET -sLI https://archive.org/download/srb2-wads-archive/SF94%20City%20Old%20Version%208-28-10.zip | gawk -F'etag: ' '{IGNORECASE=1} /etag/ {gsub("\r|\\"",""); print \$NF}' 2> /dev/null | tail -n1)
                    if [ "\$SRB2ASSETETAG" != "\$(7z l "\$SRB2BLDROOT/assets/SF94-City.zip" 2> /dev/null | gawk '/Comment/ {print \$NF}')" ]; then

                        rm -f "\$SRB2BLDROOT/assets/SF94-City.zip"
                        curl -RL https://archive.org/download/srb2-wads-archive/SF94%20City%20Old%20Version%208-28-10.zip -o "\$SRB2BLDROOT/assets/SF94-City.zip"
                        zip -z "\$SRB2BLDROOT/assets/SF94-City.zip" << EOF
\$SRB2ASSETETAG
EOF

                    fi

                    curl -RL https://mb.srb2.org/attachments/metalsonic-zip.46 -o "\$SRB2BLDROOT/assets/SF94-MetalSonic.zip"
                    curl -RL https://mb.srb2.org/attachments/metalknux-zip.389 -o "\$SRB2BLDROOT/assets/SF94-MetalKnux.zip"
                    curl -RL https://mb.srb2.org/attachments/espio-zip.659 -o "\$SRB2BLDROOT/assets/SF94-Espio.zip"
                    curl -RL https://mb.srb2.org/attachments/nitemare-zip.1056 -o "\$SRB2BLDROOT/assets/SF94-Nitemare.zip"
                    curl -RL https://mb.srb2.org/attachments/senku-zip.1057 -o "\$SRB2BLDROOT/assets/SF94-Senku.zip"
                    curl -RL https://mb.srb2.org/attachments/senya-zip.363 -o "\$SRB2BLDROOT/assets/SF94-Senya.zip"
                    curl -RL https://mb.srb2.org/attachments/zim-rar.699 -o "\$SRB2BLDROOT/assets/SF94-Zim.rar"

                fi

                7z x -y "\$SRB2BLDROOT/assets/SF94-City.zip" "*.soc" "*.wad" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"
                7z x -y "\$SRB2BLDROOT/assets/SF94-MetalSonic.zip" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"
                mv -f "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/metalsonic.wad" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/SF94-Metalsonic.wad"
                7z x -y "\$SRB2BLDROOT/assets/SF94-MetalKnux.zip" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"
                mv -f "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/metalknux.wad" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/SF94-Knux.wad"
                7z x -y "\$SRB2BLDROOT/assets/SF94-Espio.zip" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"
                mv -f "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/espio.wad" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/SF94-Espio.wad"
                7z x -y "\$SRB2BLDROOT/assets/SF94-Nitemare.zip" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"
                mv -f "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/nitemare.wad" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/SF94-Nitemare.wad"
                7z x -y "\$SRB2BLDROOT/assets/SF94-Senku.zip" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"
                mv -f "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/senku.wad" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/SF94-Senku.wad"
                7z x -y "\$SRB2BLDROOT/assets/SF94-Senya.zip" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"
                mv -f "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/senya.wad" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/SF94-Senya.wad"
                unrar x -y "\$SRB2BLDROOT/assets/SF94-Zim.rar" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"
                mv -f "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/Zim.wad" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/SF94-Zim.wad"
                chmod 644 "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/"*

            elif [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ]; then

                cp -f "\$BUILD/SRB2/branches/RIDER/bin/Resources/"*.ridr "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

                if [ -n "\$ISNET" ]; then

                    SRB2ASSETETAG=\$(curl -X GET -sLI "\$SRB2RIDERSMUSICASSETURL" | gawk -F'etag: ' '{IGNORECASE=1} /etag/ {gsub("\r|\\"",""); print \$NF}' 2> /dev/null | tail -n1)
                    if [ "\$SRB2ASSETETAG" != "\$(7z l "\$SRB2BLDROOT/assets/SRB2RidersMusic.zip" 2> /dev/null | gawk '/Comment/ {print \$NF}')" ]; then

                        rm -f "\$SRB2BLDROOT/assets/SRB2RidersMusic.zip"
                        curl -RL "\$SRB2RIDERSMUSICASSETURL" -o "\$SRB2BLDROOT/assets/SRB2RidersMusic.zip"
                        zip -z "\$SRB2BLDROOT/assets/SRB2RidersMusic.zip" << EOF
\$SRB2ASSETETAG
EOF

                    fi

                fi

                7z x -y "\$SRB2BLDROOT/assets/SRB2RidersMusic.zip" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ]; then

                if [ -n "\$ISNET" ]; then

                    curl -RLC - "\$SUPERSRB2KARTZASSETURL" -o "\$SRB2BLDROOT/assets/SuperSRB2KartZ.zip"

                fi

                7z x -y "\$SRB2BLDROOT/assets/SuperSRB2KartZ.zip" "*.kart" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/sbb2" ]; then

                cp -rf "\$BUILD/SRB2/branches/FLAME/bin/Resources/BOMBFiles" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            fi

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

            if [ -n "\$ISNET" ]; then

                curl -RLC - "\$SRB2FINALDEMOASSETURL" -o "\$SRB2BLDROOT/assets/SRB2FinalDemo.exe"

            fi

            unrar x -y "\$SRB2BLDROOT/assets/SRB2FinalDemo.exe" "*.plr" "*.dta" "*.wpn" "*.srb" "3drend.dll" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            if [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ]; then

                if [ -n "\$ISNET" ]; then

                    curl -RLC - "\$SRB2JTEASSETURL" -o "\$SRB2BLDROOT/assets/SRB2JTE.zip"

                fi

                7z x -y "\$SRB2BLDROOT/assets/SRB2JTE.zip" "*.wad" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ]; then

                cp -rf "\$BUILD/SRB21094/branches/JTESHUFFLE/data/"* "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/srb2-live" ]; then

                cp -rf "\$BUILD/SRB21094/branches/LIVE/data/"* "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ]; then

                cp -rf "\$BUILD/SRB21094/branches/LOZ/data/"* "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

                cp -rf "\$BUILD/SRB21094/branches/FLAME/data/"*.wpn "\$BUILD/SRB21094/branches/FLAME/data/"*.smash "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            fi

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ]; then

            if [ -n "\$ISNET" ]; then

                SRB21095ASSETURL=\$(curl -sL "\$SRB21095ASSETURL" | gawk -F'"' '/browser_download_url.*SRB2-1095-.*.zip/ {print \$4}' | head -n1)
                if [ "\$(curl -X GET -sLI "\$SRB21095ASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/SRB21095.zip" 2> /dev/null)" ]; then

                    rm -f "\$SRB2BLDROOT/assets/SRB21095.zip"
                    curl -RL "\$SRB21095ASSETURL" -o "\$SRB2BLDROOT/assets/SRB21095.zip"

                fi

            fi

            7z e -y "\$SRB2BLDROOT/assets/SRB21095.zip" "*/*.plr" "*/*.dta" "*/*.wpn" "*/*.srb" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

        elif [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

            if [ -n "\$ISNET" ]; then

                NEWMILLENNIUMASSETURL=\$(curl -sL "\$NEWMILLENNIUMASSETURL" | gawk -F'"' '/browser_download_url.*freedoom-.*.zip/ {print \$4}' | head -n1)
                if [ "\$(curl -X GET -sLI "\$NEWMILLENNIUMASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/NewMillennium.zip" 2> /dev/null)" ]; then

                    rm -f "\$SRB2BLDROOT/assets/NewMillennium.zip"
                    curl -RL "\$NEWMILLENNIUMASSETURL" -o "\$SRB2BLDROOT/assets/NewMillennium.zip"

                fi

            fi

            7z e -y "\$SRB2BLDROOT/assets/NewMillennium.zip" "*/freedoom2.wad" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"
            mv -f "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/freedoom2.wad" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/DOOM2.WAD"
            cp -rf "\$BUILD/Binaries/"* "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-galaxy" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-hep" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-saturn" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-neptune" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ] || [ "\$BUILD" = "\$BUILDPATH/blankart" ] || [ "\$BUILD" = "\$BUILDPATH/ring-racers" ] || [ "\$BUILD" = "\$BUILDPATH/ring-racers-noire" ] || [ "\$BUILD" = "\$BUILDPATH/ring-racers-hep" ] || [ "\$BUILD" = "\$BUILDPATH/ring-racers-freaky-build" ] || [ "\$BUILD" = "\$BUILDPATH/radio-racers" ]; then

            if [ "\$BUILD" = "\$BUILDPATH/srb2-kart-hep" ]; then

                if [ -n "\$ISNET" ]; then

                    SRB2ASSETETAG=\$(curl -X GET -sLI "\$SRB2KARTHEPASSETURL" | gawk -F'etag: ' '{IGNORECASE=1} /etag/ {gsub("\r|\\"",""); print \$NF}' 2> /dev/null | tail -n1)
                    if [ "\$SRB2ASSETETAG" != "\$(7z l "\$SRB2BLDROOT/assets/SRB2KartHEP.zip" 2> /dev/null | gawk '/Comment/ {print \$NF}')" ]; then

                        rm -f "\$SRB2BLDROOT/assets/SRB2KartHEP.zip"
                        curl -RL "\$SRB2KARTHEPASSETURL" -o "\$SRB2BLDROOT/assets/SRB2KartHEP.zip"
                        zip -z "\$SRB2BLDROOT/assets/SRB2KartHEP.zip" << EOF
\$SRB2ASSETETAG
EOF

                    fi

                fi

                7z e -y "\$SRB2BLDROOT/assets/SRB2KartHEP.zip" "*/*.kart" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-saturn" ]; then

                if [ -n "\$ISNET" ]; then

                    SRB2KARTSATURNASSETURL=\$(curl -sL "\$SRB2KARTSATURNASSETURL" | gawk -F'"' '/browser_download_url.*Just-Extra.*Files.zip/ {print \$4}' | head -n1)
                    if [ "\$(curl -X GET -sLI "\$SRB2KARTSATURNASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/SRB2KartSaturn.zip" 2> /dev/null)" ]; then

                        rm -f "\$SRB2BLDROOT/assets/SRB2KartSaturn.zip"
                        curl -RL "\$SRB2KARTSATURNASSETURL" -o "\$SRB2BLDROOT/assets/SRB2KartSaturn.zip"

                    fi

                fi

                7z x -y "\$SRB2BLDROOT/assets/SRB2KartSaturn.zip" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-neptune" ]; then

                if [ -n "\$ISNET" ]; then

                    SRB2KARTNEPTUNEASSETURL=\$(curl -sL "\$SRB2KARTNEPTUNEASSETURL" | gawk -F'"' '/browser_download_url.*64Bit.zip/ {print \$4}' | head -n1)
                    if [ "\$(curl -X GET -sLI "\$SRB2KARTNEPTUNEASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/SRB2KartNeptune.zip" 2> /dev/null)" ]; then

                        rm -f "\$SRB2BLDROOT/assets/SRB2KartNeptune.zip"
                        curl -RL "\$SRB2KARTNEPTUNEASSETURL" -o "\$SRB2BLDROOT/assets/SRB2KartNeptune.zip"

                    fi

                fi

                7z e -y "\$SRB2BLDROOT/assets/SRB2KartNeptune.zip" "*/*.kart" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            elif [ "\$BUILD" = "\$BUILDPATH/blankart" ]; then

                if [ -n "\$ISNET" ] && [ "\$(curl -X GET -sLI "\$BLANKARTASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/BlanKart.zip" 2> /dev/null)" ]; then

                    rm -f "\$SRB2BLDROOT/assets/BlanKart.zip"
                    curl -RL "\$BLANKARTASSETURL" -o "\$SRB2BLDROOT/assets/BlanKart.zip"

                fi

                # Create assets using blankart-assets repository for BlanKart.
                7z x -y "\$SRB2BLDROOT/assets/BlanKart.zip" -o"\$BUILD/build"

                for a in \$(ls -d "\$BUILD/build/blankart-assets/src/"* | gawk -F'/' '{print \$NF}'); do

                    7z a -y -tzip -mx=0 "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/\$a.pk3" "\$BUILD/build/blankart-assets/src/\$a/"*

                done

            elif [ "\$BUILD" = "\$BUILDPATH/ring-racers-freaky-build" ]; then

                # Temporarily until Freaky Build will be fully ported to v2.4.
                if [ "\$(curl -X GET -sLI "https://github.com/KartKrewDev/RingRacers/releases/download/v2.3/Dr.Robotnik.s-Ring-Racers-v2.3-Installer.exe" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/RingRacers-2.3.exe" 2> /dev/null)" ]; then

                    rm -f "\$SRB2BLDROOT/assets/RingRacers-2.3.exe"
                    curl -RL "https://github.com/KartKrewDev/RingRacers/releases/download/v2.3/Dr.Robotnik.s-Ring-Racers-v2.3-Installer.exe" -o "\$SRB2BLDROOT/assets/RingRacers-2.3.exe"

                fi

                7z x -y "\$SRB2BLDROOT/assets/RingRacers-2.3.exe" "*.pk3" "*.dat" "data/*" "models/*" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"
                cp -f "\$BUILD/!REQUIRED ASSETS/"*.pk3 "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"
                find "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR" -type d -exec chmod -R 755 {} \;

            elif [ "\$BUILD" = "\$BUILDPATH/radio-racers" ]; then

                if [ -n "\$ISNET" ]; then

                    RADIORACERSASSETURL=\$(curl -sL "\$RADIORACERSASSETURL" | gawk -F'"' '/browser_download_url.*radioracers_assets.zip/ {print \$4}' | head -n1)
                    if [ "\$(curl -X GET -sLI "\$RADIORACERSASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/RadioRacers.zip" 2> /dev/null)" ]; then

                        rm -f "\$SRB2BLDROOT/assets/RadioRacers.zip"
                        curl -RL "\$RADIORACERSASSETURL" -o "\$SRB2BLDROOT/assets/RadioRacers.zip"

                    fi

                fi

                7z x -y "\$SRB2BLDROOT/assets/RadioRacers.zip" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            fi

            if [ "\$GITVER" = "\$GITDEFVER" ] && [ "\$BUILD" != "\$BUILDPATH/ring-racers-freaky-build" ]; then

                extractsrb2kartassets

            fi

        elif [ "\$(dirname \$BUILD)" = "\$BUILDPATH/srb2-custom" ]; then

            if [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "SRB2" ]; then

                extractsrb2assets

            elif [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "SRB2Kart" ] || [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

                extractsrb2kartassets

            else

                extractsrb2assets

            fi

        fi
    }

    extractcustomassets() {
        BUILDPREFIX=\$(\$PRINTF "%s\n" "\$BUILD" | gawk -F'/' '{print \$NF}')

        # Download and extract assets for custom build.
        if [ -z "\$ISNET" ] && [ -n "\$SRB2BLDASSETPATH" ]; then

            if [ -f "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk -F'/' '{print \$NF}')" ]; then

                FILETYPE=\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk -F'.' '{print \$NF}' 2> /dev/null | tail -n1)
                SRB2BLDASSETPATH="\$SRB2BLDASSETPATH"

            else

                FILETYPE=\$(find "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER."* 2> /dev/null | gawk -F'.' '{print \$NF}' | head -n1)
                SRB2BLDASSETPATH="\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER.\$FILETYPE"

            fi

        elif [ -n "\$ISNET" ] && [ -n "\$SRB2BLDASSETPATH" ]; then

            if [ -n "\$(find "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER."* 2> /dev/null | head -n1)" ] && [ "\$(curl -X GET -sLI "\$SRB2BLDASSETPATH" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" = "\$(stat -c %s "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER."* 2> /dev/null)" ]; then

                FILETYPE=\$(find "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER."* 2> /dev/null | gawk -F'.' '{print \$NF}' | head -n1)
                SRB2BLDASSETPATH="\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER.\$FILETYPE"

            elif [ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk '/drive.google.com/ {print}')" ] || [ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk '/drive.usercontent.google.com/ {print}')" ]; then

                SRB2ASSETID=\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk '{gsub("https://drive.google.com/file/d/|https://drive.usercontent.google.com/download\\\?id=|&export=download|/view|/edit|\\\?usp=sharing",""); print}')
                SRB2BLDASSETPATH="https://drive.usercontent.google.com/download?confirm=t&id=\$SRB2ASSETID"
                FILETYPE=\$(curl -X GET -sLI "\$SRB2BLDASSETPATH" | gawk -F'.' '/content-disposition:/ {gsub("\r|\"",""); print \$NF}')

            elif [ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk '/mega.nz/ {print}')" ]; then

    	        MEGANZFILENAME=\$(megatools dl "\$SRB2BLDASSETPATH" --print-names --path "/tmp" | gawk -F'/' '/^F/ {print \$NF}')
                FILETYPE=\$(\$PRINTF "%s\n" "\$MEGANZFILENAME" | gawk -F'.' '{print \$NF}')

            else

                SRB2BLDASSETPATH="\$SRB2BLDASSETPATH"

                if [ -n "\$(curl -X GET -sLI "\$SRB2BLDASSETPATH" | gawk '/HTTP\/2 200/ {print}' 2> /dev/null | head -n1)" ] || [ -f "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk -F'/' '{print \$NF}')" ]; then

                    FILETYPE=\$(curl -X GET -sLI "\$SRB2BLDASSETPATH" | gawk -F'.' '/content-disposition:/ {gsub("\r|\"",""); print \$NF}' 2> /dev/null | tail -n1)

                    if [ -z "\$FILETYPE" ]; then

                        FILETYPE="\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk -F'.' '{print \$NF}' 2> /dev/null | tail -n1)"

                    fi

                else

                    FILETYPE=\$(find "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER."* 2> /dev/null | gawk -F'.' '{print \$NF}' | head -n1)

                fi

            fi

        elif [ -z "\$SRB2BLDASSETPATH" ]; then

            extractassets

        fi

        if [ -n "\$ISNET" ] && [ -n "\$(curl -X GET -vI "\$SRB2BLDASSETPATH" 2>&1 | gawk '/> Host:/ {gsub("\r",""); print \$NF}')" ] && [ "\$(curl -X GET -sLI "\$SRB2BLDASSETPATH" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk -F'/' '{print \$NF}')" 2> /dev/null)" ] && ([ "\$FILETYPE" = "pk3" ] || [ "\$FILETYPE" = "dta" ] || [ "\$FILETYPE" = "wad" ] || [ "\$FILETYPE" = "kart" ]); then

            rm -f "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk -F'/' '{print \$NF}')"
            curl -RL "\$SRB2BLDASSETPATH" -o "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk -F'/' '{print \$NF}')"

        elif [ -n "\$ISNET" ] && [ -n "\$(curl -X GET -vI "\$SRB2BLDASSETPATH" 2>&1 | gawk '/> Host:/ {gsub("\r",""); print \$NF}')" ] && [ "\$(curl -X GET -sLI "\$SRB2BLDASSETPATH" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER.\$FILETYPE" 2> /dev/null)" ] && ([ "\$FILETYPE" != "pk3" ] && [ "\$FILETYPE" != "dta" ] && [ "\$FILETYPE" != "wad" ] && [ "\$FILETYPE" != "kart" ]); then

            rm -f "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER.\$FILETYPE"

            if [ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk '/drive.google.com/ {print}')" ] || [ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk '/drive.usercontent.google.com/ {print}')" ]; then

                curl -RL "https://drive.usercontent.google.com/download?confirm=t&id=\$SRB2ASSETID" -o"\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER.\$FILETYPE"

            elif [ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk '/mega.nz/ {print}')" ]; then

                mv -f "/tmp/\$MEGANZFILENAME" "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER.\$FILETYPE"

            else

                curl -RL "\$SRB2BLDASSETPATH" -o "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER.\$FILETYPE"

            fi

        fi

        if [ -f "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk -F'/' '{print \$NF}')" ] && ([ "\$FILETYPE" = "pk3" ] || [ "\$FILETYPE" = "dta" ] || [ "\$FILETYPE" = "wad" ] || [ "\$FILETYPE" = "kart" ]); then

            cp -f "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDASSETPATH" | gawk -F'/' '{print \$NF}')" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

        elif [ -n "\$(find "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER.\$FILETYPE" 2> /dev/null | head -n1)" ]; then

            if [ "\$ANDROID" = "1" ]; then

                7z x -y "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER.\$FILETYPE" -x!"*.exe" -x!"*.txt" -x!"*.md" -x!"*.dll" -o"\$BUILD/android/app/src/main/assets"

            elif [ "\$OS" = "Windows" ]; then

                7z x -y "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER.\$FILETYPE" -x!"*.exe" -x!"*.txt" -x!"*.md" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            else

                7z x -y "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER.\$FILETYPE" -x!"*.exe" -x!"*.txt" -x!"*.md" -x!"*.dll" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            fi

            # Removing empty subdirectories.
            if [ "\$ANDROID" = "1" ]; then

                for i in \$(find "\$BUILD/android/app/src/main/assets" -mindepth 1 -maxdepth 1 -type d); do

                    if [ "\$(find \$i -mindepth 1 -maxdepth 1 | gawk -F'/' '{print \$(NF-1)}' | wc -l)" -eq "0" ]; then

                        rm -rf "\$i"

                    fi

                done

            else

                for i in \$(find "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR" -mindepth 1 -maxdepth 1 -type d); do

                    if [ "\$(find \$i -mindepth 1 -maxdepth 1 | gawk -F'/' '{print \$(NF-1)}' | wc -l)" -eq "0" ]; then

                        rm -rf "\$i"

                    fi

                done

            fi

            if [ "\$(find "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR" -mindepth 1 -maxdepth 1 2> /dev/null | wc -l)" -eq "1" ]; then

                mv -f "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/"*/* "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            fi

        fi

        extractextracustomassets

        # Correcting permissions for model directories.
        if [ "\$ANDROID" = "1" ]; then

            find "\$BUILD/android/app/src/main/assets" -type d -exec chmod -R 755 {} \;

        elif [ -n "\$(find "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR" -mindepth 1 -maxdepth 1 -type d 2> /dev/null | head -n1)" ]; then

            find "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR" -type d -exec chmod -R 755 {} \;

        fi

    }

    extractextracustomassets() {
        # Download and extract extra assets for custom build.
        if [ -z "\$ISNET" ] && [ -n "\$SRB2BLDEXTRAASSETPATH" ]; then

            if [ -f "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print \$NF}')" ]; then

                FILETYPE=\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk -F'.' '{print \$NF}' 2> /dev/null | tail -n1)
                SRB2BLDEXTRAASSETPATH="\$SRB2BLDEXTRAASSETPATH"

            else

                FILETYPE=\$(find "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras."* 2> /dev/null | gawk -F'.' '{print \$NF}' | head -n1)
                SRB2BLDEXTRAASSETPATH="\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras.\$FILETYPE"

            fi

        elif [ -n "\$ISNET" ] && [ -n "\$SRB2BLDEXTRAASSETPATH" ]; then

            if [ -n "\$(find "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras."* 2> /dev/null | head -n1)" ] && [ "\$(curl -X GET -sLI "\$SRB2BLDEXTRAASSETPATH" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" = "\$(stat -c %s "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras."* 2> /dev/null)" ]; then

                FILETYPE=\$(find "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras."* 2> /dev/null | gawk -F'.' '{print \$NF}' | head -n1)
                SRB2BLDEXTRAASSETPATH="\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras.\$FILETYPE"

            elif [ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk '/drive.google.com/ {print}')" ] || [ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk '/drive.usercontent.google.com/ {print}')" ]; then

                SRB2ASSETID=\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk '{gsub("https://drive.google.com/file/d/|https://drive.usercontent.google.com/download\\\?id=|&export=download|/view|/edit|\\\?usp=sharing",""); print}')
                SRB2BLDEXTRAASSETPATH="https://drive.usercontent.google.com/download?confirm=t&id=\$SRB2ASSETID"
                FILETYPE=\$(curl -X GET -sLI "\$SRB2BLDEXTRAASSETPATH" | gawk -F'.' '/content-disposition:/ {gsub("\r|\"",""); print \$NF}')

            elif [ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk '/mega.nz/ {print}')" ]; then

    	        MEGANZFILENAME=\$(megatools dl "\$SRB2BLDEXTRAASSETPATH" --print-names --path "/tmp" | gawk -F'/' '/^F/ {print \$NF}')
                FILETYPE=\$(\$PRINTF "%s\n" "\$MEGANZFILENAME" | gawk -F'.' '{print \$NF}')

            else

                SRB2BLDEXTRAASSETPATH="\$SRB2BLDEXTRAASSETPATH"

                if [ -n "\$(curl -X GET -sLI "\$SRB2BLDEXTRAASSETPATH" | gawk '/HTTP\/2 200/ {print}' 2> /dev/null | head -n1)" ] || [ -f "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print \$NF}')" ]; then

                    FILETYPE=\$(curl -X GET -sLI "\$SRB2BLDEXTRAASSETPATH" | gawk -F'.' '/content-disposition:/ {gsub("\r|\"",""); print \$NF}' 2> /dev/null | tail -n1)

                    if [ -z "\$FILETYPE" ]; then

                        FILETYPE="\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk -F'.' '{print \$NF}' 2> /dev/null | tail -n1)"

                    fi

                else

                    FILETYPE=\$(find "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras."* 2> /dev/null | gawk -F'.' '{print \$NF}' | head -n1)

                fi

            fi

        fi

        if [ -n "\$ISNET" ] && [ -n "\$(curl -X GET -vI "\$SRB2BLDEXTRAASSETPATH" 2>&1 | gawk '/> Host:/ {gsub("\r",""); print \$NF}')" ] && [ "\$(curl -X GET -sLI "\$SRB2BLDEXTRAASSETPATH" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print \$NF}')" 2> /dev/null)" ] && ([ "\$FILETYPE" = "pk3" ] || [ "\$FILETYPE" = "dta" ] || [ "\$FILETYPE" = "wad" ] || [ "\$FILETYPE" = "kart" ]); then

            rm -f "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print \$NF}')"
            curl -RL "\$SRB2BLDEXTRAASSETPATH" -o "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print \$NF}')"

        elif [ -n "\$ISNET" ] && [ -n "\$(curl -X GET -vI "\$SRB2BLDEXTRAASSETPATH" 2>&1 | gawk '/> Host:/ {gsub("\r",""); print \$NF}')" ] && [ "\$(curl -X GET -sLI "\$SRB2BLDEXTRAASSETPATH" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras.\$FILETYPE" 2> /dev/null)" ] && ([ "\$FILETYPE" != "pk3" ] && [ "\$FILETYPE" != "dta" ] && [ "\$FILETYPE" != "wad" ] && [ "\$FILETYPE" != "kart" ]); then

            rm -f "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras.\$FILETYPE"

            if [ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk '/drive.google.com/ {print}')" ] || [ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk '/drive.usercontent.google.com/ {print}')" ]; then

                curl -RL "https://drive.usercontent.google.com/download?confirm=t&id=\$SRB2ASSETID" -o"\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras.\$FILETYPE"

            elif [ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk '/mega.nz/ {print}')" ]; then

                mv -f "/tmp/\$MEGANZFILENAME.\$FILETYPE" "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras.\$FILETYPE"

            else

                curl -RL "\$SRB2BLDEXTRAASSETPATH" -o "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras.\$FILETYPE"

            fi

        fi

        if [ -f "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print \$NF}')" ] && ([ "\$FILETYPE" = "pk3" ] || [ "\$FILETYPE" = "dta" ] || [ "\$FILETYPE" = "wad" ] || [ "\$FILETYPE" = "kart" ]); then

            cp -f "\$SRB2BLDROOT/assets/\$(\$PRINTF "%s\n" "\$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print \$NF}')" "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

        elif [ -n "\$(find "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras.\$FILETYPE" 2> /dev/null | head -n1)" ]; then

            if [ "\$ANDROID" = "1" ]; then

                7z e -y -r "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras.\$FILETYPE" -x!"*.exe" -x!"*.txt" -x!"*.md" -x!"*.dll" -o"\$BUILD/android/app/src/main/assets"

            elif [ "\$OS" = "Windows" ]; then

                7z e -y -r "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras.\$FILETYPE" -x!"*.exe" -x!"*.txt" -x!"*.md" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            else

                7z e -y -r "\$SRB2BLDROOT/assets/\$BUILDPREFIX-\$GITVER-extras.\$FILETYPE" -x!"*.exe" -x!"*.txt" -x!"*.md" -x!"*.dll" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            fi

            # Removing empty subdirectories.
            if [ "\$ANDROID" = "1" ]; then

                for i in \$(find "\$BUILD/android/app/src/main/assets" -mindepth 1 -maxdepth 1 -type d); do

                    if [ "\$(find \$i -mindepth 1 -maxdepth 1 | gawk -F'/' '{print \$(NF-1)}' | wc -l)" -eq "0" ]; then

                        rm -rf "\$i"

                    fi

                done

            else

                for i in \$(find "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR" -mindepth 1 -maxdepth 1 -type d); do

                    if [ "\$(find \$i -mindepth 1 -maxdepth 1 | gawk -F'/' '{print \$(NF-1)}' | wc -l)" -eq "0" ]; then

                        rm -rf "\$i"

                    fi

                done

            fi

            if [ "\$(find "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR" -mindepth 1 -maxdepth 1 2> /dev/null | wc -l)" -eq "1" ]; then

                mv -f "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/"*/* "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            fi

        fi
    }

    extractsrb2assets() {
        if [ -n "\$ISNET" ]; then

            SRB2LATESTVER=\$(curl -sL "\$SRB2ASSETURL" | gawk -F':|_' '/tag_name/ {gsub("\"|,| ",""); print \$NF}' | head -n1)

        fi

        SRB2VER=\$(gawk -F'\"' '/SRB2VERSION/ {print \$2}' "\$BUILD/src/version.h" 2> /dev/null || \$PRINTF "%s\n" "\$SRB2LATESTVER")

        if [ "\$BUILD" = "\$BUILDPATH/srb2-persona" ]; then

            SRB2VER=\$(gawk -F'- v|- ' '/v[0-9]/ {print \$2}' "\$BUILD/src/config.h.in" 2> /dev/null | gawk '{gsub(" ",""); print}' | tail -n1 || \$PRINTF "%s\n" "\$SRB2LATESTVER")

        fi

        if [ -n "\$SRB2LATESTVER" ] && ([ "\$SRB2VER" != "\$SRB2LATESTVER" ] && [ "\$(\$PRINTF "\$SRB2VER" | gawk '{gsub("\\\.|-|[a-z]|[A-Z]",""); print}')" -lt "\$(\$PRINTF "\$SRB2LATESTVER" | gawk '{gsub("\\\.|-|[a-z]|[A-Z]",""); print}')" ]); then

            if [ -n "\$ISNET" ]; then

                SRB2OLDASSETURL=\$(curl -sL "\$SRB2ASSETURL" | gawk -F'"' '/'SRB2_release_\$SRB2VER'\/.*Full.zip/ {print \$4}')

                if [ -z "\$SRB2OLDASSETURL" ]; then

                    SRB2ASSETURL=\$(curl -sL "\$SRB2ASSETURL" | gawk -F'"' '/browser_download_url.*Full.zip/ {print \$4}' | head -n1)
                    \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Couldn't fetch older assets. Downloading and extracting $BUILDNAME's latest assets. Please wait..."

                else

                    SRB2ASSETURL="\$SRB2OLDASSETURL"

                fi

                if [ "\$(curl -X GET -sLI "\$SRB2ASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/SRB2-\$SRB2VER.zip" 2> /dev/null)" ]; then

                    rm -f "\$SRB2BLDROOT/assets/SRB2-\$SRB2VER.zip"
                    curl -RL "\$SRB2ASSETURL" -o "\$SRB2BLDROOT/assets/SRB2-\$SRB2VER.zip"

                fi

            fi

            if [ "\$ANDROID" = "1" ]; then

                7z x -y "\$SRB2BLDROOT/assets/SRB2-\$SRB2VER.zip" "*.pk3" "*.dta" "*.dat" "models/*" -o"\$BUILD/android/app/src/main/assets"

            else

                7z x -y "\$SRB2BLDROOT/assets/SRB2-\$SRB2VER.zip" "*.pk3" "*.dta" "*.dat" "models/*" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            fi

        else

            if [ -n "\$ISNET" ]; then

                SRB2ASSETURL=\$(curl -sL "\$SRB2ASSETURL" | gawk -F'"' '/browser_download_url.*Full.zip/ {print \$4}' | head -n1)
                if [ "\$(curl -X GET -sLI "\$SRB2ASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/SRB2-Latest.zip" 2> /dev/null)" ]; then

                    rm -f "\$SRB2BLDROOT/assets/SRB2-Latest.zip"
                    curl -RL "\$SRB2ASSETURL" -o "\$SRB2BLDROOT/assets/SRB2-Latest.zip"

                fi

            fi

            if [ "\$ANDROID" = "1" ]; then

                7z x -y "\$SRB2BLDROOT/assets/SRB2-Latest.zip" "*.pk3" "*.dta" "*.dat" "models/*" -o"\$BUILD/android/app/src/main/assets"

            else

                7z x -y "\$SRB2BLDROOT/assets/SRB2-Latest.zip" "*.pk3" "*.dta" "*.dat" "models/*" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            fi

        fi

        if [ "\$ANDROID" = "1" ]; then

            find "\$BUILD/android/app/src/main/assets" -type d -exec chmod -R 755 {} \;

        else

            find "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR" -type d -exec chmod -R 755 {} \;

        fi
    }

    extractsrb2kartassets() {
        if [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

            if [ -n "\$ISNET" ]; then

                RINGRACERSVERS=\$(curl -sL "\$RINGRACERSASSETURL" | gawk -F':|_' '/tag_name/ {gsub("\"|,| ",""); print \$NF}')

            fi

            RINGRACERSLATESTVER=\$(\$PRINTF "%s\n" "\$RINGRACERSVERS" | head -n1)
            RINGRACERSVER=\$(gawk -F'\"' '/SRB2VERSION/ {print \$2}' "\$BUILD/src/version.h" 2> /dev/null || \$PRINTF "%s\n" "\$RINGRACERSLATESTVER")
            RINGRACERSBETAVER=\$(gawk -F'\"' '/BETAVERSION/ {print tolower(\$2)}' "\$BUILD/src/version.h" 2> /dev/null || true)

            if [ -n "\$ISNET" ]; then

                RINGRACERSBETAASSETURL=\$(curl -sL "\$RINGRACERSASSETURL" | gawk -F'"' '/browser_download_url.*'\$RINGRACERSVER'.*'\$RINGRACERSBETAVER'.*Installer.exe/ {print \$4}')

            fi

            if ([ -n "\$RINGRACERSLATESTVER" ] && ([ "v\$RINGRACERSVER" != "\$RINGRACERSLATESTVER" ] && [ "\$(\$PRINTF "\$RINGRACERSVER" | gawk '{gsub("\\\.|-|[a-z]|[A-Z]",""); print}')" -lt "\$(\$PRINTF "\$RINGRACERSLATESTVER" | gawk '{gsub("\\\.|-|[a-z]|[A-Z]",""); print}')" ])) || [ -n "\$RINGRACERSBETAASSETURL" ]; then

                if [ -n "\$RINGRACERSBETAVER" ] && [ -n "\$RINGRACERSBETAASSETURL" ]; then

                    RINGRACERSCOMBINEDVER="\$RINGRACERSVER-\$RINGRACERSBETAVER"

                else

                    RINGRACERSCOMBINEDVER="\$RINGRACERSVER"

                fi

                if [ -n "\$ISNET" ]; then

                    if [ -z "\$RINGRACERSBETAASSETURL" ]; then

                        RINGRACERSOLDASSETURL=\$(curl -sL "\$RINGRACERSASSETURL" | gawk -F'"' '/browser_download_url.*'\$RINGRACERSVER'.*Installer.exe/ {print \$4}')

                        if [ -z "\$RINGRACERSOLDASSETURL" ]; then

                            RINGRACERSASSETURL=\$(curl -sL "\$RINGRACERSASSETURL" | gawk -F'"' '/browser_download_url.*Installer.exe/ {print \$4}' | head -n1)
                            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Couldn't fetch older assets. Downloading and extracting $BUILDNAME's latest assets. Please wait..."

                        else

                            RINGRACERSASSETURL="\$RINGRACERSOLDASSETURL"

                        fi

                    else

                        RINGRACERSASSETURL="\$RINGRACERSBETAASSETURL"

                    fi

                    if [ "\$(curl -X GET -sLI "\$RINGRACERSASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/RingRacers-\$RINGRACERSCOMBINEDVER.exe" 2> /dev/null)" ]; then

                        rm -f "\$SRB2BLDROOT/assets/RingRacers-\$RINGRACERSCOMBINEDVER.exe"
                        curl -RL "\$RINGRACERSASSETURL" -o "\$SRB2BLDROOT/assets/RingRacers-\$RINGRACERSCOMBINEDVER.exe"

                    fi

                fi

                7z x -y "\$SRB2BLDROOT/assets/RingRacers-\$RINGRACERSCOMBINEDVER.exe" "*.pk3" "*.dat" "data/*" "models/*" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            else

                if [ -n "\$ISNET" ]; then

                    RINGRACERSASSETURL=\$(curl -sL "\$RINGRACERSASSETURL" | gawk -F'"' '/browser_download_url.*Installer.exe/ {print \$4}' | head -n1)
                    if [ "\$(curl -X GET -sLI "\$RINGRACERSASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/RingRacers-Latest.exe" 2> /dev/null)" ]; then

                        rm -f "\$SRB2BLDROOT/assets/RingRacers-Latest.exe"
                        curl -RL "\$RINGRACERSASSETURL" -o "\$SRB2BLDROOT/assets/RingRacers-Latest.exe"

                    fi

                fi

                7z x -y "\$SRB2BLDROOT/assets/RingRacers-Latest.exe" "*.pk3" "*.dat" "data/*" "models/*" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            fi

            find "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR" -type d -exec chmod -R 755 {} \;

        else

            if [ -n "\$ISNET" ]; then

                SRB2KARTVERS=\$(curl -sL "\$SRB2KARTASSETURL" | gawk -F':|_' '/tag_name/ {gsub("\"|,| ",""); print \$NF}')

            fi

            SRB2KARTLATESTVER=\$(\$PRINTF "%s\n" "\$SRB2KARTVERS" | head -n1)

            if [ "\$BUILD" = "\$BUILDPATH/blankart" ]; then

                SRB2KARTVER=\$(gawk -F'\"' '/SRB2VERSION/ {print \$2}' "\$BUILD/src/version.h" 2> /dev/null || \$PRINTF "%s\n" "\$SRB2KARTLATESTVER")

            else

                SRB2KARTVER=\$(gawk -F'- [A-z]*[0-9]*' '/v[0-9]/ {print \$2}' "\$BUILD/src/config.h.in" 2> /dev/null | gawk '{gsub(" ",""); print}' | tail -n1 || \$PRINTF "%s\n" "\$SRB2KARTLATESTVER")

            fi

            if [ -n "\$SRB2KARTLATESTVER" ] && ([ "\$SRB2KARTVER" != "\$SRB2KARTLATESTVER" ] && [ "\$(\$PRINTF "\$SRB2KARTVER" | gawk '{gsub("\\\.|-|[a-z]|[A-Z]",""); print}')" -lt "\$(\$PRINTF "\$SRB2KARTLATESTVER" | gawk '{gsub("\\\.|-|[a-z]|[A-Z]",""); print}')" ]); then

                if [ -n "\$ISNET" ]; then

                    SRB2KARTOLDASSETURL=\$(curl -sL "\$SRB2KARTASSETURL" | gawk -F'"' '/'\$SRB2KARTVER'\/.*Installer.exe/ {print \$4}')

                    if [ -z "\$SRB2KARTOLDASSETURL" ]; then

                        SRB2KARTASSETURL=\$(curl -sL "\$SRB2KARTASSETURL" | gawk -F'"' '/browser_download_url.*Installer.exe/ {print \$4}' | head -n1)
                        \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Couldn't fetch older assets. Downloading and extracting $BUILDNAME's latest assets. Please wait..."

                    else

                        SRB2KARTASSETURL="\$SRB2KARTOLDASSETURL"

                    fi

                    if [ "\$(curl -X GET -sLI "\$SRB2KARTASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/SRB2Kart-\$SRB2KARTVER.exe" 2> /dev/null)" ]; then

                        rm -f "\$SRB2BLDROOT/assets/SRB2Kart-\$SRB2KARTVER.exe"
                        curl -RL "\$SRB2KARTASSETURL" -o "\$SRB2BLDROOT/assets/SRB2Kart-\$SRB2KARTVER.exe"

                    fi

                fi

                7z x -y "\$SRB2BLDROOT/assets/SRB2Kart-\$SRB2KARTVER.exe" "*.kart" "*.srb" "*.dat" "mdls/*" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            else

                if [ -n "\$ISNET" ]; then

                    SRB2KARTASSETURL=\$(curl -sL "\$SRB2KARTASSETURL" | gawk -F'"' '/browser_download_url.*Installer.exe/ {print \$4}' | head -n1)
                    if [ "\$(curl -X GET -sLI "\$SRB2KARTASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/SRB2Kart-Latest.exe" 2> /dev/null)" ]; then

                        rm -f "\$SRB2BLDROOT/assets/SRB2Kart-Latest.exe"
                        curl -RL "\$SRB2KARTASSETURL" -o "\$SRB2BLDROOT/assets/SRB2Kart-Latest.exe"

                    fi

                fi

                7z x -y "\$SRB2BLDROOT/assets/SRB2Kart-Latest.exe" "*.kart" "*.srb" "*.dat" "mdls/*" -o"\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR"

            fi

            find "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR" -type d -exec chmod -R 755 {} \;

        fi
    }

    extractwindowsdlls() {
        if [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ] || [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

            if [ -f "\$SRB2BLDROOT/assets/SRB2FinalDemo.exe" ] && ([ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ]); then

                unrar x -y "\$SRB2BLDROOT/assets/SRB2FinalDemo.exe" "r_opengl.dll" "fmod.dll" "\$BUILD/build/AppDir/usr/lib"

            fi

            if [ -n "\$ISNET" ]; then

                SRB2ASSETURL=\$(curl -sL "\$SRB2ASSETURL" | gawk -F'"' '/browser_download_url.*Full.zip/ {print \$4}' | head -n1)
                if [ "\$(curl -X GET -sLI "\$SRB2ASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/assets/SRB2-Latest.zip" 2> /dev/null)" ]; then

                    rm -f "\$SRB2BLDROOT/assets/SRB2-Latest.zip"
                    curl -RL "\$SRB2ASSETURL" -o "\$SRB2BLDROOT/assets/SRB2-Latest.zip"

                fi

            fi

            7z x -y "\$SRB2BLDROOT/assets/SRB2-Latest.zip" "*.dll" -o"\$BUILD/build/AppDir/usr/lib"
            mv -f "\$BUILD/build/AppDir/usr/lib/SDL2_mixer_ext.dll" "\$BUILD/build/AppDir/usr/lib/SDL2_mixer.dll"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ]; then

            unrar x -y "\$SRB2BLDROOT/assets/SRB2-2.0.exe" "*.dll" "\$BUILD/build/AppDir/usr/lib"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ]; then

            git clone \$GITOPTS https://git.do.srb2.org/SteelT/SRB2-OLD.git --recursive "/tmp/SRB2FinalDemoDlls"
            rm -rf "\$BUILD/libs"
            cp -rf "/tmp/SRB2FinalDemoDlls/libs" "\$BUILD/libs"
            7z e -y "\$SRB2BLDROOT/assets/SRB21095.zip" "*/*.dll" -o"\$BUILD/build/AppDir/usr/lib"

        elif [ "\$IS64" = "64" ]; then

            if [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ]; then

                rm -rf "\$BUILD/libs/dll-binaries/i686/Old"
                cp -f \$(find "\$BUILD/libs/dll-binaries/i686" "\$BUILD/libs/libopenmpt/bin/x86" "\$BUILD/libs/SDL2_mixer/i686-w64-mingw32/bin" "\$BUILD/libs/SDLMixerX/i686-w64-mingw32/bin" -name "*.dll" 2> /dev/null | gawk '{n = \$0; sub(".*/","", n); if (!seen[n]++) print \$0}') "\$BUILD/build/AppDir/usr/lib"
                cp -f \$(find "\$BUILD/libs/curl/lib32/libcurl.dll" "\$BUILD/libs/SDL2/i686-w64-mingw32/bin/SDL2.dll" "\$BUILD/bin/Resources/libgme.dll" "\$BUILD/bin/Resources/fmodex.dll" 2> /dev/null) "\$BUILD/build/AppDir/usr/lib"

            elif [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ]; then

                cp -f \$(find "\$BUILD/libs/bin" -name "*.dll" 2> /dev/null) "\$BUILD/build/AppDir/usr/lib"

            elif [ "\$BUILD" != "\$BUILDPATH/blankart" ] && [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" != "RingRacers" ]; then

                rm -rf "\$BUILD/libs/dll-binaries/x86_64/Old"
                cp -f \$(find "\$BUILD/libs/dll-binaries/x86_64" "\$BUILD/libs/libopenmpt/bin/x86_64" "\$BUILD/libs/SDL2_mixer/x86_64-w64-mingw32/bin" "\$BUILD/libs/SDLMixerX/x86_64-w64-mingw32/bin" -name "*.dll" 2> /dev/null | gawk '{n = \$0; sub(".*/","", n); if (!seen[n]++) print \$0}') "\$BUILD/build/AppDir/usr/lib"
                cp -f \$(find "\$BUILD/libs/curl/lib64/libcurl-x64.dll" "\$BUILD/libs/SDL2/x86_64-w64-mingw32/bin/SDL2.dll" "/usr/lib/gcc/x86_64-w64-mingw32/"*-win32"/libgcc_s_seh"*.dll 2> /dev/null) "\$BUILD/build/AppDir/usr/lib"

            fi

        elif [ "\$IS64" != "64" ] && [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" != "RingRacers" ]; then

            rm -rf "\$BUILD/libs/dll-binaries/i686/Old"
            cp -f \$(find "\$BUILD/libs/dll-binaries/i686" "\$BUILD/libs/bin" "\$BUILD/libs/libopenmpt/bin/x86" "\$BUILD/libs/SDL2_mixer/i686-w64-mingw32/bin" "\$BUILD/libs/SDLMixerX/i686-w64-mingw32/bin" -name "*.dll" 2> /dev/null | gawk '{n = \$0; sub(".*/","", n); if (!seen[n]++) print \$0}') "\$BUILD/build/AppDir/usr/lib"
            cp -f \$(find "\$BUILD/libs/curl/lib32/libcurl.dll" "\$BUILD/libs/SDL2/i686-w64-mingw32/bin/SDL2.dll" "\$BUILD/bin/Resources/libgme.dll" "\$BUILD/bin/Resources/fmodex.dll" 2> /dev/null) "\$BUILD/build/AppDir/usr/lib"

        fi
    }

    # Update Docker/Podman container.
    \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating \$(\$PRINTF "%s\n" "\\$OSVIRT" | gawk 'match(\$0, /docker|podman/) {print substr(\$0, RSTART, RLENGTH)}') container. Please wait..."

    if [ -n "\$ISNET" ]; then

        if [ "\$LIBC" = "musl" ] || [ "\$ANDROID" = "1" ]; then

            sudo apk update && sudo apk upgrade

        else

            sudo apt update && sudo apt full-upgrade -y

        fi

    fi

    # Download and extract assets.
    if ([ "\$BUILD" != "\$BUILDPATH/wadcli" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker" ] && [ "\$BUILD" != "\$BUILDPATH/neptunefm" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker-ring-racers" ] && [ "\$BUILD" != "\$BUILDPATH/followermaker" ] && [ "\$BUILD" != "\$BUILDPATH/slade" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-zone-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-gksz-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-lowee-builder" ] && [ "\$BUILD" != "\$BUILDPATH/high-voltage-ring" ] && [ "\$BUILD" != "\$BUILDPATH/aseprite" ]); then

        if [ -n "\$ISNET" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading and extracting $BUILDNAME's assets. Please wait..."

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Extracting $BUILDNAME's assets. Please wait..."

        fi

        if [ "\$GITVER" != "\$GITDEFVER" ] || [ "\$(dirname \$BUILD)" = "\$BUILDPATH/srb2-custom" ]; then

            extractcustomassets

        else

            extractassets

        fi

        if [ "\$OS" = "Windows" ] && [ "\$ANDROID" != "1" ]; then

            extractwindowsdlls

        fi

    fi

if [ "\$ANDROID" = "1" ]; then

    cd "\$BUILD/android" || exit

    # Running comptime.sh before compiling to avoid errors.
    if [ -x "\$BUILD/comptime.sh" ]; then

        gawk -i inplace '{gsub("\r",""); print}' "\$BUILD/comptime.sh"

    fi

    if [ -x "\$BUILD/android/gradlew" ]; then

        gawk -i inplace '{gsub("\r",""); print}' "\$BUILD/android/gradlew"

    fi

    \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $BUILDNAME's Android APK. Please wait..."

    if [ "\$SRB2BLDNOGRADLECACHE" = "1" ]; then

        "\$BUILD/android/gradlew" assembleDebug --no-build-cache --no-configuration-cache --parallel --max-workers="\$NCPU"

    else

        "\$BUILD/android/gradlew" assembleDebug --build-cache --configuration-cache --parallel --max-workers="\$NCPU"

    fi

else

    # Set path to src directory for old builds from SRB2SVN repository.
    if [ "\$BUILD" = "\$BUILDPATH/xsrb2" ]; then

        SRC="SRB2/branches/XMOD/src"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ]; then

        SRC="SRB2/branches/SF94/src"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ]; then

        SRC="SRB2/branches/RIDER/src"

    elif [ "\$BUILD" = "\$BUILDPATH/sbb2" ]; then

        SRC="SRB2/branches/FLAME/src"

    elif [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ]; then

        SRC="src"

    elif [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ]; then

        SRC="SRB21094/branches/JTESHUFFLE/src"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-live" ]; then

        SRC="SRB21094/branches/LIVE/src"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ]; then

        SRC="SRB21094/branches/LOZ/src"

    elif [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

        SRC="SRB21094/branches/FLAME/src"

    elif [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

        SRC="Code"

    else

        SRC="src"

    fi

    \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Patching $BUILDNAME's source code. Please wait..."

    if [ "\$BUILD" = "\$BUILDPATH/kartmaker" ] || [ "\$BUILD" = "\$BUILDPATH/neptunefm" ] || [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ] || [ "\$BUILD" = "\$BUILDPATH/followermaker" ]; then

         # Replacing build script for some kartmaker builds.
         if [ -n "\$ISNET" ] && [ "\$BUILD" != "\$BUILDPATH/neptunefm" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker-ring-racers" ] && [ "\$BUILD" != "\$BUILDPATH/followermaker" ]; then

             curl -RL https://raw.githubusercontent.com/BombchuLink/kartmaker/master/build.sh -o "\$BUILD/build.sh"

         fi

         chmod 755 "\$BUILD/build.sh"

         # Replacing shebang #!/bin/env sh to #!/bin/sh due to run error with build script.
         gawk -i inplace '{gsub("#!/bin/env sh","#!/bin/sh"); print}' "\$BUILD/build.sh"

         if [ "\$OS" = "Windows" ]; then

             gawk -i inplace '{gsub("gcc","'\$CCACHE_BIN_PATH''\$ARCH-w64-mingw32-''\$MINGWCCVER'"); gsub("kartmaker","kartmaker.exe"); gsub("followermaker","followermaker.exe"); gsub("NeptuneFM","NeptuneFM.exe"); gsub("\r",""); print}' "\$BUILD/build.sh"

         fi

    fi

    # Patching headers, source code to avoid compilation failure for builds on Windows.
    if [ "\$OS" = "Windows" ] && [ "\$BUILD" != "\$BUILDPATH/wadcli" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker" ] && [ "\$BUILD" != "\$BUILDPATH/neptunefm" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker-ring-racers" ] && [ "\$BUILD" != "\$BUILDPATH/followermaker" ] && [ "\$BUILD" != "\$BUILDPATH/slade" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-zone-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-gksz-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-lowee-builder" ] && [ "\$BUILD" != "\$BUILDPATH/high-voltage-ring" ] && [ "\$BUILD" != "\$BUILDPATH/aseprite" ] && [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" != "RingRacers" ]; then

         sudo gawk -i inplace '/#if !defined\(_WIN32\) && !defined\(__CYGWIN__\)/ {suppress=1} /^\$/ {suppress=0} !suppress' /usr/*/include/_mingw.h
         sudo gawk -i inplace '/#ifndef _WIN32/ {suppress=1} /^\$/ {suppress=0} !suppress' /usr/*/include/_mingw_stdarg.h
         sudo gawk -i inplace '/#ifndef _WIN32/ {suppress=1} /^\$/ {suppress=0} !suppress' /usr/*/include/sys/types.h
         sudo gawk -i inplace '/#ifndef _WIN32/ {suppress=1} /^\$/ {suppress=0} !suppress' /usr/*/include/sys/stat.h

         # Removing exchndl dependency for some SRB2/SRB2Kart/Ring Racers builds due to linking errors.
         if [ -f "\$BUILD/src/sdl/i_main.c" ] && [ -z "\$(gawk '/#ifdef DRMINGW/ {print}' \$BUILD/src/sdl/i_main.c)" ]; then

             gawk -i inplace '/#include "exchndl.h"/ {suppress=1} /#endif/ {suppress=0} !suppress' "\$BUILD/src/sdl/i_main.c"
             gawk -i inplace '/ExcHndlInit()/ {suppress=1} /}/ {suppress=0} !suppress' "\$BUILD/src/sdl/i_main.c"

         fi

         # Linking windres and dllwrap for compiling specific builds.
         if [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ] || [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ] || [ "\$BUILD" = "\$BUILDPATH/newmillennium" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ] || [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

             sudo ln -sf "/usr/bin/i686-w64-mingw32-windres" "/usr/bin/windres"
             sudo ln -sf "/usr/bin/i686-w64-mingw32-dllwrap" "/usr/bin/dllwrap"

             if [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ] || [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

                 sudo ln -sf "/usr/local/bin/i686-w64-mingw32-ld" "/usr/bin/i686-w64-mingw32-ld"

             fi

         else

             sudo ln -sf "/usr/bin/\$ARCH-w64-mingw32-windres" "/usr/bin/windres"
             sudo ln -sf "/usr/bin/\$ARCH-w64-mingw32-dllwrap" "/usr/bin/dllwrap"

         fi

    fi

    # Unset variable GITVERCONF, if git branch SRB2BLDGITVER is not specified.
    if [ "\$GITVERCONF" = "\$GITDEFVER" ] && [ -z "\$SRB2BLDGITVER" ]; then

        unset GITVERCONF

    fi

    # Running comptime.sh before compiling to avoid errors.
    if [ -x "\$BUILD/comptime.sh" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-2.0" ]; then

        gawk -i inplace '{gsub("\r",""); print}' "\$BUILD/comptime.sh"

    fi

    # Compile code with C17 standard in compiler.
    if [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-beta6" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-uncapped-plus" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-netplus" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-destructive-illusion" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-fusion-advance" ] || [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ] || [ "\$BUILD" = "\$BUILDPATH/newmillennium" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-persona" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-galaxy" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-hep" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ]; then

        export CFLAGS="-std=gnu17"

    # Dirty workaround for Ring Racers HEP buffer overflow from Noa options menu.
    elif [ "\$BUILD" = "\$BUILDPATH/ring-racers-hep" ]; then

        export CFLAGS="-D_FORTIFY_SOURCE=0"

    fi

    # Removing SDL_OpenURL, because of using outdated SDL2 in Ubuntu 18.04 Docker/Podman container according to issue #21 from https://github.com/bijman/srb2bld/issues/21.
    if [ -f "\$BUILD/src/sdl/i_system.c" ] && [ "\$(gawk 'match(\$0, /SDL_OpenURL/) {print substr(\$0, RSTART, RLENGTH)}' \$BUILD/src/sdl/i_system.c 2> /dev/null | head -n1)" = "SDL_OpenURL" ]; then

        gawk -i inplace '/if \(buttonid == 1\)/ {suppress=1} /}/ {suppress=0} !suppress' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '/#if SDL_VERSION_ATLEAST\([0-9].*\)/ {suppress=1} /}/ {suppress=0} !suppress' "\$BUILD/src/sdl/i_system.c"

    fi

    # Renaming APPIMAGE compile flag from Makefile to prevent triggering build's AppImage_build.sh script.
    if [ -f "\$BUILD/src/Makefile" ] && [ "\$(gawk 'match(\$0, /APPIMAGE/) {print substr(\$0, RSTART, RLENGTH)}' \$BUILD/src/Makefile 2> /dev/null | head -n1)" = "APPIMAGE" ]; then

        gawk -i inplace '{gsub("APPIMAGE","APPIMAGEBUILD"); print}' "\$BUILD/src/Makefile"

    fi

    # Removing function "FUNCINLINE static ATTRINLINE struct _EXCEPTION_POINTERS *GetExceptionInformation(VOID)" in file win_dbg.h due to "win32/win_dbg.h:34:58: error: expected identifier or '(' before 'struct'".
    if [ -f "\$BUILD/\$SRC/win32/win_dbg.h" ] && [ "\$(gawk 'match(\$0, /FUNCINLINE static ATTRINLINE struct _EXCEPTION_POINTERS \*GetExceptionInformation\(VOID\)/) {print substr(\$0, RSTART, RLENGTH)}' \$BUILD/\$SRC/win32/win_dbg.h 2> /dev/null | head -n1)" = "FUNCINLINE static ATTRINLINE struct _EXCEPTION_POINTERS *GetExceptionInformation(VOID)" ]; then

        gawk -i inplace '/FUNCINLINE static ATTRINLINE struct _EXCEPTION_POINTERS \*GetExceptionInformation\(VOID\)/ {suppress=1} /\/\/.*Alam_GBC: use __try1\(seh\)/ {suppress=0} !suppress' "\$BUILD/\$SRC/win32/win_dbg.h"

    fi

    # Modify the build's configuration and assets directory names to avoid conflicts between installed builds. Other fixes as well for specific build.
    if [ "\$BUILD" = "\$BUILDPATH/srb2" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2"); print}' "\$BUILD/src/sdl/i_system.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2classic\\"","#define DEFAULTDIR \\".srb2classic'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2classic\\"","#define DEFAULTDIR \\"srb2classic'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/srb2-classic","'\$SRB2BLDPREFIX'/share/games/SRB2Classic"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/srb2-classic","'\$SRB2BLDPREFIX'/games/SRB2Classic"); print}' "\$BUILD/src/sdl/i_system.c"

        # Replace MD5 hashes after creating assets.
        for a in \$(ls "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/"*.pk3 | gawk -F'/' '{gsub(".pk3",""); print \$NF}'); do

            HASH=\$(gawk -F'"' '/#define ASSET_HASH_'\$(\$PRINTF "\$a" | gawk '{print toupper(\$0)}')'_PK3/ {print \$2}' "\$BUILD/src/config.h.in")
            if [ -n "\$HASH" ]; then

                gawk -i inplace '{gsub("'\$HASH'","'\$(md5sum "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/\$a.pk3" | gawk '{print \$1}')'"); print}' "\$BUILD/src/config.h.in"

            fi

        done

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-beta6" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2beta\\"","#define DEFAULTDIR \\".srb2beta'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2beta\\"","#define DEFAULTDIR \\"srb2beta'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2Beta"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2Beta"); print}' "\$BUILD/src/sdl/i_system.c"

        # Fixing undefined reference during linking.
        gawk -i inplace '{gsub("///        parameters, and call the startup functions.","///        parameters, and call the startup functions.\nchar savegamename[256];"); print}' "\$BUILD/src/d_main.c"
        gawk -i inplace '{gsub("char savegamename","extern char savegamename"); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("nightsdata_t ntemprecords","extern nightsdata_t ntemprecords"); print}' "\$BUILD/src/doomstat.h"
        gawk -i inplace '{gsub("INT16 ms_RoomId","extern INT16 ms_RoomId"); print}' "\$BUILD/src/mserv.h"
        gawk -i inplace 'BEGIN{RS=""; ORS="\n\n"} {gsub("\r",""); gsub(/static void P_NukeAllPlayers\(player_t \*player\);\n#endif/, "static void P_NukeAllPlayers(player_t *player);\n#endif\n\nUINT32 music_stack_fadein;\nUINT32 music_stack_fadeout;\nboolean music_stack_noposition;")}1' "\$BUILD/src/p_user.c"
        gawk -i inplace 'BEGIN{RS=""; ORS="\n\n"} {gsub("\r",""); gsub(/static INT32 S_AdjustSoundParams\(const mobj_t \*listener, const mobj_t \*source, INT32 \*vol, INT32 \*sep, INT32 \*pitch, sfxinfo_t \*sfxinfo\);\n#endif/,"static INT32 S_AdjustSoundParams(const mobj_t *listener, const mobj_t *source, INT32 *vol, INT32 *sep, INT32 *pitch, sfxinfo_t *sfxinfo);\n#endif\n\nopenmpt_module *openmpt_mhandle = NULL;")}1' "\$BUILD/src/s_sound.c"
        gawk -i inplace 'BEGIN{RS=""; ORS="\n\n"} {gsub("\r",""); gsub(/char music_stack_nextmusname\[7\];\nboolean music_stack_noposition;\nUINT32 music_stack_fadeout;\nUINT32 music_stack_fadein;/,"extern char music_stack_nextmusname[7];\nextern boolean music_stack_noposition;\nextern UINT32 music_stack_fadeout;\nextern UINT32 music_stack_fadein;")}1' "\$BUILD/src/s_sound.h"
        gawk -i inplace '{gsub("openmpt_module \\\\*openmpt_mhandle;","extern openmpt_module *openmpt_mhandle;"); print}' "\$BUILD/src/s_sound.h"
        gawk -i inplace '{gsub("char \\\\*music_stack_nextmusname;","extern char *music_stack_nextmusname;"); print}' "\$BUILD/src/s_sound.h"
        gawk -i inplace '{gsub("const char \\\\*compat_special_music_slots\\\\[16\\\\];","extern const char *compat_special_music_slots[16];"); print}' "\$BUILD/src/s_sound.h"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-uncapped-plus" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2UncappedPlus"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2UncappedPlus"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2UncappedPlus"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SRB2UncappedPlus"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2uncappedplus"); print}' "\$BUILD/src/sdl/i_system.c"

        # Patching SRB2 Uncapped Plus' source code to fix error with implicit declaration of function R_ResetFirstLerp is invalid in C99 [-Werror,-Wimplicit-function-declaration]. Thanks Lach for help with this.
        gawk -i inplace '{gsub("#include \"doomdef.h\"","#include \"r_fps.h\"\n#include \"doomdef.h\""); print}' "\$BUILD/src/p_setup.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-netplus" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2NetPlus"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2NetPlus"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2NetPlus"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SRB2NetPlus"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2netplus"); print}' "\$BUILD/src/sdl/i_system.c"

        # Patching code to fix error: too few arguments to function 'UPNP_GetValidIGD'.
        if [ "\$LIBC" = "musl" ]; then

            gawk -i inplace '{gsub("UPNP_GetValidIGD\\\\(devlist, &urls, &data, lanaddr, sizeof\\\\(lanaddr\\\\)\\\\);","UPNP_GetValidIGD(devlist, \\\\&urls, \\\\&data, lanaddr, sizeof(lanaddr), NULL, 0);"); print}' "\$BUILD/src/i_tcp.c"

        fi

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-reveries" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2Reveries"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2Reveries"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2Reveries"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SRB2Reveries"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2reveries"); print}' "\$BUILD/src/sdl/i_system.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-tsourdt3rd" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2TSoURDt3rd"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2TSoURDt3rd"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2TSoURDt3rd"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SRB2TSoURDt3rd"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2tsourdt3rd"); print}' "\$BUILD/src/sdl/i_system.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-edit" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2Edit"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2Edit"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2Edit"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SRB2Edit"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2edit"); print}' "\$BUILD/src/sdl/i_system.c"

        # Fixing "error: expected identifier enum { false = 0, true = 1 };".
        if [ "\$LIBC" = "musl" ]; then

            gawk -i inplace 'BEGIN{RS=""; ORS="\n\n"} /#ifndef __cplusplus\n#ifndef _WIN32/ {suppress=1} /#ifndef INT8_MIN/ {suppress=0} !suppress' "\$BUILD/src/doomtype.h"

        fi

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-ggj" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2GGJ"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2GGJ"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2GGJ"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SRB2GGJ"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2ggj"); print}' "\$BUILD/src/sdl/i_system.c"

        # Replacing MD5 hash to load srb2ggj.pk3.
        gawk -i inplace '{gsub("'\$(gawk -F'"' '/#define ASSET_HASH_SRB2GGJ_PK3/ {print \$2}' "\$BUILD/src/config.h.in")'","'\$(md5sum "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/srb2ggj.pk3" | gawk '{print \$1}')'"); print}' "\$BUILD/src/config.h.in"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-destructive-illusion" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2DestructiveIllusion"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2DestructiveIllusion"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2DestructiveIllusion"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SRB2DestructiveIllusion"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2destructiveillusion"); print}' "\$BUILD/src/sdl/i_system.c"

        # Fixing "undefined reference to strcmpi".
        gawk -i inplace '{gsub("strcmpi","strcasecmp"); print}' "\$BUILD/src/d_netcmd.c"
        gawk -i inplace '{gsub("strcmpi","strcasecmp"); print}' "\$BUILD/src/d_netfil.c"
        gawk -i inplace '{gsub("strcmpi","strcasecmp"); print}' "\$BUILD/src/w_wad.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2VR"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2VR"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2VR"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SRB2VR"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2vr"); print}' "\$BUILD/src/sdl/i_system.c"

        # Fixing linking of libopenvr.
        gawk -i inplace '{gsub("../libs/openvr/linux*","\$(shell find -L '\$SRB2BLDPREFIX/lib64' '\$SRB2BLDPREFIX/lib' -name libopenvr_api.so 2> /dev/null | head -n1)"); print}' "\$BUILD/src/Makefile.d/sdl.mk"
        \$PRINTF "%s\n" "libs+=\$SRB2BLDROOT/libraries/libopenvr/bin/win32/openvr_api.dll" >> "\$BUILD/src/Makefile.d/win32.mk"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.1-legacy" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2_21\\"","#define DEFAULTDIR \\".srb2_2.1'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2_21\\"","#define DEFAULTDIR \\"srb2_2.1'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2legacy","'\$SRB2BLDPREFIX'/share/games/SRB2legacy"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2legacy","'\$SRB2BLDPREFIX'/games/SRB2legacy"); print}' "\$BUILD/src/sdl/i_system.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-fusion-advance" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2_21\\"","#define DEFAULTDIR \\".srb2_2.1'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2_21\\"","#define DEFAULTDIR \\"srb2_2.1'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2legacy","'\$SRB2BLDPREFIX'/share/games/SRB2FusionAdvance"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2legacy","'\$SRB2BLDPREFIX'/games/SRB2FusionAdvance"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2legacy","/usr/share/games/SRB2FusionAdvance"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2legacy","/usr/games/SRB2FusionAdvance"); print}' "\$BUILD/src/sdl/i_system.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2_2.1'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2_2.1'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2Thokker"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2Thokker"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2Thokker"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SRB2Thokker"); print}' "\$BUILD/src/sdl/i_system.c"

        # Providing path to downloaded SDL2 for Windows for linking to missing.
        \$PRINTF "LDFLAGS+=-L/tmp/SDL2/i686-w64-mingw32/lib -L/tmp/SDL2_mixer/i686-w64-mingw32/lib" >> "\$BUILD/src/win32/Makefile.cfg"

        # Fixing undefined reference during linking.
        gawk -i inplace '{gsub("///        parameters, and call the startup functions.","///        parameters, and call the startup functions.\nchar savegamename[256];"); print}' "\$BUILD/src/d_main.c"
        gawk -i inplace '{gsub("char savegamename","extern char savegamename"); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("nightsdata_t ntemprecords","extern nightsdata_t ntemprecords"); print}' "\$BUILD/src/doomstat.h"
        gawk -i inplace '{gsub("} ATTRPACK","} extern ATTRPACK"); print}' "\$BUILD/src/doomtype.h"
        gawk -i inplace '{gsub("INT16 ms_RoomId","extern INT16 ms_RoomId"); print}' "\$BUILD/src/mserv.h"
        gawk -i inplace '{gsub("OPTS\\\+=-DSDLMAIN",""); print}' "\$BUILD/src/sdl/Makefile.cfg"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2_2.1'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2_2.1'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2TopDown"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2TopDown"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2TopDown"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SRB2TopDown"); print}' "\$BUILD/src/sdl/i_system.c"

    elif [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2_2.1'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2_2.1'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SonicSmashBrawl"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SonicSmashBrawl"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SonicSmashBrawl"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SonicSmashBrawl"); print}' "\$BUILD/src/sdl/i_system.c"

        # Fixing undefined reference during linking.
        gawk -i inplace '{gsub("///        parameters, and call the startup functions.","///        parameters, and call the startup functions.\nchar savegamename[256];"); print}' "\$BUILD/src/d_main.c"
        gawk -i inplace '{gsub("char savegamename","extern char savegamename"); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("nightsdata_t ntemprecords","extern nightsdata_t ntemprecords"); print}' "\$BUILD/src/doomstat.h"
        gawk -i inplace '{gsub("} ATTRPACK","} extern ATTRPACK"); print}' "\$BUILD/src/doomtype.h"
        gawk -i inplace '{gsub("INT16 ms_RoomId","extern INT16 ms_RoomId"); print}' "\$BUILD/src/mserv.h"
        gawk -i inplace '{gsub("const char \\\\*compat_special_music_slots","extern const char *compat_special_music_slots"); print}' "\$BUILD/src/s_sound.h"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/srb2","'\$SRB2BLDPREFIX'/share/games/SRB2-2.0"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/srb2","'\$SRB2BLDPREFIX'/games/SRB2-2.0"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2-2.0"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/srb2","/usr/games/SRB2-2.0"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2-2.0"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/src/Makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/src/Makefile"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/srb2","'\$SRB2BLDPREFIX'/share/games/SRB2CB"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/srb2","'\$SRB2BLDPREFIX'/games/SRB2CB"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2CB"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/srb2","/usr/games/SRB2CB"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2-2.0"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/src/Makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(DLLWRAP\\\\) --def","\$(CC) --shared --def"); print}' "\$BUILD/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(EXENAME\\\\) dll","\$(EXENAME)"); print}' "\$BUILD/src/Makefile"

        # Fixing error "free(): invalid pointer", when running binary.
        gawk -i inplace '{gsub("free\\\\(olddata\\\\);",""); print}' "\$BUILD/src/sdl/i_sound.c"

        # Providing path to downloaded SDL2 for Windows for linking to missing.
        if [ "\$OS" = "Windows" ]; then

            gawk -i inplace '{gsub("SDL_LDFLAGS\\\\?=\\\\$\\\\(shell \\\\$\\\\(SDL_CONFIG\\\\) --libs\\\\)","SDL_LDFLAGS?=-L'\$BUILD'/libs/lib -lSDL"); print}' "\$BUILD/src/sdl/Makefile.cfg"
            gawk -i inplace '{gsub("SDL_CFLAGS\\\\?=\\\\$\\\\(shell \\\\$\\\\(SDL_CONFIG\\\\) --cflags\\\\)","SDL_CFLAGS?=-I'\$BUILD'/libs/include/SDL"); print}' "\$BUILD/src/sdl/Makefile.cfg"
            gawk -i inplace '{gsub("SDL_LDFLAGS\\\\+=-lSDL_mixer","SDL_LDFLAGS+=-L'\$BUILD'/libs/lib -lSDL_mixer"); print}' "\$BUILD/src/sdl/Makefile.cfg"
            gawk -i inplace '{gsub("SDL_CFLAGS\\\\+=-Umain","SDL_CFLAGS+=-I'\$BUILD'/libs/include/SDL -Umain"); print}' "\$BUILD/src/sdl/Makefile.cfg"
            gawk -i inplace '{gsub("LIBS\\\\+=-lGL -lGLU","LIBS+=-lopengl32 -lglu32"); print}' "\$BUILD/src/sdl/Makefile.cfg"

        fi

    elif [ "\$BUILD" = "\$BUILDPATH/xsrb2" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/SRB2/branches/XMOD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/SRB2/branches/XMOD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/srb2","'\$SRB2BLDPREFIX'/share/games/XSRB2"); print}' "\$BUILD/SRB2/branches/XMOD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/srb2","'\$SRB2BLDPREFIX'/games/XSRB2"); print}' "\$BUILD/SRB2/branches/XMOD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/srb2","/usr/share/games/XSRB2"); print}' "\$BUILD/SRB2/branches/XMOD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/srb2","/usr/games/XSRB2"); print}' "\$BUILD/SRB2/branches/XMOD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2-2.0"); print}' "\$BUILD/SRB2/branches/XMOD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/SRB2/branches/XMOD/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/SRB2/branches/XMOD/src/Makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/SRB2/branches/XMOD/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(DLLWRAP\\\\) --def","\$(CC) --shared --def"); print}' "\$BUILD/SRB2/branches/XMOD/src/Makefile"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/SRB2/branches/SF94/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/SRB2/branches/SF94/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/srb2","'\$SRB2BLDPREFIX'/share/games/SRB2SF94Serv"); print}' "\$BUILD/SRB2/branches/SF94/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/srb2","'\$SRB2BLDPREFIX'/games/SRB2SF94Serv"); print}' "\$BUILD/SRB2/branches/SF94/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/srb2","/usr/share/games/SRB2SF94Serv"); print}' "\$BUILD/SRB2/branches/SF94/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/srb2","/usr/games/SRB2SF94Serv"); print}' "\$BUILD/SRB2/branches/SF94/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2-2.0"); print}' "\$BUILD/SRB2/branches/SF94/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/SRB2/branches/SF94/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/SRB2/branches/SF94/src/Makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/SRB2/branches/SF94/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(DLLWRAP\\\\) --def","\$(CC) --shared --def"); print}' "\$BUILD/SRB2/branches/SF94/src/Makefile"

        # Require file SF94-Music.wad to be added while launching game.
        gawk -i inplace '{gsub("D_AddFile\\\\(va\\\\(pandf,srb2waddir,\\"SF94SERV/SF94-City.wad\\"\\\\)\\\\);","D_AddFile(va(pandf,srb2waddir,\\"SF94SERV/SF94-City.wad\\"));\n\tD_AddFile(va(pandf,srb2waddir,\\"SF94SERV/SF94-Music.wad\\"));"); print}' "\$BUILD/SRB2/branches/SF94/src/d_main.c"

        # Changing condition "W_CheckNumForName("ANIMATED") != LUMPERROR" in p_spec.c to force using hardcoded array of animated textures due to engine cut names from SF94-Serv.wad.
        gawk -i inplace '{gsub("W_CheckNumForName\\\\(\\"ANIMATED\\"\\\\) != LUMPERROR","W_CheckNumForName(\\"ANIMATED\\") == LUMPERROR"); print}' "\$BUILD/SRB2/branches/SF94/src/p_spec.c"

        # Adding missing animated texture names in p_spec.c.
        gawk -i inplace '{gsub("{true,      \\"DANCE4\\",       \\"DANCE1\\",       8},","{true,      \\"DANCE4\\",       \\"DANCE1\\",       8},\n\t{true,      \\"TELE9R\\",       \\"TELE1R\\",       2},\n\t{true,      \\"TELE9B\\",       \\"TELE1B\\",       2},\n\t{true,      \\"TELE9G\\",       \\"TELE1G\\",       2},\n\t{true,      \\"TELE9RV\\",       \\"TELE1RV\\",       2},\n\t{true,      \\"TELE9BV\\",       \\"TELE1BV\\",       2},\n\t{true,      \\"TELE9GV\\",       \\"TELE1GV\\",       2},\n\t{true,      \\"SWE7\\",       \\"SWE1\\",       4},"); print}' "\$BUILD/SRB2/branches/SF94/src/p_spec.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/SRB2/branches/RIDER/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/SRB2/branches/RIDER/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2Riders"); print}' "\$BUILD/SRB2/branches/RIDER/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2Riders"); print}' "\$BUILD/SRB2/branches/RIDER/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2Riders"); print}' "\$BUILD/SRB2/branches/RIDER/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SRB2Riders"); print}' "\$BUILD/SRB2/branches/RIDER/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2-2.0"); print}' "\$BUILD/SRB2/branches/RIDER/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/SRB2/branches/RIDER/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/SRB2/branches/RIDER/src/Makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/SRB2/branches/RIDER/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(DLLWRAP\\\\) --def","\$(CC) --shared --def"); print}' "\$BUILD/SRB2/branches/RIDER/src/Makefile"

        # Replacing MD5 hash to load riderslevels.ridr.
        gawk -i inplace '{gsub("c4d7a6a35887e6c7375250aad7cdb2e8","16ef8aa6b64d499ffc8622a7a06abc1f"); print}' "\$BUILD/SRB2/branches/RIDER/src/d_main.c"

    elif [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/srb2","'\$SRB2BLDPREFIX'/share/games/SuperSRB2KartZ"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/srb2","'\$SRB2BLDPREFIX'/games/SuperSRB2KartZ"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/srb2","/usr/share/games/SuperSRB2KartZ"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/srb2","/usr/games/SuperSRB2KartZ"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\SuperSRB2KartZ"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/src/Makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(DLLWRAP\\\\) --def","\$(CC) --shared --def"); print}' "\$BUILD/src/Makefile"

        # Replacing MD5 hash to load kart.kart.
        gawk -i inplace '{gsub("65e8e080254872b9cf6c2dbfa5080e90","1c29ff4446e131b8c56551d0ddba606d"); print}' "\$BUILD/src/d_main.c"

    elif [ "\$BUILD" = "\$BUILDPATH/sbb2" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/SRB2/branches/FLAME/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2_2.0'\$GITVERCONF'\\""); print}' "\$BUILD/SRB2/branches/FLAME/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SBB2"); print}' "\$BUILD/SRB2/branches/FLAME/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SBB2"); print}' "\$BUILD/SRB2/branches/FLAME/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SBB2"); print}' "\$BUILD/SRB2/branches/FLAME/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SBB2"); print}' "\$BUILD/SRB2/branches/FLAME/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2-2.0"); print}' "\$BUILD/SRB2/branches/FLAME/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/SRB2/branches/FLAME/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/SRB2/branches/FLAME/src/Makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/SRB2/branches/FLAME/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(DLLWRAP\\\\) --def","\$(CC) --shared --def"); print}' "\$BUILD/SRB2/branches/FLAME/src/Makefile"

        # Fixing issue of crashing game, when sound of bomb explosion is triggered.
        gawk -i inplace '!/sprintf\(namebuf, "ds%s", sfx->name\)/ {print}'  "\$BUILD/SRB2/branches/FLAME/src/s_sound.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb21094\\"","#define DEFAULTDIR \\".srb2fd'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb21094\\"","#define DEFAULTDIR \\"srb2fd'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2FinalDemo"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2FinalDemo"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2FinalDemo"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SRB2FinalDemo"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2finaldemo"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/src/makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/src/makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/src/makefile"

        # Corrected: use fwrite with FILE* instead of write() which expects a file descriptor.
        gawk -i inplace '{gsub("write\\\\(logstream, str, \\\\(int\\\\)strlen\\\(str\\\\))","fwrite(str, 1, strlen(str), logstream)"); print}' "\$BUILD/src/hardware/r_opengl/r_opengl.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb21095\\"","#define DEFAULTDIR \\".srb21095'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb21095\\"","#define DEFAULTDIR \\"srb21095'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB21095"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB21095"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB21095"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb21095"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/src/makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/src/makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/src/makefile"

        # Corrected: use fwrite with FILE* instead of write() which expects a file descriptor.
        gawk -i inplace '{gsub("write\\\\(logstream, str, \\\\(int\\\\)strlen\\\(str\\\\))","fwrite(str, 1, strlen(str), logstream)"); print}' "\$BUILD/src/hardware/r_opengl/r_opengl.c"

        # Fixing undefined reference to itoa.
        gawk -i inplace '{gsub("V_DrawCenteredString\\\\(266, STRINGY\\\\(180\\\\), V_YELLOWMAP, itoa\\\\(redflagFuse/TICRATE, buf, 10\\\\)\\\\);","snprintf(buf, sizeof(buf), \"%d\", redflagFuse / TICRATE);\nV_DrawCenteredString(266, STRINGY(180), V_YELLOWMAP, buf);"); print}' "\$BUILD/src/st_stuff.c"
        gawk -i inplace '{gsub("V_DrawCenteredString\\\\(298, STRINGY\\\\(180\\\\), V_YELLOWMAP, itoa\\\\(blueflagFuse/TICRATE, buf, 10\\\\)\\\\);","snprintf(buf, sizeof(buf), \"%d\", blueflagFuse / TICRATE);\nV_DrawCenteredString(298, STRINGY(180), V_YELLOWMAP, buf);"); print}' "\$BUILD/src/st_stuff.c"

        # Changing dprintf to dbgprintf due to error: conflicting types for dprintf.
        gawk -i inplace '{gsub("dprintf","dbgprintf"); print}' "\$BUILD/src/z_zone.c"
        gawk -i inplace '{gsub("dprintf","dbgprintf"); print}' "\$BUILD/src/z_zone.h"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2fd'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2fd'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/srb2","'\$SRB2BLDPREFIX'/share/games/SRB2JTE"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/srb2","'\$SRB2BLDPREFIX'/games/SRB2JTE"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/srb2","/usr/share/games/SRB2JTE"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/srb2","/usr/games/SRB2JTE"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2jte"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/src/makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/src/makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/src/makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(DLLWRAP\\\\) --def","\$(CC) --shared --def"); print}' "\$BUILD/src/makefile"
        gawk -i inplace '{gsub("Nasmw","nasm"); print}' "\$BUILD/src/makefile.cfg"
        gawk -i inplace '{gsub("struct _EXCEPTION_POINTERS \\\\*GetExceptionInformation\\\\(VOID\\\\);",""); print}' "\$BUILD/src/win32/win_dbg.h"

        # Changing condition "W_CheckNumForName("ANIMATED") != -1" in p_spec.c to force using hardcoded array of animated textures due to engine cut names for srb2JTE.wad.
        gawk -i inplace '{gsub("W_CheckNumForName\\\\(\\"ANIMATED\\"\\\\) != -1","W_CheckNumForName(\\"ANIMATED\\") == -1"); print}' "\$BUILD/src/p_spec.c"

        # Adding missing animated texture names in p_spec.c.
        gawk -i inplace '{gsub("{true,      \\"YEL3\\",         \\"YEL1\\",         4},","{true,      \\"YEL3\\",         \\"YEL1\\",         4},\n\t{true,      \\"MONITOR3\\",         \\"MONITOR1\\",         22},\n\t{true,      \\"MONITOR6\\",         \\"MONITOR4\\",         22},\n\t{true,      \\"MONITOR9\\",         \\"MONITOR7\\",         22},"); print}' "\$BUILD/src/p_spec.c"

        # Fixing error of compiling build with pCrypt.
        gawk -i inplace '{gsub("char \\\\*pCrypt\\\\(char \\\\*pw, char \\\\*salt\\\\)","char *pCrypt(const char *pw, const char *salt)"); print}' "\$BUILD/tools/masterserver/crypt.cpp"

        # Uncommenting constant UNIVERSE to enable SRB2 Universe mode in the main menu of SRB2 JTE.
        gawk -i inplace '{gsub("//#define UNIVERSE","#define UNIVERSE"); print}' "\$BUILD/src/JTE/JTEDefs.h"

    elif [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2fd'\$GITVERCONF'\\""); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2fd'\$GITVERCONF'\\""); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/srb2","'\$SRB2BLDPREFIX'/share/games/SHUFFLARB2"); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/srb2","'\$SRB2BLDPREFIX'/games/SHUFFLARB2"); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/srb2","/usr/share/games/SHUFFLARB2"); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/srb2","/usr/games/SHUFFLARB2"); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\shufflarb2"); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/Makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(DLLWRAP\\\\) --def","\$(CC) --shared --def"); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/Makefile"

        # Uncomment variables to enable day/night cycle in levels and other stuff.
        gawk -i inplace '{gsub("//\t#define NEWSTUFF","#define NEWSTUFF"); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/JTE/JTEDefs.h"
        gawk -i inplace '{gsub("//\t#define TIMEOFDAY","#define TIMEOFDAY"); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/JTE/JTEDefs.h"

        # Adding flag "-marm" to increase branch range from Thumb-2 for ARM devices.
        if [ -n \$(\$PRINTF "%s\n" "\$ARCH" | gawk 'match(\$0, /arm/) {print substr(\$0, RSTART, RLENGTH)}') ]; then

            gawk -i inplace '{gsub("OPTS\\\\+=-DLINUX","OPTS+=-DLINUX -marm"); print}' "\$BUILD/SRB21094/branches/JTESHUFFLE/src/sdl/MakeNIX.cfg"

        fi

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-live" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2fd'\$GITVERCONF'\\""); print}' "\$BUILD/SRB21094/branches/LIVE/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2fd'\$GITVERCONF'\\""); print}' "\$BUILD/SRB21094/branches/LIVE/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/srb2","'\$SRB2BLDPREFIX'/share/games/SRB2Live"); print}' "\$BUILD/SRB21094/branches/LIVE/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/srb2","'\$SRB2BLDPREFIX'/games/SRB2Live"); print}' "\$BUILD/SRB21094/branches/LIVE/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/srb2","/usr/share/games/SRB2Live"); print}' "\$BUILD/SRB21094/branches/LIVE/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/srb2","/usr/games/SRB2Live"); print}' "\$BUILD/SRB21094/branches/LIVE/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\SRB2Live"); print}' "\$BUILD/SRB21094/branches/LIVE/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/SRB21094/branches/LIVE/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/SRB21094/branches/LIVE/src/Makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/SRB21094/branches/LIVE/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(DLLWRAP\\\\) --def","\$(CC) --shared --def"); print}' "\$BUILD/SRB21094/branches/LIVE/src/Makefile"
        gawk -i inplace '{gsub("Nasmw","nasm"); print}' "\$BUILD/SRB21094/branches/LIVE/src/Makefile.cfg"

        # Adding flag "-marm" to increase branch range from Thumb-2 for ARM devices.
        if [ -n \$(\$PRINTF "%s\n" "\$ARCH" | gawk 'match(\$0, /arm/) {print substr(\$0, RSTART, RLENGTH)}') ]; then

            gawk -i inplace '{gsub("OPTS\\\\+=-DLINUX","OPTS+=-DLINUX -marm"); print}' "\$BUILD/SRB21094/branches/LIVE/src/sdl/MakeNIX.cfg"

        fi

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2fd'\$GITVERCONF'\\""); print}' "\$BUILD/SRB21094/branches/LOZ/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2fd'\$GITVERCONF'\\""); print}' "\$BUILD/SRB21094/branches/LOZ/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/games/srb2","'\$SRB2BLDPREFIX'/share/games/SRB2LoZ"); print}' "\$BUILD/SRB21094/branches/LOZ/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/srb2","/usr/games/SRB2LoZ"); print}' "\$BUILD/SRB21094/branches/LOZ/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\SRB2LoZ"); print}' "\$BUILD/SRB21094/branches/LOZ/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/SRB21094/branches/LOZ/src/makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/SRB21094/branches/LOZ/src/makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/SRB21094/branches/LOZ/src/makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(DLLWRAP\\\\) --def","\$(CC) --shared --def"); print}' "\$BUILD/SRB21094/branches/LOZ/src/makefile"
        gawk -i inplace '{gsub("LIBS :=","LIBS := -L../tools/libpng-src/projects -L../tools/zlib/win32"); print}' "\$BUILD/SRB21094/branches/LOZ/src/makefile"
        gawk -i inplace '{gsub("Nasmw","nasm"); print}' "\$BUILD/SRB21094/branches/LOZ/src/makefile.cfg"
        gawk -i inplace '{gsub("struct _EXCEPTION_POINTERS \\\\*GetExceptionInformation\\\\(VOID\\\\);",""); print}' "\$BUILD/SRB21094/branches/LOZ/src/win32/win_dbg.h"
        gawk -i inplace '{gsub("\\\\/\\\\/\\\\/\tFile i\\\\/o","#include <zlib.h>"); print}' "\$BUILD/SRB21094/branches/LOZ/src/m_misc.c"
        gawk -i inplace '{gsub("#define png_sizeof \\\\(x\\\\) sizeof \\\\(x\\\\)","#define png_sizeof(x) sizeof(x)"); print}' "\$BUILD/SRB21094/branches/LOZ/src/hardware/hw_md2.c"
        gawk -i inplace '{gsub("png_bytep \\\\*row_pointers = png_malloc\\\\(png_ptr, height\\\\*png_sizeof \\\\(png_bytep\\\\)\\\\);","png_bytep *row_pointers = png_malloc(png_ptr, height*png_sizeof(png_bytep));"); print}' "\$BUILD/SRB21094/branches/LOZ/src/hardware/hw_md2.c"

    elif [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2fd'\$GITVERCONF'\\""); print}' "\$BUILD/SRB21094/branches/FLAME/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2fd'\$GITVERCONF'\\""); print}' "\$BUILD/SRB21094/branches/FLAME/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SSBSS"); print}' "\$BUILD/SRB21094/branches/FLAME/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SSBSS"); print}' "\$BUILD/SRB21094/branches/FLAME/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SSBSS"); print}' "\$BUILD/SRB21094/branches/FLAME/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SSBSS"); print}' "\$BUILD/SRB21094/branches/FLAME/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\ssbss"); print}' "\$BUILD/SRB21094/branches/FLAME/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\$\\\\(CC\\\\) \\\\$\\\\(CFLAGS\\\\) -MM \\\\*.c","\$(CC) \$(CFLAGS) -MM \$(wildcard *.c)"); print}' "\$BUILD/SRB21094/branches/FLAME/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(INTERFACE\\\\)/\\\\*.c","\$(wildcard \$(INTERFACE)/*.c)"); print}' "\$BUILD/SRB21094/branches/FLAME/src/Makefile"
        gawk -i inplace '{gsub("\\\\$\\\\(DLLWRAP\\\\) --def","\$(CC) --shared --def"); print}' "\$BUILD/SRB21094/branches/FLAME/src/Makefile"
        gawk -i inplace '{gsub("hardware/\\\\*.c","\$(wildcard hardware/*.c)"); print}' "\$BUILD/SRB21094/branches/FLAME/src/Makefile"
        gawk -i inplace '{gsub("Nasmw","nasm"); print}' "\$BUILD/SRB21094/branches/FLAME/src/Makefile.cfg"

        # Removing "else" line that causes problem with compilation.
        gawk -i inplace 'NR != 40' "\$BUILD/SRB21094/branches/FLAME/src/win32/Makefile.cfg"

        # Fixing error: 'blackow' undeclared (first use in this function).
        gawk -i inplace '{gsub("blackow = 1; // BAM!","player->blackow = 1; // BAM!"); print}' "\$BUILD/SRB21094/branches/FLAME/src/p_user.c"

        # Fixing buffer overflow.
        gawk -i inplace '{gsub("-Os","-O0 -fno-stack-protector"); print}' "\$BUILD/SRB21094/branches/FLAME/src/Makefile"

    elif [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

        if [ "\$OS" = "Windows" ]; then

            set +e
            curl -RLC - "https://gist.github.com/Bijman/d898108c1b3d60627cb6845aae4a694c/raw" -o "\$BUILD/newmillenniumcmakecrosscompilation.patch"
            patch -Np1 -d "\$BUILD" -i "\$BUILD/newmillenniumcmakecrosscompilation.patch"
            set -e

            # Required removing carriage returns from code, if we want patches to be applied, due to CRLF endings from Windows host.
            find "\$BUILD" -type f -name "*.c" -or -name "*.h" -or -name "CMakeLists.txt" -exec gawk -i inplace '{gsub("\r",""); print}' '{}' \;

        else

            # Fixing compile errors in sdl2/i_video.c and w_wad.c
            gawk -i inplace '/boolean VID_InitConsole\(void\) {/ {suppress=1} /void VID_Command_Vidmode\(void\) {/ {suppress=0} !suppress' "\$BUILD/\$SRC/sdl2/i_video.c"
            gawk -i inplace '{gsub("void I_StartupGraphics\\\\(void\\\\)","boolean VID_InitConsole(void) {\n        CV_RegisterVar(\\\\&cv_fullscreen);\n\n        COM_AddCommand(\"videomode\", \"Changes the video mode to the specified one.\", CAT_VIDEO, VID_Command_Vidmode);\n\n        COM_AddCommand(\"listmodes\", \"Lists all available video modes.\", CAT_VIDEO, VID_Command_Listmodes);\n\n        return 0;\n}\n\nvoid I_StartupGraphics(void)"); print}' "\$BUILD/\$SRC/sdl2/i_video.c"
            gawk 'BEGIN {print "#include <time.h>"} {print}' "\$BUILD/\$SRC/w_wad.c" > "\$BUILD/\$SRC/tmp" && mv -f "\$BUILD/\$SRC/tmp" "\$BUILD/\$SRC/w_wad.c"

            # Save logs to home path in newmillennium directory to avoid issues with write permissions.
            cat > /tmp/replacement_code.c << 'REPLACEMENT'
#include <stdlib.h>    // for getenv
#include <stdio.h>     // for snprintf
#include <string.h>    // for strerror
#include <errno.h>     // for errno
#include <sys/types.h> // for stat
#include <sys/stat.h>  // for stat and mkdir
#ifdef _WIN32
#include <direct.h>    // for _mkdir
#endif

// Initialize logstream
char *home = NULL;
#ifdef _WIN32
home = getenv("USERPROFILE"); // Windows home directory
#else
home = getenv("HOME");        // Unix-like home directory
#endif

#define PATH_BUF_SIZE 1024
char dir_path[PATH_BUF_SIZE];
char logfile[PATH_BUF_SIZE];

if (home) {
    #ifdef _WIN32
    snprintf(dir_path, PATH_BUF_SIZE, "%s/newmillennium", home);
    int result = _mkdir(dir_path);
    #else
    snprintf(dir_path, PATH_BUF_SIZE, "%s/.newmillennium", home);
    int result = mkdir(dir_path, 0755);
    #endif
    if (result == -1) {
        if (errno == EEXIST) {
            // Check if the path is a directory
            struct stat st;
            if (stat(dir_path, &st) == 0) {
                if (!S_ISDIR(st.st_mode)) {
                    I_Error("Path %s exists but is not a directory", dir_path);
                }
            } else {
                I_Error("Failed to stat %s: %s", dir_path, strerror(errno));
            }
        } else {
            I_Error("Failed to create directory %s: %s", dir_path, strerror(errno));
        }
    }
    // Construct the log file path
    snprintf(logfile, PATH_BUF_SIZE, "%s/sdllog.txt", dir_path);
} else {
    // Fallback to current directory if home is not found
    snprintf(logfile, PATH_BUF_SIZE, "sdllog.txt");
}

logstream = SDL_RWFromFile(logfile, "a");
if (!logstream) {
    I_Error("Unable to get write access for log file at %s. \n Are you running multiple instances of NewMillenium?", logfile);
}
REPLACEMENT

            gawk -i inplace '/\/\/ init logstream/{system("cat /tmp/replacement_code.c"); found=1; next} !found || !/SDL_RWFromFile\("sdllog\.txt", "a"\)/ && !/I_Error\("Unable to get write access/{print}' "\$BUILD/\$SRC/sdl2/i_main.c"

        fi

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-persona" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2\\"","#define DEFAULTDIR \\".srb2persona'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2\\"","#define DEFAULTDIR \\"srb2persona'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2","'\$SRB2BLDPREFIX'/share/games/SRB2Persona"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2","'\$SRB2BLDPREFIX'/games/SRB2Persona"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2","/usr/share/games/SRB2Persona"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2","/usr/games/SRB2Persona"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("\\\\\\\srb2","\\\\srb2persona"); print}' "\$BUILD/src/sdl/i_system.c"

        # Renamed function from W_GetNumForNameMusic to W_CheckNumForNameMusic due to compilation error: implicit declaration of function 'W_GetNumForNameMusic'.
        gawk -i inplace '{gsub("W_GetNumForNameMusic","W_CheckNumForNameMusic"); print}' "\$BUILD/src/s_sound.c"
        gawk -i inplace '{gsub("W_GetNumForNameMusic","W_CheckNumForNameMusic"); print}' "\$BUILD/src/w_wad.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2kart\\"","#define DEFAULTDIR \\".srb2kart'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2kart\\"","#define DEFAULTDIR \\"srb2kart'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2Kart","'\$SRB2BLDPREFIX'/share/games/SRB2Kart"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2Kart","'\$SRB2BLDPREFIX'/games/SRB2Kart"); print}' "\$BUILD/src/sdl/i_system.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-galaxy" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2kart\\"","#define DEFAULTDIR \\".srb2kart'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2kart\\"","#define DEFAULTDIR \\"srb2kart'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2Kart","'\$SRB2BLDPREFIX'/share/games/SRB2KartGalaxy"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2Kart","'\$SRB2BLDPREFIX'/games/SRB2KartGalaxy"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2Kart","/usr/share/games/SRB2KartGalaxy"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2Kart","/usr/games/SRB2KartGalaxy"); print}' "\$BUILD/src/sdl/i_system.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-hep" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2kart\\"","#define DEFAULTDIR \\".srb2kart'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2kart\\"","#define DEFAULTDIR \\"srb2kart'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2Kart","'\$SRB2BLDPREFIX'/share/games/SRB2KartHEP"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2Kart","'\$SRB2BLDPREFIX'/games/SRB2KartHEP"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2Kart","/usr/share/games/SRB2KartHEP"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2Kart","/usr/games/SRB2KartHEP"); print}' "\$BUILD/src/sdl/i_system.c"

        # Fixed compilation issues "error: incompatible pointer to integer conversion initializing 'int32_t' (aka 'int') with an expression of type 'void *' [-Wint-conversion]".
        gawk -i inplace '{gsub(/consvar_t cv_fakelocalskin = \{"fakelocalskin", "None", CV_SAVE, NULL, 0, NULL, NULL, 0, 0, NULL\};/, "consvar_t cv_fakelocalskin = {\"fakelocalskin\", \"None\", CV_SAVE, NULL, 0, 0, NULL, NULL, 0, 0, NULL};"); print}' "\$BUILD/src/d_netcmd.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-saturn" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2kart\\"","#define DEFAULTDIR \\".srb2kart'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2kart\\"","#define DEFAULTDIR \\"srb2kart'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2Kart","'\$SRB2BLDPREFIX'/share/games/SRB2KartSaturn"); print}' "\$BUILD/src/sdl/i_system.cpp"
        gawk -i inplace '{gsub("/usr/local/games/SRB2Kart","'\$SRB2BLDPREFIX'/games/SRB2KartSaturn"); print}' "\$BUILD/src/sdl/i_system.cpp"
        gawk -i inplace '{gsub("/usr/share/games/SRB2Kart","/usr/share/games/SRB2KartSaturn"); print}' "\$BUILD/src/sdl/i_system.cpp"
        gawk -i inplace '{gsub("/usr/games/SRB2Kart","/usr/games/SRB2KartSaturn"); print}' "\$BUILD/src/sdl/i_system.cpp"

        # Add missing stdbool.h for errors with unknown type bool on Windows.
        if [ "\$OS" = "Windows" ]; then

            gawk -i inplace '{gsub("#include \"info.h\"","#include \"info.h\"\n#include <stdbool.h>"); print}' "\$BUILD/src/p_mobj.h"

        fi

        # Replacing interal types to portable ones for compatibility with Alpine Linux.
        gawk -i inplace '{gsub("__time_t","time_t"); gsub("__syscall_slong_t","long"); print}' "\$BUILD/src/sdl/i_system.cpp"

        # Going back to pthread header due to missing in Ubuntu 18.04.
        gawk -i inplace '{gsub("<threads.h>","<pthread.h>"); print}' "\$BUILD/src/r_draw_span.cpp"

        # Removing compilation flag '-mno-ms-bitfields' from src/Makefile due to "gcc: error: unrecognized command-line option '-mno-ms-bitfields'" for ARM devices.
        if [ -n \$(\$PRINTF "%s\n" "\$ARCH" | gawk 'match(\$0, /arm/) {print substr(\$0, RSTART, RLENGTH)}') ]; then

            gawk -i inplace '/ifneq \\(,\\\$\\(filter \\\$\\(CC\\) \\\$\\(CXX\\),gcc g\\+\\+\\)\\)/ {suppress=1} /^\$/ {suppress=0} !suppress' "\$BUILD/src/Makefile"

        fi

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-neptune" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2kart\\"","#define DEFAULTDIR \\".srb2kart'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2kart\\"","#define DEFAULTDIR \\"srb2kart'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2Kart","'\$SRB2BLDPREFIX'/share/games/SRB2KartNeptune"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2Kart","'\$SRB2BLDPREFIX'/games/SRB2KartNeptune"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2Kart","/usr/share/games/SRB2KartNeptune"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2Kart","/usr/games/SRB2KartNeptune"); print}' "\$BUILD/src/sdl/i_system.c"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2kart\\"","#define DEFAULTDIR \\".srb2kart'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2kart\\"","#define DEFAULTDIR \\"srb2kart'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2Kart","'\$SRB2BLDPREFIX'/share/games/SRB2KartVR"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/local/games/SRB2Kart","'\$SRB2BLDPREFIX'/games/SRB2KartVR"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/share/games/SRB2Kart","/usr/share/games/SRB2KartVR"); print}' "\$BUILD/src/sdl/i_system.c"
        gawk -i inplace '{gsub("/usr/games/SRB2Kart","/usr/games/SRB2KartVR"); print}' "\$BUILD/src/sdl/i_system.c"

        # Fixing linking error for libopenvr.
        gawk -i inplace '{gsub("../libs/openvr/linux.*","\$(shell find -L '\$SRB2BLDPREFIX/lib64' '\$SRB2BLDPREFIX/lib' -name libopenvr_api.so 2> /dev/null | head -n1)"); print}' "\$BUILD/src/sdl/Makefile.cfg"

    elif [ "\$BUILD" = "\$BUILDPATH/blankart" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".srb2kart-v2\\"","#define DEFAULTDIR \\".srb2kart-v2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"srb2kart-v2\\"","#define DEFAULTDIR \\"srb2kart-v2'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/SRB2Kart-V2","'\$SRB2BLDPREFIX'/share/games/SRB2Kart-V2"); print}' "\$BUILD/src/sdl/i_system.cpp"
        gawk -i inplace '{gsub("/usr/local/games/SRB2Kart-V2","'\$SRB2BLDPREFIX'/games/SRB2Kart-V2"); print}' "\$BUILD/src/sdl/i_system.cpp"

        # Patching BlanKart to remove uncommitted changes message from main menu.
        gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "\$BUILD/src/m_menu.c"

        # Fixing linking of pthread.
        gawk -i inplace '{gsub("add_dependencies\\\\(SRB2SDL2 _SRB2_reconf\\\\)","add_dependencies(SRB2SDL2 _SRB2_reconf)\nfind_package(Threads REQUIRED)\ntarget_link_libraries(SRB2SDL2 PRIVATE Threads::Threads)"); print}' "\$BUILD/src/CMakeLists.txt"

        # Fixing error with backtrace linking on musl-based distros.
        gawk -i inplace '/size = backtrace\(array, BT_SIZE\);/ {suppress=1} /CRASHLOG_WRITE/ {suppress=0} !suppress' "\$BUILD/src/sdl/i_system.cpp"

        # Removing compilation flag '-mno-ms-bitfields' from src/CMakeLists.txt due to "gcc: error: unrecognized command-line option '-mno-ms-bitfields'" for ARM devices.
        if [ -n \$(\$PRINTF "%s\n" "\$ARCH" | gawk 'match(\$0, /arm/) {print substr(\$0, RSTART, RLENGTH)}') ]; then

            gawk -i inplace '/if \\("\\\${CMAKE_CXX_COMPILER_ID}" STREQUAL "GNU" OR "\\\${CMAKE_CXX_COMPILER_ID}" STREQUAL "Clang"\)/ {suppress=1} /^\$/ {suppress=0} !suppress' "\$BUILD/src/CMakeLists.txt"

        fi

        # Replace XXH3 hashes after creating assets.
        for a in \$(ls "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/"*.pk3 | gawk -F'/' '{gsub(".pk3",""); print \$NF}'); do

            HASH=\$(gawk -F'0x' '/#define ASSET_HASH_'\$(\$PRINTF "\$a" | gawk '{print toupper(\$0)}')'_PK3/ {print \$2}' "\$BUILD/src/d_main.cpp")
            if [ -n "\$HASH" ]; then

                gawk -i inplace '{gsub("'\$HASH'","'\$(xxhsum -H3 --tag "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR/\$a.pk3" | gawk '{print \$NF}')'"); print}' "\$BUILD/src/d_main.cpp"

            fi

        done

    elif [ "\$BUILD" = "\$BUILDPATH/ring-racers" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".ringracers\\"","#define DEFAULTDIR \\".ringracers'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"ringracers\\"","#define DEFAULTDIR \\"ringracers'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/RingRacers","'\$SRB2BLDPREFIX'/share/games/RingRacers"); print}' "\$BUILD/src/sdl/i_system.cpp"
        gawk -i inplace '{gsub("/usr/local/games/RingRacers","'\$SRB2BLDPREFIX'/games/RingRacers"); print}' "\$BUILD/src/sdl/i_system.cpp"
        gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "\$BUILD/src/f_finale.c"
        gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "\$BUILD/src/d_netcmd.c"

    elif [ "\$BUILD" = "\$BUILDPATH/ring-racers-noire" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".ringracers\\"","#define DEFAULTDIR \\".ringracers'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"ringracers\\"","#define DEFAULTDIR \\"ringracers'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/RingRacers","'\$SRB2BLDPREFIX'/share/games/RingRacersNoire"); print}' "\$BUILD/src/sdl/i_system.cpp"
        gawk -i inplace '{gsub("/usr/local/games/RingRacers","'\$SRB2BLDPREFIX'/games/RingRacersNoire"); print}' "\$BUILD/src/sdl/i_system.cpp"
        gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "\$BUILD/src/f_finale.c"
        gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "\$BUILD/src/d_netcmd.c"

        # Fixing error: no member named 'denom' in 'divider<T, ALGO>' for Ring Racers Noire
        gawk -i inplace '{gsub(/other\.denom/, "other.div.denom")}1' "\$BUILD/src/libdivide.h"

    elif [ "\$BUILD" = "\$BUILDPATH/ring-racers-hep" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".ringracers\\"","#define DEFAULTDIR \\".ringracers'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"ringracers\\"","#define DEFAULTDIR \\"ringracers'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/RingRacers","'\$SRB2BLDPREFIX'/share/games/RingRacersHEP"); print}' "\$BUILD/src/sdl/i_system.cpp"
        gawk -i inplace '{gsub("/usr/local/games/RingRacers","'\$SRB2BLDPREFIX'/games/RingRacersHEP"); print}' "\$BUILD/src/sdl/i_system.cpp"
        gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "\$BUILD/src/f_finale.c"
        gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "\$BUILD/src/d_netcmd.c"

    elif [ "\$BUILD" = "\$BUILDPATH/ring-racers-freaky-build" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".ringracers\\"","#define DEFAULTDIR \\".ringracers'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"ringracers\\"","#define DEFAULTDIR \\"ringracers'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/RingRacers","'\$SRB2BLDPREFIX'/share/games/RingRacersFreakyBuild"); print}' "\$BUILD/src/sdl/i_system.cpp"
        gawk -i inplace '{gsub("/usr/local/games/RingRacers","'\$SRB2BLDPREFIX'/games/RingRacersFreakyBuild"); print}' "\$BUILD/src/sdl/i_system.cpp"

    elif [ "\$BUILD" = "\$BUILDPATH/radio-racers" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \\".ringracers\\"","#define DEFAULTDIR \\".ringracers'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("#define DEFAULTDIR \\"ringracers\\"","#define DEFAULTDIR \\"ringracers'\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
        gawk -i inplace '{gsub("/usr/local/share/games/RingRacers","'\$SRB2BLDPREFIX'/share/games/RadioRacers"); print}' "\$BUILD/src/sdl/i_system.cpp"
        gawk -i inplace '{gsub("/usr/local/games/RingRacers","'\$SRB2BLDPREFIX'/games/RadioRacers"); print}' "\$BUILD/src/sdl/i_system.cpp"
        gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "\$BUILD/src/f_finale.c"
        gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "\$BUILD/src/d_netcmd.c"

        # Fixed in src/radioracers/hud/rr_hud.cpp: error: 'CONST' was not declared in this scope and error: cannot bind non-const lvalue reference of type 'tic_t&' {aka 'unsigned int&'}.
        gawk -i inplace '{gsub("CONST","const"); gsub(/size_t& frame = emoteFrameMap\[emote\];/,"&\n    std::unordered_map<emote_t*, tic_t> emoteLastUpdate;");gsub(/size_t& frame = chatEmoteFrameMap\[emote\];/,"&\n    std::unordered_map<emote_t*, tic_t> chatEmoteLastUpdate;"); print}' "\$BUILD/src/radioracers/hud/rr_hud.cpp"

    elif [ "\$(dirname \$BUILD)" = "\$BUILDPATH/srb2-custom" ]; then

        SRB2CASSETDIRTMP=\$(gawk -F'"' '/\/usr\/local/ {print \$2}' \$BUILD/src/*/i_system.c* | gawk -F'/' '/games/ {print \$NF}' | gawk '!/games/ {print}' 2> /dev/null | head -n1)
        SRB2CASSETDIR=\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)
        SRB2CCONFDIR=\$(gawk -F'\"' '/DEFAULTDIR/ {gsub(" |\\\\.",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null | head -n1)

        if [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

            gawk -i inplace '{gsub("#define DEFAULTDIR \\".'\$SRB2CCONFDIR'\\"","#define DEFAULTDIR \\".'\$SRB2CCONFDIR'c'\$CUSTOMDIR''\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
            gawk -i inplace '{gsub("#define DEFAULTDIR \\"'\$SRB2CCONFDIR'\\"","#define DEFAULTDIR \\"'\$SRB2CCONFDIR'c'\$CUSTOMDIR''\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
            gawk -i inplace '{gsub("\"/usr/local/share/games/'\$SRB2CASSETDIRTMP'\"","\"'\$SRB2BLDPREFIX'/share/games/'\$SRB2CASSETDIR'C'\$CUSTOMDIR'\""); print}' "\$BUILD/src/sdl/i_system.cpp"
            gawk -i inplace '{gsub("\"/usr/local/games/'\$SRB2CASSETDIRTMP'\"","\"'\$SRB2BLDPREFIX'/games/'\$SRB2CASSETDIR'C'\$CUSTOMDIR'\""); print}' "\$BUILD/src/sdl/i_system.cpp"
            gawk -i inplace '{gsub("\"/usr/share/games/'\$SRB2CASSETDIRTMP'\"","\"/usr/games/'\$SRB2CASSETDIR'C'\$CUSTOMDIR'\""); print}' "\$BUILD/src/sdl/i_system.cpp"
            gawk -i inplace '{gsub("\"/usr/games/'\$SRB2CASSETDIRTMP'\"","\"/usr/games/'\$SRB2CASSETDIR'C'\$CUSTOMDIR'\""); print}' "\$BUILD/src/sdl/i_system.cpp"
            gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "\$BUILD/src/f_finale.c"
            gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "\$BUILD/src/d_netcmd.c"

        else

            gawk -i inplace '{gsub("#define DEFAULTDIR \\".'\$SRB2CCONFDIR'\\"","#define DEFAULTDIR \\".'\$SRB2CCONFDIR'c'\$CUSTOMDIR''\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
            gawk -i inplace '{gsub("#define DEFAULTDIR \\"'\$SRB2CCONFDIR'\\"","#define DEFAULTDIR \\"'\$SRB2CCONFDIR'c'\$CUSTOMDIR''\$GITVERCONF'\\""); print}' "\$BUILD/src/doomdef.h"
            gawk -i inplace '{gsub("\"/usr/local/share/games/'\$SRB2CASSETDIRTMP'\"","\"'\$SRB2BLDPREFIX'/share/games/'\$SRB2CASSETDIR'C'\$CUSTOMDIR'\""); print}' "\$BUILD/src/sdl/i_system.c"
            gawk -i inplace '{gsub("\"/usr/local/games/'\$SRB2CASSETDIRTMP'\"","\"'\$SRB2BLDPREFIX'/games/'\$SRB2CASSETDIR'C'\$CUSTOMDIR'\""); print}' "\$BUILD/src/sdl/i_system.c"
            gawk -i inplace '{gsub("\"/usr/share/games/'\$SRB2CASSETDIRTMP'\"","\"/usr/games/'\$SRB2CASSETDIR'C'\$CUSTOMDIR'\""); print}' "\$BUILD/src/sdl/i_system.c"
            gawk -i inplace '{gsub("\"/usr/games/'\$SRB2CASSETDIRTMP'\"","\"/usr/games/'\$SRB2CASSETDIR'C'\$CUSTOMDIR'\""); print}' "\$BUILD/src/sdl/i_system.c"

        fi

    elif [ "\$BUILD" = "\$BUILDPATH/slade" ]; then

        gawk -i inplace '/if\(ZIP_COMMAND\)/ {suppress=1} /if\(APPLE\)/ {suppress=0} !suppress' "\$BUILD/dist/CMakeLists.txt"

        if [ -f "\$BUILD/cmake/cotire.cmake" ]; then

            gawk -i inplace '{gsub(/cmake_minimum_required\(VERSION [0-9.]+\)/, "cmake_minimum_required(VERSION '\$CMAKEPOLVER')")} 1' "\$BUILD/cmake/cotire.cmake"

        fi

        if [ \$(git -C "\$BUILD" describe --tags | gawk -F'_|-' '{gsub("\\\.|-|[a-z]",""); print \$1}' | gawk '{if(\$0 < 1000) {gsub("$","0"); print} else {print}}') -ge "3250" ] && [ "\$LIBC" != "musl" ]; then

            gawk -i inplace '!/REGEX REPLACE "windres"/ {print}' "\$BUILD/cmake/unix.cmake"
            gawk -i inplace '{gsub("\\\\$<BUILD_INTERFACE:|>",""); print}' "\$BUILD/thirdparty/fmt/CMakeLists.txt"

        fi

    # Adding the System.Numerics reference to BuilderMono.csproj file to fix "error CS0246: The type or namespace name 'Matrix4x4' could not be found".
    elif [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ]; then

        gawk -i inplace '{gsub("<Reference Include=\"System.Data\" />","<Reference Include=\"System.Numerics\" />\n\t<Reference Include=\"System.Data\" />"); print}' "\$BUILD/Source/Core/BuilderMono.csproj"

    elif [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]; then

        # Adding the EffectThingAnchorSlope.cs reference to BuilderMono.csproj file to fix "error CS0246: The type or namespace name 'EffectThingAnchorSlope' could not be found".
        gawk -i inplace '{gsub("<Compile Include=\"VisualModes\\\\\\\\EffectThingVertexSlope.cs\" />","<Compile Include=\"VisualModes\\\\EffectThingVertexSlope.cs\" />\n\t<Compile Include=\"VisualModes\\\\EffectThingAnchorSlope.cs\" />"); print}' "\$BUILD/Source/Plugins/BuilderModes/BuilderModesMono.csproj"

        # Renaming configuration file for High Voltage Ring due to run exceptions.
        gawk -i inplace '{gsub("UDBuilder.default.cfg","HVRBuilder.default.cfg"); print}' "\$BUILD/Source/Core/General/General.cs"

    fi

    # Add compilation flags.
    if [ "\$OS" = "Windows" ]; then

        if [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ]; then

            BLDCMD="cmake -S \$BUILD -B \$BUILD/build -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=\$BUILD/cmake/Toolchains/mingw-w64-x86_64.cmake -DCMAKE_INSTALL_PREFIX=\$BUILD/build/AppDir/usr"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ]; then

            if [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ] || [ "\$ARCH" = "x86_64" ]; then

                # Only 32bit supported for Windows build.
                BLDCMD="make CC="\$CCACHE_BIN_PATH"i686-w64-mingw32-\$MINGWCCVER LD_LIBRARY_PATH=\$SRB2BLDROOT/libraries/libopenvr/bin/linux32 C_INCLUDE_PATH=/usr/i686-w64-mingw32/include/.:/usr/include/i386-linux-gnu/.:\$SRB2BLDPREFIX/include/SDL2/. -k -j\$NCPU -C \$BUILD/src MINGW=1 SDL=1 NOOBJDUMP=1 NOVERSION=1 NOUPX=1"

            else

                BLDCMD="make CC="\$CCACHE_BIN_PATH"\$ARCH-w64-mingw32-\$MINGWCCVER LD_LIBRARY_PATH=\$SRB2BLDROOT/libraries/libopenvr/bin/linux32 C_INCLUDE_PATH=/usr/\$ARCH-w64-mingw32/include/.:/usr/include/\$ARCH-linux-gnu/.:\$SRB2BLDPREFIX/include/SDL2/. -k -j\$NCPU -C \$BUILD/src MINGW=1 NONX86=1 SDL=1 NOOBJDUMP=1 NOVERSION=1 NOUPX=1"

            fi

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ] || [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

            if [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ] || [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ]; then

                export BLDFLAGS="SDL=1 NOGETTEXT=1"

            elif [ "\$BUILD" = "\$BUILDPATH/sbb2" ]; then

                export BLDFLAGS="BOMB=1"

            elif [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ]; then

                export BLDFLAGS="SHUFFLE=1"

            elif [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

                export BLDFLAGS="SMASH=1"

            fi

            if [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ] || [ "\$ARCH" = "x86_64" ]; then

               # SDL=1 flag is removed because of errors with building it and only 32bit supported for Windows build.
               BLDCMD="make CC="\$CCACHE_BIN_PATH"i686-w64-mingw32-\$MINGWOLDCCVER LD_LIBRARY_PATH=/usr/local/lib/i386-linux-gnu/.:/usr/lib/i386-linux-gnu/.:/usr/i686-w64-mingw32/lib/. C_INCLUDE_PATH=/usr/local/i686-w64-mingw32/include/.:/usr/i686-w64-mingw32/include/.:/usr/include/i386-linux-gnu/.:/usr/include/. -j\$NCPU -C \$BUILD/\$SRC MINGW=1 NOOBJDUMP=1 NOVERSION=1 NOUPX=1 \$BLDFLAGS"

            else

               BLDCMD="make CC="\$CCACHE_BIN_PATH"\$ARCH-w64-mingw32-\$MINGWOLDCCVER LD_LIBRARY_PATH=\$SRB2BLDPREFIX/lib/\$ARCH-linux-gnu C_INCLUDE_PATH=\$SRB2BLDPREFIX/\$ARCH-w64-mingw32/include/.:/usr/\$ARCH-w64-mingw32/include/.:/usr/include/\$ARCH-linux-gnu/.:/usr/include/.:\$SRB2BLDPREFIX/include/SDL2/. -k -j\$NCPU -C \$BUILD/src MINGW=1 NONX86=1 NOOBJDUMP=1 NOVERSION=1 NOUPX=1 \$BLDFLAGS"

            fi

        elif [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

            BLDCMD="cmake -S \$BUILD/\$SRC -B \$BUILD/build -DCMAKE_C_COMPILER="\$CCACHE_BIN_PATH"i686-w64-mingw32-gcc -DCMAKE_SYSTEM_NAME=Windows -DCMAKE_BUILD_TYPE=Release -DCMAKE_FIND_ROOT_PATH_MODE_PROGRAM=NEVER -DCMAKE_FIND_ROOT_PATH_MODE_LIBRARY=ONLY -DCMAKE_FIND_ROOT_PATH_MODE_INCLUDE=ONLY -DCMAKE_INSTALL_PREFIX=\$BUILD/build/AppDir/usr"

        elif [ "\$BUILD" = "\$BUILDPATH/blankart" ]; then

            export CC=""\$CCACHE_BIN_PATH"\$ARCH-w64-mingw32-gcc-posix"
            export CXX=""\$CCACHE_BIN_PATH"\$ARCH-w64-mingw32-g++-posix"

            BLDCMD="cmake -S \$BUILD -B \$BUILD/build -DCMAKE_C_COMPILER=\$CC -DCMAKE_CXX_COMPILER=\$CXX -DCMAKE_SYSTEM_NAME=Windows -DTOOLCHAIN_PREFIX=\$ARCH-w64-mingw32 -DCMAKE_FIND_ROOT_PATH=/usr/\$ARCH-w64-mingw32 -DCMAKE_FIND_ROOT_PATH_MODE_PROGRAM=NEVER -DCMAKE_FIND_ROOT_PATH_MODE_LIBRARY=ONLY -DCMAKE_FIND_ROOT_PATH_MODE_INCLUDE=ONLY -DBUILD_SHARED_LIBS=OFF -DSRB2_CONFIG_SYSTEM_LIBRARIES=OFF -DSRB2_CONFIG_ENABLE_TESTS=OFF -DSRB2_CONFIG_USE_OPENAL=ON -DCMAKE_BUILD_TYPE=Release -DSRB2_SDL2_EXE_NAME=blankart -DSRB2_SDL2_EXE_SUFFIX= -DCMAKE_INSTALL_PREFIX=\$BUILD/build/AppDir/usr"

        elif [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

            BLDCMD="cmake -S \$BUILD --preset ninja-x86_mingw_static_vcpkg-release -DVCPKG_TARGET_TRIPLET=x86-mingw-static -DCMAKE_C_COMPILER="\$CCACHE_BIN_PATH"i686-w64-mingw32-gcc-posix -DCMAKE_CXX_COMPILER="\$CCACHE_BIN_PATH"i686-w64-mingw32-g++-posix -DCMAKE_MAKE_PROGRAM=/usr/bin/ninja -DCMAKE_BUILD_TYPE=Release -DVCPKG_CHAINLOAD_TOOLCHAIN_FILE=\$VCPKG_ROOT/scripts/toolchains/mingw.cmake -DCMAKE_TOOLCHAIN_FILE=\$VCPKG_ROOT/scripts/buildsystems/vcpkg.cmake -DSRB2_CONFIG_SKIP_COMPTIME=ON"

        elif [ "\$BUILD" = "\$BUILDPATH/wadcli" ]; then

            BLDCMD="make CXX="\$CCACHE_BIN_PATH"\$ARCH-w64-mingw32-\$MINGWCXXVER CPLUS_INCLUDE_PATH=/usr/\$ARCH-w64-mingw32/include/.:/usr/include/\$ARCH-linux-gnu/.:\$SRB2BLDPREFIX/include/. -k -j\$NCPU -C \$BUILD WINDOWS=1"

        elif [ "\$BUILD" = "\$BUILDPATH/kartmaker" ] || [ "\$BUILD" = "\$BUILDPATH/neptunefm" ] || [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ] || [ "\$BUILD" = "\$BUILDPATH/followermaker" ]; then

            BLDCMD="\$BUILD/build.sh"

        elif [ "\$BUILD" = "\$BUILDPATH/slade" ]; then

            BLDCMD="cmake -S \$BUILD -B \$BUILD/build -DCMAKE_C_COMPILER="\$CCACHE_BIN_PATH"\$ARCH-w64-mingw32-\$MINGWCCVER -DCMAKE_CXX_COMPILER="\$CCACHE_BIN_PATH"\$ARCH-w64-mingw32-\$MINGWCXXVER -DCMAKE_INCLUDE_PATH=/usr/include/\$ARCH-linux-gnu;\$BUILD/thirdparty/fmt/include -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=\$BUILD/AppDir/usr -DCMAKE_SYSTEM_NAME=Windows -DTOOLCHAIN_PREFIX=\$ARCH-w64-mingw32 -DCMAKE_FIND_ROOT_PATH=/usr/\$ARCH-w64-mingw32 -DCMAKE_FIND_ROOT_PATH_MODE_PROGRAM=NEVER -DCMAKE_FIND_ROOT_PATH_MODE_LIBRARY=ONLY -DCMAKE_FIND_ROOT_PATH_MODE_INCLUDE=ONLY -DNO_WEBVIEW=ON -DwxWidgets_CONFIG_EXECUTABLE=/usr/bin/wx-config -DFREETYPE_INCLUDE_DIRS=/usr/include/freetype2/freetype -DFREETYPE_LIBRARY=/usr/lib/\$ARCH-linux-gnu/libfreetype.so -DFTGL_INCLUDE_DIR=/usr/include/FTGL -DFTGL_LIBRARIES=/usr/lib/\$ARCH-linux-gnu/libftgl.so -DFLUIDSYNTH_INCLUDE_DIR=/usr/include/fluidsynth -DFLUIDSYNTH_LIBRARIES=/usr/lib/\$ARCH-linux-gnu/libfluidsynth.so -DFREEIMAGE_INCLUDE_DIR=/usr/include -DFREEIMAGE_LIBRARIES=/usr/lib/\$ARCH-linux-gnu/libfreeimage.so -DSFML_DIR=/usr/lib/\$ARCH-linux-gnu/cmake/SFML -DSFML_INCLUDE_DIR=/usr/include/SFML -DSFML_MAIN_LIBRARY_SHARED_NONDEBUG=/usr/lib/\$ARCH-linux-gnu/libsfml-system.so -DSFML_AUDIO_INCLUDE_DIR=/usr/include/SFML/Audio -DSFML_AUDIO_LIBRARY_SHARED_NONDEBUG=/usr/lib/\$ARCH-linux-gnu/libsfml-audio.so -DSFML_NETWORK_INCLUDE_DIR=/usr/include/SFML/Network -DSFML_NETWORK_LIBRARY_SHARED_NONDEBUG=/usr/lib/\$ARCH-linux-gnu/libsfml-network.so -DSFML_SYSTEM_INCLUDE_DIR=/usr/include/SFML/System -DSFML_SYSTEM_LIBRARY_SHARED_NONDEBUG=/usr/lib/\$ARCH-linux-gnu/libsfml-system.so -DSFML_WINDOW_INCLUDE_DIR=/usr/include/SFML/Window -DSFML_WINDOW_LIBRARY_SHARED_NONDEBUG=/usr/lib/\$ARCH-linux-gnu/libsfml-window.so -DLUA_INCLUDE_DIR=/usr/include/lua5.3 -DLUA_LIBRARIES=/usr/lib/\$ARCH-linux-gnu/liblua5.3.so -DMPG123_INCLUDE_DIR=/usr/include -DMPG123_LIBRARIES=/usr/lib/\$ARCH-linux-gnu/libmpg123.so -DZLIB_INCLUDE_DIR=/usr/include -DZLIB_LIBRARY=/usr/lib/\$ARCH-linux-gnu/libz.so -DBZIP2_INCLUDE_DIR=/usr/include -DBZIP2_LIBRARIES=/usr/lib/\$ARCH-linux-gnu/libz.so -DWebP_DIR=/usr/lib/\$ARCH-linux-gnu/cmake/WebP"

        elif [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ] || [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]; then

            BLDCMD="make CXX="\$CCACHE_BIN_PATH"\$MINGWCXXVER CPLUS_INCLUDE_PATH=/usr/include/\$ARCH-linux-gnu/. -k -j\$NCPU -C \$BUILD"

        elif [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

            if [ "\$ARCH" = "x86_64" ]; then

                LIBSKIAPATH="/tmp/libskia/out/Release-x64"

            elif [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ]; then

                LIBSKIAPATH="/tmp/libskia/out/Release-x86"

            elif [ "\$ARCH" = "aarch64" ]; then

                LIBSKIAPATH="/tmp/libskia/out/Release-arm64"

            fi

            BLDCMD="cmake -S \$BUILD -B \$BUILD/build -G Ninja -DCMAKE_POLICY_VERSION_MINIMUM=\$CMAKEPOLVER -DCMAKE_C_COMPILER=\$ARCH-w64-mingw32-gcc-posix -DCMAKE_CXX_COMPILER=\$ARCH-w64-mingw32-g++-posix -DCMAKE_MAKE_PROGRAM=/usr/bin/ninja -DCMAKE_BUILD_TYPE=Release -DCMAKE_LIBRARY_PATH=\$LIBSKIAPATH -DCMAKE_INSTALL_PREFIX=\$BUILD/build/AppDir/usr -DCMAKE_SYSTEM_NAME=Windows -DTOOLCHAIN_PREFIX=\$ARCH-w64-mingw32 -DCMAKE_FIND_ROOT_PATH=/usr/\$ARCH-w64-mingw32 -DCMAKE_FIND_ROOT_PATH_MODE_PROGRAM=NEVER -DCMAKE_FIND_ROOT_PATH_MODE_LIBRARY=ONLY -DCMAKE_FIND_ROOT_PATH_MODE_INCLUDE=ONLY -DBUILD_TESTING=OFF -DCLIP_TESTS=OFF -DCMARK_TESTS=OFF -DENABLE_TEST=OFF -DENABLE_TESTS=OFF -DFMT_CUDA_TEST=OFF -DFMT_TEST=OFF -DJSON11_BUILD_TESTS=OFF -DLAF_WITH_TESTS=OFF -DOBSERVABLE_TESTS=OFF -DPNG_TESTS=OFF -DUNDO_TESTS=OFF -Dtinyxml2_BUILD_TESTING=OFF -DLAF_BACKEND=skia -DSKIA_DIR=/tmp/libskia -DSKIA_LIBRARY_DIR=\$LIBSKIAPATH -DSKIA_LIBRARY=\$LIBSKIAPATH/skia.lib -DWEBP_LIBRARIES=\$LIBSKIAPATH/libwebp.lib -DFREETYPE_LIBRARY=\$LIBSKIAPATH/freetype2.lib -DHARFBUZZ_LIBRARY=\$LIBSKIAPATH/harfbuzz.lib -DSKSHAPER_LIBRARY=\$LIBSKIAPATH/skshaper.lib -DSKUNICODE_LIBRARY=\$LIBSKIAPATH/skunicode.lib -DLIBJPEG_TURBO_LIBRARY=\$LIBSKIAPATH/libjpeg.lib -DCMAKE_PREFIX_PATH=\$LIBSKIAPATH"

        else

            if [ "\$ARCH" = "x86_64" ]; then

                BLDCMD="make CC="\$CCACHE_BIN_PATH"x86_64-w64-mingw32-\$MINGWCCVER CXX="\$CCACHE_BIN_PATH"x86_64-w64-mingw32-\$MINGWCXXVER C_INCLUDE_PATH=/usr/x86_64-w64-mingw32/include/.:/usr/x86_64-linux-gnu/include/.:\$SRB2BLDPREFIX/include/SDL2/.:\$SRB2BLDPREFIX/include/openvr/. -k -j\$NCPU -C \$BUILD/src MINGW64=1 SDL=1 NOOBJDUMP=1 NOVERSION=1 NOUPX=1"

            elif [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ]; then

                BLDCMD="make CC="\$CCACHE_BIN_PATH"i686-w64-mingw32-\$MINGWCCVER CXX="\$CCACHE_BIN_PATH"i686-w64-mingw32-\$MINGWCXXVER C_INCLUDE_PATH=/usr/i686-w64-mingw32/include/.:/usr/include/i386-linux-gnu/.:\$SRB2BLDPREFIX/include/SDL2/.:\$SRB2BLDPREFIX/include/openvr/. -k -j\$NCPU -C \$BUILD/src MINGW=1 SDL=1 NOOBJDUMP=1 NOVERSION=1 NOUPX=1"

            else

                BLDCMD="make CC="\$CCACHE_BIN_PATH"\$ARCH-w64-mingw32-\$MINGWCCVER CXX="\$CCACHE_BIN_PATH"\$ARCH-w64-mingw32-\$MINGWCXXVER C_INCLUDE_PATH=/usr/\$ARCH-w64-mingw32/include/.:/usr/include/\$ARCH-linux-gnu/.:\$SRB2BLDPREFIX/include/SDL2/.:\$SRB2BLDPREFIX/include/openvr/. -k -j\$NCPU -C \$BUILD/src MINGW\$IS64=1 NONX86=1 SDL=1 NOOBJDUMP=1 NOVERSION=1 NOUPX=1"

            fi

        fi

    elif [ "\$OS" = "Linux" ]; then

        if [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ]; then

            BLDCMD="cmake -S \$BUILD -B \$BUILD/build -DCMAKE_C_COMPILER="\$CCACHE_BIN_PATH"\$GCCVER -DCMAKE_CXX_COMPILER="\$CCACHE_BIN_PATH"\$GXXVER -DCMAKE_C_FLAGS=-pthread -DCMAKE_CXX_FLAGS=-pthread -DSRB2_CONFIG_HWRENDER=ON -DBUILD_SHARED_LIBS=ON -DCMAKE_BUILD_TYPE=Debug -DCMAKE_INSTALL_PREFIX=\$BUILD/build/AppDir/usr"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ]; then

            export GCCVER="\$GCCOLDVER"

            if [ "\$LIBC" = "musl" ]; then

                sudo apk del gettext-dev openal-soft-dev fluidsynth-dev
                sudo apk add gettext-tiny-dev

            fi

            if [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ] || [ "\$ARCH" = "x86_64" ]; then

                BLDCMD="make CC="\$CCACHE_BIN_PATH"\$GCCVER C_INCLUDE_PATH=\$SRB2BLDPREFIX/include/.:\$SRB2BLDPREFIX/include/SDL2/.:/usr/lib/klibc-\$ARCH/include/.:/usr/include/FMOD/.:/usr/include/\$ARCH-linux-gnu/. LIBGME_CFLAGS= LIBGME_LDFLAGS=-lgme -j\$NCPU -C \$BUILD/src LINUX\$IS64=1 NOOBJDUMP=1 NOVERSION=1 NOUPX=1"

            else

                BLDCMD="make CC="\$CCACHE_BIN_PATH"\$GCCVER C_INCLUDE_PATH=\$SRB2BLDPREFIX/include/.:\$SRB2BLDPREFIX/include/SDL2/.:/usr/lib/klibc-\$ARCH/include/.:/usr/include/FMOD/.:/usr/include/\$ARCH-linux-gnu/. LIBGME_CFLAGS= LIBGME_LDFLAGS=-lgme -k -j\$NCPU -C \$BUILD/src LINUX\$IS64=1 NONX86=1 NOOBJDUMP=1 NOVERSION=1 NOUPX=1"

            fi

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

            if [ "\$LIBC" = "musl" ]; then

                sudo apk del gettext-dev openal-soft-dev fluidsynth-dev
                sudo apk add gettext-tiny-dev

            fi

            if [ "\$BUILD" = "\$BUILDPATH/sbb2" ]; then

                export BLDFLAGS="BOMB=1"

            elif [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ]; then

                export BLDFLAGS="SHUFFLE=1"

            elif [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

                export BLDFLAGS="SMASH=1"

            fi

            if [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ] || [ "\$ARCH" = "x86_64" ]; then

                BLDCMD="make CC="\$CCACHE_BIN_PATH"\$GCCOLDVER C_INCLUDE_PATH=\$SRB2BLDPREFIX/include/.:\$SRB2BLDPREFIX/include/SDL2/.:/usr/lib/klibc-x86/include/.:/usr/include/FMOD/.:/usr/include/i386-linux-gnu/. LIBGME_CFLAGS= LIBGME_LDFLAGS=-lgme -k -j\$NCPU -C \$BUILD/\$SRC LINUX=1 NOOBJDUMP=1 NOVERSION=1 NOUPX=1 NOASM=1 \$BLDFLAGS"

            else

                BLDCMD="make CC="\$CCACHE_BIN_PATH"\$GCCOLDVER C_INCLUDE_PATH=\$SRB2BLDPREFIX/include/.:\$SRB2BLDPREFIX/include/SDL2/.:/usr/lib/klibc-\$ARCH/include/.:/usr/include/FMOD/.:/usr/include/\$ARCH-linux-gnu/. LIBGME_CFLAGS= LIBGME_LDFLAGS=-lgme -k -j\$NCPU -C \$BUILD/\$SRC LINUX=1 NONX86=1 NOOBJDUMP=1 NOVERSION=1 NOUPX=1 NOASM=1 \$BLDFLAGS"

            fi

        elif [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

            BLDCMD="cmake -S \$BUILD/\$SRC -B \$BUILD/build -DCMAKE_C_COMPILER="\$CCACHE_BIN_PATH"\$GCCVER -DBUILD_SHARED_LIBS=OFF -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=\$BUILD/build/AppDir/usr"

        elif [ "\$BUILD" = "\$BUILDPATH/blankart" ]; then

            export CC=""\$CCACHE_BIN_PATH"\$GCCVER"
            export CXX=""\$CCACHE_BIN_PATH"\$GXXVER"

            BLDCMD="cmake -S \$BUILD -B \$BUILD/build -DCMAKE_C_COMPILER=\$CC -DCMAKE_CXX_COMPLER=\$CXX -DBUILD_SHARED_LIBS=OFF -DCMAKE_BUILD_TYPE=Debug -DSRB2_SDL2_EXE_NAME=blankart -DSRB2_SDL2_EXE_SUFFIX= -DCMAKE_INSTALL_PREFIX=\$BUILD/build/AppDir/usr"

        elif [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

            if [ "\$LIBC" = "musl" ]; then

                GCCVER="gcc"
                GXXVER="g++"

            elif [ "\$BUILD" != "\$BUILDPATH/radio-racers" ]; then

                GCCVER="\$RINGRACERSGCCVER"
                GXXVER="\$RINGRACERSGXXVER"

            fi

            BLDCMD="cmake -S \$BUILD -B \$BUILD/build -DCMAKE_POLICY_VERSION_MINIMUM=\$CMAKEPOLVER -DCMAKE_C_COMPILER="\$CCACHE_BIN_PATH"\$GCCVER -DCMAKE_CXX_COMPILER="\$CCACHE_BIN_PATH"\$GXXVER -DBUILD_SHARED_LIBS=OFF -DCMAKE_BUILD_TYPE=Debug -DCMAKE_INSTALL_PREFIX=\$BUILD/build/AppDir/usr -DSRB2_CONFIG_ENABLE_WEBM_MOVIES=OFF -DSRB2_CONFIG_ASAN=OFF -DSRB2_CONFIG_ALWAYS_MAKE_DEBUGLINK=ON -DSRB2_SDL2_EXE_NAME=ringracers"

        elif [ "\$BUILD" = "\$BUILDPATH/wadcli" ]; then

            BLDCMD="make CXX="\$CCACHE_BIN_PATH"g++ CPLUS_INCLUDE_PATH=/usr/include/\$ARCH-linux-gnu/.:/usr/local/include/.:$HOME/.local/include/. -k -j\$NCPU -C \$BUILD STATIC=1"

        elif [ "\$BUILD" = "\$BUILDPATH/kartmaker" ] || [ "\$BUILD" = "\$BUILDPATH/neptunefm" ] || [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ] || [ "\$BUILD" = "\$BUILDPATH/followermaker" ]; then

            BLDCMD="\$BUILD/build.sh"

        elif [ "\$BUILD" = "\$BUILDPATH/slade" ]; then

            if [ \$(git -C "\$BUILD" describe --tags | gawk -F'_|-' '{gsub("\\\.|-|[a-z]",""); print \$1}' | gawk '{if(\$0 < 1000) {gsub("$","0"); print} else {print}}') -le "3113" ] && ([ "\$LIBC" != "musl" ] && ([ "\$ARCH" = "x86_64" ] || [ "\$ARCH" != "x86_64" ])); then

                sudo apt install -y $LNXWXGTK30PKG

                BLDCMD="cmake -S \$BUILD -B \$BUILD/build -DCMAKE_POLICY_VERSION_MINIMUM=\$CMAKEPOLVER -DNO_WEBVIEW=ON -DwxWidgets_CONFIG_EXECUTABLE=/usr/bin/wx-config -DCMAKE_C_COMPILER="\$CCACHE_BIN_PATH"\$SLADEGCCOLDVER -DCMAKE_CXX_COMPILER="\$CCACHE_BIN_PATH"\$SLADEGXXOLDVER -DBUILD_SHARED_LIBS=OFF -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=\$BUILD/build/AppDir/usr"

            elif [ \$(git -C "\$BUILD" describe --tags | gawk -F'_|-' '{gsub("\\\.|-|[a-z]",""); print \$1}' | gawk '{if(\$0 < 1000) {gsub("$","0"); print} else {print}}') -ge "3113" ] && [ \$(git -C "\$BUILD" describe --tags | gawk -F'_|-' '{gsub("\\\.|-|[a-z]",""); print \$1}' | gawk '{if(\$0 < 1000) {gsub("$","0"); print} else {print}}') -le "3250" ] && ([ "\$LIBC" != "musl" ] && ([ "\$ARCH" = "x86_64" ] || [ "\$ARCH" != "x86_64" ])); then

                sudo apt install -y $LNXWXGTKPKG

                BLDCMD="cmake -S \$BUILD -B \$BUILD/build -DCMAKE_POLICY_VERSION_MINIMUM=\$CMAKEPOLVER -DNO_WEBVIEW=ON -DwxWidgets_CONFIG_EXECUTABLE=/usr/bin/wx-config -DCMAKE_C_COMPILER="\$CCACHE_BIN_PATH"gcc -DCMAKE_CXX_COMPILER="\$CCACHE_BIN_PATH"g++ -DBUILD_SHARED_LIBS=OFF -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=\$BUILD/build/AppDir/usr"

            else

                BLDCMD="cmake -S \$BUILD -B \$BUILD/build -DCMAKE_POLICY_VERSION_MINIMUM=\$CMAKEPOLVER -DNO_WEBVIEW=ON -DwxWidgets_CONFIG_EXECUTABLE=/usr/bin/wx-config -DCMAKE_C_COMPILER="\$CCACHE_BIN_PATH"\$GCCVER -DCMAKE_CXX_COMPILER="\$CCACHE_BIN_PATH"\$GXXVER -DBUILD_SHARED_LIBS=OFF -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=\$BUILD/build/AppDir/usr"

            fi

        elif [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ] || [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]; then

            BLDCMD="make CXX="\$CCACHE_BIN_PATH"\$GXXVER CPLUS_INCLUDE_PATH=/usr/include/\$ARCH-linux-gnu/. -k -j\$NCPU -C \$BUILD"

        elif [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

            if [ "\$ARCH" = "x86_64" ]; then

                LIBSKIAPATH="/tmp/libskia/out/Release-x64"

            elif [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ]; then

                LIBSKIAPATH="/tmp/libskia/out/Release-x86"

            elif [ "\$ARCH" = "aarch64" ]; then

                LIBSKIAPATH="/tmp/libskia/out/Release-arm64"

            fi

            BLDCMD="cmake -S \$BUILD -B \$BUILD/build -G Ninja -DCMAKE_POLICY_VERSION_MINIMUM=\$CMAKEPOLVER -DBUILD_TESTING=OFF -DCLIP_TESTS=OFF -DCMARK_TESTS=OFF -DENABLE_TEST=OFF -DENABLE_TESTS=OFF -DFMT_CUDA_TEST=OFF -DFMT_TEST=OFF -DJSON11_BUILD_TESTS=OFF -DLAF_WITH_TESTS=OFF -DOBSERVABLE_TESTS=OFF -DPNG_TESTS=OFF -DUNDO_TESTS=OFF -Dtinyxml2_BUILD_TESTING=OFF -DLAF_BACKEND=skia -DSKIA_DIR=/tmp/libskia -DSKIA_LIBRARY_DIR=\$LIBSKIAPATH -DSKIA_LIBRARY=\$LIBSKIAPATH/libskia.a -DCMAKE_PREFIX_PATH=\$LIBSKIAPATH -DCMAKE_C_COMPILER="\$CCACHE_BIN_PATH"\$GCCVER -DCMAKE_CXX_COMPILER="\$CCACHE_BIN_PATH"\$GXXVER -DCMAKE_MAKE_PROGRAM=/usr/bin/ninja -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=\$BUILD/build/AppDir/usr"

        else

            if [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ] || [ "\$ARCH" = "x86_64" ]; then

                BLDCMD="make CC="\$CCACHE_BIN_PATH"\$GCCVER C_INCLUDE_PATH=\$SRB2BLDPREFIX/include/.:\$SRB2BLDPREFIX/include/SDL2/.:\$SRB2BLDPREFIX/include/openvr/.:/usr/include/\$ARCH-linux-gnu/. LIBGME_CFLAGS= LIBGME_LDFLAGS=-lgme -k -j\$NCPU -C \$BUILD/src LINUX\$IS64=1 NOOBJDUMP=1 NOVERSION=1 NOUPX=1"

            else

                BLDCMD="make CC="\$CCACHE_BIN_PATH"\$GCCVER C_INCLUDE_PATH=\$SRB2BLDPREFIX/include/.:\$SRB2BLDPREFIX/include/SDL2/.:\$SRB2BLDPREFIX/include/openvr/.:/usr/include/\$ARCH-linux-gnu/. LIBGME_CFLAGS= LIBGME_LDFLAGS=-lgme -k -j\$NCPU -C \$BUILD/src LINUX\$IS64=1 NONX86=1 NOOBJDUMP=1 NOVERSION=1 NOUPX=1"

            fi

        fi

    fi

    if [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

        # Required to remove carriage returns from code, if we want cmake files to be properly run, due to CRLF endings from Windows host.
        find "\$BUILD" -name "*.cmake" -executable -type f -exec gawk -i inplace '{gsub("\r",""); print}' '{}' \;

        if [ "\$OS" = "Windows" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading vcpkg's source code. Please wait..."
            git clone \$GITOPTS https://github.com/microsoft/vcpkg.git --recursive --branch "$LNXVCPKGVER" "\$VCPKG_ROOT"

            # Fix issue of broken configure build script for libvpx within container mounted to host's path.
            if [ -d "\$BUILD/thirdparty/vcpkg-overlays/libvpx" ]; then

                git -C "\$BUILD" restore --worktree thirdparty/vcpkg-overlays/libvpx

            fi

        fi

        \$BLDCMD -LAH 2> /dev/null 2>&1 | gawk '{if(f)print} /-- Cache values/{f=1}' 2> /dev/null

    fi

    if [ -n "\$UPGRADEBUILD" ] && [ -z "\$CUSTOMDIR" ]; then

        export CONF="\$(gawk '/---------------/ {gsub("---------------",""); getline; print}' "\$SRB2BLDROOT/installed/\$UPGRADEBUILD")"

    elif [ -n "\$UPGRADEBUILD" ] && [ -n "\$CUSTOMDIR" ]; then

        export CONF="\$(gawk '/---------------/ {gsub("---------------",""); getline; print}' "\$SRB2BLDROOT/installed/\$CUSTOMDIR")"

    # Otherwise set compilation flags, build and install as usual.
    else

        \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Preparing and displaying $BUILDNAME's configure options for compilation. Please wait..."

        # Display content of Makefile for a good view of available compilation flags.
        if [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

            gawk '/^#/,/ / {print}' "\$BUILD/\$SRC/\$(find "\$BUILD/\$SRC" -iname Makefile -maxdepth 1 -printf "%f" 2> /dev/null | head -n1)"

        elif [ "\$BUILD" = "\$BUILDPATH/wadcli" ]; then

            cat "\$BUILD/README.md"

        elif [ "\$BUILD" = "\$BUILDPATH/kartmaker" ] || [ "\$BUILD" = "\$BUILDPATH/neptunefm" ] || [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ] || [ "\$BUILD" = "\$BUILDPATH/followermaker" ]; then

            \$PRINTF "$NOTICE%s\n\e[0m" "No configs found for kartmaker/NeptuneFM/followermaker."

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ] || [ "\$BUILD" = "\$BUILDPATH/newmillennium" ] || [ "\$BUILD" = "\$BUILDPATH/blankart" ] || [ "\$BUILD" = "\$BUILDPATH/slade" ] || [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

            \$BLDCMD -LAH 2>&1 | gawk '{if(f)print} /-- Cache values/{f=1}' 2> /dev/null

        elif [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ] || [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]; then

            cat "\$BUILD/Makefile"

        elif [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" != "RingRacers" ]; then

            gawk '/^#/,/ / {print}' "\$BUILD/src/\$(find "\$BUILD/src" -iname Makefile -maxdepth 1 -printf "%f" 2> /dev/null | head -n1)"

        fi

        \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please enter $BUILDNAME's space separated compilation flags and then press enter, or just press enter to begin compiling. Default command and flags for compilation:"
        \$PRINTF "$NOTICE%s\n\e[0m" "\$BLDCMD [YOUR-COMPILATION-FLAGS-WILL-BE-HERE]"
        \$PRINTF "$PROMPT\n%s\e[0m" "> "
        read -r CONF

    fi

    # We don't want to enter OS flags other than detected.
    if [ -n "\$(\$PRINTF "%s\n" \$CONF | gawk 'match(\$0, /LINUX=1|LINUX64=1|MINGW=1|MINGW64=1|NONX86=1|UNIX=1|UNIXCOMMON=1|FREEBSD=1|CYGWIN32=1|SOLARIS=1|WATTCP=1|WINDOWS=1/) {print substr(\$0, RSTART, RLENGTH)}')" ]; then

        CONF=\$(\$PRINTF "%s\n" "\$CONF" | gawk '{gsub("LINUX=1|LINUX64=1|MINGW=1|MINGW64=1|NONX86=1|UNIX=1|UNIXCOMMON=1|FREEBSD=1|CYGWIN32=1|SOLARIS=1|WATTCP=1|WINDOWS=1",""); print}')
        \$PRINTF "$FAILURE\n%s\n\e[0m" "ERROR: Entering OS flags like LINUX64=1, MINGW=1 or FREEBSD=1 is not supported on this script. Exiting."
        exit

    fi

    # Fixing linking of pthread.
    if [ -f "\$BUILD/src/Makefile" ] && [ -z "\$(\$PRINTF "%s\n" \$CONF | gawk 'match(\$0, /NOTHREADS=1/) {print substr(\$0, RSTART, RLENGTH)}')" ]; then

        gawk -i inplace '{gsub("libs:=$","libs:=-lpthread"); print}' "\$BUILD/src/Makefile"

    fi

    # Download libbacktrace's source code, build and install it.
    if ([ "\$OS" = "Linux" ] && [ "\$LIBC" = "musl" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-2.0" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-cb" ] && [ "\$BUILD" != "\$BUILDPATH/xsrb2" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-sf94-serv" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-riders" ] && [ "\$BUILD" != "\$BUILDPATH/super-srb2-kart-z" ] && [ "\$BUILD" != "\$BUILDPATH/sbb2" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-final-demo" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-1095" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-jte" ] && [ "\$BUILD" != "\$BUILDPATH/shufflarb2" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-live" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-loz" ] && [ "\$BUILD" != "\$BUILDPATH/ssbss" ] && [ "\$BUILD" != "\$BUILDPATH/newmillennium" ] && [ "\$BUILD" != "\$BUILDPATH/wadcli" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker" ] && [ "\$BUILD" != "\$BUILDPATH/neptunefm" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker-ring-racers" ] && [ "\$BUILD" != "\$BUILDPATH/followermaker" ] && [ "\$BUILD" != "\$BUILDPATH/slade" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-zone-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-gksz-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-lowee-builder" ] && [ "\$BUILD" != "\$BUILDPATH/high-voltage-ring" ] && [ "\$BUILD" != "\$BUILDPATH/aseprite" ]) || ([ "\$OS" = "Windows" ] && [ "\$BUILD" = "\$BUILDPATH/srb2-kart-saturn" ]); then

        if [ "\$APPIMAGE" = "1" ] || [ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ] || [ "\$WINPORTABLE" = "1" ] || [ "\$LNXOSNAME" = "NixOS" ]; then

            LIBBACKTRACEPREFIX="\$SRB2BLDPREFIX"

        else

            LIBBACKTRACEPREFIX="\$SRB2BLDPREFIX/stow/libbacktrace"

        fi

        if [ ! -d "\$SRB2BLDROOT/libraries/libbacktrace/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libbacktrace's source code. Please wait..."
            git clone \$GITOPTS https://github.com/ianlancetaylor/libbacktrace.git --recursive --branch "$LNXBACKTRACEVER" "\$SRB2BLDROOT/libraries/libbacktrace"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libbacktrace's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/libbacktrace" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libbacktrace" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/libbacktrace" checkout -q master

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/libbacktrace" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/libbacktrace" checkout -q "$LNXBACKTRACEVER"

        fi

        if [ "\$OS" = "Windows" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing libbacktrace. Please wait..."

            if [ -n "\$ISNET" ]; then

                LIBBACKTRACEURL="https://mirror.msys2.org/mingw/mingw64/\$(curl -sL https://mirror.msys2.org/mingw/mingw64 | gawk -F'"' '/mingw-w64-'\$ARCH'-libbacktrace/ {print \$2}' | head -n1)"
                curl -RL "\$LIBBACKTRACEURL" > "\$SRB2BLDROOT/libraries/libbacktrace/libbacktrace.pkg.tar.zst"

            fi

            7z x -y "\$SRB2BLDROOT/libraries/libbacktrace/libbacktrace.pkg.tar.zst" -o"/tmp"
            7z e -y "/tmp/libbacktrace.pkg.tar" "mingw64/lib/"* -o"\$BUILD/libs/libbacktrace/lib/\$ARCH"
            7z e -y "/tmp/libbacktrace.pkg.tar" "mingw64/bin/"* -o"\$BUILD/build/AppDir/usr/lib"

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/libbacktrace" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/libbacktrace/.comrev"
            cd "\$BUILD" || exit

        elif [ ! -f \$SRB2BLDPREFIX/lib/libbacktrace.so ] || ([ -n "\$(cat "\$SRB2BLDROOT/libraries/libbacktrace/.comrev" 2> /dev/null)" ] && [ "\$(git -C "\$SRB2BLDROOT/libraries/libbacktrace" rev-parse --short HEAD)" != "\$(cat "\$SRB2BLDROOT/libraries/libbacktrace/.comrev" 2> /dev/null)" ]); then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libbacktrace. Please wait..."
            cd "\$SRB2BLDROOT/libraries/libbacktrace" || exit
            CFLAGS="" CC=""\$CCACHE_BIN_PATH"\$GCCVER" CXX=""\$CCACHE_BIN_PATH"\$GXXVER" "\$SRB2BLDROOT/libraries/libbacktrace/configure" --prefix="\$LIBBACKTRACEPREFIX" --enable-shared
            make -k -j"\$NCPU" -C "\$SRB2BLDROOT/libraries/libbacktrace"

            if [ -d "\$SRB2BLDPREFIX/stow/libbacktrace" ] && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]); then

                sudo -E stow -Dv --adopt libbacktrace
                sudo rm -rf "\$LIBBACKTRACEPREFIX"

            fi

            sudo -E make -C "\$SRB2BLDROOT/libraries/libbacktrace" install

            if [ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]; then

                sudo -E stow -v --adopt libbacktrace

            fi

            git -C "\$SRB2BLDROOT/libraries/libbacktrace" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libbacktrace" reset -q --hard

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/libbacktrace" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/libbacktrace/.comrev"
            cd "\$BUILD" || exit

        fi

    fi

    # Download libpng's source code, build and install it.
    if [ "\$OS" = "Linux" ] && [ "\$LIBC" = "musl" ] && [ -z "\$(\$PRINTF "%s\n" "\$CONF" | gawk 'match(\$0, /NOPNG=1/) {print substr(\$0, RSTART, RLENGTH)}')" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-2.0" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-cb" ] && [ "\$BUILD" != "\$BUILDPATH/xsrb2" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-sf94-serv" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-riders" ] && [ "\$BUILD" != "\$BUILDPATH/super-srb2-kart-z" ] && [ "\$BUILD" != "\$BUILDPATH/sbb2" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-final-demo" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-1095" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-jte" ] && [ "\$BUILD" != "\$BUILDPATH/shufflarb2" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-live" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-loz" ] && [ "\$BUILD" != "\$BUILDPATH/ssbss" ] && [ "\$BUILD" != "\$BUILDPATH/newmillennium" ] && [ "\$BUILD" != "\$BUILDPATH/wadcli" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker" ] && [ "\$BUILD" != "\$BUILDPATH/neptunefm" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker-ring-racers" ] && [ "\$BUILD" != "\$BUILDPATH/followermaker" ] && [ "\$BUILD" != "\$BUILDPATH/slade" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-zone-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-gksz-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-lowee-builder" ] && [ "\$BUILD" != "\$BUILDPATH/high-voltage-ring" ] && [ "\$BUILD" != "\$BUILDPATH/aseprite" ]; then

        # Uninstall system's package libpng-dev to avoid conflicts with compiled libpng.
        sudo apk del libpng-dev

        LIBPNGPREFIX="/usr"

        if [ ! -d "\$SRB2BLDROOT/libraries/libpng/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libpng's source code. Please wait..."
            git clone \$GITOPTS git://git.code.sf.net/p/libpng/code.git --recursive --branch "$LNXPNGVER" "\$SRB2BLDROOT/libraries/libpng"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libpng's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/libpng" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libpng" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/libpng" checkout -q master

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/libpng" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/libpng" checkout -q "$LNXPNGVER"

        fi

        if [ ! -f \$SRB2BLDPREFIX/lib/libpng.so ] || ([ -n "\$(cat "\$SRB2BLDROOT/libraries/libpng/.comrev" 2> /dev/null)" ] && [ "\$(git -C "\$SRB2BLDROOT/libraries/libpng" rev-parse --short HEAD)" != "\$(cat "\$SRB2BLDROOT/libraries/libpng/.comrev" 2> /dev/null)" ]); then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libpng. Please wait..."
            cd "\$SRB2BLDROOT/libraries/libpng" || exit
            CFLAGS="" CC=""\$CCACHE_BIN_PATH"\$GCCVER" CXX=""\$CCACHE_BIN_PATH"\$GXXVER" "\$SRB2BLDROOT/libraries/libpng/configure" --prefix="\$LIBPNGPREFIX"
            make -k -j"\$NCPU" -C "\$SRB2BLDROOT/libraries/libpng"
            sudo -E make -C "\$SRB2BLDROOT/libraries/libpng" install

            git -C "\$SRB2BLDROOT/libraries/libpng" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libpng" reset -q --hard

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/libpng" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/libpng/.comrev"
            cd "\$BUILD" || exit

        fi

    fi

    # Download libpng12's source code, build and install it.
    if [ -z "\$(\$PRINTF "%s\n" "\$CONF" | gawk 'match(\$0, /NOPNG=1/) {print substr(\$0, RSTART, RLENGTH)}')" ] && ([ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ] || [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]); then

        # Uninstall system's package libpng-dev to avoid conflicts with compiled libpng.
        if [ "\$LIBC" = "musl" ]; then

            sudo apk del libpng-dev

        else

            sudo dpkg --remove --force-depends libpng-dev

        fi

        LIBPNG12PREFIX="\$SRB2BLDPREFIX"

        if [ ! -d "\$SRB2BLDROOT/libraries/libpng12/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libpng12's source code. Please wait..."
            git clone \$GITOPTS git://git.code.sf.net/p/libpng/code.git --recursive --branch "$LNXPNG12VER" "\$SRB2BLDROOT/libraries/libpng12"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libpng12's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/libpng12" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libpng12" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/libpng12" checkout -q master

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/libpng12" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/libpng12" checkout -q "$LNXPNG12VER"

        fi

        if [ ! -f \$SRB2BLDPREFIX/lib/libpng12.so ] || ([ -n "\$(cat "\$SRB2BLDROOT/libraries/libpng12/.comrev" 2> /dev/null)" ] && [ "\$(git -C "\$SRB2BLDROOT/libraries/libpng12" rev-parse --short HEAD)" != "\$(cat "\$SRB2BLDROOT/libraries/libpng12/.comrev" 2> /dev/null)" ]); then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libpng12. Please wait..."
            cd "\$SRB2BLDROOT/libraries/libpng12" || exit

            if [ "\$OS" = "Linux" ]; then

                CFLAGS="" CC=""\$CCACHE_BIN_PATH"\$GCCVER" CXX=""\$CCACHE_BIN_PATH"\$GXXVER" "\$SRB2BLDROOT/libraries/libpng12/configure" --prefix="\$LIBPNG12PREFIX"

            else

                CFLAGS="" "\$SRB2BLDROOT/libraries/libpng12/configure" --prefix="\$LIBPNG12PREFIX"

            fi

            make -k -j"\$NCPU" -C "\$SRB2BLDROOT/libraries/libpng12"
            sudo -E make -C "\$SRB2BLDROOT/libraries/libpng12" install

            git -C "\$SRB2BLDROOT/libraries/libpng12" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libpng12" reset -q --hard

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/libpng12" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/libpng12/.comrev"
            cd "\$BUILD" || exit

        fi

    fi

    # Download libgme's source code, build and install it.
    if [ "\$OS" = "Linux" ] && [ -z "\$(\$PRINTF "%s\n" "\$CONF" | gawk 'match(\$0, /NOGME=1/) {print substr(\$0, RSTART, RLENGTH)}')" ] && [ -n "\$(\$PRINTF "%s\n" "\$CONF" | gawk 'match(\$0, /HAVE_MIXERX=1/) {print substr(\$0, RSTART, RLENGTH)}')" ] && [ "\$BUILD" != "\$BUILDPATH/wadcli" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker" ] && [ "\$BUILD" != "\$BUILDPATH/neptunefm" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker-ring-racers" ] && [ "\$BUILD" != "\$BUILDPATH/followermaker" ] && [ "\$BUILD" != "\$BUILDPATH/slade" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-zone-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-gksz-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-lowee-builder" ] && [ "\$BUILD" != "\$BUILDPATH/high-voltage-ring" ] && [ "\$BUILD" != "\$BUILDPATH/aseprite" ]; then

        # Uninstall system's package libgme-dev to avoid conflicts with compiled libgme.
        if [ "\$LIBC" = "musl" ]; then

            sudo apk del libgme-dev

        else

            sudo apt autoremove -y libgme-dev

        fi

        if [ "\$APPIMAGE" = "1" ] || [ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ] || [ "\$WINPORTABLE" = "1" ] || [ "\$LNXOSNAME" = "NixOS" ]; then

            LIBGMEPREFIX="\$SRB2BLDPREFIX"

        else

            LIBGMEPREFIX="\$SRB2BLDPREFIX/stow/libgme"

        fi

        if [ ! -d "\$SRB2BLDROOT/libraries/libgme/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libgme's source code. Please wait..."
            git clone \$GITOPTS https://bitbucket.org/mpyne/game-music-emu.git --recursive --branch "$LNXGMEVER" "\$SRB2BLDROOT/libraries/libgme"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libgme's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/libgme" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libgme" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/libgme" checkout -q master

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/libgme" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/libgme" checkout -q "$LNXGMEVER"

        fi

        if [ ! -f \$SRB2BLDPREFIX/lib/libgme.so ] || ([ -n "\$(cat "\$SRB2BLDROOT/libraries/libgme/.comrev" 2> /dev/null)" ] && [ "\$(git -C "\$SRB2BLDROOT/libraries/libgme" rev-parse --short HEAD)" != "\$(cat "\$SRB2BLDROOT/libraries/libgme/.comrev" 2> /dev/null)" ]); then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libgme. Please wait..."
            gawk -i inplace 'BEGIN { del=0 } /4.1 had poor support for symbol visibility/ { del=2 } del<=0 { print } /endif()/ { del -= 1 }' "\$SRB2BLDROOT/libraries/libgme/CMakeLists.txt"
            CFLAGS="" cmake -S "\$SRB2BLDROOT/libraries/libgme" -B "\$SRB2BLDROOT/libraries/libgme/build" -DCMAKE_C_COMPILER=""\$CCACHE_BIN_PATH"\$GCCVER" -DCMAKE_CXX_COMPILER=""\$CCACHE_BIN_PATH"\$GXXVER" -DGME_YM2612_EMU=MAME -DENABLE_UBSAN=OFF -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX="\$LIBGMEPREFIX"
            cmake --build "\$SRB2BLDROOT/libraries/libgme/build" -j"\$NCPU" --config Release

            if [ -d "\$SRB2BLDPREFIX/stow/libgme" ] && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]); then

                sudo -E stow -Dv --adopt libgme
                sudo rm -rf "\$LIBGMEPREFIX"

            fi

            sudo -E cmake --install "\$SRB2BLDROOT/libraries/libgme/build"

            if [ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]; then

                sudo -E stow -v --adopt libgme

            fi

            git -C "\$SRB2BLDROOT/libraries/libgme" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libgme" reset -q --hard

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/libgme" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/libgme/.comrev"

        fi

    fi

    # Download libfluidsynth's source code, build and install it.
    if [ "\$OS" = "Linux" ] && [ -z "\$(\$PRINTF "%s\n" "\$CONF" | gawk 'match(\$0, /NOGME=1/) {print substr(\$0, RSTART, RLENGTH)}')" ] && [ -n "\$(\$PRINTF "%s\n" "\$CONF" | gawk 'match(\$0, /HAVE_MIXERX=1/) {print substr(\$0, RSTART, RLENGTH)}')" ] && [ "\$BUILD" != "\$BUILDPATH/wadcli" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker" ] && [ "\$BUILD" != "\$BUILDPATH/neptunefm" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker-ring-racers" ] && [ "\$BUILD" != "\$BUILDPATH/followermaker" ] && [ "\$BUILD" != "\$BUILDPATH/slade" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-zone-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-gksz-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-lowee-builder" ] && [ "\$BUILD" != "\$BUILDPATH/high-voltage-ring" ] && [ "\$BUILD" != "\$BUILDPATH/aseprite" ]; then

        # Uninstall system's package libfluidsynth-dev to avoid conflicts with compiled libfluidsynth.
        if [ "\$LIBC" = "musl" ]; then

            sudo apk del fluidsynth-dev
            sudo apk add glib-dev

        else

            sudo apt autoremove -y libfluidsynth-dev

        fi

        if [ "\$APPIMAGE" = "1" ] || [ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ] || [ "\$WINPORTABLE" = "1" ] || [ "\$LNXOSNAME" = "NixOS" ]; then

            LIBFLUIDSYNTHPREFIX="\$SRB2BLDPREFIX"

        else

            LIBFLUIDSYNTHPREFIX="\$SRB2BLDPREFIX/stow/libfluidsynth"

        fi

        if [ ! -d "\$SRB2BLDROOT/libraries/libfluidsynth/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libfluidsynth's source code. Please wait..."
            git clone \$GITOPTS https://github.com/FluidSynth/fluidsynth.git --recursive --branch "v$LNXFLUIDSYNTHVER" "\$SRB2BLDROOT/libraries/libfluidsynth"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libfluidsynth's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/libfluidsynth" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libfluidsynth" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/libfluidsynth" checkout -q master

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/libfluidsynth" submodule update --init --recursive
                git -C "\$SRB2BLDROOT/libraries/libfluidsynth" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/libfluidsynth" checkout -q "v$LNXFLUIDSYNTHVER"

        fi

        if [ ! -f \$SRB2BLDPREFIX/lib/libfluidsynth.so ] || ([ -n "\$(cat "\$SRB2BLDROOT/libraries/libfluidsynth/.comrev" 2> /dev/null)" ] && [ "\$(git -C "\$SRB2BLDROOT/libraries/libfluidsynth" rev-parse --short HEAD)" != "\$(cat "\$SRB2BLDROOT/libraries/libfluidsynth/.comrev" 2> /dev/null)" ]); then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libfluidsynth. Please wait..."
            CFLAGS="" cmake -S "\$SRB2BLDROOT/libraries/libfluidsynth" -B "\$SRB2BLDROOT/libraries/libfluidsynth/build" -DCMAKE_C_COMPILER=""\$CCACHE_BIN_PATH"\$GCCVER" -DCMAKE_CXX_COMPILER=""\$CCACHE_BIN_PATH"\$GXXVER" -DCMAKE_BUILD_TYPE=Release -DLIB_INSTALL_DIR=lib -DCMAKE_INSTALL_PREFIX="\$LIBFLUIDSYNTHPREFIX"
            cmake --build "\$SRB2BLDROOT/libraries/libfluidsynth/build" -j"\$NCPU" --config Release

            if [ -d "\$SRB2BLDPREFIX/stow/libfluidsynth" ] && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]); then

                sudo -E stow -Dv --adopt libfluidsynth
                sudo rm -rf "\$LIBFLUIDSYNTHPREFIX"

            fi

            sudo -E cmake --install "\$SRB2BLDROOT/libraries/libfluidsynth/build"

            if [ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]; then

                sudo -E stow -v --adopt libfluidsynth

            fi

            git -C "\$SRB2BLDROOT/libraries/libfluidsynth" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libfluidsynth" reset -q --hard

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/libfluidsynth" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/libfluidsynth/.comrev"

        fi

    fi

    # Download libsndfile's source code, build and install it.
    if [ "\$OS" = "Linux" ] && [ "\$LIBC" != "musl" ] && [ "\$BUILD" = "\$BUILDPATH/blankart" ]; then

        if [ ! -d "\$SRB2BLDROOT/libraries/libsndfile/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libsndfile's source code. Please wait..."
            git clone \$GITOPTS https://github.com/libsndfile/libsndfile.git --recursive --branch "$LNXSNDFILEVER" "\$SRB2BLDROOT/libraries/libsndfile"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libsndfile's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/libsndfile" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libsndfile" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/libsndfile" checkout -q master

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/libsndfile" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/libsndfile" checkout -q "$LNXSNDFILEVER"

        fi

        \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libsndfile. Please wait..."
        cd "\$SRB2BLDROOT/libraries/libsndfile" || exit
        autoreconf -vif
        CFLAGS="" CC=""\$CCACHE_BIN_PATH"\$GCCVER" CXX=""\$CCACHE_BIN_PATH"\$GXXVER" "\$SRB2BLDROOT/libraries/libsndfile/configure" --enable-opus --prefix="/usr"
        sudo make -j"\$NCPU" install

        git -C "\$SRB2BLDROOT/libraries/libsndfile" clean -qdffx -e .comrev
        git -C "\$SRB2BLDROOT/libraries/libsndfile" reset -q --hard

        COMREV=\$(git -C "\$SRB2BLDROOT/libraries/libsndfile" rev-parse --short HEAD)
        \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/libsndfile/.comrev"

    fi

    # Download libSDL's source code, build and install it.
    if [ "\$OS" = "Linux" ] && [ "\$LIBC" != "musl" ] && ([ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-reveries" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-tsourdt3rd" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-saturn" ] || [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ] || [ "\$(dirname \$BUILD)" = "\$BUILDPATH/srb2-custom" ]); then

        if [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ]; then

            LNXSDLVER="$LNXSDL3VER"

        # Version 2.0.22 of libSDL2 for Ring Racers is required to fix error: 'SDL_GetErrorMsg' was not declared in this scope; did you mean 'SDL_GetError'?
        elif [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

            LNXSDLVER="release-2.0.22"
            sudo dpkg --remove --force-depends libsdl2-dev libsdl2-2.0-0

        else

            LNXSDLVER="$LNXSDL2VER"
            sudo dpkg --remove --force-depends libsdl2-dev libsdl2-2.0-0

        fi

        if [ ! -d "\$SRB2BLDROOT/libraries/libsdl/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libSDL's source code. Please wait..."
            git clone \$GITOPTS https://github.com/libsdl-org/SDL.git --recursive --branch "\$LNXSDLVER" "\$SRB2BLDROOT/libraries/libsdl"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libSDL's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/libsdl" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libsdl" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/libsdl" checkout -q main

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/libsdl" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/libsdl" checkout -q "\$LNXSDLVER"

        fi

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libSDL. Please wait..."
            cd "\$SRB2BLDROOT/libraries/libsdl" || exit

            if [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ]; then

                CFLAGS="" cmake -S "\$SRB2BLDROOT/libraries/libsdl" -B "\$SRB2BLDROOT/libraries/libsdl/build" -DCMAKE_C_COMPILER=""\$CCACHE_BIN_PATH"\$GCCVER" -DCMAKE_CXX_COMPILER=""\$CCACHE_BIN_PATH"\$GXXVER" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX="/usr"
                cmake --build "\$SRB2BLDROOT/libraries/libsdl/build" -j"\$NCPU" --config Release
                sudo -E cmake --install "\$SRB2BLDROOT/libraries/libsdl/build"

            else

                CFLAGS="" CC=""\$CCACHE_BIN_PATH"\$GCCVER" CXX=""\$CCACHE_BIN_PATH"\$GXXVER" "\$SRB2BLDROOT/libraries/libsdl/configure" --disable-video-wayland --prefix="/usr"
                make -k -j"\$NCPU" -C "\$SRB2BLDROOT/libraries/libsdl"
                sudo make -C "\$SRB2BLDROOT/libraries/libsdl" install

            fi

            git -C "\$SRB2BLDROOT/libraries/libsdl" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libsdl" reset -q --hard

            cd "\$BUILD" || exit

    elif [ "\$OS" = "Windows" ] && ([ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ] || [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]); then

        \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing libSDL. Please wait..."

        if [ -n "\$ISNET" ]; then

            LIBSDLDEVASSETURL=\$(curl -sL "https://api.github.com/repos/libsdl-org/SDL/releases" | gawk -F'"' '/browser_download_url.*SDL2-devel-2.*-mingw.zip/ {print \$4}' | head -n1)
            if [ "\$(curl -X GET -sLI "\$LIBSDLDEVASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/libraries/SDL2-devel-mingw.zip" 2> /dev/null)" ]; then

                rm -f "\$SRB2BLDROOT/libraries/SDL2-devel-mingw.zip"
                curl -RL "\$LIBSDLDEVASSETURL" -o "\$SRB2BLDROOT/libraries/SDL2-devel-mingw.zip"

            fi

            LIBSDLASSETURL=\$(curl -sL "https://api.github.com/repos/libsdl-org/SDL/releases" | gawk -F'"' '/browser_download_url.*SDL2-2.*-win32-x86.zip/ {print \$4}' | head -n1)
            if [ "\$(curl -X GET -sLI "\$LIBSDLASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/libraries/SDL2-win32-x86.zip" 2> /dev/null)" ]; then

                rm -f "\$SRB2BLDROOT/libraries/SDL2-win32-x86.zip"
                curl -RL "\$LIBSDLASSETURL" -o "\$SRB2BLDROOT/libraries/SDL2-win32-x86.zip"

            fi

        fi

        7z x -y "\$SRB2BLDROOT/libraries/SDL2-devel-mingw.zip" -o"/tmp"
        mv -f "/tmp/SDL2-"* "/tmp/SDL2"
        7z x -y "\$SRB2BLDROOT/libraries/SDL2-win32-x86.zip" "*.dll" -o"\$BUILD/build/AppDir/usr/lib"

    fi

    # Download libSDL2_mixer's source code, build and install it.
    if [ "\$OS" = "Linux" ] && [ "\$LIBC" != "musl" ] && [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

        \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing libSDL2_mixer. Please wait..."

        if [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ] || [ "\$ARCH" = "x86_64" ]; then

            sudo mkdir -p "/usr/lib/i386-linux-gnu/cmake/SDL2_mixer"
            curl -LO http://ftp.us.debian.org/debian/pool/main/libs/libsdl2-mixer/libsdl2-mixer-dev_2.6.2+dfsg-2_i386.deb
            7z x libsdl2-mixer-dev_2.6.2+dfsg-2_i386.deb
            7z x data.tar
            sudo cp -rf "usr/lib/i386-linux-gnu/cmake/SDL2_mixer" "/usr/lib/i386-linux-gnu/cmake"

        elif [ -n \$(\$PRINTF "%s\n" "\$ARCH" | gawk 'match(\$0, /arm/) {print substr(\$0, RSTART, RLENGTH)}') ]; then

            sudo mkdir -p "/usr/lib/arm-linux-gnueabihf/cmake/SDL2_mixer"
            curl -LO http://ftp.us.debian.org/debian/pool/main/libs/libsdl2-mixer/libsdl2-mixer-dev_2.6.2+dfsg-2_armhf.deb
            7z x libsdl2-mixer-dev_2.6.2+dfsg-2_armhf.deb
            7z x data.tar
            sudo cp -rf "usr/lib/arm-linux-gnueabihf/cmake/SDL2_mixer" "/usr/lib/arm-linux-gnueabihf/cmake"

        fi

    elif [ "\$OS" = "Windows" ] && ([ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ] || [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]); then

        \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing libSDL2_mixer. Please wait..."

        if [ -n "\$ISNET" ]; then

            LIBSDL2MIXERDEVASSETURL=\$(curl -sL "https://api.github.com/repos/libsdl-org/SDL_mixer/releases" | gawk -F'"' '/browser_download_url.*SDL2_mixer-devel-2.*-mingw.zip/ {print \$4}' | head -n1)
            if [ "\$(curl -X GET -sLI "\$LIBSDL2MIXERDEVASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/libraries/SDL2_mixer-devel-mingw.zip" 2> /dev/null)" ]; then

                rm -f "\$SRB2BLDROOT/libraries/SDL2_mixer-devel-mingw.zip"
                curl -RL "\$LIBSDL2MIXERDEVASSETURL" -o "\$SRB2BLDROOT/libraries/SDL2_mixer-devel-mingw.zip"

            fi

            LIBSDL2MIXERASSETURL=\$(curl -sL "https://api.github.com/repos/libsdl-org/SDL_mixer/releases" | gawk -F'"' '/browser_download_url.*SDL2_mixer-2.*-win32-x86.zip/ {print \$4}' | head -n1)
            if [ "\$(curl -X GET -sLI "\$LIBSDL2MIXERASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/libraries/SDL2_mixer-win32-x86.zip" 2> /dev/null)" ]; then

                rm -f "\$SRB2BLDROOT/libraries/SDL2_mixer-win32-x86.zip"
                curl -RL "\$LIBSDL2MIXERASSETURL" -o "\$SRB2BLDROOT/libraries/SDL2_mixer-win32-x86.zip"

            fi

        fi

        7z x -y "\$SRB2BLDROOT/libraries/SDL2_mixer-devel-mingw.zip" -o"/tmp"
        mv -f "/tmp/SDL2_mixer"* "/tmp/SDL2_mixer"
        7z x -y "\$SRB2BLDROOT/libraries/SDL2_mixer-win32-x86.zip" "*.dll" "optional/*.dll" -o"\$BUILD/build/AppDir/usr/lib"

    fi

    # Download libSDL2_mixerX's source code, build and install it.
    if [ "\$OS" = "Linux" ] && [ -n "\$(\$PRINTF "%s\n" \$CONF | gawk 'match(\$0, /HAVE_MIXERX=1/) {print substr(\$0, RSTART, RLENGTH)}')" ]; then

        if [ "\$APPIMAGE" = "1" ] || [ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ] || [ "\$WINPORTABLE" = "1" ] || [ "\$LNXOSNAME" = "NixOS" ]; then

            LIBSDL2MIXERXPREFIX="\$SRB2BLDPREFIX"

        else

            LIBSDL2MIXERXPREFIX="\$SRB2BLDPREFIX/stow/libsdl2-mixerx"

        fi

        if [ ! -d "\$SRB2BLDROOT/libraries/libsdl2-mixerx/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libSDL2_mixerX's source code. Please wait..."
            git clone \$GITOPTS https://github.com/WohlSoft/SDL-Mixer-X.git --recursive --branch "$LNXSDL2MIXERXVER" "\$SRB2BLDROOT/libraries/libsdl2-mixerx"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libSDL2_mixerX's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/libsdl2-mixerx" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libsdl2-mixerx" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/libsdl2-mixerx" checkout -q master

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/libsdl2-mixerx" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/libsdl2-mixerx" checkout -q "$LNXSDL2MIXERXVER"

        fi

        if [ ! -f \$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.so ] || ([ -n "\$(cat "\$SRB2BLDROOT/libraries/libsdl2-mixerx/.comrev" 2> /dev/null)" ] && [ "\$(git -C "\$SRB2BLDROOT/libraries/libsdl2-mixerx" rev-parse --short HEAD)" != "\$(cat "\$SRB2BLDROOT/libraries/libsdl2-mixerx/.comrev" 2> /dev/null)" ]); then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libSDL2_mixerX. Please wait..."
            CFLAGS="" cmake -S "\$SRB2BLDROOT/libraries/libsdl2-mixerx" -B "\$SRB2BLDROOT/libraries/libsdl2-mixerx/build" -DCMAKE_C_COMPILER=""\$CCACHE_BIN_PATH"\$GCCVER" -DCMAKE_CXX_COMPILER=""\$CCACHE_BIN_PATH"\$GXXVER" -DBUILD_SHARED_LIBS=ON -DCMAKE_BUILD_TYPE=Release -DUSE_SYSTEM_AUDIO_LIBRARIES=ON -DDOWNLOAD_AUDIO_CODECS_DEPENDENCY=OFF -DAUDIO_CODECS_BUILD_LOCAL_SDL2=OFF -DSDL_MIXER_X_SHARED=ON -DSDL_MIXER_X_STATIC=OFF -DUSE_SYSTEM_SDL2=ON -DUSE_GME=ON -DUSE_FLAC=OFF -DUSE_DRFLAC=OFF -DUSE_MP3_MPG123=OFF -DUSE_MP3_MINIMP3=OFF -DUSE_OGG_VORBIS=ON -DUSE_XMP=OFF -DUSE_MODPLUG=ON -DUSE_MODPLUG_STATIC=OFF -DUSE_OPUS=OFF -DUSE_MIDI=ON -DUSE_MIDI_FLUIDSYNTH=ON -DUSE_MIDI_FLUIDLITE=OFF -DUSE_MIDI_TIMIDITY=ON -DUSE_MIDI_OPNMIDI=OFF -DUSE_MIDI_ADLMIDI=OFF -DUSE_MIDI_NATIVE=OFF -DGME_INCLUDE_DIR="\$SRB2BLDPREFIX/include/gme" -DGME_LIBRARY="\$SRB2BLDPREFIX/lib/libgme.so" -DCMAKE_INSTALL_PREFIX="\$LIBSDL2MIXERXPREFIX"
            cmake --build "\$SRB2BLDROOT/libraries/libsdl2-mixerx/build" -j"\$NCPU" --config Release

            if [ -d "\$SRB2BLDPREFIX/stow/libsdl2-mixerx" ] && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]); then

                sudo -E stow -Dv --adopt libsdl2-mixerx
                sudo rm -rf "\$LIBSDL2MIXERXPREFIX"

            fi

            sudo -E cmake --install "\$SRB2BLDROOT/libraries/libsdl2-mixerx/build"

            if [ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]; then

                sudo -E stow -v --adopt libsdl2-mixerx

            fi

            git -C "\$SRB2BLDROOT/libraries/libsdl2-mixerx" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libsdl2-mixerx" reset -q --hard

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/libsdl2-mixerx" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/libsdl2-mixerx/.comrev"

        fi

    fi

    # Download libopenal's source code, build and install it.
    if [ "\$OS" = "Windows" ] && [ "\$BUILD" = "\$BUILDPATH/blankart" ]; then

        \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libopenal's source code. Please wait..."

        if [ -n "\$ISNET" ]; then

            LIBOPENALURL=\$(curl -sL https://api.github.com/repos/kcat/openal-soft/releases | gawk -F'"' '/browser_download_url.*OpenALSoft.*.zip/ && !/HRTF/ {print \$4}' | head -n1)
            if [ "\$(curl -X GET -sLI "\$LIBOPENALURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/libraries/libopenal-win.zip" 2> /dev/null)" ]; then

                rm -f "\$SRB2BLDROOT/libraries/libopenal-win.zip"
                curl -RL "\$LIBOPENALURL" -o "\$SRB2BLDROOT/libraries/libopenal-win.zip"

            fi

        fi

        if [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ]; then

            7z e -y "\$SRB2BLDROOT/libraries/libopenal-win.zip" "Win32/OpenAL32.dll" -o"\$BUILD/build/AppDir/usr/lib"

        else

            7z e -y "\$SRB2BLDROOT/libraries/libopenal-win.zip" "Win64/OpenAL32.dll" -o"\$BUILD/build/AppDir/usr/lib"

        fi

    fi

    # Download DiscordRPC source code, build and install it.
    if [ -n "\$(\$PRINTF "%s\n" \$CONF | gawk 'match(\$0, /HAVE_DISCORDRPC=1/) {print substr(\$0, RSTART, RLENGTH)}')" ] && ([ "\$BUILD" = "\$BUILDPATH/srb2-uncapped-plus" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-netplus" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-reveries" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-tsourdt3rd" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-galaxy" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-hep" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-saturn" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-neptune" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ] || [ "\$(dirname \$BUILD)" = "\$BUILDPATH/srb2-custom" ]); then

        if [ "\$APPIMAGE" = "1" ] || [ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ] || [ "\$WINPORTABLE" = "1" ] || [ "\$LNXOSNAME" = "NixOS" ]; then

            DISCORDRPCPREFIX="\$SRB2BLDPREFIX"

        else

            DISCORDRPCPREFIX="\$SRB2BLDPREFIX/stow/discord-rpc"

        fi

        if [ ! -d "\$SRB2BLDROOT/libraries/discord-rpc/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading DiscordRPC's source code. Please wait..."
            git clone \$GITOPTS https://github.com/discord/discord-rpc.git --recursive --branch "$LNXDISCORDRPCVER" "\$SRB2BLDROOT/libraries/discord-rpc"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up DiscordRPC's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/discord-rpc" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/discord-rpc" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/discord-rpc" checkout -q master

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/discord-rpc" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/discord-rpc" checkout -q "$LNXDISCORDRPCVER"

        fi

        if [ "\$OS" = "Windows" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing DiscordRPC. Please wait..."

            if [ -n "\$ISNET" ]; then

                DISCORDRPCURL="\$(curl -sL https://api.github.com/repos/discord/discord-rpc/releases/latest | gawk -F'"' '/browser_download_url.*discord-rpc-win.zip/ {print \$4}')"
                curl -RL "\$DISCORDRPCURL" > "\$SRB2BLDROOT/libraries/discord-rpc/discord-rpc-win.zip"

            fi

            if ([ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ]) || [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ]; then

                7z e -y "\$SRB2BLDROOT/libraries/discord-rpc/discord-rpc-win.zip" "discord-rpc/win32-dynamic/bin/discord-rpc.dll" -o"\$BUILD/build/AppDir/usr/lib"

            else

                7z e -y "\$SRB2BLDROOT/libraries/discord-rpc/discord-rpc-win.zip" "discord-rpc/win64-dynamic/bin/discord-rpc.dll" -o"\$BUILD/build/AppDir/usr/lib"

            fi

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/discord-rpc" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/discord-rpc/.comrev"

        elif [ "\$OS" = "Linux" ] && ([ ! -f \$SRB2BLDPREFIX/lib/libdiscord-rpc.so ] || ([ -n "\$(cat "\$SRB2BLDROOT/libraries/discord-rpc/.comrev" 2> /dev/null)" ] && [ "\$(git -C "\$SRB2BLDROOT/libraries/discord-rpc" rev-parse --short HEAD)" != "\$(cat "\$SRB2BLDROOT/libraries/discord-rpc/.comrev" 2> /dev/null)" ])); then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing DiscordRPC. Please wait..."
            CFLAGS="" cmake -S "\$SRB2BLDROOT/libraries/discord-rpc" -B "\$SRB2BLDROOT/libraries/discord-rpc/build" -DCMAKE_C_COMPILER=""\$CCACHE_BIN_PATH"\$GCCVER" -DCMAKE_CXX_COMPILER=""\$CCACHE_BIN_PATH"\$GXXVER" -DBUILD_EXAMPLES=OFF -DBUILD_SHARED_LIBS=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX="\$DISCORDRPCPREFIX"
            cmake --build "\$SRB2BLDROOT/libraries/discord-rpc/build" -j"\$NCPU" --config Release

            if [ -d "\$SRB2BLDPREFIX/stow/discord-rpc" ] && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]); then

                sudo -E stow -Dv --adopt discord-rpc
                sudo rm -rf "\$DISCORDRPCPREFIX"

            fi

            sudo -E cmake --install "\$SRB2BLDROOT/libraries/discord-rpc/build"

            if [ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]; then

                sudo -E stow -v --adopt discord-rpc

            fi

            git -C "\$SRB2BLDROOT/libraries/discord-rpc" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/discord-rpc" reset -q --hard

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/discord-rpc" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/discord-rpc/.comrev"

        fi

    fi

    # Download libopenvr's source code, build and install it.
    if [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ]; then

        if [ "\$APPIMAGE" = "1" ] || [ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ] || [ "\$WINPORTABLE" = "1" ] || [ "\$LNXOSNAME" = "NixOS" ]; then

            LIBOPENVRPREFIX="\$SRB2BLDPREFIX"

        else

            LIBOPENVRPREFIX="\$SRB2BLDPREFIX/stow/libopenvr"

        fi

        if [ ! -d "\$SRB2BLDROOT/libraries/libopenvr/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libopenvr's source code. Please wait..."
            git clone \$GITOPTS https://github.com/ValveSoftware/openvr.git --recursive --branch "v$LNXOPENVRVER" "\$SRB2BLDROOT/libraries/libopenvr"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libopenvr's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/libopenvr" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libopenvr" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/libopenvr" checkout -q master

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/libopenvr" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/libopenvr" checkout -q "v$LNXOPENVRVER"

        fi

        if [ "\$OS" = "Windows" ]; then

            cp -f "\$SRB2BLDROOT/libraries/libopenvr/bin/win32/openvr_api.dll" "\$BUILD/build/AppDir/usr/lib"

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/libopenvr" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/libopenvr/.comrev"

        elif [ "\$OS" = "Linux" ] && [ ! -f \$SRB2BLDPREFIX/lib/libopenvr_api.so ] || ([ -n "\$(cat "\$SRB2BLDROOT/libraries/libopenvr/.comrev" 2> /dev/null)" ] && [ "\$(git -C "\$SRB2BLDROOT/libraries/libopenvr" rev-parse --short HEAD)" != "\$(cat "\$SRB2BLDROOT/libraries/libopenvr/.comrev" 2> /dev/null)" ]); then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libopenvr. Please wait..."
            cp -rf "\$SRB2BLDROOT/libraries/libopenvr/src/vrcommon" "\$SRB2BLDROOT/libraries/libopenvr/src/vrcore"
            CFLAGS="" cmake -S "\$SRB2BLDROOT/libraries/libopenvr" -B "\$SRB2BLDROOT/libraries/libopenvr/build" -DCMAKE_POLICY_VERSION_MINIMUM=\$CMAKEPOLVER -DCMAKE_C_COMPILER=""\$CCACHE_BIN_PATH"\$GCCVER" -DCMAKE_CXX_COMPILER=""\$CCACHE_BIN_PATH"\$GXXVER" -DBUILD_UNIVERSAL=OFF -DBUILD_SHARED=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX="\$LIBOPENVRPREFIX"
            cmake --build "\$SRB2BLDROOT/libraries/libopenvr/build" -j"\$NCPU" --config Release

            if [ -d "\$SRB2BLDPREFIX/stow/libopenvr" ] && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]); then

                sudo -E stow -Dv --adopt libopenvr
                sudo rm -rf "\$LIBOPENVRPREFIX"

            fi

            sudo -E cmake --install "\$SRB2BLDROOT/libraries/libopenvr/build"

            if [ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]; then

                sudo -E stow -v --adopt libopenvr

            fi

            git -C "\$SRB2BLDROOT/libraries/libopenvr" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libopenvr" reset -q --hard

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/libopenvr" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/libopenvr/.comrev"

        fi

    fi

    # Download liblzf's source code, build and install it.
    if [ "\$OS" = "Linux" ] && [ "\$BUILD" = "\$BUILDPATH/wadcli" ]; then

        if [ "\$APPIMAGE" = "1" ] || [ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ] || [ "\$WINPORTABLE" = "1" ] || [ "\$LNXOSNAME" = "NixOS" ]; then

            LIBLZFPREFIX="\$SRB2BLDPREFIX"

        else

            LIBLZFPREFIX="\$SRB2BLDPREFIX/stow/liblzf"

        fi

        if [ ! -d "\$SRB2BLDROOT/libraries/liblzf/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading liblzf's source code. Please wait..."
            git clone \$GITOPTS https://salsa.debian.org/debian/liblzf.git --recursive --branch "$LNXLZFVER" "\$SRB2BLDROOT/libraries/liblzf"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up liblzf's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/liblzf" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/liblzf" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/liblzf" checkout -q master

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/liblzf" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/liblzf" checkout -q "$LNXLZFVER"

        fi

        if [ ! -f "\$SRB2BLDPREFIX/lib/liblzf.a" ] || ([ -n "\$(cat "\$SRB2BLDROOT/libraries/liblzf/.comrev" 2> /dev/null)" ] && [ "\$(git -C "\$SRB2BLDROOT/libraries/liblzf" rev-parse --short HEAD)" != "\$(cat "\$SRB2BLDROOT/libraries/liblzf/.comrev" 2> /dev/null)" ]); then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing liblzf. Please wait..."
            cd "\$SRB2BLDROOT/libraries/liblzf" || exit
            cp -rf "\$SRB2BLDROOT/libraries/liblzf/debian/extras/"* "\$SRB2BLDROOT/libraries/liblzf"
            patch -Np1 -d "\$SRB2BLDROOT/libraries/liblzf" -i "\$SRB2BLDROOT/libraries/liblzf/debian/patches/"*.patch
            CFLAGS="" CC=""\$CCACHE_BIN_PATH"\$GCCVER" CXX=""\$CCACHE_BIN_PATH"\$GXXVER" "\$SRB2BLDROOT/libraries/liblzf/configure" --prefix="\$LIBLZFPREFIX" --includedir="\$LIBLZFPREFIX/include/liblzf"
            make -k -j"\$NCPU" -C "\$SRB2BLDROOT/libraries/liblzf"

            if [ -d "\$SRB2BLDPREFIX/stow/liblzf" ] && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]); then

                sudo -E stow -Dv --adopt liblzf
                sudo rm -rf "\$LIBLZFPREFIX"

            fi

            sudo make -C "\$SRB2BLDROOT/libraries/liblzf" install

            if [ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]; then

                sudo -E stow -v --adopt liblzf

            fi

            git -C "\$SRB2BLDROOT/libraries/liblzf" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/liblzf" reset -q --hard

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/liblzf" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/liblzf/.comrev"
            cd "\$BUILD" || exit

        fi

    fi

    # Download libwxgtk's source code, build and install it.
    if [ "\$BUILD" = "\$BUILDPATH/slade" ] && [ \$(git -C "\$BUILD" describe --tags | gawk -F'_|-' '{gsub("\\\.|-|[a-z]",""); print \$1}' | gawk '{if(\$0 < 1000) {gsub("$","0"); print} else {print}}') -ge "3260" ] && ([ "\$LIBC" != "musl" ] && ([ "\$ARCH" = "x86_64" ] || [ "\$ARCH" != "x86_64" ])); then

        if [ ! -d "\$SRB2BLDROOT/libraries/libwxgtk/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libwxgtk's source code. Please wait..."
            git clone \$GITOPTS https://github.com/wxWidgets/wxWidgets.git --recursive --branch "v$LNXWXGTKVER" "\$SRB2BLDROOT/libraries/libwxgtk"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libwxgtk's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/libwxgtk" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libwxgtk" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/libwxgtk" checkout -q master

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/libwxgtk" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/libwxgtk" checkout -qf "v$LNXWXGTKVER"

        fi

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libwxgtk. Please wait..."
            cd "\$SRB2BLDROOT/libraries/libwxgtk" || exit
            CFLAGS="" CC=""\$CCACHE_BIN_PATH"\$GCCVER" CXX=""\$CCACHE_BIN_PATH"\$GXXVER" "\$SRB2BLDROOT/libraries/libwxgtk/configure" --with-gtk --enable-webrequest --enable-webview --enable-webviewwebkit --prefix="/usr" --bindir="/usr/bin" --libdir="/usr/lib"
            make -k -j"\$NCPU" -C "\$SRB2BLDROOT/libraries/libwxgtk"
            sudo make -C "\$SRB2BLDROOT/libraries/libwxgtk" install

            git -C "\$SRB2BLDROOT/libraries/libwxgtk" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libwxgtk" reset -q --hard

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/libwxgtk" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/libwxgtk/.comrev"
            cd "\$BUILD" || exit

    fi

    # Download libwebp's source code, build and install it.
    if [ "\$BUILD" = "\$BUILDPATH/slade" ] && [ \$(git -C "\$BUILD" describe --tags | gawk -F'_|-' '{gsub("\\\.|-|[a-z]",""); print \$1}' | gawk '{if(\$0 < 1000) {gsub("$","0"); print} else {print}}') -ge "3260" ] && ([ "\$LIBC" != "musl" ] && ([ "\$ARCH" = "x86_64" ] || [ "\$ARCH" != "x86_64" ])); then

        if [ "\$APPIMAGE" = "1" ] || [ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ] || [ "\$WINPORTABLE" = "1" ] || [ "\$LNXOSNAME" = "NixOS" ]; then

            LIBWEBPPREFIX="\$SRB2BLDPREFIX"

        else

            LIBWEBPPREFIX="\$SRB2BLDPREFIX/stow/libwebp"

        fi

        if [ ! -d "\$SRB2BLDROOT/libraries/libwebp/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libwebp's source code. Please wait..."
            git clone \$GITOPTS https://github.com/webmproject/libwebp.git --recursive --branch "$LNXWEBPVER" "\$SRB2BLDROOT/libraries/libwebp"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libwebp's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/libwebp" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libwebp" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/libwebp" checkout -q main

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/libwebp" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/libwebp" checkout -q "$LNXWEBPVER"

        fi

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libwebp. Please wait..."
            CFLAGS="" cmake -S "\$SRB2BLDROOT/libraries/libwebp" -B "\$SRB2BLDROOT/libraries/libwebp/build" -DCMAKE_C_COMPILER=""\$CCACHE_BIN_PATH"\$GCCVER" -DCMAKE_CXX_COMPILER=""\$CCACHE_BIN_PATH"\$GXXVER" -DBUILD_SHARED_LIBS=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX="\$LIBWEBPPREFIX"
            cmake --build "\$SRB2BLDROOT/libraries/libwebp/build" -j"\$NCPU" --config Release

            if [ -d "\$SRB2BLDPREFIX/stow/libwebp" ] && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]); then

                sudo -E stow -Dv --adopt libwebp
                sudo rm -rf "\$LIBWEBPPREFIX"

            fi

            sudo -E cmake --install "\$SRB2BLDROOT/libraries/libwebp/build"

            if [ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$WINPORTABLE" != "1" ] && [ "\$LNXOSNAME" != "NixOS" ]; then

                sudo -E stow -v --adopt libwebp

            fi

            git -C "\$SRB2BLDROOT/libraries/libwebp" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/libwebp" reset -q --hard

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/libwebp" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/libwebp/.comrev"

    fi

    if [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

          # Download Google Depot Tools' source code, build and install it.
          if [ "\$OS" = "Linux" ]; then

              if [ ! -d "\$SRB2BLDROOT/libraries/depot_tools/.git" ]; then

                  \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading Google Depot Tools' source code. Please wait..."
                  git clone \$GITOPTS https://chromium.googlesource.com/chromium/tools/depot_tools.git --recursive --branch "$LNXDEPOTTOOLSVER" "\$SRB2BLDROOT/libraries/depot_tools"

              else

                  \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up Google Depot Tools' source code. Please wait..."
                  git -C "\$SRB2BLDROOT/libraries/depot_tools" clean -qdffx -e .comrev
                  git -C "\$SRB2BLDROOT/libraries/depot_tools" reset -q --hard
                  git -C "\$SRB2BLDROOT/libraries/depot_tools" checkout -q main

                  if [ -n "\$ISNET" ]; then

                      git -C "\$SRB2BLDROOT/libraries/depot_tools" pull --recurse-submodules --rebase --autostash

                  fi

                  git -C "\$SRB2BLDROOT/libraries/depot_tools" checkout -q "$LNXDEPOTTOOLSVER"

              fi

          fi

          if [ -n "\$(cat "\$SRB2BLDROOT/libraries/depot_tools/.comrev" 2>/dev/null)" ] && [ "\$(git -C "\$SRB2BLDROOT/libraries/depot_tools" rev-parse --short HEAD)" != "\$(cat "\$SRB2BLDROOT/libraries/depot_tools/.comrev" 2>/dev/null)" ]; then

               \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing depot_tools. Please wait..."
               git -C "\$SRB2BLDROOT/libraries/depot_tools" clean -qdffx -e .comrev
               git -C "\$SRB2BLDROOT/libraries/depot_tools" reset -q --hard

               COMREV=\$(git -C "\$SRB2BLDROOT/libraries/depot_tools" rev-parse --short HEAD)
               \$PRINTF "%s\n" "\$COMREV" >"\$SRB2BLDROOT/libraries/depot_tools/.comrev"

          fi

          # Download libskia's source code, build and install it.
          if [ "\$OS" = "Windows" ] && ([ ! -f "\$LIBSKIAPATH/libskia.lib" ] || ([ -n "\$(cat "\$SRB2BLDROOT/libraries/libskia/.comrev" 2>/dev/null)" ] && [ "\$(git -C "\$SRB2BLDROOT/libraries/libskia" rev-parse --short HEAD)" != "\$(cat "\$SRB2BLDROOT/libraries/libskia/.comrev" 2>/dev/null)" ])); then

              \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing libskia. Please wait..."

              if [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ]; then

                  if [ -n "\$ISNET" ]; then

                      LIBSKIAASSETURL=\$(curl -sL "https://api.github.com/repos/aseprite/skia/releases/latest" | gawk -F'"' '/browser_download_url.*Skia-Windows-Release-x86.zip/ {print \$4}')
                      if [ "\$(curl -X GET -sLI "\$LIBSKIAASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/libraries/Skia-Windows-Release-x86.zip" 2> /dev/null)" ]; then

                          rm -f "\$SRB2BLDROOT/libraries/Skia-Windows-Release-x86.zip"
                          curl -RL "\$LIBSKIAASSETURL" -o "\$SRB2BLDROOT/libraries/Skia-Windows-Release-x86.zip"

                      fi

                  fi

                  7z x -y "\$SRB2BLDROOT/libraries/Skia-Windows-Release-x86.zip" -o"/tmp/libskia"

              else

                  if [ -n "\$ISNET" ]; then

                      LIBSKIAASSETURL=\$(curl -sL "https://api.github.com/repos/aseprite/skia/releases/latest" | gawk -F'"' '/browser_download_url.*Skia-Windows-Release-x64.zip/ {print \$4}')
                      if [ "\$(curl -X GET -sLI "\$LIBSKIAASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/libraries/Skia-Windows-Release-x64.zip" 2> /dev/null)" ]; then

                          rm -f "\$SRB2BLDROOT/libraries/Skia-Windows-Release-x64.zip"
                          curl -RL "\$LIBSKIAASSETURL" -o "\$SRB2BLDROOT/libraries/Skia-Windows-Release-x64.zip"

                      fi

                  fi

                  7z x -y "\$SRB2BLDROOT/libraries/Skia-Windows-Release-x64.zip" -o"/tmp/libskia"

              fi

          elif [ "\$OS" = "Linux" ] && ([ ! -f "\$LIBSKIAPATH/libskia.a" ] || ([ -n "\$(cat "\$SRB2BLDROOT/libraries/libskia/.comrev" 2>/dev/null)" ] && [ "\$(git -C "\$SRB2BLDROOT/libraries/libskia" rev-parse --short HEAD)" != "\$(cat "\$SRB2BLDROOT/libraries/libskia/.comrev" 2>/dev/null)" ])); then

              \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing libskia. Please wait..."

              if [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ]; then

                  if [ -n "\$ISNET" ]; then

                      LIBSKIAASSETURL=\$(curl -sL "https://api.github.com/repos/aseprite/skia/releases/latest" | gawk -F'"' '/browser_download_url.*Skia-Linux-Release-x86.zip/ {print \$4}')
                      if [ "\$(curl -X GET -sLI "\$LIBSKIAASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/libraries/Skia-Linux-Release-x86.zip" 2> /dev/null)" ]; then

                          rm -f "\$SRB2BLDROOT/libraries/Skia-Linux-Release-x86.zip"
                          curl -RL "\$LIBSKIAASSETURL" -o "\$SRB2BLDROOT/libraries/Skia-Linux-Release-x86.zip"

                      fi

                  fi

                  7z x -y "\$SRB2BLDROOT/libraries/Skia-Linux-Release-x86.zip" -o"/tmp/libskia"

              else

                  if [ -n "\$ISNET" ]; then

                      LIBSKIAASSETURL=\$(curl -sL "https://api.github.com/repos/aseprite/skia/releases/latest" | gawk -F'"' '/browser_download_url.*Skia-Linux-Release-x64.zip/ {print \$4}')
                      if [ "\$(curl -X GET -sLI "\$LIBSKIAASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print \$NF}' 2> /dev/null | tail -n1)" != "\$(stat -c %s "\$SRB2BLDROOT/libraries/Skia-Linux-Release-x64.zip" 2> /dev/null)" ]; then

                          rm -f "\$SRB2BLDROOT/libraries/Skia-Linux-Release-x64.zip"
                          curl -RL "\$LIBSKIAASSETURL" -o "\$SRB2BLDROOT/libraries/Skia-Linux-Release-x64.zip"

                      fi

                  fi

                  7z x -y "\$SRB2BLDROOT/libraries/Skia-Linux-Release-x64.zip" -o"/tmp/libskia"

              fi

          fi

    fi

    # Download zdbsp's source code, build and install it.
    if [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ] || [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]; then

        if [ ! -d "\$SRB2BLDROOT/libraries/zdbsp/.git" ]; then

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading zdbsp's source code. Please wait..."
            git clone \$GITOPTS https://github.com/rheit/zdbsp.git --recursive --branch "$LNXZDBSPVER" "\$SRB2BLDROOT/libraries/zdbsp"

        else

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up zdbsp's source code. Please wait..."
            git -C "\$SRB2BLDROOT/libraries/zdbsp" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/zdbsp" reset -q --hard
            git -C "\$SRB2BLDROOT/libraries/zdbsp" checkout -q master

            if [ -n "\$ISNET" ]; then

                git -C "\$SRB2BLDROOT/libraries/zdbsp" pull --recurse-submodules --rebase --autostash

            fi

            git -C "\$SRB2BLDROOT/libraries/zdbsp" checkout -q "$LNXZDBSPVER"

        fi

            \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing zdbsp. Please wait..."
            CFLAGS="" cmake -S "\$SRB2BLDROOT/libraries/zdbsp" -B "\$SRB2BLDROOT/libraries/zdbsp/build" -DCMAKE_POLICY_VERSION_MINIMUM="\$CMAKEPOLVER" -DCMAKE_C_COMPILER=""\$CCACHE_BIN_PATH"\$GCCVER" -DCMAKE_CXX_COMPILER=""\$CCACHE_BIN_PATH"\$GXXVER" -DBUILD_SHARED_LIBS=ON -DCMAKE_BUILD_TYPE=Release
            cmake --build "\$SRB2BLDROOT/libraries/zdbsp/build" -j"\$NCPU" --config Release
            cp -f "\$SRB2BLDROOT/libraries/zdbsp/build/zdbsp" "\$BUILD/Build/Compilers/Nodebuilders/zdbsp.exe"

            git -C "\$SRB2BLDROOT/libraries/zdbsp" clean -qdffx -e .comrev
            git -C "\$SRB2BLDROOT/libraries/zdbsp" reset -q --hard

            COMREV=\$(git -C "\$SRB2BLDROOT/libraries/zdbsp" rev-parse --short HEAD)
            \$PRINTF "%s\n" "\$COMREV" > "\$SRB2BLDROOT/libraries/zdbsp/.comrev"

    fi

    # Downgrading Linux headers due to missing file ipx.h in recent versions of Alpine Linux.
    if [ "\$LIBC" = "musl" ] && ([ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ] || [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]); then

        curl -RLC - http://dl-cdn.alpinelinux.org/alpine/v3.15/main/\$(apk --print-arch)/linux-headers-5.10.41-r0.apk -o/tmp/linux-headers-5.10.41-r0.apk
        sudo apk add /tmp/linux-headers-5.10.41-r0.apk

    fi

    # Compile the build's source code.
    \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $BUILDNAME's source code. Please wait..."

    if [ "\$OS" = "Windows" ]; then

        if [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ] || [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ]; then

            if [ "\$BUILD" != "\$BUILDPATH/srb2-vr" ] && [ "\$BUILD" != "\$BUILDPATH/srb2-kart-vr" ]; then

                mkdir -p "\$BUILD/\$(\$PRINTF "%s\n" "\$SRC" | gawk '{gsub("src",""); print}')/objs/Mingw/Release"
                mkdir -p "\$BUILD/\$(\$PRINTF "%s\n" "\$SRC" | gawk '{gsub("src",""); print}')/bin/Mingw/Release"

            fi

            if [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ]; then

                cp -f "\$BUILD/SRB21094/branches/JTESHUFFLE/tools/libpng-src/projects/libpng.a" "\$BUILD/SRB21094/branches/LOZ/tools/libpng-src/projects"
                cp -f "\$BUILD/SRB21094/branches/JTESHUFFLE/tools/zlib/win32/libz.a" "\$BUILD/SRB21094/branches/LOZ/tools/zlib/win32"

            fi

            \$BLDCMD \$CONF

            if [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ] || [ "\$ARCH" = "x86_64" ]; then

                i686-w64-mingw32-objdump -x \$(find "\$BUILD/\$(\$PRINTF "%s\n" "\$SRC" | gawk '{gsub("src",""); print}')/bin" -name "*.exe") | gawk '/DLL/ && /.dll/ {print \$NF}' > "\$BUILD/deps"

            else

                \$ARCH-w64-mingw32-objdump -x \$(find "\$BUILD/\$(\$PRINTF "%s\n" "\$SRC" | gawk '{gsub("src",""); print}')/bin" -name "*.exe") | gawk '/DLL/ && /.dll/ {print \$NF}' > "\$BUILD/deps"

            fi

        elif [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

            \$BLDCMD \$CONF -DSDL2_DIR=\$(find "/tmp/SDL2/cmake" -type d 2> /dev/null) -DSDL2_mixer_DIR=\$(find "/tmp/SDL2_mixer/cmake" -type d 2> /dev/null)
            cmake --build "\$BUILD/build" --config Release -j"\$NCPU"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ] || [ "\$BUILD" = "\$BUILDPATH/blankart" ]; then

            if [ "\$BUILD" = "\$BUILDPATH/blankart" ] && [ ! -d "\$BUILD/build/_deps/png-build/include" ]; then

                mkdir -p "\$BUILD/build/_deps/png-build/include"

            fi

            cd "\$BUILD" || exit

            if [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ]; then

                sh "\$BUILD/setup-deps.sh"

            fi

            \$BLDCMD \$CONF
            cmake --build "\$BUILD/build" --config Release -j"\$NCPU"

            if [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ]; then

                cp -f \$(find "\$BUILD/build" -name "*.dll" -mindepth 1 -type f 2> /dev/null | gawk '!/AppDir/ {print}') "\$BUILD/build/AppDir/usr/lib"

            fi

        elif [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

            \$BLDCMD \$CONF
            cmake --build "\$BUILD/build/ninja-x86_mingw_static_vcpkg-release" --config Release -j"\$NCPU"

        elif [ "\$BUILD" = "\$BUILDPATH/slade" ]; then

            mkdir -p "\$BUILD/build"
            rm -f "\$BUILD/slade.pk3"
            7z a -y -tzip "\$BUILD/build/slade.pk3" "\$BUILD/dist/res/"*
            sudo ln -s /usr/include/\$ARCH-linux-gnu/bits /usr/include/bits
            sudo ln -s /usr/include/\$ARCH-linux-gnu/gnu /usr/include/gnu
            sudo ln -s /usr/include/\$ARCH-linux-gnu/asm /usr/include/asm

            WX_LIBRARIES=\$(find /usr -name "libwx_gtk3u*.so.*" -printf "%p;" 2> /dev/null | gawk '{gsub(";$",""); print}')

            \$BLDCMD \$CONF -DwxWidgets_LIBRARIES=\$WX_LIBRARIES
            cmake --build "\$BUILD/build" --config Release -j"\$NCPU"
            cmake --install "\$BUILD/build"
            sudo rm -rf "\$BUILD/build/AppDir/usr/share/applications/net.mancubus.SLADE.desktop" "\$BUILD/build/AppDir/usr/share/icons/net.mancubus.SLADE.png" "\$BUILD/build/AppDir/usr/share/metainfo"
            cp -f "\$BUILD/dist/res/logo_icon.png" "\$BUILD/build/icon.png"

        elif [ "\$BUILD" = "\$BUILDPATH/kartmaker" ] || [ "\$BUILD" = "\$BUILDPATH/neptunefm" ] || [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ] || [ "\$BUILD" = "\$BUILDPATH/followermaker" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ] || [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]; then

            cd "\$BUILD" || exit
            \$BLDCMD \$CONF

        elif [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

            export C_INCLUDE_PATH="\$BUILD/third_party/freetype2/include:\$BUILD/third_party/harfbuzz/src:\$C_INCLUDE_PATH"
            export CPLUS_INCLUDE_PATH="\$BUILD/third_party/freetype2/include:\$BUILD/third_party/harfbuzz/src:\$CPLUS_INCLUDE_PATH"

            curl -L https://raw.githubusercontent.com/wine-mirror/wine/master/include/interactioncontext.h -o /usr/x86_64-w64-mingw32/include/interactioncontext.h

            # Required removing carriage returns from code, if we want patches to be applied, due to CRLF endings from Windows host.
            find "\$BUILD" -name "*.awk" -o -name "*.cmake" -o -name "*.dfa" -exec gawk -i inplace '{gsub("\r",""); print}' {} \;
            \$BLDCMD \$CONF

            ninja -C "\$BUILD/build" -k0 -j"\$NCPU" aseprite
            ninja -C "\$BUILD/build" install
            git clone \$GITOPTS https://github.com/DragonDePlatino/Kart-Builder.git "\$BUILD/build/AppDir/usr/share/aseprite/data/extensions/kart-builder"

        else

            if [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ] || [ "\$ARCH" = "x86_64" ]; then

                \$BLDCMD \$CONF

                if [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ]; then

                    i686-w64-mingw32-objdump -x \$(find "\$BUILD/\$(\$PRINTF "%s\n" "\$SRC" | gawk '{gsub("src",""); print}')/bin" -name "*.exe") | gawk '/DLL/ && /.dll/ {print \$NF}' > "\$BUILD/deps"

                else

                    \$ARCH-w64-mingw32-objdump -x \$(find "\$BUILD/\$(\$PRINTF "%s\n" "\$SRC" | gawk '{gsub("src",""); print}')/bin" -name "*.exe") | gawk '/DLL/ && /.dll/ {print \$NF}' > "\$BUILD/deps"

                fi

            fi

        fi

     elif [ "\$OS" = "Linux" ]; then

        if [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ] || [ "\$BUILD" = "\$BUILDPATH/newmillennium" ] || [ "\$BUILD" = "\$BUILDPATH/blankart" ]; then

            \$BLDCMD \$CONF
            cmake --build "\$BUILD/build" --config Release -j"\$NCPU"

            if [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

                cp -rf "\$BUILD/build/NewMillennium" "\$BUILD/build/AppDir/usr/bin"

            fi

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

                mkdir -p "\$BUILD/\$(\$PRINTF "%s\n" "\$SRC" | gawk '{gsub("src",""); print}')/objs/Linux/Release"
                mkdir -p "\$BUILD/\$(\$PRINTF "%s\n" "\$SRC" | gawk '{gsub("src",""); print}')/bin/Linux/Release"
                mkdir -p "\$BUILD/\$(\$PRINTF "%s\n" "\$SRC" | gawk '{gsub("src",""); print}')/objs/Linux/SDL/Release"
                mkdir -p "\$BUILD/\$(\$PRINTF "%s\n" "\$SRC" | gawk '{gsub("src",""); print}')/bin/Linux/SDL/Release"

            if [ "\$LIBC" = "musl" ] && [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

                export GCCOLDVER="gcc"
                sudo apk del libgomp libatomic build-base alpine-sdk imagemagick
                curl -L https://dl-cdn.alpinelinux.org/alpine/v3.10/main/x86/gcc-8.3.0-r0.apk -o /tmp/gcc-8.3.0-r0.apk
                curl -L https://dl-cdn.alpinelinux.org/alpine/v3.10/main/x86/libatomic-8.3.0-r0.apk -o /tmp/libatomic-8.3.0-r0.apk
                curl -L https://dl-cdn.alpinelinux.org/alpine/v3.10/main/x86/libgomp-8.3.0-r0.apk -o /tmp/libgomp-8.3.0-r0.apk
                curl -L https://dl-cdn.alpinelinux.org/alpine/v3.10/main/x86/isl-0.18-r0.apk -o /tmp/isl-0.18-r0.apk
                curl -L https://dl-cdn.alpinelinux.org/alpine/v3.10/main/x86/mpfr3-3.1.5-r1.apk -o /tmp/mpfr3-3.1.5-r1.apk
                sudo apk add /tmp/gcc-8.3.0-r0.apk /tmp/libatomic-8.3.0-r0.apk /tmp/libgomp-8.3.0-r0.apk /tmp/isl-0.18-r0.apk /tmp/mpfr3-3.1.5-r1.apk make musl-dev imagemagick
                sudo ln -sf ../../../bin/ccache /usr/lib/ccache/bin/gcc

            fi

            \$BLDCMD \$CONF

        elif [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

            if [ "\$BUILD" = "\$BUILDPATH/ring-racers" ]; then

                export BUILD="/tmp/ring-racers"

            elif [ "\$BUILD" = "\$BUILDPATH/ring-racers-noire" ]; then

                export BUILD="/tmp/ring-racers-noire"

            elif [ "\$BUILD" = "\$BUILDPATH/ring-racers-hep" ]; then

                export BUILD="/tmp/ring-racers-hep"

            elif [ "\$BUILD" = "\$BUILDPATH/ring-racers-freaky-build" ]; then

                export BUILD="/tmp/ring-racers-freaky-build"

            elif [ "\$BUILD" = "\$BUILDPATH/radio-racers" ]; then

                export BUILD="/tmp/radio-racers"

            else

                export BUILD="/tmp/srb2-custom"

            fi

            cp -rf "\$BUILDMAIN" "\$BUILD"
            git -C "\$BUILD" clean -qdffx -e build/AppDir

            if [ "\$LIBC" != "musl" ]; then

                gawk -i inplace '{gsub("\\\\$<IF:\\\\$<TARGET_EXISTS:SDL2::SDL2>,SDL2::SDL2,SDL2::SDL2-static>","/usr/lib/libSDL2.so"); print}' "\$BUILD/src/sdl/CMakeLists.txt"

            fi

            BLDCMD=\$(\$PRINTF "%s\n" "\$BLDCMD" | gawk '{gsub("'\$BUILDMAIN'","'\$BUILD'"); print}')
            \$BLDCMD \$CONF
            C_INCLUDE_PATH="/usr/include/SDL2" CPLUS_INCLUDE_PATH="/usr/include/SDL2" cmake --build "\$BUILD/build" --config Release -j"\$NCPU"

        elif [ "\$BUILD" = "\$BUILDPATH/kartmaker" ] || [ "\$BUILD" = "\$BUILDPATH/neptunefm" ] || [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ] || [ "\$BUILD" = "\$BUILDPATH/followermaker" ]; then

            cd "\$BUILD" || exit
            \$BLDCMD \$CONF

        elif [ "\$BUILD" = "\$BUILDPATH/slade" ]; then

            mkdir -p "\$BUILD/build/AppDir/usr/lib/gtk-3.0/modules" "\$BUILD/build/AppDir/usr/lib/gio/modules" "\$BUILD/build/AppDir/usr/lib/gdk-pixbuf" "\$BUILD/build/AppDir/usr/share/glib-2.0/schemas" "\$BUILD/build/AppDir/usr/share/mime" "\$BUILD/build/AppDir/usr/share/icons"
            rm -f "\$BUILD/slade.pk3"
            7z a -y -tzip "\$BUILD/build/slade.pk3" "\$BUILD/dist/res/"*

            WX_LIBRARIES=\$(find /usr -name "libwx_gtk3u*.so.*" -printf "%p;" 2> /dev/null | gawk '{gsub(";$",""); print}')

            \$BLDCMD \$CONF -DwxWidgets_LIBRARIES=\$WX_LIBRARIES
            cmake --build "\$BUILD/build" --config Release -j"\$NCPU"
            cmake --install "\$BUILD/build"

            if [ "\$LIBC" != "musl" ]; then

                cp -Lf \$(find /usr/lib/\$ARCH-linux-gnu/libcanberra.so.[0-9] /usr/lib/\$ARCH-linux-gnu/libtdb.so.[0-9] /usr/lib/\$ARCH-linux-gnu/libltdl.so.[0-9] /usr/lib/\$ARCH-linux-gnu/libgmp.so.[0-9][0-9] /usr/lib/\$ARCH-linux-gnu/libp11-kit.so.[0-9] /usr/lib/\$ARCH-linux-gnu/liblua[0-9].[0-9].so /usr/lib/\$ARCH-linux-gnu/libnotify.so.[0-9] /usr/lib/\$ARCH-linux-gnu/librsvg-[0-9].so.[0-9] /usr/lib/\$ARCH-linux-gnu/libcroco-[0-9].[0-9].so.[0-9] /usr/lib/\$ARCH-linux-gnu/libxml[0-9].so.[0-9] /usr/lib/\$ARCH-linux-gnu/libicuuc.so.[0-9][0-9] /usr/lib/\$ARCH-linux-gnu/libicudata.so.[0-9][0-9] /usr/lib/\$ARCH-linux-gnu/libproxy.so.[0-9] /usr/lib/\$ARCH-linux-gnu/libgnutls.so.[0-9][0-9] /usr/lib/\$ARCH-linux-gnu/libidn[0-9].so.[0-9] /usr/lib/\$ARCH-linux-gnu/libunistring.so.[0-9] /usr/lib/\$ARCH-linux-gnu/libtasn[0-9].so.[0-9] /usr/lib/\$ARCH-linux-gnu/libnettle.so.[0-9] /usr/lib/\$ARCH-linux-gnu/libhogweed.so.[0-9] /usr/lib/\$ARCH-linux-gnu/libcanberra-gtk[0-9].so.[0-9] 2> /dev/null) "\$BUILD/build/AppDir/usr/lib"
                cp -Lf /usr/lib/\$ARCH-linux-gnu/gtk-3.0/modules/* "\$BUILD/build/AppDir/usr/lib/gtk-3.0/modules"
                cp -rf /usr/lib/\$ARCH-linux-gnu/gio/modules/* "\$BUILD/build/AppDir/usr/lib/gio/modules"
                cp -rf /usr/lib/\$ARCH-linux-gnu/gdk-pixbuf-2.0/2.10.0/* "\$BUILD/build/AppDir/usr/lib/gdk-pixbuf"
                cp -rf /usr/share/glib-2.0/schemas/* "\$BUILD/build/AppDir/usr/share/glib-2.0/schemas"
                cp -rf /usr/share/mime/* "\$BUILD/build/AppDir/usr/share/mime"
                cp -rf /usr/share/icons/Adwaita /usr/share/icons/gnome "\$BUILD/build/AppDir/usr/share/icons"

            else

                cp -Lf \$(find /usr/lib/libgmp.so.[0-9][0-9] /usr/lib/libp11-kit.so.[0-9] /usr/lib/liblua[0-9].[0-9].so /usr/lib/libnotify.so.[0-9] /usr/lib/librsvg-[0-9].so.[0-9] /usr/lib/libcroco-[0-9].[0-9].so.[0-9] /usr/lib/libxml[0-9].so.[0-9] /usr/lib/libicuuc.so.[0-9][0-9] /usr/lib/libicudata.so.[0-9][0-9] /usr/lib/libproxy.so.[0-9] /usr/lib/libgnutls.so.[0-9][0-9] /usr/lib/libidn[0-9].so.[0-9] /usr/lib/libunistring.so.[0-9] /usr/lib/libtasn[0-9].so.[0-9] /usr/lib/libnettle.so.[0-9] /usr/lib/libhogweed.so.[0-9] /usr/lib/libcanberra-gtk[0-9].so.[0-9] 2> /dev/null) "\$BUILD/build/AppDir/usr/lib"
                cp -Lf /usr/lib/gtk-3.0/modules/* "\$BUILD/build/AppDir/usr/lib/gtk-3.0/modules"
                cp -rf /usr/lib/gio/modules/* "\$BUILD/build/AppDir/usr/lib/gio/modules"
                cp -rf /usr/lib/gdk-pixbuf-2.0/2.10.0/* "\$BUILD/build/AppDir/usr/lib/gdk-pixbuf"
                cp -rf /usr/share/glib-2.0/schemas/* "\$BUILD/build/AppDir/usr/share/glib-2.0/schemas"
                cp -rf /usr/share/mime/* "\$BUILD/build/AppDir/usr/share/mime"
                cp -rf /usr/share/icons/Adwaita /usr/share/icons/gnome "\$BUILD/build/AppDir/usr/share/icons"

            fi

            # Creating loaders.cache with new paths to modules and moving slade.pk3 for SLADE.
            if [ "\$APPIMAGE" = "1" ] || [ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ]; then

                gawk -i inplace '{gsub("^\".*/usr/lib/.*-linux-gnu/.*/loaders|^\".*/usr/lib/.*/loaders","\"/usr/lib/gdk-pixbuf/loaders"); print}' "\$BUILD/build/AppDir/usr/lib/gdk-pixbuf/loaders.cache"
                mv -f "\$BUILD/build/slade.pk3" "\$BUILD/build/AppDir/usr/bin"

            fi

            sudo rm -rf "\$BUILD/build/AppDir/usr/share/applications/net.mancubus.SLADE.desktop" "\$BUILD/build/AppDir/usr/share/icons/net.mancubus.SLADE.png" "\$BUILD/build/AppDir/usr/share/metainfo"
            cp -f "\$BUILD/dist/res/logo_icon.png" "\$BUILD/build/icon.png"

        elif [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ] || [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]; then

            if [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ]; then

                UZBBIN="uzb"

            elif [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ]; then

                UZBBIN="ugb"

            elif [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ]; then

                UZBBIN="ulb"

            elif [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]; then

                UZBBIN="hvr"

            fi

            \$BLDCMD \$CONF

            if [ "\$APPIMAGE" = "1" ] || [ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ] || [ "\$LNXOSNAME" != "NixOS" ]; then

                mkbundle --fetch-target "mono-$LNXMONOVER-ubuntu-$LNXMONOUBUVER-x64"
                cp -f "\$HOME/.mono/targets/mono-$LNXMONOVER-ubuntu-$LNXMONOUBUVER-x64/etc/mono/config" "\$BUILD/Build/config"
                gawk -i inplace '{gsub("\\\\\$mono_libdir/",""); print}' "\$BUILD/Build/config"
                mkbundle --deps --cross "mono-$LNXMONOVER-ubuntu-$LNXMONOUBUVER-x64" --config "\$BUILD/Build/config" --machine-config "\$HOME/.mono/targets/mono-$LNXMONOVER-ubuntu-$LNXMONOUBUVER-x64/etc/mono/4.5/machine.config" -L "\$HOME/.mono/targets/mono-$LNXMONOVER-ubuntu-$LNXMONOUBUVER-x64/lib/mono/4.5" -L "\$BUILD/Build" --library /lib/\$ARCH-linux-gnu/libc.so.6 --library /usr/lib/\$ARCH-linux-gnu/libjpeg.so.8 --library /usr/lib/\$ARCH-linux-gnu/libjbig.so.0 --library /usr/lib/\$ARCH-linux-gnu/libtiff.so.5 --library /lib/\$ARCH-linux-gnu/liblzma.so.5 --library /lib/\$ARCH-linux-gnu/libz.so.1 --library /usr/lib/\$ARCH-linux-gnu/libX11.so.6 --library /usr/lib/\$ARCH-linux-gnu/libxcb.so.1 --library /usr/lib/\$ARCH-linux-gnu/libXau.so.6 --library /lib/\$ARCH-linux-gnu/libbsd.so.0 --library /usr/lib/\$ARCH-linux-gnu/libXdmcp.so.6 --library /usr/lib/\$ARCH-linux-gnu/libexif.so.12 --library /usr/lib/libgdiplus.so --library /usr/lib/\$ARCH-linux-gnu/libcairo.so.2 --library /usr/lib/\$ARCH-linux-gnu/libfreetype.so.6 --library /usr/lib/\$ARCH-linux-gnu/libgif.so.7 --library /usr/lib/\$ARCH-linux-gnu/libpng16.so.16 --library /usr/lib/\$ARCH-linux-gnu/libfontconfig.so.1 --library /usr/lib/\$ARCH-linux-gnu/libXext.so.6 --library /usr/lib/\$ARCH-linux-gnu/libXrender.so.1 --library /usr/lib/\$ARCH-linux-gnu/libxcb-render.so.0 --library /usr/lib/\$ARCH-linux-gnu/libxcb-shm.so.0 --library /usr/lib/\$ARCH-linux-gnu/libpixman-1.so.0 --library /lib/\$ARCH-linux-gnu/libbz2.so.1.0 --library /usr/lib/\$ARCH-linux-gnu/libharfbuzz.so.0 --library /lib/\$ARCH-linux-gnu/libexpat.so.1 --library /usr/lib/\$ARCH-linux-gnu/libgraphite2.so.3 --library /usr/lib/\$ARCH-linux-gnu/libXcursor.so.1 --library /usr/lib/\$ARCH-linux-gnu/libXfixes.so.3 --library /usr/lib/\$ARCH-linux-gnu/libXinerama.so.1 --library /lib/\$ARCH-linux-gnu/libkeyutils.so.1 --library /usr/lib/\$ARCH-linux-gnu/libkrb5support.so.0 --library /usr/lib/\$ARCH-linux-gnu/libk5crypto.so.3 --library /usr/lib/\$ARCH-linux-gnu/libkrb5.so.3 --library /usr/lib/\$ARCH-linux-gnu/libgssapi_krb5.so.2 --library /lib/\$ARCH-linux-gnu/libcom_err.so.2 --library /lib/\$ARCH-linux-gnu/libresolv.so.2 --library /usr/lib/libmono-native.so --library /usr/lib/libMonoPosixHelper.so --library /usr/lib/libMonoSupportW.so -o "\$BUILD/build/AppDir/usr/bin/\$UZBBIN.bin" "\$BUILD/Build/Builder.exe"

            fi

            cp -rf \$(find "\$BUILD/Build" -mindepth 1 -maxdepth 1 | gawk '!/AppDir/ {print}') "\$BUILD/build/AppDir/usr/bin"
            cp -rf /usr/share/icons/Adwaita "\$BUILD/build/AppDir/usr/share/icons"

        elif [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

            # Required removing carriage returns from code, if we want patches to be applied, due to CRLF endings from Windows host.
            find "\$BUILD" -name "*.awk" -o -name "*.cmake" -o -name "*.dfa" -exec gawk -i inplace '{gsub("\r",""); print}' {} \;

            \$BLDCMD \$CONF
            ninja -C "\$BUILD/build" -k0 -j"\$NCPU" aseprite
            ninja -C "\$BUILD/build" install
            git clone \$GITOPTS https://github.com/DragonDePlatino/Kart-Builder.git "\$BUILD/build/AppDir/usr/share/aseprite/data/extensions/kart-builder"

            if [ "\$APPIMAGE" = "1" ] || [ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ]; then

                cp -rf "/usr/lib/p7zip" "\$BUILD/build/AppDir/usr/lib"

            fi

        else

            \$BLDCMD \$CONF

        fi

    fi

    if [ "\$OS" = "Linux" ]; then

        \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Copying $BUILDNAME's binary, libraries, icons, desktop file and AppRun to AppDir. Please wait..."

        # Copy compiled binary to AppDir.
        if [ -f "\$BUILD/wadcli" ]; then

            cp -f "\$BUILD/wadcli" "\$BUILD/build/AppDir/usr/bin"

        elif [ -f "\$BUILD/build/kartmaker" ]; then

            cp -f "\$BUILD/build/kartmaker" "\$BUILD/build/AppDir/usr/bin"

        elif [ -f "\$BUILD/kartmaker" ]; then

            cp -f "\$BUILD/kartmaker" "\$BUILD/build/AppDir/usr/bin"

        elif [ -f "\$BUILD/NeptuneFM" ]; then

            cp -f "\$BUILD/NeptuneFM" "\$BUILD/build/AppDir/usr/bin/neptunefm"

        elif [ -f "\$BUILD/followermaker" ]; then

            cp -f "\$BUILD/followermaker" "\$BUILD/build/AppDir/usr/bin"

        else

            cp -f \$(find "\$BUILD/bin" "\$BUILD/build/bin" "\$BUILD/SRB2"*"/branches/"*"/bin/Linux" -mindepth 1 -executable -type f ! -name "*.debug" ! -name ".gitignore" 2> /dev/null | head -n1) "\$BUILD/build/AppDir/usr/bin" 2> /dev/null || true

        fi

    fi

if [ "\$APPIMAGE" = "1" ]; then

    # Create desktop file.
    COMREV=\$(sudo git -C "\$BUILD" rev-parse --short HEAD)

    if [ "\$BUILD" = "\$BUILDPATH/srb2" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2
Comment=Open source 3D Sonic platformer based on Doom Legacy engine
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Classic
Comment=Modified open source 3D Sonic platformer based on Doom Legacy engine
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2-2.2-Classic
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-beta6" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Beta 6
Comment=Recreation of open source 3D Sonic platformer based on SRB2 2.2 Beta 6 engine
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2-2.2-Beta6
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-uncapped-plus" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Uncapped PLUS
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.2 with improved framerate and additional features
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2UncappedPlus
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-netplus" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 NetPlus
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.2 with rollback netcode
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2NetPlus
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-reveries" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Reveries
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.2 with customized physics and movesets
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2Reveries
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-tsourdt3rd" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 TSoURDt3rd
Comment=Modified open source 3D Sonic platformer with based on SRB2 v2.2 with improved framerate and additional features combined from Uncapped and other builds
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2TSoURDt3rd
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-edit" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Edit
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.2 with multiplayer enchancements, Lua additions and other changes
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2Edit
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-ggj" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 The Great Galactic Journey
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.2 with features increased flat limits, timelines and maps utilizing build's exclusive functions
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2GGJ
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-destructive-illusion" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Destructive Illusion
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.2 with unique campaign and game mechanics
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2DestructiveIllusion
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 VR
Comment=Modified open source 3D Sonic VR platformer based on SRB2 v2.2 with improved framerate and additional features
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;OpenVR;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRBVR
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software

[Desktop Action OpenVR]
Name=OpenVR runtime
Exec=AppRun -openvr -win
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.1-legacy" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 v2.1 Legacy
Comment=Open source 3D Sonic platformer based on Doom Legacy engine
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2-2.1-Legacy
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-fusion-advance" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Fusion Advance
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.1 with improved framerate, coronas and orbital camera
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2FusionAdvance
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Thokker
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.1 with soccer-like gamemode
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2Thokker
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Top Down
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.1 with top down camera and unique set of levels
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2TopDown
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Smash Brawl
Comment=Modified open source 2D Sonic game based on SRB2 v2.1 with Super Smash Bros. gameplay
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SonicSmashBrawl
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 v2.0
Comment=Open source 3D Sonic platformer based on Doom Legacy engine
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2-2.0
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Community Build
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.0 with included functional slopes, PNG support, bots and extensive improvements to the OpenGL renderer
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2CB
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/xsrb2" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=X Sonic Robo Blast 2
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.0 with additional modes like Sonic Golf mode and unique set of levels
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=XSRB2
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 SF94-Serv
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.0 with hangout maps
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2SF94Serv
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Riders
Comment=Modified open source 3D Sonic racing game based on SRB2 v2.0 with Sonic Riders gameplay
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;riders;kart;racing;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2Riders
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Super Sonic Robo Blast 2 Kart Z
Comment=Modified open source 3D Sonic game based SRB2 v2.0 with kart racing gameplay
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;kart;racing;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SuperSRB2KartZ
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/sbb2" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Bomberman Blast 2
Comment=Modified open source 3D Sonic game based on SRB2 v2.0 with Bomberman gameplay
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;bomberman;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SBB2
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Final Demo
Comment=Open source 3D Sonic platformer based on Doom Legacy engine
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2FinalDemo
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 1.09.5
Comment=Modified open source 3D Sonic platformer based on SRB2 OLD (fork of SRB2 v1.09.4)
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB21095
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 JTE
Comment=Modified open source 3D Sonic platformer based on SRB2 Final Demo with additional modes, maps and easter eggs
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2JTE
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=ShufflarB2
Comment=Modified open source 3D Sonic platformer based on SRB2 Final Demo with additional modes, maps and day/night cycle in the levels
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=ShufflarB2
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-live" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Live
Comment=Modified open source 3D Sonic platformer based on SRB2 Final Demo with additional modes and multiplayer maps
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2Live
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 LoZ
Comment=Modified open source 3D Sonic game based on SRB2 Final Demo with The Legend of Zelda gameplay
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2LoZ
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software -win
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Super Smash Bros Sonic Showdown
Comment=Modified open source 2D Sonic game based on SRB2 Final Demo with Super Smash Bros. gameplay
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SSBSS
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software -win
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=NewMillennium
Comment=Modified open source 3D Sonic platformer based on SRB2 2000 prototype with various fixes and enhancements
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;platformer;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=NewMillennium
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-persona" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Persona
Comment=Modified open source 3D Sonic game with Persona gameplay
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;rpg;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2Persona
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Kart
Comment=Modified open source 3D Sonic game with kart racing gameplay
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;kart;racing;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2Kart
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-galaxy" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Kart Galaxy
Comment=Modified open source 3D Sonic game with kart racing gameplay, improved framerate and additional features inspired by Moe Mansion
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;kart;racing;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2KartGalaxy
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-hep" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Kart HEP
Comment=Modified open source 3D Sonic game with kart racing gameplay, improved framerate and additional features based on SRB2 Kart Galaxy
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;kart;racing;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2KartHEP
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-saturn" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Kart Saturn
Comment=Modified open source 3D Sonic game with kart racing gameplay, improved framerate and additional features based on SRB2 Kart Galaxy
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;kart;racing;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2KartSaturn
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-neptune" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Kart Neptune
Comment=Modified open source 3D Sonic game with kart racing gameplay, improved framerate and additional features based on SRB2 Kart Saturn
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;kart;racing;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2KartNeptune
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Kart VR
Comment=Modified open source 3D Sonic game with VR kart racing gameplay, improved framerate and additional features
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;kart;racing;
Actions=OpenGL;Software;OpenVR;
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2KartVR
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software

[Desktop Action OpenVR]
Name=OpenVR runtime
Exec=AppRun -openvr -win
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/blankart" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Blankart
Comment=Modified open source 3D Sonic game with kart racing gameplay
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;kart;racing;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=Blankart
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$(basename \$BUILD)" = "ring-racers" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Dr. Robotnik's Ring Racers
Comment=Modified open source 3D Sonic game with kart racing gameplay
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;kart;racing;ring;racers;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=RingRacers
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$(basename \$BUILD)" = "ring-racers-noire" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Dr. Robotnik's Ring Racers Noire
Comment=Modified open source 3D Sonic game with kart racing gameplay with additional features
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;kart;racing;ring;racers;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=RingRacersNoire
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$(basename \$BUILD)" = "ring-racers-hep" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Dr. Robotnik's Ring Racers HEP
Comment=Modified open source 3D Sonic game with kart racing gameplay with additional features
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;kart;racing;ring;racers;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=RingRacersHEP
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$(basename \$BUILD)" = "ring-racers-freaky-build" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Dr. Robotnik's Ring Racers Freaky Build
Comment=Modified open source 3D Sonic game with kart racing gameplay with additional features like color profiles
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;kart;racing;ring;racers;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=RingRacersFreakyBuild
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$(basename \$BUILD)" = "radio-racers" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Radio Racers
Comment=Modified open source 3D Sonic game with kart racing gameplay with additional features
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;kart;racing;ring;racers;
Actions=OpenGL;Software;
Terminal=false
NoDisplay=false
X-AppImage-Name=RadioRacers
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$(dirname \$BUILD)" = "\$BUILDPATH/srb2-custom" ] || [ "\$(dirname \$BUILDMAIN)" = "\$BUILDPATH/srb2-custom" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Sonic Robo Blast 2 Custom \$CUSTOMDIR
Comment=Modified open source 3D Sonic game
Icon=icon
Exec=AppRun
Categories=Game;
Keywords=sonic;
Actions=OpenGL;Software
Terminal=false
NoDisplay=false
X-AppImage-Name=SRB2C\$CUSTOMDIR
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV

[Desktop Action OpenGL]
Name=OpenGL renderer
Exec=AppRun -opengl

[Desktop Action Software]
Name=Software renderer
Exec=AppRun -software
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/wadcli" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=wadcli
Comment=Allows the manipulation of Doom WAD files through command-line
Icon=icon
Exec=AppRun
Categories=Development;
Keywords=sonic;wad;
Terminal=true
NoDisplay=false
X-AppImage-Name=wadcli
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/kartmaker" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=kartmaker
Comment=Simple utility that automatically creates a character WAD for SRB2Kart from a working folder
Icon=icon
Exec=AppRun
Categories=Development;
Keywords=sonic;wad;kart
Terminal=true
NoDisplay=false
X-AppImage-Name=kartmaker
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/neptunefm" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=NeptuneFM (SRB2 Kart)
Comment=A fork of followermaker for SRB2Kart Neptune
Icon=icon
Exec=AppRun
Categories=Development;
Keywords=sonic;wad;kart
Terminal=true
NoDisplay=false
X-AppImage-Name=neptunefm
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=kartmaker (Ring Racers)
Comment=Simple utility that automatically creates a character WAD for Ring Racers from a working folder
Icon=icon
Exec=AppRun
Categories=Development;
Keywords=sonic;wad;kart
Terminal=true
NoDisplay=false
X-AppImage-Name=kartmaker_rr
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/followermaker" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=followermaker
Comment=Simple utility that automatically creates a follower WAD for Ring Racers from a working folder
Icon=icon
Exec=AppRun
Categories=Development;
Keywords=sonic;wad;kart
Terminal=true
NoDisplay=false
X-AppImage-Name=followermaker
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/slade" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=SLADE
Comment=Allows the manipulation of Doom WAD files
Icon=icon
Exec=AppRun
Categories=Development;
Keywords=sonic;wad;
Terminal=false
NoDisplay=false
X-AppImage-Name=slade
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Ultimate Zone Builder
Comment=A map editor for UDMF levels in SRB2, forked from Ultimate Doom Builder
Icon=icon
Exec=AppRun
Categories=Development;
Keywords=sonic;wad;uzb;
Terminal=false
NoDisplay=false
X-AppImage-Name=UltimateZoneBuilder
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Ultimate GKSZ Builder
Comment=A map editor for UDMF levels in SRB2, forked from Ultimate Doom Builder
Icon=icon
Exec=AppRun
Categories=Development;
Keywords=sonic;wad;ugb;
Terminal=false
NoDisplay=false
X-AppImage-Name=UltimateGKSZBuilder
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Ultimate Lowee Builder
Comment=A map editor for UDMF levels in BlanKart, forked from Ultimate Zone Builder
Icon=icon
Exec=AppRun
Categories=Development;
Keywords=sonic;wad;ulb;
Terminal=false
NoDisplay=false
X-AppImage-Name=UltimateLoweeBuilder
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=High Voltage Ring
Comment=A map editor for UDMF levels in Ring Racers, forked from Ultimate Zone Builder
Icon=icon
Exec=AppRun
Categories=Development;
Keywords=sonic;wad;ring;racers;hvr;
Terminal=false
NoDisplay=false
X-AppImage-Name=HighVoltageRing
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/app.desktop" << DESKTOP
[Desktop Entry]
Type=Application
Name=Aseprite
Comment=Animated sprite editor and pixel art tool
Icon=icon
Exec=AppRun
Categories=Graphics;
Keywords=aseprite;
Terminal=false
NoDisplay=false
X-AppImage-Name=Aseprite
X-AppImage-Arch=\$ARCH
X-AppImage-Version=\$COMREV
DESKTOP

    fi

    cat > "\$BUILD/build/AppDir/AppRun" << 'APPRUN'
#!/bin/sh

export HERE="\$(dirname "\$(readlink -f "\$0")")"
export LD_LIBRARY_PATH="\$HERE/usr/lib:\$HERE/usr/lib/gtk-3.0/modules:\$HERE/usr/lib/gdk-pixbuf/loaders:\$LD_LIBRARY_PATH"
APPRUN

    if [ "\$BUILD" = "\$BUILDPATH/srb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-beta6" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-uncapped-plus" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-netplus" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-reveries" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-tsourdt3rd" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-edit" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-ggj" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-destructive-illusion" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-2.1-legacy" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-fusion-advance" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ] || [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-persona" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-galaxy" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-hep" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-saturn" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-neptune" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ] || [ "\$BUILD" = "\$BUILDPATH/blankart" ] || [ "\$(basename \$BUILD)" = "ring-racers" ] || [ "\$(basename \$BUILD)" = "ring-racers-noire" ] || [ "\$(basename \$BUILD)" = "ring-racers-hep" ] || [ "\$(basename \$BUILD)" = "ring-racers-freaky-build" ] || [ "\$(basename \$BUILD)" = "radio-racers" ] || [ "\$(dirname \$BUILD)" = "\$BUILDPATH/srb2-custom" ] || [ "\$(dirname \$BUILDMAIN)" = "\$BUILDPATH/srb2-custom" ]; then

        if [ -n "\$(gawk -F'"' '/envstr = I_GetEnv\(".*"\)\) != NULL\) && isWadPathOk\(envstr\)\)/ {print \$2}' "\$BUILD/src/sdl/i_system.c"*)" ]; then

            APPIMAGEWADDIR=\$(gawk -F'"' '/envstr = I_GetEnv\(".*"\)\) != NULL\) && isWadPathOk\(envstr\)\)/ {print \$2}' "\$BUILD/src/sdl/i_system.c"*)

        else

            APPIMAGEWADDIR="SRB2WADDIR"

        fi

        cat >> "\$BUILD/build/AppDir/AppRun" << APPRUNBIN
export \$APPIMAGEWADDIR="\\\$HERE/usr/games/\$ASSETAPPDIR"
export SDL_SOUNDFONTS="\\\$SDL_SOUNDFONTS"
export SDL_FORCE_SOUNDFONTS=1

exec "\\\$HERE/usr/bin/\\\$(ls \\\$HERE/usr/bin)" "\\\$@"
APPRUNBIN

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

        cat >> "\$BUILD/build/AppDir/AppRun" << 'APPRUNBIN'
export SRB2WADDIR="\$HERE/usr/games/SRB2"

if [ "\$(gawk -F'=' '/^NAME=/ {gsub("\"",""); print \$NF}' /etc/os-release)" = "NixOS" ]; then

    if [ ! -f "\$(patchelf --print-interpreter "\$HERE/usr/bin/\$(ls \$HERE/usr/bin)")" ] && [ "\$(patchelf --print-interpreter "\$HERE/usr/bin/\$(ls \$HERE/usr/bin)")" != "\$(find /lib/ld-linux.so.* 2> /dev/null)" ]; then

        patchelf --set-interpreter "\$(find /nix/store -name ld-linux.so.* -type f 2> /dev/null | sort -V | tail -n1)" "\$HERE/usr/bin/\$(ls \$HERE/usr/bin)"

    fi

    SRB2WADDIRTMP=\$(mktemp -d)
    ln -sf "\$SRB2WADDIR" "\$SRB2WADDIRTMP"
    export SRB2WADDIR="\$SRB2WADDIRTMP/SRB2"

fi

cd "\$HERE"

exec "\$HERE/usr/bin/\$(ls \$HERE/usr/bin)" "\$@"
APPRUNBIN

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ]; then

        cat >> "\$BUILD/build/AppDir/AppRun" << 'APPRUNBIN'
if [ "\$(gawk -F'=' '/^NAME=/ {gsub("\"",""); print \$NF}' /etc/os-release)" = "NixOS" ]; then

    if [ ! -f "\$(patchelf --print-interpreter "\$HERE/usr/bin/lsdlsrb2")" ] && [ "\$(patchelf --print-interpreter "\$HERE/usr/bin/lsdlsrb2")" != "\$(find /lib/ld-linux.so.* 2> /dev/null)" ]; then

        patchelf --set-interpreter "\$(find /nix/store -name ld-linux.so.* -type f 2> /dev/null | sort -V | tail -n1)" "\$HERE/usr/bin/lsdlsrb2"

    fi

    SRB2WADDIRTMP=\$(mktemp -d)
    ln -sf "\$SRB2WADDIR" "\$SRB2WADDIRTMP"
    export SRB2WADDIR="\$SRB2WADDIRTMP/SRB2"

fi

cd "\$HERE/usr/games/SRB2"

exec "\$HERE/usr/bin/\$(ls \$HERE/usr/bin)" -opengl "\$@"
APPRUNBIN

    elif [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

        cat >> "\$BUILD/build/AppDir/AppRun" << 'APPRUNBIN'
export LD_LIBRARY_PATH=\$(dirname \$(file -L \$(find -L /usr/lib32 /lib -name libGL.so.[0-9] 2> /dev/null) | gawk -F':' '/32-bit/ {print $1}') 2> /dev/null):\$LD_LIBRARY_PATH
export LIBGL_DRIVERS_PATH="\$HERE/usr/lib/dri"
export __EGL_VENDOR_LIBRARY_DIRS="/etc/glvnd/egl_vendor.d:/usr/share/glvnd/egl_vendor.d"
export __GLX_VENDOR_LIBRARY_NAME="mesa"
export GALLIUM_DRIVER="llvmpipe"
export MESA_LOADER_DRIVER_OVERRIDE="llvmpipe"
export LIBGL_ALWAYS_SOFTWARE="1"
export __NV_PRIME_RENDER_OFFLOAD="0"
export DBUS_FATAL_WARNINGS="0"

export SRB2WADDIR="\$HERE/usr/games/SRB2"

if [ "\$(gawk -F'=' '/^NAME=/ {gsub("\"",""); print \$NF}' /etc/os-release)" = "NixOS" ]; then

    if [ ! -f "\$(patchelf --print-interpreter "\$HERE/usr/bin/NewMillennium")" ] && [ "\$(patchelf --print-interpreter "\$HERE/usr/bin/NewMillennium")" != "\$(find /lib/ld-linux.so.* 2> /dev/null)" ]; then

        patchelf --set-interpreter "\$(find /nix/store -name ld-linux.so.* -type f 2> /dev/null | sort -V | tail -n1)" "\$HERE/usr/bin/NewMillennium"

    fi

fi

cd "\$SRB2WADDIR"

exec "\$HERE/usr/bin/NewMillennium" "\$@"
APPRUNBIN

    elif [ "\$BUILD" = "\$BUILDPATH/wadcli" ]; then

        cat >> "\$BUILD/build/AppDir/AppRun" << 'APPRUNBIN'
exec "\$HERE/usr/bin/wadcli" "\$@"
APPRUNBIN

    elif [ "\$BUILD" = "\$BUILDPATH/kartmaker" ] || [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ]; then

        cat >> "\$BUILD/build/AppDir/AppRun" << 'APPRUNBIN'
exec "\$HERE/usr/bin/kartmaker" "\$@"
APPRUNBIN

    elif [ "\$BUILD" = "\$BUILDPATH/neptunefm" ]; then

        cat >> "\$BUILD/build/AppDir/AppRun" << 'APPRUNBIN'
exec "\$HERE/usr/bin/neptunefm" "\$@"
APPRUNBIN

    elif [ "\$BUILD" = "\$BUILDPATH/followermaker" ]; then

        cat >> "\$BUILD/build/AppDir/AppRun" << 'APPRUNBIN'
exec "\$HERE/usr/bin/followermaker" "\$@"
APPRUNBIN

    elif [ "\$BUILD" = "\$BUILDPATH/slade" ]; then

        cat >> "\$BUILD/build/AppDir/AppRun" << 'APPRUNBIN'
export GTK_PATH="\$HERE/usr/lib/gtk-3.0"
export GIO_MODULE_DIR="\$HERE/usr/lib/gio/modules"
export GIO_EXTRA_MODULES="\$HERE/usr/lib/gio/modules"
export GDK_PIXBUF_MODULEDIR="\$HERE/usr/lib/gdk-pixbuf/loaders"
export GDK_PIXBUF_MODULE_FILE="/tmp/loaders.cache"
export XDG_DATA_DIRS="\$HERE/usr/share:\$HERE/usr/share/mime:\$XDG_DATA_DIRS"
export KDE_FULL_SESSION="false"

\$(find / -type f -executable -name "gdk-pixbuf-query-loaders*" 2> /dev/null | head -n1) > "/tmp/loaders.cache"

exec "\$HERE/usr/bin/slade" "\$@"
APPRUNBIN

    elif [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ]; then

        cat >> "\$BUILD/build/AppDir/AppRun" << 'APPRUNBIN'
cd "\$HERE/usr/bin"
exec "\$HERE/usr/bin/uzb.bin" "\$@"
APPRUNBIN

    elif [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ]; then

        cat >> "\$BUILD/build/AppDir/AppRun" << 'APPRUNBIN'
cd "\$HERE/usr/bin"
exec "\$HERE/usr/bin/ugb.bin" "\$@"
APPRUNBIN

    elif [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ]; then

        cat >> "\$BUILD/build/AppDir/AppRun" << 'APPRUNBIN'
cd "\$HERE/usr/bin"
exec "\$HERE/usr/bin/ulb.bin" "\$@"
APPRUNBIN

    elif [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]; then

        cat >> "\$BUILD/build/AppDir/AppRun" << 'APPRUNBIN'
cd "\$HERE/usr/bin"
exec "\$HERE/usr/bin/hvr.bin" "\$@"
APPRUNBIN

    elif [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

        cat >> "\$BUILD/build/AppDir/AppRun" << 'APPRUNBIN'
export PATH="\$HERE/usr/bin:\$PATH"
exec "\$HERE/usr/bin/aseprite" "\$@"
APPRUNBIN
        cat >> "\$BUILD/build/AppDir/usr/bin/7z" << '7Z'
#!/bin/sh
export HERE="\$(dirname \$(dirname "\$(readlink -f "\$0")"))"
exec "\$HERE/lib/p7zip/7z" "\$@"
7Z
        chmod 755 "\$BUILD/build/AppDir/usr/bin/7z"

    fi

    chmod 755 "\$BUILD/build/AppDir/AppRun"

    # Copying libraries to AppDir.
    if [ "\$BUILD" != "\$BUILDPATH/kartmaker" ] && [ "\$BUILD" != "\$BUILDPATH/neptunefm" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker-ring-racers" ] && [ "\$BUILD" != "\$BUILDPATH/followermaker" ]; then

        # libstdc++.so.6 and libzstd.so.1 cause SDL2 window without loading game for NewMillennium on Gentoo.
        # libGL.so.1, libGLdispatch.so.0, libGLX.so.0 and libGLX_mesa.so.0 create GLX opcode error and does not open SDL2 window.
        cp -Lf \$(ldd \$(find "\$BUILD/build/AppDir/usr/bin" -type f) 2> /dev/null | gawk '{print \$3}' | gawk '!/not|dynamic|version|libc.so|libdl.so|ld-|libm.so|libpthread.so|libresolv.so|librt.so|libcom_err.so/ {print}' | sort -u) "\$BUILD/build/AppDir/usr/lib"

        if [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

            cp -Lf \$(find /usr/lib/i386-linux-gnu/libgbm.so.[0-9] /lib/i386-linux-gnu/libexpat.so.[0-9] /usr/lib/i386-linux-gnu/libX11.so.[0-9] /usr/lib/i386-linux-gnu/libX11-xcb.so.[0-9] /usr/lib/i386-linux-gnu/libxcb-dri2.so.[0-9] /usr/lib/i386-linux-gnu/libxcb-randr.so.[0-9] /usr/lib/i386-linux-gnu/libxcb-xfixes.so.[0-9] /usr/lib/i386-linux-gnu/libxcb-shm.so.[0-9] /usr/lib/i386-linux-gnu/libdrm.so.[0-9] /usr/lib/i386-linux-gnu/libxcb-dri3.so.0 /usr/lib/i386-linux-gnu/libxcb-present.so.[0-9] /usr/lib/i386-linux-gnu/libdrm_intel.so.[0-9] /usr/lib/i386-linux-gnu/libxcb-sync.so.[0-9] /usr/lib/i386-linux-gnu/libxshmfence.so.[0-9] /usr/lib/i386-linux-gnu/libpciaccess.so.[0-9] /usr/lib/i386-linux-gnu/libxcb-glx.so.[0-9] /usr/lib/i386-linux-gnu/libffi.so.[0-9] /usr/lib/i386-linux-gnu/libXdamage.so.[0-9] /usr/lib/i386-linux-gnu/libLLVM-[0-9][0-9].so.[0-9] /usr/lib/i386-linux-gnu/libsensors.so.[0-9] /usr/lib/i386-linux-gnu/libdrm_radeon.so.[0-9] /usr/lib/i386-linux-gnu/libelf.so.[0-9] /usr/lib/i386-linux-gnu/libdrm_amdgpu.so.[0-9] /usr/lib/i386-linux-gnu/libdrm_nouveau.so.[0-9] /usr/lib/i386-linux-gnu/libatomic.so.[0-9] /usr/lib/i386-linux-gnu/libedit.so.[0-9] /usr/lib/i386-linux-gnu/libwayland-server.so.[0-9] /usr/lib/i386-linux-gnu/libglapi.so.[0-9] /usr/lib/i386-linux-gnu/libGLX_indirect.so.[0-9]) "\$BUILD/build/AppDir/usr/lib"
            cp -rf "/usr/lib/i386-linux-gnu/dri" "\$BUILD/build/AppDir/usr/lib"

        fi

    fi

    # Download appimagetool.
    \$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $BUILDNAME's AppImage. Please wait..."
    ISARM=\$(\$PRINTF "%s\n" "\$ARCH" | gawk 'match(\$0, /arm/) {print substr(\$0, RSTART, RLENGTH)}')
    IS64=\$(getconf LONG_BIT)

    if [ -z "\$ISNET" ]; then

        exit

    fi

    if [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ] || [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

        if [ "\$ARCH" = "x86_64" ]; then

            curl -L "https://github.com/AppImage/AppImageKit/releases/download/continuous/appimagetool-i686.AppImage" -o "\$BUILD/appimagetool"

        elif [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ]; then

            curl -L "https://github.com/AppImage/AppImageKit/releases/download/continuous/appimagetool-i686.AppImage" -o "\$BUILD/appimagetool"

        elif ([ -n "\$ISARM" ] && [ "\$IS64" = "64" ]) || [ "\$ARCH" = "aarch64" ]; then

            curl -L "https://github.com/AppImage/AppImageKit/releases/download/continuous/appimagetool-armhf.AppImage" -o "\$BUILD/appimagetool"

        elif [ -n "\$ISARM" ] && [ "\$IS64" = "32" ]; then

            curl -L "https://github.com/AppImage/AppImageKit/releases/download/continuous/appimagetool-armhf.AppImage" -o "\$BUILD/appimagetool"

        fi

    else

        if [ "\$ARCH" = "x86_64" ]; then

            curl -L "https://github.com/AppImage/AppImageKit/releases/download/continuous/appimagetool-x86_64.AppImage" -o "\$BUILD/appimagetool"

        elif [ "\$ARCH" = "i386" ] || [ "\$ARCH" = "i486" ] || [ "\$ARCH" = "i686" ]; then

            curl -L "https://github.com/AppImage/AppImageKit/releases/download/continuous/appimagetool-i686.AppImage" -o "\$BUILD/appimagetool"

        elif ([ -n "\$ISARM" ] && [ "\$IS64" = "64" ]) || [ "\$ARCH" = "aarch64" ]; then

            curl -L "https://github.com/AppImage/AppImageKit/releases/download/continuous/appimagetool-aarch64.AppImage" -o "\$BUILD/appimagetool"

        elif [ -n "\$ISARM" ] && [ "\$IS64" = "32" ]; then

            curl -L "https://github.com/AppImage/AppImageKit/releases/download/continuous/appimagetool-armhf.AppImage" -o "\$BUILD/appimagetool"

        fi

    fi

    chmod 755 "\$BUILD/appimagetool"

else

 # Saving configuration flags for future upgrades.
 \$PRINTF "%s\n" "\$CONF" > "\$BUILD/conf"

 if [ "\$OS" = "Linux" ]; then

    if (([ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ]) && ([ "\$BUILD" != "\$BUILDPATH/wadcli" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker" ] && [ "\$BUILD" != "\$BUILDPATH/neptunefm" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker-ring-racers" ] && [ "\$BUILD" != "\$BUILDPATH/followermaker" ])) || [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ] || [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

        if [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

            if [ "\$LIBC" != "musl" ] || [ "\$FLATPAK" = "1" ] || [ "\$CROSS" = "1" ]; then

                # LD_TRACE_LOADED_OBJECTS=1 is required specifically to NewMillennium to read linked libraries to compiled binary file.
                cp -Lf \$(LD_LIBRARY_PATH="\$SRB2BLDPREFIX/lib" LD_TRACE_LOADED_OBJECTS=1 \$(find "\$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null) 2> /dev/null | gawk '{print \$3}' | gawk '!/not|dynamic|version|libc.so|libdl.so|ld-|libstdc++|libgcc_s.so|libm.so|libpthread.so|libresolv.so|librt.so|libz.so|libcom_err.so/ {print}' | sort -u) "\$BUILD/build/AppDir/usr/lib"

                cp -Lf \$(find /usr/lib/*/libgbm.so.[0-9] /lib/*/libexpat.so.[0-9] /usr/lib/*/libX11.so.[0-9] /usr/lib/*/libX11-xcb.so.[0-9] /usr/lib/*/libxcb-dri2.so.[0-9] /usr/lib/*/libxcb-randr.so.[0-9] /usr/lib/*/libxcb-xfixes.so.[0-9] /usr/lib/*/libxcb-shm.so.[0-9] /usr/lib/*/libdrm.so.[0-9] /usr/lib/*/libxcb-dri3.so.0 /usr/lib/*/libxcb-present.so.[0-9] /usr/lib/*/libdrm_intel.so.[0-9] /usr/lib/*/libxcb-sync.so.[0-9] /usr/lib/*/libxshmfence.so.[0-9] /usr/lib/*/libpciaccess.so.[0-9] /usr/lib/*/libxcb-glx.so.[0-9] /usr/lib/*/libffi.so.[0-9] /usr/lib/*/libXdamage.so.[0-9] /usr/lib/*/libLLVM-[0-9][0-9].so.[0-9] /usr/lib/*/libsensors.so.[0-9] /usr/lib/*/libdrm_radeon.so.[0-9] /usr/lib/*/libelf.so.[0-9] /usr/lib/*/libdrm_amdgpu.so.[0-9] /usr/lib/*/libdrm_nouveau.so.[0-9] /usr/lib/*/libatomic.so.[0-9] /usr/lib/*/libedit.so.[0-9] /usr/lib/*/libwayland-server.so.[0-9] /usr/lib/*/libglapi.so.[0-9] /usr/lib/*/libGLX_indirect.so.[0-9] 2> /dev/null) "\$BUILD/build/AppDir/usr/lib"
                cp -rf "/usr/lib/"*/dri "\$BUILD/build/AppDir/usr/lib"

            else

                cp -Lf \$(find /usr/lib/libgbm.so.[0-9] /lib/libexpat.so.[0-9] /usr/lib/libX11.so.[0-9] /usr/lib/libX11-xcb.so.[0-9] /usr/lib/libxcb-dri2.so.[0-9] /usr/lib/libxcb-randr.so.[0-9] /usr/lib/libxcb-xfixes.so.[0-9] /usr/lib/libxcb-shm.so.[0-9] /usr/lib/libdrm.so.[0-9] /usr/lib/libxcb-dri3.so.0 /usr/lib/libxcb-present.so.[0-9] /usr/lib/libdrm_intel.so.[0-9] /usr/lib/libxcb-sync.so.[0-9] /usr/lib/libxshmfence.so.[0-9] /usr/lib/libpciaccess.so.[0-9] /usr/lib/libxcb-glx.so.[0-9] /usr/lib/libffi.so.[0-9] /usr/lib/libXdamage.so.[0-9] /usr/lib/libLLVM-[0-9][0-9].so.[0-9] /usr/lib/libsensors.so.[0-9] /usr/lib/libdrm_radeon.so.[0-9] /usr/lib/libelf.so.[0-9] /usr/lib/libdrm_amdgpu.so.[0-9] /usr/lib/libdrm_nouveau.so.[0-9] /usr/lib/libatomic.so.[0-9] /usr/lib/libedit.so.[0-9] /usr/lib/libwayland-server.so.[0-9] /usr/lib/libglapi.so.[0-9] /usr/lib/libGLX_indirect.so.[0-9] 2> /dev/null) "\$BUILD/build/AppDir/usr/lib"
                cp -rf "/usr/lib/dri" "\$BUILD/build/AppDir/usr/lib"

            fi

        else

            cp -Lf \$(LD_LIBRARY_PATH="\$SRB2BLDPREFIX/lib" ldd \$(find "\$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null) 2> /dev/null | gawk '{print \$3}' | gawk '!/not|dynamic|version|libc.so|libdl.so|ld-|libgcc_s.so|libm.so|libpthread.so|libresolv.so|librt.so|libz.so|libcom_err.so/ {print}' | sort -u) "\$BUILD/build/AppDir/usr/lib"

        fi

    fi

    if ([ "\$LNXOSNAME" = "NixOS" ] || [ "\$BUILD" = "\$BUILDPATH/slade" ]) && [ "\$BUILD" != "\$BUILDPATH/kartmaker" ] && [ "\$BUILD" != "\$BUILDPATH/neptunefm" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker-ring-racers" ] && [ "\$BUILD" != "\$BUILDPATH/followermaker" ]; then

         cp -Lf \$(LD_LIBRARY_PATH="\$SRB2BLDPREFIX/lib" ldd \$(find "\$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null) 2> /dev/null | gawk '{print \$3}' | gawk '!/not|dynamic|version|libc.so|libdl.so|ld-|libm.so|libpthread.so|libresolv.so|librt.so/ {print}' | sort -u) "\$BUILD/build/AppDir/usr/lib"

    fi

    if [ "\$LIBC" = "musl" ] && ([ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ] || [ "\$BUILD" = "\$BUILDPATH/xsrb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ] || [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ] || [ "\$BUILD" = "\$BUILDPATH/sbb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ] || [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-live" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ] || [ "\$BUILD" = "\$BUILDPATH/ssbss" ] || [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]); then

        cp -Lf \$(find /usr/lib/libpulse.so.[0-9] /usr/lib/pulseaudio/libpulsecommon-[0-9][0-9].[0-9].so /usr/lib/libjack.so.[0-9] /usr/lib/libasound.so.[0-9] /usr/lib/libpipewire-[0-9].[0-9].so.[0-9] /usr/lib/libxmp.so.[0-9] /usr/lib/libdbus-[0-9].so.[0-9] /usr/lib/libintl.so.[0-9] /usr/lib/libsndfile.so.[0-9] /usr/lib/libgomp.so.[0-9] /usr/lib/libfluidsynth.so.[0-9] /usr/lib/libxcb.so.[0-9] /usr/lib/libasyncns.so.[0-9] /usr/lib/libogg.so.[0-9] /usr/lib/libvorbisenc.so.[0-9] /usr/lib/libvorbisfile.so.[0-9] /usr/lib/libFLAC.so.[0-9][0-9] /usr/lib/libmpg123.so.[0-9] /usr/lib/libopus.so.[0-9] /usr/lib/libmp3lame.so.[0-9] /usr/lib/libvorbis.so.[0-9] /usr/lib/libXau.so.[0-9] /usr/lib/libXdmcp.so.[0-9] /usr/lib/libbsd.so.[0-9] /usr/lib/libmd.so.[0-9] /usr/lib/libGL.so.[0-9] /usr/lib/libX11.so.[0-9] /usr/lib/libXext.so.[0-9] /usr/lib/libXcursor.so.[0-9] /usr/lib/libXi.so.[0-9] /usr/lib/libXfixes.so.[0-9] /usr/lib/libXrandr.so.[0-9] /usr/lib/libXrender.so.[0-9] /usr/lib/libXss.so.[0-9] /usr/lib/libgbm.so.[0-9] /usr/lib/libdrm.so.[0-9] /usr/lib/libglapi.so.[0-9] /usr/lib/libGLESv2.so.[0-9] /usr/lib/libgallium-[0-9][0-9].[0-9].[0-9].so /usr/lib/libxcb-glx.so.[0-9] /usr/lib/libX11-xcb.so.[0-9] /usr/lib/libxcb-dri[0-9].so.[0-9] /usr/lib/libXxf86vm.so.[0-9] /usr/lib/libxcb-shm.so.[0-9] /usr/lib/libexpat.so.[0-9] /usr/lib/libxshmfence.so.[0-9] /usr/lib/libxcb-randr.so.[0-9] /usr/lib/libxcb-dri[0-9].so.[0-9] /usr/lib/libxcb-sync.so.[0-9] /usr/lib/libxcb-present.so.[0-9] /usr/lib/libxcb-xfixes.so.[0-9] /usr/lib/libLLVM.so.[0-9][0-9].[0-9] /usr/lib/libzstd.so.[0-9] /usr/lib/libdrm_radeon.so.[0-9] /usr/lib/libelf.so.[0-9] /usr/lib/libdrm_amdgpu.so.[0-9] /usr/lib/libdrm_intel.so.[0-9] /usr/lib/libstdc++.so.[0-9] /usr/lib/libffi.so.[0-9] /usr/lib/libxml[0-9].so.[0-9] /usr/lib/libpciaccess.so.[0-9] /usr/lib/liblzma.so.[0-9] /usr/lib/libmikmod.so.[0-9] /usr/lib/libGLU.so /usr/lib/libOSMesa.so.[0-9] /usr/lib/libSDL2-[0-9].[0-9].so.[0-9] /usr/lib/libSDL2_mixer-[0-9].[0-9].so.[0-9] /lib/ld-musl-i386.so.[0-9] /lib/libc.musl-x86.so.[0-9] /usr/lib/libgcc_s.so.[0-9] /usr/lib/libz.so.[0-9] /usr/lib/libSPIRV-Tools.so 2> /dev/null) "\$BUILD/build/AppDir/usr/lib"

    fi

    # Create desktop file.
    COMREV=\$(sudo git -C "\$BUILD" rev-parse --short HEAD)

    if [ "\$BUILD" = "\$BUILDPATH/srb2" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 (Software)
Comment=Open source 3D Sonic platformer based on Doom Legacy engine
Icon=srb2
Exec=$SRB2BLDPREFIX/bin/srb2 -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 \\\(Software\\\)","Name=Sonic Robo Blast 2 (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2 -software","Exec=$SRB2BLDPREFIX/bin/srb2 -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-2.2-classic-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Classic (Software)
Comment=Open source 3D Sonic platformer based on Doom Legacy engine
Icon=srb2classic
Exec=$SRB2BLDPREFIX/bin/srb2c -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-2.2-classic-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-2.2-classic-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Classic \\\(Software\\\)","Name=Sonic Robo Blast 2 Classic (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2c -software","Exec=$SRB2BLDPREFIX/bin/srb2c -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-2.2-classic-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-beta6" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-2.2-beta6-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Beta 6 (Software)
Comment=Recreation of open source 3D Sonic platformer based on SRB2 2.2 Beta 6 engine
Icon=srb2beta
Exec=$SRB2BLDPREFIX/bin/srb2beta -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-2.2-beta6-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-2.2-beta6-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Beta 6 \\\(Software\\\)","Name=Sonic Robo Blast 2 Beta 6 (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2beta -software","Exec=$SRB2BLDPREFIX/bin/srb2beta -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-2.2-beta6-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-uncapped-plus" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-uncapped-plus-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Uncapped PLUS (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.2 with improved framerate and additional features
Icon=srb2uncappedplus
Exec=$SRB2BLDPREFIX/bin/srb2ucp -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-uncapped-plus-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-uncapped-plus-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Uncapped PLUS \\\(Software\\\)","Name=Sonic Robo Blast 2 Uncapped PLUS (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2ucp -software","Exec=$SRB2BLDPREFIX/bin/srb2ucp -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-uncapped-plus-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-netplus" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-netplus-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 NetPlus (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.2 with rollback netcode
Icon=srb2netplus
Exec=$SRB2BLDPREFIX/bin/srb2np -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-netplus-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-netplus-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 NetPlus \\\(Software\\\)","Name=Sonic Robo Blast 2 NetPlus (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2np -software","Exec=$SRB2BLDPREFIX/bin/srb2np -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-netplus-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-reveries" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-reveries-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Reveries (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.2 with customized physics and movesets
Icon=srb2reveries
Exec=$SRB2BLDPREFIX/bin/srb2r -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-reveries-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-reveries-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Reveries \\\(Software\\\)","Name=Sonic Robo Blast 2 Reveries (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2r -software","Exec=$SRB2BLDPREFIX/bin/srb2r -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-reveries-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-tsourdt3rd" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-tsourdt3rd-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 TSoURDt3rd (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.2 with improved framerate and additional features combined from Uncapped and other builds
Icon=srb2tsourdt3rd
Exec=$SRB2BLDPREFIX/bin/srb2tsourdt3rd -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-tsourdt3rd-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-tsourdt3rd-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 TSoURDt3rd \\\(Software\\\)","Name=Sonic Robo Blast 2 TSoURDt3rd (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2tsourdt3rd -software","Exec=$SRB2BLDPREFIX/bin/srb2tsourdt3rd -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-tsourdt3rd-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-edit" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-edit-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Edit (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.2 with multiplayer enchancements, Lua additions and other changes
Icon=srb2edit
Exec=$SRB2BLDPREFIX/bin/srb2edit -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-edit-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-edit-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Edit \\\(Software\\\)","Name=Sonic Robo Blast 2 Edit (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2edit -software","Exec=$SRB2BLDPREFIX/bin/srb2edit -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-edit-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-ggj" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-ggj-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 The Great Galactic Journey (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.2 with features increased flat limits, timelines and maps utilizing build's exclusive functions
Icon=srb2ggj
Exec=$SRB2BLDPREFIX/bin/srb2ggj -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-ggj-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-ggj-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 The Great Galactic Journey \\\(Software\\\)","Name=Sonic Robo Blast 2 The Great Galactic Journey (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2ggj -software","Exec=$SRB2BLDPREFIX/bin/srb2ggj -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-ggj-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-destructive-illusion" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-destructive-illusion-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Destructive Illusion (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.2 with unique campaign and game mechanics
Icon=srb2destructiveillusion
Exec=$SRB2BLDPREFIX/bin/srb2di -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-destructive-illusion-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-destructive-illusion-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Destructive Illusion \\\(Software\\\)","Name=Sonic Robo Blast 2 Destructive Illusion (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2di -software","Exec=$SRB2BLDPREFIX/bin/srb2di -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-destructive-illusion-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-vr-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 VR (Software)
Comment=Modified open source 3D Sonic VR platformer based on SRB2 v2.2 with improved framerate and additional features
Icon=srb2vr
Exec=$SRB2BLDPREFIX/bin/srb2vr -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-vr-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-vr-opengl.desktop"
    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-vr-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-vr-openvr.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 VR \\\(Software\\\)","Name=Sonic Robo Blast 2 VR (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2vr -software","Exec=$SRB2BLDPREFIX/bin/srb2vr -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-vr-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 VR \\\(Software\\\)","Name=Sonic Robo Blast 2 VR (OpenVR)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2vr -software","Exec=$SRB2BLDPREFIX/bin/srb2vr -openvr -win"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-vr-openvr.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.1-legacy" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-2.1-legacy-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 v2.1 Legacy (Software)
Comment=Open source 3D Sonic platformer based on Doom Legacy engine
Icon=srb2legacy
Exec=$SRB2BLDPREFIX/bin/srb2legacy -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-2.1-legacy-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-2.1-legacy-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 v2.1 Legacy \\\(Software\\\)","Name=Sonic Robo Blast 2 v2.1 Legacy (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2legacy -software","Exec=$SRB2BLDPREFIX/bin/srb2legacy -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-2.1-legacy-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-fusion-advance" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-fusion-advance-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Fusion Advance (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.1 with improved framerate, coronas and orbital camera
Icon=srb2fusionadvance
Exec=$SRB2BLDPREFIX/bin/srb2fa -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-fusion-advance-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-fusion-advance-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Fusion Advance \\\(Software\\\)","Name=Sonic Robo Blast 2 Fusion Advance (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2fa -software","Exec=$SRB2BLDPREFIX/bin/srb2fa -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-fusion-advance-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-thokker-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Thokker (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.1 with soccer-like gamemode
Icon=srb2thokker
Exec=$SRB2BLDPREFIX/bin/srb2thk -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-thokker-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-thokker-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Thokker \\\(Software\\\)","Name=Sonic Robo Blast 2 Thokker (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2thk -software","Exec=$SRB2BLDPREFIX/bin/srb2thk -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-thokker-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-top-down-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Top Down (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.1 with top down camera and unique set of levels
Icon=srb2topdown
Exec=$SRB2BLDPREFIX/bin/srb2td -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-top-down-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-top-down-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Top Down \\\(Software\\\)","Name=Sonic Robo Blast 2 Top Down (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2td -software","Exec=$SRB2BLDPREFIX/bin/srb2td -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-top-down-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/sonic-smash-brawl-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Smash Brawl (Software)
Comment=Modified open source 2D Sonic game based on SRB2 v2.1 with Super Smash Bros. gameplay
Icon=sonicsmashbrawl
Exec=$SRB2BLDPREFIX/bin/ssb -software
Categories=Game;
Keywords=sonic;super;smash;bros
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/sonic-smash-brawl-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/sonic-smash-brawl-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Smash Brawl \\\(Software\\\)","Name=Sonic Smash Brawl (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/ssb -software","Exec=$SRB2BLDPREFIX/bin/ssb -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/sonic-smash-brawl-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-2.0-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 v2.0 (Software)
Comment=Open source 3D Sonic platformer based on Doom Legacy engine
Icon=srb2_2.0
Exec=$SRB2BLDPREFIX/bin/srb2_2.0 -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-2.0-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-2.0-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 v2.0 \\\(Software\\\)","Name=Sonic Robo Blast 2 v2.0 (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2_2.0 -software","Exec=$SRB2BLDPREFIX/bin/srb2_2.0 -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-2.0-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-cb-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Community Build (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.0 with included functional slopes, PNG support (allowing for full-color graphics), bots and extensive improvements to the OpenGL renderer
Icon=srb2cb
Exec=$SRB2BLDPREFIX/bin/srb2cb -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-cb-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-cb-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Community Build \\\(Software\\\)","Name=Sonic Robo Blast 2 Community Build (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2cb -software","Exec=$SRB2BLDPREFIX/bin/srb2cb -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-cb-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/xsrb2" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/xsrb2-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=X Sonic Robo Blast 2 (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.0 with additional modes like Sonic Golf and unique set of levels
Icon=xsrb2
Exec=$SRB2BLDPREFIX/bin/xsrb2 -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/xsrb2-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/xsrb2-opengl.desktop"
    gawk -i inplace '{gsub("Name=X Sonic Robo Blast 2 \\\(Software\\\)","Name=X Sonic Robo Blast 2 (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/xsrb2 -software","Exec=$SRB2BLDPREFIX/bin/xsrb2 -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/xsrb2-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-sf94-serv-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 SF94-Serv (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 v2.0 with additional modes like Sonic Golf and unique set of levels
Icon=srb2sf94serv
Exec=$SRB2BLDPREFIX/bin/srb2sf94serv -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-sf94-serv-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-sf94-serv-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 SF94-Serv \\\(Software\\\)","Name=Sonic Robo Blast 2 SF94-Serv (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2sf94serv -software","Exec=$SRB2BLDPREFIX/bin/srb2sf94serv -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-sf94-serv-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-riders-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Riders (Software)
Comment=Modified open source 3D Sonic racing game based on SRB2 v2.0 with Sonic Riders gameplay
Icon=srb2riders
Exec=$SRB2BLDPREFIX/bin/srb2riders -software
Categories=Game;
Keywords=sonic;riders;kart;racing;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-riders-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-riders-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Riders \\\(Software\\\)","Name=Sonic Robo Blast 2 Riders (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2riders -software","Exec=$SRB2BLDPREFIX/bin/srb2riders -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-riders-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/super-srb2-kart-z-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Super Sonic Robo Blast 2 Kart Z (Software)
Comment=Modified open source 3D Sonic game based on SRB2 v2.0 with kart racing gameplay
Icon=supersrb2kartz
Exec=$SRB2BLDPREFIX/bin/supersrb2kartz -software
Categories=Game;
Keywords=sonic;kart;racing;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/super-srb2-kart-z-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/super-srb2-kart-z-opengl.desktop"
    gawk -i inplace '{gsub("Name=Super Sonic Robo Blast 2 Kart Z \\\(Software\\\)","Name=Super Sonic Robo Blast 2 Kart Z (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/supersrb2kartz -software","Exec=$SRB2BLDPREFIX/bin/supersrb2kartz -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/super-srb2-kart-z-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/sbb2" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/sbb2-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Super Bomberman Blast 2 (Software)
Comment=Modified open source 3D Sonic game based on SRB2 v2.0 with Bomberman gameplay
Icon=sbb2
Exec=$SRB2BLDPREFIX/bin/sbb2 -software
Categories=Game;
Keywords=sonic;bomberman;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/sbb2-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/sbb2-opengl.desktop"
    gawk -i inplace '{gsub("Name=Super Bomberman Blast 2 \\\(Software\\\)","Name=Super Bomberman Blast 2 (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/sbb2 -software","Exec=$SRB2BLDPREFIX/bin/sbb2 -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/sbb2-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-final-demo-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Final Demo (Software)
Comment=Open source 3D Sonic platformer based on Doom Legacy engine
Icon=srb2finaldemo
Exec=$SRB2BLDPREFIX/bin/srb2fd -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-final-demo-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-final-demo-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Final Demo \\\(Software\\\)","Name=Sonic Robo Blast 2 Final Demo (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2fd -software","Exec=$SRB2BLDPREFIX/bin/srb2fd -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-final-demo-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-1095-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 1.09.5 (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 OLD (fork of SRB2 v1.09.4)
Icon=srb21095
Exec=$SRB2BLDPREFIX/bin/srb21095 -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-1095-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-1095-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 1.09.5 \\\(Software\\\)","Name=Sonic Robo Blast 2 1.09.5 (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb21095 -software","Exec=$SRB2BLDPREFIX/bin/srb21095 -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-1095-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-jte-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 JTE (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 Final Demo with additional modes, maps and easter eggs
Icon=srb2jte
Exec=$SRB2BLDPREFIX/bin/srb2jte -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-jte-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-jte-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 JTE \\\(Software\\\)","Name=Sonic Robo Blast 2 JTE (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2jte -software","Exec=$SRB2BLDPREFIX/bin/srb2jte -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-jte-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/shufflarb2-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=ShufflarB2 (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 Final Demo with additional modes, maps and day/night cycle in the levels
Icon=shufflarb2
Exec=$SRB2BLDPREFIX/bin/shufflarb2 -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/shufflarb2-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/shufflarb2-opengl.desktop"
    gawk -i inplace '{gsub("Name=ShufflarB2 \\\(Software\\\)","Name=ShufflarB2 (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/shufflarb2 -software","Exec=$SRB2BLDPREFIX/bin/shufflarb2 -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/shufflarb2-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-live" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-live-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Live (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 Final Demo with additional modes and multiplayer maps
Icon=srb2live
Exec=$SRB2BLDPREFIX/bin/srb2live -software
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-live-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-live-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Live \\\(Software\\\)","Name=Sonic Robo Blast 2 Live (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2live -software","Exec=$SRB2BLDPREFIX/bin/srb2live -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-live-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-loz-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 LoZ (Software)
Comment=Modified open source 3D Sonic platformer based on SRB2 Final Demo with The Legend of Zelda gameplay
Icon=srb2loz
Exec=$SRB2BLDPREFIX/bin/srb2loz -software -win
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-loz-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-loz-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 LoZ \\\(Software\\\)","Name=Sonic Robo Blast 2 LoZ (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2loz -software","Exec=$SRB2BLDPREFIX/bin/srb2loz -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-loz-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/ssbss-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Super Smash Bros Sonic Showdown (Software)
Comment=Modified open source 2D Sonic based on SRB2 Final Demo with Super Smash Bros. Gameplay
Icon=ssbss
Exec=$SRB2BLDPREFIX/bin/ssbss -software -win
Categories=Game;
Keywords=sonic;super;smash;bros;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/ssbss-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/ssbss-opengl.desktop"
    gawk -i inplace '{gsub("Name=Super Smash Bros Sonic Showdown \\\(Software\\\)","Name=Super Smash Bros Sonic Showdown (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/ssbss -software","Exec=$SRB2BLDPREFIX/bin/ssbss -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/ssbss-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/newmillennium.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=NewMillennium
Comment=Modified open source 3D Sonic platformer based on SRB2 2000 prototype with various fixes and enhancements
Icon=newmillennium
Exec=$SRB2BLDPREFIX/bin/newmillennium
Categories=Game;
Keywords=sonic;platformer;
Terminal=false
NoDisplay=false
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-persona" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-persona-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Persona (Software)
Comment=Modified open source 3D Sonic game with Persona gameplay
Icon=srb2persona
Exec=$SRB2BLDPREFIX/bin/srb2p -software
Categories=Game;
Keywords=sonic;rpg;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-persona-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-persona-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Persona \\\(Software\\\)","Name=Sonic Robo Blast 2 Persona (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2p -software","Exec=$SRB2BLDPREFIX/bin/srb2p -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-persona-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Kart (Software)
Comment=Modified open source 3D Sonic game with kart racing gameplay
Icon=srb2kart
Exec=$SRB2BLDPREFIX/bin/srb2kart -software
Categories=Game;
Keywords=sonic;kart;racing;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Kart \\\(Software\\\)","Name=Sonic Robo Blast 2 Kart (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2kart -software","Exec=$SRB2BLDPREFIX/bin/srb2kart -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-galaxy" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-galaxy-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Kart Galaxy (Software)
Comment=Modified open source 3D Sonic game with kart racing gameplay, improved framerate and additional features inspired by Moe Mansion
Icon=srb2kartgalaxy
Exec=$SRB2BLDPREFIX/bin/srb2kartgalaxy -software
Categories=Game;
Keywords=sonic;kart;racing;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-galaxy-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-galaxy-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Kart Galaxy \\\(Software\\\)","Name=Sonic Robo Blast 2 Kart Galaxy (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2kartgalaxy -software","Exec=$SRB2BLDPREFIX/bin/srb2kartgalaxy -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-galaxy-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-hep" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-hep-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Kart HEP (Software)
Comment=Modified open source 3D Sonic game with kart racing gameplay, improved framerate and additional features based on SRB2 Kart Galaxy
Icon=srb2karthep
Exec=$SRB2BLDPREFIX/bin/srb2karthep -software
Categories=Game;
Keywords=sonic;kart;racing;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-hep-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-hep-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Kart HEP \\\(Software\\\)","Name=Sonic Robo Blast 2 Kart HEP (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2karthep -software","Exec=$SRB2BLDPREFIX/bin/srb2karthep -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-hep-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-saturn" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-saturn-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Kart Saturn (Software)
Comment=Modified open source 3D Sonic game with kart racing gameplay, improved framerate and additional features based on SRB2 Kart Galaxy
Icon=srb2kartsaturn
Exec=$SRB2BLDPREFIX/bin/srb2kartsaturn -software
Categories=Game;
Keywords=sonic;kart;racing;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-saturn-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-saturn-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Kart Saturn \\\(Software\\\)","Name=Sonic Robo Blast 2 Kart Saturn (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2kartsaturn -software","Exec=$SRB2BLDPREFIX/bin/srb2kartsaturn -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-saturn-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-neptune" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-neptune-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Kart Neptune (Software)
Comment=Modified open source 3D Sonic game with kart racing gameplay, improved framerate and additional features based on SRB2 Kart Saturn
Icon=srb2kartneptune
Exec=$SRB2BLDPREFIX/bin/srb2kartneptune -software
Categories=Game;
Keywords=sonic;kart;racing;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-neptune-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-neptune-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Kart Neptune \\\(Software\\\)","Name=Sonic Robo Blast 2 Kart Neptune (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2kartneptune -software","Exec=$SRB2BLDPREFIX/bin/srb2kartneptune -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-neptune-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-vr-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Kart VR (Software)
Comment=Modified open source 3D Sonic game with VR kart racing gameplay, improved framerate and additional features
Icon=srb2kartvr
Exec=$SRB2BLDPREFIX/bin/srb2kartvr -software
Categories=Game;
Keywords=sonic;kart;racing;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-vr-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-vr-opengl.desktop"
    cp -f "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-vr-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-vr-openvr.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Kart VR \\\(Software\\\)","Name=Sonic Robo Blast 2 Kart VR (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2kartvr -software","Exec=$SRB2BLDPREFIX/bin/srb2kartvr -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-vr-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Kart VR \\\(Software\\\)","Name=Sonic Robo Blast 2 Kart VR (OpenVR)") || gsub("Exec=$SRB2BLDPREFIX/bin/srb2kartvr -software","Exec=$SRB2BLDPREFIX/bin/srb2kartvr -openvr -win"); print}' "\$BUILD/build/AppDir/usr/share/applications/srb2-kart-vr-openvr.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/blankart" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/blankart-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=BlanKart (Software)
Comment=Modified open source 3D Sonic game with kart racing gameplay
Icon=blankart
Exec=$SRB2BLDPREFIX/bin/blankart -software
Categories=Game;
Keywords=sonic;kart;racing;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/blankart-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/blankart-opengl.desktop"
    gawk -i inplace '{gsub("Name=BlanKart \\\(Software\\\)","Name=BlanKart (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/blankart -software","Exec=$SRB2BLDPREFIX/bin/blankart -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/blankart-opengl.desktop"

    elif [ "\$(basename \$BUILD)" = "ring-racers" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/ring-racers-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Dr. Robotnik's Ring Racers (Software)
Comment=Modified open source 3D Sonic game with kart racing gameplay
Icon=ringracers
Exec=$SRB2BLDPREFIX/bin/ringracers -software
Categories=Game;
Keywords=sonic;kart;racing;ring;racers;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/ring-racers-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/ring-racers-opengl.desktop"
    gawk -i inplace '{gsub("Name=Dr. Robotnik'\''s Ring Racers \\\(Software\\\)","Name=Dr. Robotnik'\''s Ring Racers (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/ringracers -software","Exec=$SRB2BLDPREFIX/bin/ringracers -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/ring-racers-opengl.desktop"

    elif [ "\$(basename \$BUILD)" = "ring-racers-noire" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/ring-racers-noire-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Dr. Robotnik's Ring Racers Noire (Software)
Comment=Modified open source 3D Sonic game with kart racing gameplay with additional features
Icon=ringracersnoire
Exec=$SRB2BLDPREFIX/bin/ringracersnoire -software
Categories=Game;
Keywords=sonic;kart;racing;ring;racers;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/ring-racers-noire-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/ring-racers-noire-opengl.desktop"
    gawk -i inplace '{gsub("Name=Dr. Robotnik'\''s Ring Racers Noire \\\(Software\\\)","Name=Dr. Robotnik'\''s Ring Racers Noire (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/ringracersnoire -software","Exec=$SRB2BLDPREFIX/bin/ringracersnoire -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/ring-racers-noire-opengl.desktop"

    elif [ "\$(basename \$BUILD)" = "ring-racers-hep" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/ring-racers-hep-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Dr. Robotnik's Ring Racers HEP (Software)
Comment=Modified open source 3D Sonic game with kart racing gameplay with additional features
Icon=ringracershep
Exec=$SRB2BLDPREFIX/bin/ringracershep -software
Categories=Game;
Keywords=sonic;kart;racing;ring;racers;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/ring-racers-hep-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/ring-racers-hep-opengl.desktop"
    gawk -i inplace '{gsub("Name=Dr. Robotnik'\''s Ring Racers HEP \\\(Software\\\)","Name=Dr. Robotnik'\''s Ring Racers HEP (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/ringracershep -software","Exec=$SRB2BLDPREFIX/bin/ringracershep -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/ring-racers-hep-opengl.desktop"

    elif [ "\$(basename \$BUILD)" = "ring-racers-freaky-build" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/ring-racers-freaky-build-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Dr. Robotnik's Ring Racers Freaky Build (Software)
Comment=Modified open source 3D Sonic game with kart racing gameplay with additional features like color profiles
Icon=ringracersfreakybuild
Exec=$SRB2BLDPREFIX/bin/ringracersfreakybuild -software
Categories=Game;
Keywords=sonic;kart;racing;ring;racers;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/ring-racers-freaky-build-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/ring-racers-freaky-build-opengl.desktop"
    gawk -i inplace '{gsub("Name=Dr. Robotnik'\''s Ring Racers Freaky Build \\\(Software\\\)","Name=Dr. Robotnik'\''s Ring Racers Freaky Build (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/ringracersfreakybuild -software","Exec=$SRB2BLDPREFIX/bin/ringracersfreakybuild -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/ring-racers-freaky-build-opengl.desktop"

    elif [ "\$(basename \$BUILD)" = "radio-racers" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/radio-racers-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Radio Racers (Software)
Comment=Modified open source 3D Sonic game with kart racing gameplay with additional features
Icon=radioracers
Exec=$SRB2BLDPREFIX/bin/radioracers -software
Categories=Game;
Keywords=sonic;kart;racing;ring;racers;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/radio-racers-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/radio-racers-opengl.desktop"
    gawk -i inplace '{gsub("Name=Radio Racers \\\(Software\\\)","Name=Radio Racers (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/radioracers -software","Exec=$SRB2BLDPREFIX/bin/radioracers -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/radio-racers-opengl.desktop"

    elif [ "\$(dirname \$BUILD)" = "\$BUILDPATH/srb2-custom" ] || [ "\$(dirname \$BUILDMAIN)" = "\$BUILDPATH/srb2-custom" ]; then

        SRB2CNAME="\$SRB2CCONFDIR"c"\$CUSTOMDIR"

        cat > "\$BUILD/build/AppDir/usr/share/applications/\$SRB2CNAME-software.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Sonic Robo Blast 2 Custom \$CUSTOMDIR (Software)
Comment=Modified open source 3D Sonic game
Icon=\$SRB2CNAME
Exec=$SRB2BLDPREFIX/bin/\$SRB2CNAME -software
Categories=Game;
Keywords=sonic;
Terminal=false
NoDisplay=false
DESKTOP

    cp -f "\$BUILD/build/AppDir/usr/share/applications/\$SRB2CNAME-software.desktop" "\$BUILD/build/AppDir/usr/share/applications/\$SRB2CNAME-opengl.desktop"
    gawk -i inplace '{gsub("Name=Sonic Robo Blast 2 Custom '$CUSTOMDIR' \\\(Software\\\)","Name=Sonic Robo Blast 2 Custom '$CUSTOMDIR' (OpenGL)") || gsub("Exec=$SRB2BLDPREFIX/bin/'\$SRB2CNAME' -software","Exec=$SRB2BLDPREFIX/bin/'\$SRB2CNAME' -opengl"); print}' "\$BUILD/build/AppDir/usr/share/applications/\$SRB2CNAME-opengl.desktop"

    elif [ "\$BUILD" = "\$BUILDPATH/wadcli" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/wadcli.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=wadcli
Comment=Allows the manipulation of Doom WAD files through command-line
Icon=wadcli
Exec=$SRB2BLDPREFIX/bin/wadcli
Categories=Development;
Keywords=sonic;wad;
Terminal=true
NoDisplay=false
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/kartmaker" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/kartmaker.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=kartmaker
Comment=Simple utility that automatically creates a character WAD for SRB2Kart from a working folder
Icon=kartmaker
Exec=$SRB2BLDPREFIX/bin/kartmaker
Categories=Development;
Keywords=sonic;wad;kart
Terminal=true
NoDisplay=false
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/neptunefm" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/neptunefm.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=NeptuneFM (SRB2 Kart)
Comment=A fork of followermaker for SRB2Kart Neptune
Icon=neptunefm
Exec=$SRB2BLDPREFIX/bin/neptunefm
Categories=Development;
Keywords=sonic;wad;kart
Terminal=true
NoDisplay=false
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/kartmaker-ring-racers.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=kartmaker (Ring Racers)
Comment=Simple utility that automatically creates a character WAD for Ring Racers from a working folder
Icon=kartmakerringracers
Exec=$SRB2BLDPREFIX/bin/kartmaker_rr
Categories=Development;
Keywords=sonic;wad;kart
Terminal=true
NoDisplay=false
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/followermaker" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/followermaker.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=followermaker
Comment=Simple utility that automatically creates a follower WAD for Ring Racers from a working folder
Icon=followermaker
Exec=$SRB2BLDPREFIX/bin/followermaker
Categories=Development;
Keywords=sonic;wad;kart
Terminal=true
NoDisplay=false
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/slade" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/slade.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=SLADE
Comment=Allows the manipulation of Doom WAD files
Icon=slade
Exec=$SRB2BLDPREFIX/bin/slade
Categories=Development;
Keywords=sonic;wad;
Terminal=false
NoDisplay=false
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/ultimate-zone-builder.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Ultimate Zone Builder
Comment=A map editor for UDMF levels in SRB2, forked from Ultimate Doom Builder
Icon=ultimatezonebuilder
Exec=$SRB2BLDPREFIX/bin/uzb
Categories=Development;
Keywords=sonic;wad;uzb;
Terminal=false
NoDisplay=false
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/ultimate-gksz-builder.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Ultimate GKSZ Builder
Comment=A map editor for UDMF levels in SRB2, forked from Ultimate Doom Builder
Icon=ultimategkszbuilder
Exec=$SRB2BLDPREFIX/bin/ugb
Categories=Development;
Keywords=sonic;wad;ugb;
Terminal=false
NoDisplay=false
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/ultimate-lowee-builder.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Ultimate Lowee Builder
Comment=A map editor for UDMF levels in BlanKart, forked from Ultimate Zone Builder
Icon=ultimateloweebuilder
Exec=$SRB2BLDPREFIX/bin/ulb
Categories=Development;
Keywords=sonic;wad;ulb;
Terminal=false
NoDisplay=false
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/high-voltage-ring.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=High Voltage Ring
Comment=A map editor for UDMF levels in Ring Racers, forked from Ultimate Zone Builder
Icon=highvoltagering
Exec=$SRB2BLDPREFIX/bin/hvr
Categories=Development;
Keywords=sonic;wad;ring;racers;hvr;
Terminal=false
NoDisplay=false
DESKTOP

    elif [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

        cat > "\$BUILD/build/AppDir/usr/share/applications/aseprite.desktop" << DESKTOP
[Desktop Entry]
Version=\$COMREV
Type=Application
Name=Aseprite
Comment=Animated sprite editor and pixel art tool
Icon=aseprite
Exec=$SRB2BLDPREFIX/bin/aseprite
Categories=Graphics;
Keywords=aseprite;
Terminal=false
NoDisplay=false
DESKTOP

    fi

    # Modify desktop files for flatpaks.
    if [ "\$FLATPAK" = "1" ]; then

        if [ "\$BUILD" = "\$BUILDPATH/newmillennium" ] || [ "\$BUILD" = "\$BUILDPATH/wadcli" ] || [ "\$BUILD" = "\$BUILDPATH/kartmaker" ] || [ "\$BUILD" = "\$BUILDPATH/neptunefm" ] || [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ] || [ "\$BUILD" = "\$BUILDPATH/followermaker" ]; then

            gawk -i inplace '{gsub("Icon=.*","Icon=org.srb2bld.'\$(\$PRINTF \$BUILD | gawk -F'/' '{print \$NF}')'"); print}' "\$BUILD/build/AppDir/usr/share/applications/\$(\$PRINTF \$BUILD | gawk -F'/' '{print \$NF}').desktop"

        elif [ "\$BUILD" = "\$BUILDPATH/slade" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ] || [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ] || [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

            gawk -i inplace '{gsub("Exec=.*","Exec=AppRun") || gsub("Icon=.*","Icon=org.srb2bld.'\$(\$PRINTF \$BUILD | gawk -F'/' '{print \$NF}')'"); print}' "\$BUILD/build/AppDir/usr/share/applications/\$(\$PRINTF \$BUILD | gawk -F'/' '{print \$NF}').desktop"

        elif [ "\$(dirname \$BUILD)" = "\$BUILDPATH/srb2-custom" ] || [ "\$(dirname \$BUILDMAIN)" = "\$BUILDPATH/srb2-custom" ]; then

            gawk -i inplace '{gsub("Exec=.*","Exec=AppRun -software") || gsub("Icon=.*","Icon=org.srb2bld.'\$(\$PRINTF \$SRB2CNAME | gawk '{gsub("-","_"); gsub("\\\.",""); print}')'"); print}' "\$BUILD/build/AppDir/usr/share/applications/\$SRB2CNAME-software.desktop"
            gawk -i inplace '{gsub("Exec=.*","Exec=AppRun -opengl") || gsub("Icon=.*","Icon=org.srb2bld.'\$(\$PRINTF \$SRB2CNAME | gawk '{gsub("-","_"); gsub("\\\.",""); print}')'"); print}' "\$BUILD/build/AppDir/usr/share/applications/\$SRB2CNAME-opengl.desktop"

        else

            gawk -i inplace '{gsub("Exec=.*","Exec=AppRun -software") || gsub("Icon=.*","Icon=org.srb2bld.'\$(\$PRINTF \$BUILD | gawk -F'/' '{gsub("-","_"); gsub("\\\.",""); print \$NF}')'"); print}' "\$BUILD/build/AppDir/usr/share/applications/\$(\$PRINTF \$BUILD | gawk -F'/' '{print \$NF}')-software.desktop"
            gawk -i inplace '{gsub("Exec=.*","Exec=AppRun -opengl") || gsub("Icon=.*","Icon=org.srb2bld.'\$(\$PRINTF \$BUILD | gawk -F'/' '{gsub("-","_"); gsub("\\\.",""); print \$NF}')'"); print}' "\$BUILD/build/AppDir/usr/share/applications/\$(\$PRINTF \$BUILD | gawk -F'/' '{print \$NF}')-opengl.desktop"

        fi

    fi

 fi

fi

fi

# Get app icon.
if [ "\$ANDROID" != "1" ]; then

    if [ "\$BUILD" = "\$BUILDPATH/wadcli" ] || [ "\$BUILD" = "\$BUILDPATH/kartmaker" ] || [ "\$BUILD" = "\$BUILDPATH/neptunefm" ] || [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ] || [ "\$BUILD" = "\$BUILDPATH/followermaker" ]; then

        if [ -n "\$ISNET" ]; then

            curl -L https://files.catbox.moe/3avugu.png -o "\$BUILD/build/icon.png"

        else

            cp -f \$(find "/usr/share/icons/hicolor" -type f -name "*.png" 2> /dev/null | head -n1) "\$BUILD/build/icon.png"

        fi

        convert "\$BUILD/build/icon.png" -alpha on -background none "\$BUILD/build/icon.ico"

    elif [ "\$BUILD" = "\$BUILDPATH/slade" ]; then

        convert "\$BUILD/dist/res/slade.ico" -resize 64x64\! -filter lanczos -alpha on -background none -flatten "\$BUILD/build/icon.png"
        cp -f "\$BUILD/dist/res/slade.ico" "\$BUILD/build/icon.ico"

    elif [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ]; then

        convert "\$BUILD/Setup/UZB-small.bmp" -resize 64x64\! -filter lanczos -alpha on -background none -flatten "\$BUILD/build/icon.png"
        convert "\$BUILD/Setup/UZB-small.bmp" -alpha on -background none "\$BUILD/build/icon.ico"

    elif [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]; then

        convert "\$BUILD/Setup/HVR-small.bmp" -resize 64x64\! -filter lanczos -alpha on -background none -flatten "\$BUILD/build/icon.png"
        convert "\$BUILD/Setup/HVR-small.bmp" -alpha on -background none "\$BUILD/build/icon.ico"

    elif [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

        cp -f "\$BUILD/data/icons/ase64.png" "\$BUILD/build/icon.png"
        convert "\$BUILD/data/icons/ase64.png" -alpha on -background none "\$BUILD/build/icon.ico"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ]; then

        convert "\$BUILD/src/win32/srb2classic.ico[5]" -resize 64x64\! -filter lanczos -alpha on -background none -flatten "\$BUILD/build/icon.png"

    elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-beta6" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-2.1-legacy" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-fusion-advance" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ] || [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ] || [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ]; then

        convert "\$BUILD/src/win32/Srb2win.ico[8]" -resize 64x64\! -filter lanczos -alpha on -background none -flatten "\$BUILD/build/icon.png"

    elif [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ]; then

        convert "\$BUILD/\$SRC/win32/ShufRB2.ico" -resize 64x64\! -filter lanczos -alpha on -background none -flatten "\$BUILD/build/icon.png"

    elif [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

        convert "\$BUILD/\$SRC/WIN32/Srb2win.ico" -resize 64x64\! -filter lanczos -alpha on -background none -flatten "\$BUILD/build/icon.png"

    else

        if [ -n "\$(identify "\$BUILD/\$SRC/win32/Srb2win.ico" | gawk '/ico\\[5\\] PNG/ {print}')" ] || [ -n "\$(identify "\$BUILD/\$SRC/win32/Srb2win.ico" | tail -n1 | gawk '/ico\\[1\\] PNG/ {print}')" ]; then

            convert "\$BUILD/\$SRC/win32/Srb2win.ico[5]" -resize 64x64\! -filter lanczos -alpha on -background none -flatten "\$BUILD/build/icon.png"

        else

            convert "\$BUILD/\$SRC/win32/Srb2win.ico" -resize 64x64\! -filter lanczos -alpha on -background none -flatten "\$BUILD/build/icon.png"

        fi

    fi

    ICONSIZE=\$(identify "\$BUILD/build/icon.png" | gawk '{print \$3}')
    mkdir -p "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps"
    cp -f "\$BUILD/build/icon.png"  "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps"

    if [ "\$OS" = "Linux" ] && [ "\$APPIMAGE" != "1" ]; then

        if [ "\$BUILD" = "\$BUILDPATH/srb2" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.2-classic" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2classic.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-uncapped-plus" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2uncappedplus.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-netplus" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2netplus.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-reveries" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2reveries.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-tsourdt3rd" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2tsourdt3rd.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-edit" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2edit.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-ggj" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2ggj.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-destructive-illusion" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2destructiveillusion.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-vr" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2vr.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.1-legacy" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2legacy.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-fusion-advance" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2fusionadvance.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-thokker" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2thokker.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-top-down" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2topdown.png"

        elif [ "\$BUILD" = "\$BUILDPATH/sonic-smash-brawl" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/sonicsmashbrawl.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-2.0" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2_2.0.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-cb" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2cb.png"

        elif [ "\$BUILD" = "\$BUILDPATH/xsrb2" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/xsrb2.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-sf94-serv" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2sf94serv.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-riders" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2riders.png"

        elif [ "\$BUILD" = "\$BUILDPATH/super-srb2-kart-z" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/supersrb2kartz.png"

        elif [ "\$BUILD" = "\$BUILDPATH/sbb2" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/sbb2.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-final-demo" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2finaldemo.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-1095" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb21095.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-jte" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2jte.png"

        elif [ "\$BUILD" = "\$BUILDPATH/shufflarb2" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/shufflarb2.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-live" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2live.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-loz" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2loz.png"

        elif [ "\$BUILD" = "\$BUILDPATH/ssbss" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/ssbss.png"

        elif [ "\$BUILD" = "\$BUILDPATH/newmillennium" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/newmillennium.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-persona" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2persona.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2kart.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-galaxy" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2kartgalaxy.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-hep" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2karthep.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-saturn" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2kartsaturn.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-neptune" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2kartneptune.png"

        elif [ "\$BUILD" = "\$BUILDPATH/srb2-kart-vr" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/srb2kartvr.png"

        elif [ "\$BUILD" = "\$BUILDPATH/blankart" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/blankart.png"

        elif [ "\$(basename \$BUILD)" = "ring-racers" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/ringracers.png"

        elif [ "\$(basename \$BUILD)" = "ring-racers-noire" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/ringracersnoire.png"

        elif [ "\$(basename \$BUILD)" = "ring-racers-hep" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/ringracershep.png"

        elif [ "\$(basename \$BUILD)" = "ring-racers-freaky-build" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/ringracersfreakybuild.png"

        elif [ "\$(basename \$BUILD)" = "radio-racers" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/radioracers.png"

        elif [ "\$(dirname \$BUILD)" = "\$BUILDPATH/srb2-custom" ] || [ "\$(dirname \$BUILDMAIN)" = "\$BUILDPATH/srb2-custom" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/"\$SRB2CCONFDIR"c"\$CUSTOMDIR".png"

        elif [ "\$BUILD" = "\$BUILDPATH/wadcli" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/wadcli.png"

        elif [ "\$BUILD" = "\$BUILDPATH/kartmaker" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/kartmaker.png"

        elif [ "\$BUILD" = "\$BUILDPATH/neptunefm" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/neptunefm.png"

        elif [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/kartmakerringracers.png"

        elif [ "\$BUILD" = "\$BUILDPATH/followermaker" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/followermaker.png"

        elif [ "\$BUILD" = "\$BUILDPATH/slade" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/slade.png"

        elif [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/ultimatezonebuilder.png"

        elif [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/ultimategkszbuilder.png"

        elif [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/ultimateloweebuilder.png"

        elif [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ]; then

            mv -f "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/icon.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/highvoltagering.png"

        elif [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

            mv -f "\$BUILD/data/icons/ase64.png" "\$BUILD/build/AppDir/usr/share/icons/hicolor/\$ICONSIZE/apps/aseprite.png"

        fi

    fi

fi

# Build cross-compiled or Windows portable bundle.
if [ "\$CROSS" = "1" ] || [ "\$WINPORTABLE" = "1" ]; then

    mkdir -p "\$BUILD/build/package"

    if [ "\$WINPORTABLE" = "1" ]; then

        if [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ] || [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ] || [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

            cp -rf \$(find "\$BUILD/Build" "\$BUILD/build" -mindepth 1 -maxdepth 1 | gawk '!/AppDir|package/ {print}') "\$BUILD/build/package"

        elif [ "\$BUILD" = "\$BUILDPATH/kartmaker" ] || [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ] || [ "\$BUILD" = "\$BUILDPATH/neptunefm" ] || [ "\$BUILD" = "\$BUILDPATH/followermaker" ]; then

            cp -rf \$(find "\$BUILD" "\$BUILD/build" -mindepth 1 -maxdepth 1 -name "*.exe" -type f) "\$BUILD/build/package"

        else

            cp -rf \$(find "\$BUILD/bin" "\$BUILD/build/bin" "\$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" "\$BUILD/SRB2"*"/branches/"*"/bin" -name "*.exe" -type f 2> /dev/null) "\$BUILD/build/package"

        fi

    else

        if [ "\$BUILD" = "\$BUILDPATH/ultimate-zone-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-gksz-builder" ] || [ "\$BUILD" = "\$BUILDPATH/ultimate-lowee-builder" ] || [ "\$BUILD" = "\$BUILDPATH/high-voltage-ring" ] || [ "\$BUILD" = "\$BUILDPATH/aseprite" ]; then

            cp -rf \$(find "\$BUILD/Build" "\$BUILD/build" -mindepth 1 -maxdepth 1 | gawk '!/AppDir|package/ {print}') "\$BUILD/build/package"

        elif [ "\$BUILD" = "\$BUILDPATH/kartmaker" ] || [ "\$BUILD" = "\$BUILDPATH/kartmaker-ring-racers" ] || [ "\$BUILD" = "\$BUILDPATH/neptunefm" ] || [ "\$BUILD" = "\$BUILDPATH/followermaker" ]; then

            cp -rf \$(find "\$BUILD" "\$BUILD/build" -mindepth 1 -maxdepth 1 -type f) "\$BUILD/build/package"

        else

            if [ "\$WINOS" = "1" ]; then

                cp -rf \$(find "\$BUILD/bin" "\$BUILD/build/bin" "\$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" "\$BUILD/SRB2"*"/branches/"*"/bin" ! -name ".gitignore" ! -name "rules" -type f 2> /dev/null) "\$BUILD/build/package"

            else

                cp -rf \$(find "\$BUILD/bin" "\$BUILD/build/bin" "\$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" "\$BUILD/SRB2"*"/branches/"*"/bin" -name "*.exe" ! -name ".gitignore" ! -name "rules" -executable -type f 2> /dev/null) "\$BUILD/build/package"

            fi

        fi

    fi

    cp -rf \$(find "\$BUILD/bin" "\$BUILD/build/bin" "\$BUILD/SRB2"*"/branches/"*"/bin" -name ".debug" -type f 2> /dev/null) "\$BUILD/build/package" 2> /dev/null || true

    if [ "\$BUILD" != "\$BUILDPATH/wadcli" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker" ] && [ "\$BUILD" != "\$BUILDPATH/neptunefm" ] && [ "\$BUILD" != "\$BUILDPATH/kartmaker-ring-racers" ] && [ "\$BUILD" != "\$BUILDPATH/followermaker" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-zone-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-gksz-builder" ] && [ "\$BUILD" != "\$BUILDPATH/ultimate-lowee-builder" ] && [ "\$BUILD" != "\$BUILDPATH/high-voltage-ring" ]; then

        if [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" != "RingRacers" ]; then

            cp -rf \$(find "\$BUILD/build/AppDir/usr/lib" -mindepth 1 -maxdepth 1 2> /dev/null) "\$BUILD/build/package"

        fi

        if [ "\$BUILD" = "\$BUILDPATH/slade" ]; then

            cp -f "\$BUILD/build/AppDir/usr/share/slade3/slade.pk3" "\$BUILD/build/package"

        elif [ "\$BUILD" != "\$BUILDPATH/aseprite" ]; then

            cp -rf \$(find "\$BUILD/build/AppDir/usr/games/\$ASSETAPPDIR" -mindepth 1 -maxdepth 1 2> /dev/null) "\$BUILD/build/package"

        fi

    fi

    cd "\$BUILD/build/package" || exit
    7z a -y -tzip "\$BUILDPATH/package.zip" "./"*

fi

if [ "\$WINOS" != "1" ]; then

    # Correcting path to Ring Racers' source code.
    if [ "\$ANDROID" != "1" ] && [ "\$OS" = "Linux" ] && [ "\$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print \$2}' "\$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

        sudo rm -rf "\$BUILDMAIN"
        cp -rf "\$BUILD" "\$BUILDMAIN"
        export BUILD="\$BUILDMAIN"

    fi

    # Correcting compiled build's source code, libraries etc. permissions when running -u/--user or having read-only filesystem.
    if [ "\$OSVIRT" = "podman" ] && ([ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDPREFIX" | gawk 'match(\$0, /\/home\/'\$HOSTUSER'\/.local/) {print substr(\$0, RSTART, RLENGTH)}')" ] || [ -n "\$ISREADONLY" ]) && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$ANDROID" != "1" ]); then

        trap '\$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Correcting permissions to $BUILDNAME'\''s source code. Please wait..." && [ "\$(basename \$BUILD)" = "ring-racers" ] && export BUILD="\$BUILDMAIN" ; sudo find -L "\$BUILD" "\$SRB2BLDPREFIX/stow" "\$SRB2BLDPREFIX/bin" "\$SRB2BLDPREFIX/include" "\$SRB2BLDPREFIX/lib" "\$SRB2BLDROOT/libraries" "$HOME/.cache/ccache" ! -group root -exec chown -R root:root {} \; 2> /dev/null || true ; exit 0' 0

    elif [ "\$OSVIRT" = "docker" ] && ([ -n "\$(\$PRINTF "%s\n" "\$SRB2BLDPREFIX" | gawk 'match(\$0, /\/home\/'\$HOSTUSER'\/.local/) {print substr(\$0, RSTART, RLENGTH)}')" ] || [ -n "\$ISREADONLY" ]) && ([ "\$APPIMAGE" != "1" ] && [ "\$FLATPAK" != "1" ] && [ "\$CROSS" != "1" ] && [ "\$ANDROID" != "1" ]); then

        trap '\$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Correcting permissions to $BUILDNAME'\''s source code. Please wait..." && [ "\$(basename \$BUILD)" = "ring-racers" ] && export BUILD="\$BUILDMAIN" ; sudo find -L "\$BUILD" "\$SRB2BLDPREFIX/stow" "\$SRB2BLDPREFIX/bin" "\$SRB2BLDPREFIX/include" "\$SRB2BLDPREFIX/lib" "\$SRB2BLDROOT/libraries" "$HOME/.cache/ccache" -group root -exec chown -R srb2bld:srb2bld {} \; 2> /dev/null || true ; exit 0' 0

    else

        trap '\$PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Correcting permissions to $BUILDNAME'\''s source code. Please wait..." && [ "\$(basename \$BUILD)" = "ring-racers" ] && export BUILD="\$BUILDMAIN" ; sudo find -L "\$BUILD" "\$SRB2BLDROOT/libraries" "$HOME/.cache/ccache" ! -group \$HOSTUSERID -exec chown -R \$HOSTUSERID:\$HOSTUSERID {} \; 2> /dev/null || true ; exit 0' 0

    fi

fi

ENTRYPOINT
    chmod 755 "$SRB2BLDROOT/containers/srb2-games-linux-glibc-container/Entrypoint"

    # Prepare Docker/Podman images.
    find "$SRB2BLDROOT/containers" -mindepth 1 -maxdepth 1 -type d ! -name "srb2-games-linux-glibc-container" -exec rm -rf '{}' \;
    cp -rf "$SRB2BLDROOT/containers/srb2-games-linux-glibc-container" "$SRB2BLDROOT/containers/srb2-tools-linux-glibc-container"
    cp -rf "$SRB2BLDROOT/containers/srb2-games-linux-glibc-container" "$SRB2BLDROOT/containers/srb2-uzb-linux-glibc-container"
    cp -rf "$SRB2BLDROOT/containers/srb2-games-linux-glibc-container" "$SRB2BLDROOT/containers/srb2-games-linux-musl-container"
    cp -rf "$SRB2BLDROOT/containers/srb2-games-linux-glibc-container" "$SRB2BLDROOT/containers/srb2-tools-linux-musl-container"
    cp -rf "$SRB2BLDROOT/containers/srb2-games-linux-glibc-container" "$SRB2BLDROOT/containers/srb2-games-windows-container"
    cp -rf "$SRB2BLDROOT/containers/srb2-games-linux-glibc-container" "$SRB2BLDROOT/containers/srb2-tools-windows-container"
    cp -rf "$SRB2BLDROOT/containers/srb2-games-linux-glibc-container" "$SRB2BLDROOT/containers/srb2-games-android-container"

    # Set CPU architecture for Docker/Podman images in case of building old SRB2 versions.
    if ([ "$ARCH" = "i386" ] || [ "$ARCH" = "i486" ] || [ "$ARCH" = "i686" ] || [ "$ARCH" = "x86_64" ]) && ( ([ "$OS" = "Windows" ] && ([ "$BUILD" = "$BUILDPATH/srb2-thokker" ] || [ "$BUILD" = "$BUILDPATH/srb2-top-down" ] || [ "$BUILD" = "$BUILDPATH/sonic-smash-brawl" ])) || [ "$BUILD" = "$BUILDPATH/srb2-2.0" ] || [ "$BUILD" = "$BUILDPATH/srb2-cb" ] || [ "$BUILD" = "$BUILDPATH/xsrb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ] || [ "$BUILD" = "$BUILDPATH/srb2-riders" ] || [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ] || [ "$BUILD" = "$BUILDPATH/sbb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-final-demo" ] || [ "$BUILD" = "$BUILDPATH/srb2-1095" ] || [ "$BUILD" = "$BUILDPATH/srb2-jte" ] || [ "$BUILD" = "$BUILDPATH/shufflarb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-live" ] || [ "$BUILD" = "$BUILDPATH/srb2-loz" ] || [ "$BUILD" = "$BUILDPATH/ssbss" ] || [ "$BUILD" = "$BUILDPATH/newmillennium" ]); then

        PLATFORM="--platform linux/386"

    elif ([ "$ARCH" = "armhf" ] || [ "$ARCH" = "aarch64" ]) && ([ "$BUILD" = "$BUILDPATH/srb2-2.0" ] || [ "$BUILD" = "$BUILDPATH/srb2-cb" ] || [ "$BUILD" = "$BUILDPATH/xsrb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ] || [ "$BUILD" = "$BUILDPATH/srb2-riders" ] || [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ] || [ "$BUILD" = "$BUILDPATH/sbb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-final-demo" ] || [ "$BUILD" = "$BUILDPATH/srb2-1095" ] || [ "$BUILD" = "$BUILDPATH/srb2-jte" ] || [ "$BUILD" = "$BUILDPATH/shufflarb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-live" ] || [ "$BUILD" = "$BUILDPATH/srb2-loz" ] || [ "$BUILD" = "$BUILDPATH/ssbss" ] || [ "$BUILD" = "$BUILDPATH/newmillennium" ]); then

        PLATFORM="--platform linux/armhf"

    # For compatibility with Debian Testing for Windows builds due to lack of CPU architecture detection in this container.
    else

        PLATFORM="--platform linux/$($OSVIRT info | gawk '/arch:|Architecture:/ {gsub("\x1b\\[0K",""); print $2}' | head -n1)"

        if [ "$ARCH" != "armhf" ] && [ "$ARCH" != "aarch64" ]; then

            LIBNVIDIA="libnvidia-gl-530 libnvidia-extra-530"

        fi

    fi

    # Compiled binary is borked when building on Ubuntu 18.04, so moving SRB2 Classic to Ubuntu 22.04 container.
    if [ "$BUILD" = "$BUILDPATH/srb2-2.2-classic" ]; then

        UBUVER="jammy"
        unset GCCOLDVER GXXOLDVER

    fi

    # Create Dockerfiles.
    cat > "$SRB2BLDROOT/containers/srb2-games-linux-glibc-container/Dockerfile" << DOCKERFILE
FROM docker.io/ubuntu:"$UBUVER"

ENV container $(printf "%s\n" "$OSVIRT" | gawk '{print $1}')

ENV DEBIAN_FRONTEND noninteractive

ENV GNUTLS_CPUID_OVERRIDE 0x1

RUN printf 'Acquire::Check-Valid-Until "false";\nAcquire::Check-Date "false";' > /etc/apt/apt.conf.d/90ignore-release-date && \
printf 'Dpkg::Options:: "--force-confdef";' > /etc/apt/apt.conf.d/90force-confdef && \
printf 'APT::Install-Recommends "false";\nAPT::Install-Suggests "false";' > /etc/apt/apt.conf.d/90no-recommend && \
apt-get update && \
apt-get install -y gnupg apt-transport-https ca-certificates curl gawk && \
printf "deb http://ppa.launchpad.net/apt-fast/stable/ubuntu $UBUVER main\ndeb http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu $UBUVER main\ndeb https://apt.kitware.com/ubuntu/ $UBUVER main" >> /etc/apt/sources.list && \
curl -Ls "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0xA2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B" | gawk '!/Comment:|Version:/ {gsub("\r",""); print}' | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/aptfast.gpg > /dev/null && \
curl -Ls "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x1E9377A2BA9EF27F" | gawk '!/Comment:|Version:/ {gsub("\r",""); print}' | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/toolchain.gpg > /dev/null && \
curl -Ls "https://apt.kitware.com/keys/kitware-archive-latest.asc" | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/cmake.gpg > /dev/null

RUN apt-get update && \
apt-get full-upgrade -y && \
apt-get install -y apt-fast && \
gawk -i inplace '{sub("DOWNLOADBEFORE=","DOWNLOADBEFORE=true");sub("_MAXNUM=5","_MAXNUM=20"); print}' /etc/apt-fast.conf && \
apt-fast install -y libsdl2-dev libsdl2-mixer-dev libsdl1.2-dev libsdl-image1.2-dev libsdl-mixer1.2-dev libsdl-ttf2.0-dev $LIBNVIDIA libxcb-shm0 libpng-dev libopenal-dev libgme-dev libopenmpt-dev libfluidsynth-dev libmodplug-dev libopus-dev libjack-dev libcurl4-openssl-dev libupnp-dev zlib1g-dev rapidjson-dev libfuse-dev fuse nasm python3-dev python3-setuptools python3-pil python3-wheel build-essential $GCCVER $GXXVER $GCCOLDVER $GXXOLDVER $RINGRACERSGCCVER $RINGRACERSGXXVER ccache automake autogen libtool cmake file sudo dash gettext git stow imagemagick p7zip-full p7zip-rar zip unrar

RUN DEBARCH="\$(dpkg --print-architecture)" ; \
curl -RLC - --retry 999 https://snapshot.debian.org/archive/debian/20180611T145305Z/pool/main/m/miniupnpc/libminiupnpc-dev_2.0.20180410-2_\$DEBARCH.deb -o /tmp/libminiupnpc-dev_2.1-1_\$DEBARCH.deb && \
curl -RLC - --retry 999 https://snapshot.debian.org/archive/debian/20180611T145305Z/pool/main/m/miniupnpc/libminiupnpc17_2.0.20180410-2_\$DEBARCH.deb -o /tmp/libminiupnpc17_2.1-1_\$DEBARCH.deb && \
dpkg -i /tmp/*.deb && \
rm -f /tmp/*.deb

RUN git clone https://github.com/Cyan4973/xxHash --branch release /tmp/xxHash && \
make -C /tmp/xxHash PREFIX=/usr install

RUN curl -sL "https://xff.cz/megatools/builds/builds/\$(curl -sL https://xff.cz/megatools/builds/builds/ | gawk -F'"' '/megatools-.*linux-'$ARCH'.tar.gz/ {print \$2}' | tail -n1)" -o "/tmp/megatools.tar.gz" && \
tar xfv "/tmp/megatools.tar.gz" --wildcards --strip-components=1 -C "/usr/bin" "*/megatools"

RUN mkdir -p "/usr/include/FMOD" "$SRB2BLDROOT/libraries/FMOD" && \
curl -RLC - "https://zdoom.org/files/fmod/$LNXFMODVER.tar.gz" -o "$SRB2BLDROOT/libraries/FMOD/$LNXFMODVER.tar.gz" && \
tar xvf "$SRB2BLDROOT/libraries/FMOD/$LNXFMODVER.tar.gz" --wildcards --strip-components=2 -C "/usr/lib" "$LNXFMODVER/api/libfmod-"*.so && \
tar xvf "$SRB2BLDROOT/libraries/FMOD/$LNXFMODVER.tar.gz" --strip-components=3 -C "/usr/include/FMOD" "$LNXFMODVER/api/inc"

RUN printf "%s\n" "%sudo ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers && \
useradd -m -G sudo -s /bin/dash srb2bld && \
passwd -d srb2bld && \
ln -sf /bin/dash /bin/sh

USER srb2bld

COPY Entrypoint /home/srb2bld/Entrypoint

ENTRYPOINT [ "sh", "/home/srb2bld/Entrypoint" ]

DOCKERFILE

    cat > "$SRB2BLDROOT/containers/srb2-tools-linux-glibc-container/Dockerfile" << DOCKERFILE
FROM docker.io/ubuntu:"$UBUSOFTVER"

ENV container $(printf "%s\n" "$OSVIRT" | gawk '{print $1}')

ENV DEBIAN_FRONTEND noninteractive

ENV GNUTLS_CPUID_OVERRIDE 0x1

RUN printf 'Acquire::Check-Valid-Until "false";\nAcquire::Check-Date "false";' > /etc/apt/apt.conf.d/90ignore-release-date && \
printf 'Dpkg::Options:: "--force-confdef";' > /etc/apt/apt.conf.d/90force-confdef && \
printf 'APT::Install-Recommends "false";\nAPT::Install-Suggests "false";' > /etc/apt/apt.conf.d/90no-recommend && \
apt-get update && \
apt-get install -y gnupg apt-transport-https ca-certificates curl gawk && \
printf "deb http://ppa.launchpad.net/apt-fast/stable/ubuntu $UBUSOFTVER main\ndeb http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu $UBUSOFTVER main\ndeb https://apt.kitware.com/ubuntu/ $UBUSOFTVER main\ndeb https://repos.codelite.org/wx3.2.0/ubuntu/ $UBUSOFTVER universe" >> /etc/apt/sources.list && \
curl -Ls "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0xA2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B" | gawk '!/Comment:|Version:/ {gsub("\r",""); print}' | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/aptfast.gpg > /dev/null && \
curl -Ls "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x1E9377A2BA9EF27F" | gawk '!/Comment:|Version:/ {gsub("\r",""); print}' | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/toolchain.gpg > /dev/null && \
curl -Ls "https://apt.kitware.com/keys/kitware-archive-latest.asc" | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/cmake.gpg > /dev/null && \
curl -Ls "https://repos.codelite.org/CodeLite.asc" | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/libwxgtk.gpg > /dev/null && \
ln -sf /bin/true /usr/bin/chfn

RUN apt-get update && \
apt-get full-upgrade -y && \
apt-get install -y apt-fast && \
gawk -i inplace '{sub("DOWNLOADBEFORE=","DOWNLOADBEFORE=true");sub("_MAXNUM=5","_MAXNUM=20"); print}' /etc/apt-fast.conf && \
apt-fast install -y libwebkit2gtk-4.0-dev libnotify-dev libsecret-1-dev libssh-dev libsm-dev libfmt-dev libsfml-dev libjpeg-dev libogg-dev libflac-dev libvorbis-dev libopenal-dev libudev-dev libglew-dev libfreeimage-dev libftgl-dev libfluidsynth-dev libgconf2-dev freeglut3-dev libmodplug-dev libnotify-dev libcurl4-openssl-dev libbz2-dev gtk2-engines-pixbuf libgtk-3-dev libcanberra-gtk3-dev libcanberra-gtk3-module libcanberra-gtk-dev libcanberra-gtk-module liblua5.3-dev libmpg123-dev libfuse-dev fuse libx11-dev libc++-dev libc++abi-dev libfontconfig1-dev libxcursor-dev libxi-dev libgl1-mesa-dev mesa-common-dev gnome-icon-theme gnome-themes-extra nasm xapps-common python3 python-is-python3 build-essential clang g++ $GCCVER $GXXVER $SLADEGCCOLDVER $SLADEGXXOLDVER ccache automake libtool cmake ninja-build patchelf file sudo dash git stow imagemagick p7zip-full p7zip-rar

RUN printf "%s\n" "%sudo ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers && \
useradd -m -G sudo -s /bin/dash srb2bld && \
passwd -d srb2bld && \
ln -sf /bin/dash /bin/sh

USER srb2bld

COPY Entrypoint /home/srb2bld/Entrypoint

ENTRYPOINT [ "sh", "/home/srb2bld/Entrypoint" ]

DOCKERFILE

    cat > "$SRB2BLDROOT/containers/srb2-uzb-linux-glibc-container/Dockerfile" << DOCKERFILE
FROM docker.io/ubuntu:"$UBUUZBVER"

ENV container $(printf "%s\n" "$OSVIRT" | gawk '{print $1}')

ENV DEBIAN_FRONTEND noninteractive

ENV GNUTLS_CPUID_OVERRIDE 0x1

RUN printf 'Acquire::Check-Valid-Until "false";\nAcquire::Check-Date "false";' > /etc/apt/apt.conf.d/90ignore-release-date && \
printf 'Dpkg::Options:: "--force-confdef";' > /etc/apt/apt.conf.d/90force-confdef && \
printf 'APT::Install-Recommends "false";\nAPT::Install-Suggests "false";' > /etc/apt/apt.conf.d/90no-recommend && \
apt-get update && \
apt-get install -y gnupg apt-transport-https ca-certificates curl gawk && \
printf "deb http://ppa.launchpad.net/apt-fast/stable/ubuntu $UBUUZBVER main\ndeb http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu $UBUUZBVER main\ndeb https://apt.kitware.com/ubuntu/ $UBUVER main\ndeb https://download.mono-project.com/repo/ubuntu stable-$UBUUZBVER/snapshots/$LNXMONOVER main" >> /etc/apt/sources.list && \
curl -Ls "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0xA2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B" | gawk '!/Comment:|Version:/ {gsub("\r",""); print}' | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/aptfast.gpg > /dev/null && \
curl -Ls "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x1E9377A2BA9EF27F" | gawk '!/Comment:|Version:/ {gsub("\r",""); print}' | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/toolchain.gpg > /dev/null && \
curl -Ls "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF" | gawk '!/Comment:|Version:/ {gsub("\r",""); print}' | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/mono.gpg > /dev/null && \
curl -Ls "https://apt.kitware.com/keys/kitware-archive-latest.asc" | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/cmake.gpg > /dev/null

RUN apt-get update && \
apt-get full-upgrade -y && \
apt-get install -y apt-fast && \
gawk -i inplace '{sub("DOWNLOADBEFORE=","DOWNLOADBEFORE=true");sub("_MAXNUM=5","_MAXNUM=20"); print}' /etc/apt-fast.conf && \
apt-fast install -y libfmt-dev libsfml-dev libjpeg-dev libogg-dev libflac-dev libvorbis-dev libopenal-dev libudev-dev libglew-dev libfreeimage-dev libftgl-dev libfluidsynth-dev libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev libgconf2-dev freeglut3-dev libmodplug-dev libnotify-dev libcurl4-openssl-dev libbz2-dev gtk2-engines-pixbuf libgtk-3-dev libcanberra-gtk3-dev libcanberra-gtk3-module libcanberra-gtk-dev libcanberra-gtk-module liblua5.3-dev libmpg123-dev libfuse-dev fuse libx11-dev mesa-common-dev mono-complete gnome-themes-extra nasm build-essential g++ $GCCVER $GXXVER ccache automake libtool cmake patchelf file sudo dash git stow imagemagick p7zip-full p7zip-rar

RUN printf "%s\n" "%sudo ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers && \
useradd -m -G sudo -s /bin/dash srb2bld && \
passwd -d srb2bld && \
ln -sf /bin/dash /bin/sh

USER srb2bld

COPY Entrypoint /home/srb2bld/Entrypoint

ENTRYPOINT [ "sh", "/home/srb2bld/Entrypoint" ]

DOCKERFILE

    cat > "$SRB2BLDROOT/containers/srb2-games-linux-musl-container/Dockerfile" << DOCKERFILE
FROM docker.io/alpine:latest

ENV container $(printf "%s\n" "$OSVIRT" | gawk '{print $1}')

ENV GNUTLS_CPUID_OVERRIDE 0x1

RUN printf "https://dl-cdn.alpinelinux.org/alpine/edge/testing" >> /etc/apk/repositories && \
apk update && \
apk upgrade && \
apk add sdl3-dev sdl2-dev sdl2_mixer-dev sdl12-compat-dev sdl_mixer-dev mesa-dri-gallium glu-dev libpng-dev openal-soft-dev libgme-dev libopenmpt-dev fluidsynth-dev fluidsynth libxmp libmodplug-dev mpg123-dev jack-dev curl-dev miniupnpc-dev libupnp-dev zlib-dev rapidjson-dev libpulse libxcursor libxi libxrandr libxscrnsaver libmikmod nasm python3-dev py3-setuptools py3-wheel py3-pillow build-base ccache alpine-sdk automake autoconf libtool cmake sudo bash dash shadow gawk curl git stow imagemagick zip p7zip findutils

RUN if [ "$ARCH" = "x86_64" ]; then \
curl -L https://7-zip.org/a/7z2301-linux-x64.tar.xz -o /tmp/7z2301-linux.tar.xz ; \
elif [ "$ARCH" = "i386" ] || [ "$ARCH" = "i486" ] || [ "$ARCH" = "i686" ]; then \
curl -L https://7-zip.org/a/7z2301-linux-x86.tar.xz -o /tmp/7z2301-linux.tar.xz ; \
elif [ "$ARCH" = "armhf" ] || [ "$ARCH" = "aarch64" ]; then \
curl -L https://7-zip.org/a/7z2301-linux-arm$IS64.tar.xz -o /tmp/7z2301-linux.tar.xz ; \
fi && \
7z x /tmp/7z2301-linux.tar.xz -so | 7z x -aoa -si -ttar 7zzs -o/usr/bin && \
mv /usr/bin/7zzs /usr/bin/7z

RUN git clone https://github.com/aawc/unrar.git /tmp/unrar && \
make -C /tmp/unrar -j"$NCPU" && \
install -Dm755 /tmp/unrar/unrar /usr/bin/unrar

RUN git clone https://github.com/Cyan4973/xxHash --branch release /tmp/xxHash && \
make -C /tmp/xxHash PREFIX=/usr install

RUN curl -sL "https://xff.cz/megatools/builds/builds/\$(curl -sL https://xff.cz/megatools/builds/builds/ | gawk -F'"' '/megatools-.*linux-'$ARCH'.tar.gz/ {print \$2}' | tail -n1)" -o "/tmp/megatools.tar.gz" && \
tar xfv "/tmp/megatools.tar.gz" --wildcards --strip-components=1 -C "/usr/bin" "*/megatools"

RUN printf "%s\n" "%wheel ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers && \
useradd -m -G wheel,abuild -s /usr/bin/dash srb2bld && \
passwd -d srb2bld && \
ln -sf /usr/bin/dash /bin/sh

USER srb2bld

RUN APKARCH=\$(apk --print-arch) && \
curl -RLC - https://raw.githubusercontent.com/alpinelinux/aports/refs/heads/3.16-stable/main/libexecinfo/APKBUILD -o/tmp/APKBUILD && \
curl -RLC - https://raw.githubusercontent.com/alpinelinux/aports/refs/heads/3.16-stable/main/libexecinfo/10-execinfo.patch -o/tmp/10-execinfo.patch && \
curl -RLC - https://raw.githubusercontent.com/alpinelinux/aports/refs/heads/3.16-stable/main/libexecinfo/20-define-gnu-source.patch -o/tmp/20-define-gnu-source.patch && \
curl -RLC - https://raw.githubusercontent.com/alpinelinux/aports/refs/heads/3.16-stable/main/libexecinfo/30-linux-makefile.patch -o/tmp/30-linux-makefile.patch && \
cd /tmp && \
abuild-keygen -nai && \
abuild -rc -P /tmp && \
curl -RLC - https://dl-cdn.alpinelinux.org/alpine/v3.18/community/\$APKARCH/libstdc%2B%2B6-6.4.0-r16.apk -o/tmp/libstdc%2B%2B6-6.4.0-r16.apk && \
curl -RLC - https://dl-cdn.alpinelinux.org/alpine/v3.18/community/\$APKARCH/gcc6-6.4.0-r16.apk -o/tmp/gcc6-6.4.0-r16.apk && \
sudo apk add \$(find /tmp -name "*.apk" 2> /dev/null)

RUN sudo ln -sf ../../../bin/ccache /usr/lib/ccache/bin/gcc-6

COPY Entrypoint /home/srb2bld/Entrypoint

ENTRYPOINT [ "sh", "/home/srb2bld/Entrypoint" ]

DOCKERFILE

    cat > "$SRB2BLDROOT/containers/srb2-tools-linux-musl-container/Dockerfile" << DOCKERFILE
FROM docker.io/alpine:latest

ENV container $(printf "%s\n" "$OSVIRT" | gawk '{print $1}')

ENV GNUTLS_CPUID_OVERRIDE 0x1

RUN apk update && \
apk upgrade && \
apk add fmt-dev sfml-dev jpeg-dev libogg-dev flac-dev libvorbis-dev openal-soft-dev eudev-dev glew-dev freeimage-dev ftgl-dev fluidsynth-dev gstreamer-dev gst-plugins-base-dev freeglut-dev libmodplug-dev wxwidgets-dev curl-dev libbz2 gtk+3.0 libcanberra-gtk3 lua-dev mpg123-dev fuse-dev libc-dev libc-utils libx11-dev libxcursor-dev libxi-dev mesa-dev fontconfig-dev adwaita-icon-theme nasm build-base g++ clang ccache alpine-sdk automake autoconf libtool cmake ninja sudo bash dash gawk curl git shadow imagemagick stow p7zip findutils

RUN printf "%s\n" "%wheel ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers && \
useradd -m -G wheel,abuild -s /usr/bin/dash srb2bld && \
passwd -d srb2bld && \
ln -sf /usr/bin/dash /bin/sh

USER srb2bld

RUN APKARCH=\$(apk --print-arch) && \
curl -RLC - https://raw.githubusercontent.com/alpinelinux/aports/refs/heads/3.16-stable/main/libexecinfo/APKBUILD -o/tmp/APKBUILD && \
curl -RLC - https://raw.githubusercontent.com/alpinelinux/aports/refs/heads/3.16-stable/main/libexecinfo/10-execinfo.patch -o/tmp/10-execinfo.patch && \
curl -RLC - https://raw.githubusercontent.com/alpinelinux/aports/refs/heads/3.16-stable/main/libexecinfo/20-define-gnu-source.patch -o/tmp/20-define-gnu-source.patch && \
curl -RLC - https://raw.githubusercontent.com/alpinelinux/aports/refs/heads/3.16-stable/main/libexecinfo/30-linux-makefile.patch -o/tmp/30-linux-makefile.patch && \
cd /tmp && \
abuild-keygen -nai && \
abuild -rc -P /tmp && \
sudo apk add \$(find /tmp -name "*.apk" 2> /dev/null) && \
rm -rf "/tmp/APKBUILD" "/tmp/*.patch" && \
curl -RLC - https://raw.githubusercontent.com/alpinelinux/aports/refs/heads/3.16-stable/community/gnome-icon-theme/APKBUILD -o/tmp/APKBUILD && \
abuild-keygen -nai && \
abuild -rc -P /tmp && \
sudo apk add \$(find /tmp -name "*.apk" 2> /dev/null) && \
rm -rf "/tmp/APKBUILD" "/tmp/*.patch"

COPY Entrypoint /home/srb2bld/Entrypoint

ENTRYPOINT [ "sh", "/home/srb2bld/Entrypoint" ]

DOCKERFILE

    cat > "$SRB2BLDROOT/containers/srb2-games-windows-container/Dockerfile" << DOCKERFILE
FROM docker.io/debian:latest

ENV container $(printf "%s\n" "$OSVIRT" | gawk '{print $1}')

ENV DEBIAN_FRONTEND noninteractive

ENV GNUTLS_CPUID_OVERRIDE 0x1

RUN printf 'Acquire::Check-Valid-Until "false";\nAcquire::Check-Date "false";' > /etc/apt/apt.conf.d/90ignore-release-date && \
printf 'Dpkg::Options:: "--force-confdef";' > /etc/apt/apt.conf.d/90force-confdef && \
printf 'APT::Install-Recommends "false";\nAPT::Install-Suggests "false";' > /etc/apt/apt.conf.d/90no-recommend && \
apt-get update && \
apt-get install -y gnupg apt-transport-https ca-certificates curl gawk && \
mkdir -p /etc/apt/sources.list.d && \
printf "deb http://ppa.launchpad.net/apt-fast/stable/ubuntu $UBUSOFTVER main" >> /etc/apt/sources.list.d/apt-fast.list && \
gawk -i inplace '{gsub("main","main contrib non-free"); print}' /etc/apt/sources.list.d/debian.sources && \
curl -Ls "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0xbc5934fd3debd4daea544f791e2824a7f22b44bd" | gawk '!/Comment:|Version:/ {gsub("\r",""); print}' | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/aptfast.gpg > /dev/null

RUN apt-get update && \
apt-get full-upgrade -y && \
apt-get install -y apt-fast && \
gawk -i inplace '{sub("DOWNLOADBEFORE=","DOWNLOADBEFORE=true");sub("_MAXNUM=5","_MAXNUM=20"); print}' /etc/apt-fast.conf && \
apt-fast install -y libsdl2-dev libsdl2-mixer-dev libsdl1.2-dev libsdl-image1.2-dev libsdl-mixer1.2-dev libsdl-ttf2.0-dev libpng-dev libgme-dev libopenmpt-dev libfluidsynth-dev libmodplug-dev libjack-dev libcurl4-openssl-dev libminiupnpc-dev libupnp-dev zlib1g-dev rapidjson-dev libfuse-dev libc6-dev-i386-cross fuse nasm python3-dev python3-setuptools python3-pil python3-wheel build-essential ninja-build mingw-w64 ccache automake libtool cmake file sudo dash git-svn stow imagemagick p7zip-full p7zip-rar zip unzip unrar tar zstd

RUN git clone https://github.com/Cyan4973/xxHash --branch release /tmp/xxHash && \
make -C /tmp/xxHash PREFIX=/usr install

RUN curl -sL "https://xff.cz/megatools/builds/builds/\$(curl -sL https://xff.cz/megatools/builds/builds/ | gawk -F'"' '/megatools-.*linux-'$ARCH'.tar.gz/ {print \$2}' | tail -n1)" -o "/tmp/megatools.tar.gz" && \
tar xfv "/tmp/megatools.tar.gz" --wildcards --strip-components=1 -C "/usr/bin" "*/megatools"

RUN if [ "$BUILD" = "$BUILDPATH/ring-racers" ] || [ "$BUILD" = "$BUILDPATH/ring-racers-noire" ] || [ "$BUILD" = "$BUILDPATH/ring-racers-hep" ] || [ "$BUILD" = "$BUILDPATH/ring-racers-freaky-build" ] || [ "$BUILD" = "$BUILDPATH/radio-racers" ]; then \
curl -RLOC - --retry 999 https://snapshot.debian.org/archive/debian/20231215T150950Z/pool/main/i/icu/libicu74_74.2-1_\$(dpkg --print-architecture).deb --output-dir /tmp && \
curl -LO \$(curl -Ls https://api.github.com/repos/PowerShell/PowerShell/releases/latest | gawk -F'"' '/browser_download_url.*powershell.*.deb_'\$(dpkg --print-architecture)'.deb/ {print \$4}') --output-dir /tmp && \
dpkg -i /tmp/*.deb ; \
fi

RUN mkdir -p "/usr/include/FMOD" "\$SRB2BLDROOT/libraries/FMOD" && \
curl -RLOC - "https://zdoom.org/files/fmod/fmodapi375win.zip" --output-dir "\$SRB2BLDROOT/libraries/FMOD" && \
7z e -y "\$SRB2BLDROOT/libraries/FMOD/fmodapi375win.zip" "fmodapi375win/api/lib/*.lib" "fmodapi375win/api/lib/*.a" -o"/usr/i686-w64-mingw32/lib" && \
mkdir -p "/usr/i686-w64-mingw32/include/FMOD" && \
7z e -y "\$SRB2BLDROOT/libraries/FMOD/fmodapi375win.zip" "fmodapi375win/api/inc/"* -o"/usr/i686-w64-mingw32/include/FMOD"

RUN ln -sf ../../bin/ccache /usr/lib/ccache/i686-w64-mingw32-$MINGWCCVER && \
ln -sf ../../bin/ccache /usr/lib/ccache/$ARCH-w64-mingw32-$MINGWCCVER && \
ln -sf ../../bin/ccache /usr/lib/ccache/i686-w64-mingw32-$MINGWCXXVER && \
ln -sf ../../bin/ccache /usr/lib/ccache/$ARCH-w64-mingw32-$MINGWCXXVER && \
ln -sf ../../bin/ccache /usr/lib/ccache/i686-w64-mingw32-gcc-posix && \
ln -sf ../../bin/ccache /usr/lib/ccache/$ARCH-w64-mingw32-gcc-posix && \
ln -sf ../../bin/ccache /usr/lib/ccache/i686-w64-mingw32-g++-posix && \
ln -sf ../../bin/ccache /usr/lib/ccache/$ARCH-w64-mingw32-g++-posix

# Download and install old version of gcc compiler and FMOD to compile old SRB2 versions on Windows.
RUN if [ "$BUILD" = "$BUILDPATH/srb2-thokker" ] || [ "$BUILD" = "$BUILDPATH/srb2-top-down" ] || [ "$BUILD" = "$BUILDPATH/sonic-smash-brawl" ] || [ "$BUILD" = "$BUILDPATH/srb2-2.0" ] || [ "$BUILD" = "$BUILDPATH/srb2-cb" ] || [ "$BUILD" = "$BUILDPATH/xsrb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ] || [ "$BUILD" = "$BUILDPATH/srb2-riders" ] || [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ] || [ "$BUILD" = "$BUILDPATH/sbb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-jte" ] || [ "$BUILD" = "$BUILDPATH/shufflarb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-live" ] || [ "$BUILD" = "$BUILDPATH/srb2-loz" ] || [ "$BUILD" = "$BUILDPATH/ssbss" ] || [ "$BUILD" = "$BUILDPATH/newmillennium" ]; then \
curl -RLOC - --retry 999 https://snapshot.debian.org/archive/debian/20150828T100026Z/pool/main/b/binutils-mingw-w64/binutils-mingw-w64-i686_2.25-5%2B5.2%2Bdeb8u1_i386.deb --output-dir /tmp && \
curl -RLOC - --retry 999 https://snapshot.debian.org/archive/debian/20141220T040525Z/pool/main/g/gcc-mingw-w64/gcc-mingw-w64_4.9.1-19%2B14.3_all.deb --output-dir /tmp && \
curl -RLOC - --retry 999 https://snapshot.debian.org/archive/debian/20141220T100804Z/pool/main/g/gcc-mingw-w64/gcc-mingw-w64-base_4.9.1-19%2B14.3_i386.deb --output-dir /tmp && \
curl -RLOC - --retry 999 https://snapshot.debian.org/archive/debian/20141220T100804Z/pool/main/g/gcc-mingw-w64/gcc-mingw-w64-i686_4.9.1-19%2B14.3_i386.deb --output-dir /tmp && \
curl -RLOC - --retry 999 https://snapshot.debian.org/archive/debian/20140912T042222Z/pool/main/m/mingw-w64/mingw-w64_3.2.0-2_all.deb --output-dir /tmp && \
curl -RLOC - --retry 999 https://snapshot.debian.org/archive/debian/20140912T042222Z/pool/main/m/mingw-w64/mingw-w64-common_3.2.0-2_all.deb --output-dir /tmp && \
curl -RLOC - --retry 999 https://snapshot.debian.org/archive/debian/20140912T042222Z/pool/main/m/mingw-w64/mingw-w64-i686-dev_3.2.0-2_all.deb --output-dir /tmp && \
curl -RLOC - --retry 999 https://snapshot.debian.org/archive/debian/20141209T220743Z/pool/main/c/cloog/libcloog-isl4_0.18.2-1%2Bb2_i386.deb --output-dir /tmp && \
curl -RLOC - --retry 999 https://snapshot.debian.org/archive/debian/20140625T223032Z/pool/main/i/isl/libisl10_0.12.2-2_i386.deb --output-dir /tmp && \
curl -RLOC - --retry 999 https://snapshot.debian.org/archive/debian/20140710T222555Z/pool/main/m/mpclib3/libmpc3_1.0.2-1_i386.deb --output-dir /tmp && \
curl -RLOC - --retry 999 https://snapshot.debian.org/archive/debian/20141211T161416Z/pool/main/m/mpfr4/libmpfr4_3.1.2-2_i386.deb --output-dir /tmp && \
for i in /tmp/*.deb; do sudo dpkg-deb -xv "\$i" /usr/local/stow; done && \
mv -f /usr/local/stow/usr /usr/local/stow/mingw-w64-4.9 && \
STOW_DIR=/usr/local/stow sudo -E stow -v mingw-w64-4.9 && \
ln -sf ../../bin/ccache /usr/lib/ccache/i686-w64-mingw32-$MINGWOLDCCVER && \
ln -sf ../../bin/ccache /usr/lib/ccache/$ARCH-w64-mingw32-$MINGWOLDCCVER ; \
fi

RUN printf "%s\n" "%sudo ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers && \
useradd -m -G sudo -s /usr/bin/dash srb2bld && \
passwd -d srb2bld

USER srb2bld

COPY Entrypoint /home/srb2bld/Entrypoint

ENTRYPOINT [ "sh", "/home/srb2bld/Entrypoint" ]

DOCKERFILE

    cat > "$SRB2BLDROOT/containers/srb2-tools-windows-container/Dockerfile" << DOCKERFILE
FROM docker.io/ubuntu:"$UBUSOFTVER"

ENV container $(printf "%s\n" "$OSVIRT" | gawk '{print $1}')

ENV DEBIAN_FRONTEND noninteractive

ENV GNUTLS_CPUID_OVERRIDE 0x1

RUN printf 'Acquire::Check-Valid-Until "false";\nAcquire::Check-Date "false";' > /etc/apt/apt.conf.d/90ignore-release-date && \
printf 'Dpkg::Options:: "--force-confdef";' > /etc/apt/apt.conf.d/90force-confdef && \
printf 'APT::Install-Recommends "false";\nAPT::Install-Suggests "false";' > /etc/apt/apt.conf.d/90no-recommend && \
apt-get update && \
apt-get install -y gnupg apt-transport-https ca-certificates curl gawk && \
gawk -i inplace '{gsub("main","main contrib non-free"); print}' /etc/apt/sources.list && \
printf "deb http://ppa.launchpad.net/apt-fast/stable/ubuntu $UBUSOFTVER main\ndeb http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu $UBUSOFTVER main\ndeb https://apt.kitware.com/ubuntu/ $UBUSOFTVER main\ndeb https://download.mono-project.com/repo/ubuntu stable-focal main" >> /etc/apt/sources.list && \
curl -Ls "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0xA2166B8DE8BDC3367D1901C11EE2FF37CA8DA16B" | gawk '!/Comment:|Version:/ {gsub("\r",""); print}' | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/aptfast.gpg > /dev/null && \
curl -Ls "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x1E9377A2BA9EF27F" | gawk '!/Comment:|Version:/ {gsub("\r",""); print}' | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/toolchain.gpg > /dev/null && \
curl -Ls "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF" | gawk '!/Comment:|Version:/ {gsub("\r",""); print}' | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/mono.gpg > /dev/null && \
curl -Ls "https://apt.kitware.com/keys/kitware-archive-latest.asc" | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/cmake.gpg > /dev/null

RUN apt-get update && \
apt-get full-upgrade -y && \
apt-get install -y apt-fast && \
gawk -i inplace '{sub("DOWNLOADBEFORE=","DOWNLOADBEFORE=true");sub("_MAXNUM=5","_MAXNUM=20"); print}' /etc/apt-fast.conf && \
apt-fast install -y libfluidsynth-dev libmodplug-dev libjack-dev libcurl4-openssl-dev libupnp-dev zlib1g-dev libglew-dev libfreeimage-dev libftgl-dev libsfml-dev libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev freeglut3-dev libbz2-dev libgtk-3-dev liblua5.3-dev libfmt-dev libmpg123-dev rapidjson-dev libfuse-dev libx11-dev mesa-common-dev fuse nasm build-essential ninja-build $GCCVER $GXXVER mingw-w64 ccache automake libtool cmake file sudo dash git stow imagemagick p7zip-full p7zip-rar mono-complete

RUN ln -sf ../../bin/ccache /usr/lib/ccache/i686-w64-mingw32-$MINGWCCVER && \
ln -sf ../../bin/ccache /usr/lib/ccache/$ARCH-w64-mingw32-$MINGWCCVER && \
ln -sf ../../bin/ccache /usr/lib/ccache/i686-w64-mingw32-$MINGWCXXVER && \
ln -sf ../../bin/ccache /usr/lib/ccache/$ARCH-w64-mingw32-$MINGWCXXVER && \
ln -sf ../../bin/ccache /usr/lib/ccache/i686-w64-mingw32-gcc-posix && \
ln -sf ../../bin/ccache /usr/lib/ccache/$ARCH-w64-mingw32-gcc-posix && \
ln -sf ../../bin/ccache /usr/lib/ccache/i686-w64-mingw32-g++-posix && \
ln -sf ../../bin/ccache /usr/lib/ccache/$ARCH-w64-mingw32-g++-posix

RUN printf "%s\n" "%sudo ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers && \
useradd -m -G sudo -s /usr/bin/dash srb2bld && \
passwd -d srb2bld

USER srb2bld

COPY Entrypoint /home/srb2bld/Entrypoint

ENTRYPOINT [ "sh", "/home/srb2bld/Entrypoint" ]

DOCKERFILE

    cat > "$SRB2BLDROOT/containers/srb2-games-android-container/Dockerfile" << DOCKERFILE
FROM docker.io/alvrme/alpine-android-base:"$ANDROIDSDKVER"

ENV container $(printf "%s\n" "$OSVIRT" | gawk '{print $1}')

ENV GNUTLS_CPUID_OVERRIDE 0x1

RUN apk update && \
apk upgrade && \
apk add file sudo bash dash gawk curl git shadow p7zip findutils

RUN curl -sL "https://xff.cz/megatools/builds/builds/\$(curl -sL https://xff.cz/megatools/builds/builds/ | gawk -F'"' '/megatools-.*linux-'$ARCH'.tar.gz/ {print \$2}' | tail -n1)" -o "/tmp/megatools.tar.gz" && \
tar xfv "/tmp/megatools.tar.gz" --wildcards --strip-components=1 -C "/usr/bin" "*/megatools"

RUN printf "%s\n" "%wheel ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers && \
useradd -m -G wheel,abuild -s /usr/bin/dash srb2bld && \
passwd -d srb2bld && \
ln -sf /usr/bin/dash /bin/sh

USER srb2bld

COPY Entrypoint /home/srb2bld/Entrypoint

ENTRYPOINT [ "sh", "/home/srb2bld/Entrypoint" ]

DOCKERFILE
}

containerrun() {
    # Restarting Docker daemon in order to avoid connection to be refused by Docker image repository. One time check after every reboot/shutdown of system.
    if [ ! -f /tmp/srb2bld-docker ] && [ ! -x "$(command -v podman 2> /dev/null)" ]; then

        if [ -x "$(command -v doas 2> /dev/null)" ]; then

            SUDO="doas"

        else

            SUDO="sudo"

        fi

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Starting Docker daemon. Please wait..."

        if [ -x "$(command -v systemctl 2> /dev/null)" ] && [ -n "$(systemctl --user list-units docker.service | gawk '/docker/ {print $1}')" ]; then

            systemctl --user restart docker || systemctl --user restart dockerd

        elif [ -x "$(command -v systemctl 2> /dev/null)" ] && [ -n "$(systemctl list-units docker.service | gawk '/docker/ {print $1}')" ]; then

            $SUDO systemctl restart docker || $SUDO systemctl restart dockerd

        elif [ -x "$(command -v rc-service 2> /dev/null)" ]; then

            $SUDO rc-service docker restart || $SUDO rc-service dockerd restart

        elif [ -x "$(command -v sv 2> /dev/null)" ]; then

            $SUDO sv restart docker || $SUDO sv restart dockerd

        elif [ -x "$(command -v dinitctl 2> /dev/null)" ]; then

            $SUDO dinitctl restart docker || $SUDO dinitctl restart dockerd

        elif [ -x "$(command -v s6-rc 2> /dev/null)" ]; then

            $SUDO s6-rc stop docker || $SUDO s6-rc stop dockerd
            $SUDO s6-rc start docker || $SUDO s6-rc start dockerd

        fi

        touch /tmp/srb2bld-docker

        if [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u -| -u$| --user -| --user$/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk 'match($0, /\/home\/'$USER'\/.local/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$ISREADONLY" ]; then

            unset SUDO

        fi

        sleep 1

    elif [ "$OS" = "Linux" ] && [ -x "$(command -v podman 2> /dev/null)" ] && ([ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u -| -u$| --user -| --user$/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk 'match($0, /\/home\/'$USER'\/.local/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$ISREADONLY" ]) && [ -n "$(podman unshare find -L "$SRB2BLDPREFIX/stow" "$SRB2BLDPREFIX/bin" "$SRB2BLDPREFIX/include" "$SRB2BLDPREFIX/lib" "$SRB2BLDROOT/libraries" "$HOME/.cache/ccache" -printf "%u:%g\n" 2> /dev/null | gawk '!/root/ {print $3,$4}' | head -n1)" ]; then

        if [ -x "$(command -v doas 2> /dev/null)" ]; then

            SUDO="doas"

        else

            SUDO="sudo"

        fi

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Correcting permissions to $BUILDNAME's files. Please wait..."
        $SUDO find -L "$SRB2BLDPREFIX/stow" "$SRB2BLDPREFIX/bin" "$SRB2BLDPREFIX/include" "$SRB2BLDPREFIX/lib" "$SRB2BLDROOT/libraries" "$HOME/.cache/ccache" ! -group "$USER" -exec chown -R "$USER:$USER" {} \; 2> /dev/null || true

        if [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u -| -u$| --user -| --user$/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk 'match($0, /\/home\/'$USER'\/.local/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$ISREADONLY" ]; then

            unset SUDO

        fi

    elif [ -x "$(command -v podman 2> /dev/null)" ] && [ "$(podman machine info 2> /dev/null | gawk '/machinestate:/ {print $2}')" = "Stopped" ]; then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Starting Podman daemon. Please wait..."
        podman machine start

    fi

    if [ "$ANDROID" = "1" ]; then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for SRB2 Android. Please wait..."

        if [ -n "$ISNET" ]; then

            $OSVIRT pull $PLATFORM docker.io/alvrme/alpine-android-base:"$ANDROIDSDKVER"

        fi

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for SRB2 Android. Please wait..."
        $OSVIRT build --rm $PLATFORM --network host -t srb2-games-android-container "$SRB2BLDROOT/containers/srb2-games-android-container"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Running $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') container from built image for $BUILDNAME. Please wait..."

        if [ "$OS" = "Windows" ]; then

            $OSVIRT run $OSVIRTOPTS --volume="$($PRINTF "%s\n" "$USERPROFILE")\\AppData\\Roaming\\srb2bld:$SRB2BLDROOT:rw" --volume="$($PRINTF "%s\n" "$USERPROFILE")\\.cache\\gradle:$GRADLE_USER_HOME:rw" srb2-games-android-container

        elif [ "$OS" = "Linux" ]; then

            $OSVIRT run $OSVIRTOPTS --volume="$SRB2BLDROOT:$SRB2BLDROOT:rw" --volume="$GRADLE_USER_HOME:$GRADLE_USER_HOME:rw" srb2-games-android-container

        fi

    elif [ "$OS" = "Windows" ] && ([ "$BUILD" = "$BUILDPATH/wadcli" ] || [ "$BUILD" = "$BUILDPATH/kartmaker" ] || [ "$BUILD" = "$BUILDPATH/neptunefm" ] || [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ] || [ "$BUILD" = "$BUILDPATH/followermaker" ] || [ "$BUILD" = "$BUILDPATH/slade" ] || [ "$BUILD" = "$BUILDPATH/ultimate-zone-builder" ] || [ "$BUILD" = "$BUILDPATH/ultimate-gksz-builder" ] || [ "$BUILD" = "$BUILDPATH/ultimate-lowee-builder" ] || [ "$BUILD" = "$BUILDPATH/high-voltage-ring" ] || [ "$BUILD" = "$BUILDPATH/aseprite" ]); then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for Windows SRB2 tools. Please wait..."

        if [ -n "$ISNET" ]; then

            $OSVIRT pull $PLATFORM docker.io/ubuntu:"$UBUSOFTVER"

        fi

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for Windows SRB2 tools. Please wait..."
        $OSVIRT build --rm $PLATFORM --network host -t srb2-tools-windows-container "$SRB2BLDROOT/containers/srb2-tools-windows-container"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Running $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') container from built image for $BUILDNAME. Please wait..."

        if [ "$CROSS" = "1" ]; then

            $OSVIRT run $OSVIRTOPTS --volume="$SRB2BLDROOT:$SRB2BLDROOT:rw" --volume="$CCACHE_DIR:$CCACHE_DIR:rw" srb2-tools-windows-container

        else

            $OSVIRT run $OSVIRTOPTS --volume="$($PRINTF "%s\n" "$USERPROFILE")\\AppData\\Roaming\\srb2bld:$SRB2BLDROOT:rw" --volume="$($PRINTF "%s\n" "$USERPROFILE")\\.cache\\ccache:$CCACHE_DIR:rw" srb2-tools-windows-container

        fi

    elif [ "$OS" = "Windows" ]; then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for Windows SRB2 builds. Please wait..."

        if [ -n "$ISNET" ]; then

            $OSVIRT pull $PLATFORM docker.io/debian:latest

        fi

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for Windows SRB2 builds. Please wait..."
        $OSVIRT build --rm $PLATFORM --network host -t srb2-games-windows-container "$SRB2BLDROOT/containers/srb2-games-windows-container"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Running $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') container from built image for $BUILDNAME. Please wait..."

        if [ "$CROSS" = "1" ]; then

            $OSVIRT run $OSVIRTOPTS --volume="$SRB2BLDROOT:$SRB2BLDROOT:rw" --volume="$CCACHE_DIR:$CCACHE_DIR:rw" srb2-games-windows-container

        else

            $OSVIRT run $OSVIRTOPTS --volume="$($PRINTF "%s\n" "$USERPROFILE")\\AppData\\Roaming\\srb2bld:$SRB2BLDROOT:rw" --volume="$($PRINTF "%s\n" "$USERPROFILE")\\.cache\\ccache:$CCACHE_DIR:rw" --volume="$($PRINTF "%s\n" "$USERPROFILE")\\.cache\\vcpkg:/home/srb2bld/.cache/vcpkg:rw" srb2-games-windows-container

        fi

    elif [ "$LIBC" = "musl" ] && ([ "$BUILD" = "$BUILDPATH/wadcli" ] || [ "$BUILD" = "$BUILDPATH/kartmaker" ] || [ "$BUILD" = "$BUILDPATH/neptunefm" ] || [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ] || [ "$BUILD" = "$BUILDPATH/followermaker" ] || [ "$BUILD" = "$BUILDPATH/slade" ] || [ "$BUILD" = "$BUILDPATH/aseprite" ]); then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for musl based Linux SRB2 tools. Please wait..."

        if [ -n "$ISNET" ]; then

            $OSVIRT pull $PLATFORM docker.io/alpine:latest

        fi

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for musl based Linux SRB2 tools. Please wait..."
        $OSVIRT build --rm $PLATFORM --network host -t srb2-tools-linux-musl-container "$SRB2BLDROOT/containers/srb2-tools-linux-musl-container"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Running $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') container from built image for $BUILDNAME. Please wait..."

        if [ "$CROSS" = "1" ]; then

            $OSVIRT run $OSVIRTOPTS --volume="$($PRINTF "%s\n" "$USERPROFILE")\\AppData\\Roaming\\srb2bld:$SRB2BLDROOT:rw" --volume="$($PRINTF "%s\n" "$USERPROFILE")\\.cache\\ccache:$CCACHE_DIR:rw" srb2-tools-linux-musl-container

        else

            $OSVIRT run $OSVIRTOPTS --volume="$SRB2BLDROOT:$SRB2BLDROOT:rw" --volume="$SRB2BLDPREFIX:$SRB2BLDPREFIX:rw" --volume="$CCACHE_DIR:$CCACHE_DIR:rw" srb2-tools-linux-musl-container

        fi

    elif [ "$LIBC" = "musl" ] && ([ "$BUILD" != "$BUILDPATH/ultimate-zone-builder" ] && [ "$BUILD" != "$BUILDPATH/ultimate-gksz-builder" ] && [ "$BUILD" != "$BUILDPATH/ultimate-lowee-builder" ] && [ "$BUILD" != "$BUILDPATH/high-voltage-ring" ]); then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for musl based Linux SRB2 builds. Please wait..."

        if [ -n "$ISNET" ]; then

            $OSVIRT pull $PLATFORM docker.io/alpine:latest

        fi

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for musl based Linux SRB2 builds. Please wait..."
        $OSVIRT build --rm $PLATFORM --network host -t srb2-games-linux-musl-container "$SRB2BLDROOT/containers/srb2-games-linux-musl-container"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Running $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') container from built image for $BUILDNAME. Please wait..."

        if [ "$CROSS" = "1" ]; then

            $OSVIRT run $OSVIRTOPTS --volume="$($PRINTF "%s\n" "$USERPROFILE")\\AppData\\Roaming\\srb2bld:$SRB2BLDROOT:rw" --volume="$($PRINTF "%s\n" "$USERPROFILE")\\.cache\\ccache:$CCACHE_DIR:rw" srb2-games-linux-musl-container

        else

            $OSVIRT run $OSVIRTOPTS --volume="$SRB2BLDROOT:$SRB2BLDROOT:rw" --volume="$SRB2BLDPREFIX:$SRB2BLDPREFIX:rw" --volume="$CCACHE_DIR:$CCACHE_DIR:rw" srb2-games-linux-musl-container

        fi

    elif [ "$OS" = "Linux" ] && ([ "$BUILD" = "$BUILDPATH/wadcli" ] || [ "$BUILD" = "$BUILDPATH/kartmaker" ] || [ "$BUILD" = "$BUILDPATH/neptunefm" ] || [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ] || [ "$BUILD" = "$BUILDPATH/followermaker" ] || [ "$BUILD" = "$BUILDPATH/slade" ] || [ "$BUILD" = "$BUILDPATH/aseprite" ]); then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for glibc based Linux SRB2 tools. Please wait..."

        if [ -n "$ISNET" ]; then

            $OSVIRT pull $PLATFORM docker.io/ubuntu:"$UBUSOFTVER"

        fi

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for glibc based Linux SRB2 tools. Please wait..."
        $OSVIRT build --rm $PLATFORM --network host -t srb2-tools-linux-glibc-container "$SRB2BLDROOT/containers/srb2-tools-linux-glibc-container"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Running $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') container from built image for $BUILDNAME. Please wait..."

        if [ "$CROSS" = "1" ]; then

            $OSVIRT run $OSVIRTOPTS --volume="$($PRINTF "%s\n" "$USERPROFILE")\\AppData\\Roaming\\srb2bld:$SRB2BLDROOT:rw" --volume="$($PRINTF "%s\n" "$USERPROFILE")\\.cache\\ccache:$CCACHE_DIR:rw" srb2-tools-linux-glibc-container

        else

            $OSVIRT run $OSVIRTOPTS --volume="$SRB2BLDROOT:$SRB2BLDROOT:rw" --volume="$SRB2BLDPREFIX:$SRB2BLDPREFIX:rw" --volume="$CCACHE_DIR:$CCACHE_DIR:rw" srb2-tools-linux-glibc-container

        fi

    elif [ "$OS" = "Linux" ] && ([ "$BUILD" = "$BUILDPATH/ultimate-zone-builder" ] || [ "$BUILD" = "$BUILDPATH/ultimate-gksz-builder" ] || [ "$BUILD" = "$BUILDPATH/ultimate-lowee-builder" ] || [ "$BUILD" = "$BUILDPATH/high-voltage-ring" ]); then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for glibc based Linux SRB2 tools. Please wait..."

        if [ -n "$ISNET" ]; then

            $OSVIRT pull $PLATFORM docker.io/ubuntu:"$UBUUZBVER"

        fi

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for glibc based Linux Ultimate Zone Builder or Ultimate Lowee Builder or High Voltage Ring. Please wait..."
        $OSVIRT build --rm $PLATFORM --network host -t srb2-uzb-linux-glibc-container "$SRB2BLDROOT/containers/srb2-uzb-linux-glibc-container"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Running $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') container from built image for $BUILDNAME. Please wait..."

        if [ "$CROSS" = "1" ]; then

            $OSVIRT run $OSVIRTOPTS --volume="$($PRINTF "%s\n" "$USERPROFILE")\\AppData\\Roaming\\srb2bld:$SRB2BLDROOT:rw" --volume="$($PRINTF "%s\n" "$USERPROFILE")\\.cache\\ccache:$CCACHE_DIR:rw" srb2-uzb-linux-glibc-container

        else

            $OSVIRT run $OSVIRTOPTS --volume="$SRB2BLDROOT:$SRB2BLDROOT:rw" --volume="$SRB2BLDPREFIX:$SRB2BLDPREFIX:rw" --volume="$CCACHE_DIR:$CCACHE_DIR:rw" srb2-uzb-linux-glibc-container

        fi

    elif [ "$OS" = "Linux" ]; then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for glibc based Linux SRB2 builds. Please wait..."

        if [ -n "$ISNET" ]; then

            $OSVIRT pull $PLATFORM docker.io/ubuntu:"$UBUVER"

        fi

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') image for glibc based Linux SRB2 builds. Please wait..."
        $OSVIRT build --rm $PLATFORM --network host -t srb2-games-linux-glibc-container "$SRB2BLDROOT/containers/srb2-games-linux-glibc-container"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Running $($PRINTF "%s\n" "$OSVIRT" | gawk 'match($0, /docker|podman/) {print substr($0, RSTART, RLENGTH)}') container from built image for $BUILDNAME. Please wait..."

        if [ "$CROSS" = "1" ]; then

            $OSVIRT run $OSVIRTOPTS --volume="$($PRINTF "%s\n" "$USERPROFILE")\\AppData\\Roaming\\srb2bld:$SRB2BLDROOT:rw" --volume="$($PRINTF "%s\n" "$USERPROFILE")\\.cache\\ccache:$CCACHE_DIR:rw" --volume="$($PRINTF "%s\n" "$USERPROFILE")\\.cache\\vcpkg:/home/srb2bld/.cache/vcpkg:rw" srb2-games-linux-glibc-container

        else

            $OSVIRT run $OSVIRTOPTS --volume="$SRB2BLDROOT:$SRB2BLDROOT:rw" --volume="$SRB2BLDPREFIX:$SRB2BLDPREFIX:rw" --volume="$CCACHE_DIR:$CCACHE_DIR:rw" srb2-games-linux-glibc-container

        fi

    fi
}

crosscompile() {
    clear

    # Blocking access to this option for users that have OS other than Linux and Windows.
    if [ "$OS" != "Linux" ] && [ "$OS" != "Windows" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Currently building cross-compiled bundle is only available for Linux and Windows. Exiting."
        exit

    fi

    # We have to set this in order to make cross-compiled bundle in Docker/Podman container.
    CROSS=1

    # Set to other OS for cross-compile, so we get proper compiler and other steps for compatibility in Docker/Podman container.
    if [ "$OS" = "Linux" ]; then

        OS="Windows"

    elif [ "$OS" = "Windows" ]; then

        OS="Linux"

    fi

    checkuseropt

    # Set current working directory.
    LNXPWD="$(pwd)"

    choosebuild

    buildvar

    fetchupdatebuild

    choosebranchcommit

    preparebuild

    setsudo

    preparecontainer

    containerentry

    sudo_ping

    settrap

    containerrun

    if [ "$BUILD" = "$BUILDPATH/srb2-2.0" ] || [ "$BUILD" = "$BUILDPATH/srb2-cb" ] || [ "$BUILD" = "$BUILDPATH/xsrb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ] || [ "$BUILD" = "$BUILDPATH/srb2-riders" ] || [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ] || [ "$BUILD" = "$BUILDPATH/sbb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-final-demo" ] || [ "$BUILD" = "$BUILDPATH/srb2-1095" ] || [ "$BUILD" = "$BUILDPATH/srb2-jte" ] || [ "$BUILD" = "$BUILDPATH/shufflarb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-live" ] || [ "$BUILD" = "$BUILDPATH/srb2-loz" ] || [ "$BUILD" = "$BUILDPATH/ssbss" ]; then

        ARCH="i386"

    fi

    # Export commit revision name before creating cross-compiled bundle.
    VERSION="$GITVER-$(git -C "$BUILD" rev-parse --short HEAD)"

    # Move created bundle to working directory.
    CROSSBUILDNAME="$($PRINTF "%s\n" "$BUILDNAME" | gawk '{gsub(" ","_"); print}')-$VERSION-$OS-$ARCH.zip"

    mv -f "$BUILDPATH/package.zip" "$LNXPWD/$CROSSBUILDNAME"

    $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Cross-compiled bundle for $BUILDNAME is done. Look for \"$CROSSBUILDNAME\" in \"$LNXPWD\" path."
}

customvar() {
    if [ -z "$SRB2BLDGITPATH" ]; then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please enter valid Git local or remote path."
        read -r SRB2BLDGITPATH

    fi

    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please enter name of custom build (it will be written as subdirectory in srb2-custom folder)."
    read -r CUSTOMDIR

    while printf "%s\n" "$CUSTOMDIR"; do

        if [ -z "$CUSTOMDIR" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please enter again."
            read -r CUSTOMDIR

        else

            break

        fi

    done
}

custombuild() {
    BUILD="$BUILDPATH/srb2-custom"

    if [ ! -d "$BUILD" ]; then

        mkdir -p "$BUILD"

    fi

    if [ -n "$(find "$BUILD" -mindepth 1 -maxdepth 1 -type d 2> /dev/null)" ]; then

        # Remove build.
        while true; do

            CUSTOMDIRS="$(find "$BUILD" -mindepth 1 -maxdepth 1 -type d 2> /dev/null)"
            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose custom build by typing number and then pressing enter. Press enter or ctrl+c to quit."
            array=$($PRINTF "%s\nAddNewCustom" "$CUSTOMDIRS")
            arrayname=$($PRINTF "%s\nBuild new custom build" "$(for c in $($PRINTF "%s\n" "$CUSTOMDIRS" | gawk -F'/' '{print $NF}'); do $PRINTF "%s\n" "Build $c"; done)")
            count="$($PRINTF "%s\n" "$array" | wc -l)"
            n=""
            $PRINTF "%s\n" "$arrayname" | gawk '{print NR")", $0}'
            $PRINTF "#? "
            read -r n

            if [ -n "$n" ] && [ "$n" -eq "$n" ] && [ "$n" -gt 0 ] && [ "$n" -le "$count" ]; then

                CUSTOMDIR="$($PRINTF "%s\n" "$array" | gawk -F'/' '{print $NF}' | gawk NR=="${n}")"
                CUSTOMPATH="$($PRINTF "%s\n" "$array" | gawk NR=="${n}")"

                if [ "$CUSTOMPATH" = "AddNewCustom" ]; then

                    customvar

                else

                    SRB2BLDGITPATH="$CUSTOMPATH"

                fi

                break

            else

                $PRINTF "$NOTICE\n%s\n\e[0m" "No option has been chosen."
                exit

            fi

        done

    else

        customvar

    fi

    if [ "$ANDROID" = "1" ]; then

        CUSTOMDIR="$CUSTOMDIR-android"

    fi

    BUILD="$BUILDPATH/srb2-custom/$CUSTOMDIR"

    # Check whether SRB2BLDGITPATH environment variable is set or not.
    if [ -z "$SRB2BLDGITPATH" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: No SRB2BLDGITPATH is set. Add SRB2BLDGITPATH environment variable to valid Git local or remote path in shell configuration file (for example \".bash_profile\" or \".zshrc\" or \".bashrc\").
                EXAMPLE:
			1. export SRB2BLDGITPATH=\"https://github.com/STJr/SRB2\"

			2. export SRB2BLDGITPATH=\"https://git.do.srb2.org/TehRealSalt/SRB2\"

			3. export SRB2BLDGITPATH=\"\$HOME/Builds/SRB2\"

			4. export SRB2BLDGITPATH=\"C:\Builds\SRB2\"
                "
        exit

    fi

    if [ -z "$(find "$SRB2BLDGITPATH" -mindepth 1 -maxdepth 1 -type d 2> /dev/null | head -n1)" ] && [ -z "$(curl -vI "$SRB2BLDGITPATH" 2>&1 | gawk '/> Host:/ {gsub("\r",""); print $NF}')" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Can't find path to custom SRB2's source code at $SRB2BLDGITPATH path. Exiting."
        exit

    fi

    # Check if directory srb2-custom exits in script's data path.
    if ([ -d "$BUILD/.git" ] && [ -n "$(git -C "$SRB2BLDGITPATH" diff --shortstat 2> /dev/null)" ]) || ([ -d "$BUILD/.git" ] && [ "$(git -C "$BUILD" remote -v 2> /dev/null | gawk '/fetch/ {print $2}')" != "$(git -C "$SRB2BLDGITPATH" remote -v 2> /dev/null | gawk '/fetch/ {print $2}')" ]) && ([ -d "$BUILD/.git" ] && [ "$(git -C "$BUILD" remote -v 2> /dev/null | gawk '/fetch/ {print $2}')" != "$($PRINTF "$SRB2BLDGITPATH" | gawk '{gsub(".git$",""); print}').git" ]); then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Found existing directory with source code in $BUILD path. Are you sure you want to remove it? Enter \"yes/Yes\" or \"no/No\" (\"y/Y\" or \"n/N\"). If you choose \"no/No\", \"n/N\" or just press enter, script will continue with current source code's directory in $BUILD path. Press ctrl+c to quit."
        $PRINTF "$PROMPT\n%s\e[0m" "> "
        read -r CONFIRM

        if [ "$CONFIRM" = y ] || [ "$CONFIRM" = Y ] || [ "$CONFIRM" = yes ] || [ "$CONFIRM" = Yes ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Removing existing source at path $BUILD. Please wait..."
            sleep 1
            rm -rf "$BUILD"

        fi

    fi

    # Fixing Windows path to source code to be found by script.
    if [ "$OS" = "Windows" ]; then

        SRB2BLDGITPATH=$($PRINTF "%s\n" "$SRB2BLDGITPATH" | gawk 'gsub("\\\\","\\\\");{print}' | gawk '!a[$0]++ {print}')

    fi

    # Copy directory with source code to script's data path.
    if [ -n "$(find "$SRB2BLDGITPATH" -mindepth 1 -maxdepth 1 -type d 2> /dev/null | head -n1)" ] && [ ! -d "$BUILD/.git" ]; then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Copying source code. Please wait..."
        sleep 1
        cp -rf "$SRB2BLDGITPATH" "$BUILDPATH/srb2-custom/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')"

    fi

    # Set proper default branch.
    if [ -n "$SRB2BLDGITVER" ] && [ ! -d "$BUILD/.git" ] || [ -n "$ISNET" ]; then

        GITDEFVER="--branch $SRB2BLDGITVER"

    elif [ -z "$SRB2BLDGITVER" ] && [ ! -d "$BUILD/.git" ] || [ -n "$ISNET" ]; then

        GITDEFVER="--branch $(git ls-remote --refs $($PRINTF $SRB2BLDGITPATH | gawk '{gsub(".git$",""); print}').git | gawk -F'/' '/'$(git ls-remote $($PRINTF $SRB2BLDGITPATH | gawk '{gsub(".git$",""); print}').git --symref HEAD | gawk '{print $1}')'/ {print $NF}' | head -n1)"

    elif [ -n "$SRB2BLDGITVER" ] && [ -d "$BUILD/.git" ]; then

        GITDEFVER="$SRB2BLDGITVER"

    else

        GITDEFVER=$(gawk -F'/' '{print $NF}' "$BUILD/.git/refs/remotes/origin/HEAD" 2> /dev/null)

    fi

    GITVER="$GITDEFVER"
    GITVERCONF=$($PRINTF "%s\n" "$GITDEFVER" | gawk '{print $NF}')
}

defaultmessage() {
    $PRINTF "$NOTICE%s\n\e[0m" "Please enter \"srb2bld --help\" to check usage of this shell script."
}

extractmacosassets() {
    if [ "$BUILD" = "$BUILDPATH/srb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-2.2-classic" ] || [ "$BUILD" = "$BUILDPATH/srb2-uncapped-plus" ] || [ "$BUILD" = "$BUILDPATH/srb2-netplus" ] || [ "$BUILD" = "$BUILDPATH/srb2-reveries" ] || [ "$BUILD" = "$BUILDPATH/srb2-tsourdt3rd" ] || [ "$BUILD" = "$BUILDPATH/srb2-edit" ] || [ "$BUILD" = "$BUILDPATH/srb2-ggj" ] || [ "$BUILD" = "$BUILDPATH/srb2-vr" ] || [ "$BUILD" = "$BUILDPATH/srb2-persona" ]; then

        # Copying documentation and license file to installer path.
        cp -f "$BUILD/assets/"*.txt $(find "$BUILD" -name "README-SDL.txt" 2> /dev/null | head -n1) "$BUILD/assets/installer"

        if [ "$BUILD" = "$BUILDPATH/srb2-2.2-classic" ]; then

            if [ -n "$ISNET" ] && [ "$(curl -X GET -sLI "$SRB2CLASSICASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/SRB2Classic.zip" 2> /dev/null)" ]; then

                rm -f "$SRB2BLDROOT/assets/SRB2Classic.zip"
                curl -RL "$SRB2CLASSICASSETURL" -o "$SRB2BLDROOT/assets/SRB2Classic.zip"

            fi

            # Create assets using srb2classic-assets repository for SRB2 Classic.
            7z x -y "$SRB2BLDROOT/assets/SRB2Classic.zip" -o"$BUILD/build"

            cd "$BUILD/build/srb2classic-assets"

            for a in $(ls -d "$BUILD/build/srb2classic-assets/"*.pk3dir | gawk -F'/' '{gsub(".pk3dir",".pk3"); print $NF}'); do

                "$BUILD/build/srb2classic-assets/assemble.py" "$a"

            done

            mkdir -p "$BUILD/assets/installer"
            cp -f "$BUILD/build/srb2classic-assets/"*.pk3 "$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/srb2-reveries" ]; then

            if [ -n "$ISNET" ]; then

                SRB2REVERIESASSETURL=$(/usr/bin/curl -sL "$SRB2REVERIESASSETURL" | gawk '{gsub(",","\n"); print}' | gawk -F'"' '/browser_download_url.*.zip/ {print $4}' | head -n1)
                if [ "$(/usr/bin/curl -X GET -sLI "$SRB2REVERIESASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/SRB2Reveries.zip" 2> /dev/null)" ]; then

                    rm -f "$SRB2BLDROOT/assets/SRB2Reveries.zip"
                    /usr/bin/curl -RL "$SRB2REVERIESASSETURL" -o "$SRB2BLDROOT/assets/SRB2Reveries.zip"

                fi

            fi

            7z x -y "$SRB2BLDROOT/assets/SRB2Reveries.zip" "*.pk3" "*.wad" -o"$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/srb2-tsourdt3rd" ]; then

            if [ -n "$ISNET" ] && [ "$(curl -X GET -LI "https://git.do.srb2.org/StarManiaKG/tsourdt3rd-assets/-/raw/main/releases/$(curl -sL "https://git.do.srb2.org/api/v4/projects/435/repository/tree?path=releases" | gawk '{gsub(",","\n"); print}' | gawk -F'releases/' '/path/ {gsub("\"","");gsub(" ","%20"); print $2}' | tail -n1)/tsourdt3rd.pk3" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/tsourdt3rd.pk3" 2> /dev/null)" ]; then

                rm -f "$SRB2BLDROOT/assets/tsourdt3rd.pk3"
                curl -RL "https://git.do.srb2.org/StarManiaKG/tsourdt3rd-assets/-/raw/main/releases/$(curl -sL "https://git.do.srb2.org/api/v4/projects/435/repository/tree?path=releases" | gawk '{gsub(",","\n"); print}' | gawk -F'releases/' '/path/ {gsub("\"","");gsub(" ","%20"); print $2}' | tail -n1)/tsourdt3rd.pk3" -o "$SRB2BLDROOT/assets/tsourdt3rd.pk3"

            fi

            cp -f "$SRB2BLDROOT/assets/tsourdt3rd.pk3" "$BUILD/assets/installer"

            if [ -n "$ISNET" ] && [ "$(curl -X GET -sLI "https://git.do.srb2.org/StarManiaKG/tsourdt3rd-assets/-/raw/main/extras/jukebox.pk3" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/jukebox.pk3" 2> /dev/null)" ]; then

                rm -f "$SRB2BLDROOT/assets/jukebox.pk3"
                curl -RL "https://git.do.srb2.org/StarManiaKG/tsourdt3rd-assets/-/raw/main/extras/jukebox.pk3" -o "$SRB2BLDROOT/assets/jukebox.pk3"

            fi

            cp -f "$SRB2BLDROOT/assets/jukebox.pk3" "$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/srb2-ggj" ]; then

            git -C "$BUILD/build" clone "$SRB2GGJASSETURL" "srb2ggj-assets"
            7z a -y -tzip -mx=0 "$BUILD/assets/installer/srb2ggj.pk3" "$BUILD/build/srb2ggj-assets/"*

        elif [ "$BUILD" = "$BUILDPATH/srb2-persona" ]; then

            if [ -n "$ISNET" ]; then

                SRB2ASSETETAG=$(curl -X GET -sLI "$SRB2PERSONAASSETURL" | gawk -F'etag: ' '{IGNORECASE=1} /etag/ {gsub("\r|\"",""); print $NF}' 2> /dev/null | tail -n1)
                if [ "$SRB2ASSETETAG" != "$(7z l "$SRB2BLDROOT/assets/SRB2P_MP.zip" 2> /dev/null | gawk '/Comment/ {print $NF}')" ]; then

                    rm -f "$SRB2BLDROOT/assets/SRB2P_MP.zip"
                    curl -RL "$SRB2PERSONAASSETURL" -o "$SRB2BLDROOT/assets/SRB2P_MP.zip"
                    zip -z "$SRB2BLDROOT/assets/SRB2P_MP.zip" << EOF
$SRB2ASSETETAG
EOF

                fi

            fi

            7z x -y "$SRB2BLDROOT/assets/SRB2P_MP.zip" "*.pk3" "*.wad" -o"$BUILD/assets/installer"

        fi

        if [ "$GITVER" = "$GITDEFVER" ]; then

            extractsrb2macosassets

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.2-beta6" ]; then

        SRB2BETAASSETURL=$(curl -sL "$SRB2BETAASSETURL" | gawk -F'"' '/browser_download_url.*srb2-windowsx86.zip/ {print $4}' | head -n1)
        if [ -n "$ISNET" ] && [ "$(curl -X GET -sLI "$SRB2BETAASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/SRB2Beta.zip" 2> /dev/null)" ]; then

            rm -f "$SRB2BLDROOT/assets/SRB2Beta.zip"
            curl -RL "$SRB2BETAASSETURL" -o "$SRB2BLDROOT/assets/SRB2Beta.zip"

        fi

        7z e -y "$SRB2BLDROOT/assets/SRB2Beta.zip" "*/*.pk3" "*/*.dta" -o"$BUILD/assets/installer"

    elif [ "$BUILD" = "$BUILDPATH/srb2-destructive-illusion" ]; then

        if [ -n "$ISNET" ]; then

            SRB2ASSETETAG=$(curl -X GET -sLI "$SRB2DESTRUCTIVEILLUSIONASSETURL" | gawk -F'etag: ' '{IGNORECASE=1} /etag/ {gsub("\r|\"",""); print $NF}' 2> /dev/null | tail -n1)
            if [ "$SRB2ASSETETAG" != "$(7z l "$SRB2BLDROOT/assets/SRB2DI.zip" 2> /dev/null | gawk '/Comment/ {print $NF}')" ]; then

                rm -f "$SRB2BLDROOT/assets/SRB2DI.zip"
                curl -RL "$SRB2DESTRUCTIVEILLUSIONASSETURL" -o "$SRB2BLDROOT/assets/SRB2DI.zip"
                zip -z "$SRB2BLDROOT/assets/SRB2DI.zip" << EOF
$SRB2ASSETETAG
EOF

            fi

        fi

        7z e -y "$SRB2BLDROOT/assets/SRB2DI.zip" "*/*.pk3" "*/*.dta" "*/*.lua" -o"$BUILD/assets/installer"

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.1-legacy" ] || [ "$BUILD" = "$BUILDPATH/srb2-fusion-advance" ] || [ "$BUILD" = "$BUILDPATH/srb2-thokker" ] || [ "$BUILD" = "$BUILDPATH/srb2-top-down" ] || [ "$BUILD" = "$BUILDPATH/sonic-smash-brawl" ]; then

        if [ -n "$ISNET" ]; then

            curl -RLC - "$SRB2LEGACYASSETURL" -o "$SRB2BLDROOT/assets/SRB2-2.1.exe"

        fi

        7z x -y "$SRB2BLDROOT/assets/SRB2-2.1.exe" "*.srb" "*.dta" "*.dat" -o"$BUILD/assets/installer"

        if [ "$BUILD" = "$BUILDPATH/srb2-thokker" ]; then

            if [ -n "$ISNET" ]; then

                megatools dl "$SRB2THOKKERASSETURL" --path "/tmp"
                mv -f "/tmp/Thokker-1-0-1.zip" "$SRB2BLDROOT/assets/SRB2Thokker.zip"

            fi

            7z x -y "$SRB2BLDROOT/assets/SRB2Thokker.zip" "*.thk" -o"$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/srb2-top-down" ]; then

            if [ -n "$ISNET" ]; then

                rm -f "$SRB2BLDROOT/assets/SRB2TD.zip"*
                curl -RL "$SRB2TOPDOWNASSET1URL" -o "$SRB2BLDROOT/assets/SRB2TD.zip.001"
                curl -RL "$SRB2TOPDOWNASSET2URL" -o "$SRB2BLDROOT/assets/SRB2TD.zip.002"

            fi

            7z x -y "$SRB2BLDROOT/assets/SRB2TD.zip.001" "*.td" -o"$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/sonic-smash-brawl" ]; then

            if [ -n "$ISNET" ]; then

                if [ "$(curl -sLI "$SONICSMASHBRAWLASSET1URL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/SSB.zip.001" 2> /dev/null)" ]; then

                    rm -f "$SRB2BLDROOT/assets/SSB.zip"*
                    curl -RL "$SONICSMASHBRAWLASSET1URL" -o "$SRB2BLDROOT/assets/SSB.zip.001"
                    curl -RL "$SONICSMASHBRAWLASSET2URL" -o "$SRB2BLDROOT/assets/SSB.zip.002"

                fi

            fi

            7z e -y "$SRB2BLDROOT/assets/SSB.zip.001" "*/*.ssb" "*/*.dta" -o"$BUILD/assets/installer"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.0" ] || [ "$BUILD" = "$BUILDPATH/srb2-cb" ] || [ "$BUILD" = "$BUILDPATH/xsrb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ] || [ "$BUILD" = "$BUILDPATH/srb2-riders" ] || [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ] || [ "$BUILD" = "$BUILDPATH/sbb2" ]; then

        if [ -n "$ISNET" ]; then

            curl -RLC - "$SRB220ASSETURL" -o "$SRB2BLDROOT/assets/SRB2-2.0.exe"

        fi

        unrar x -y "$SRB2BLDROOT/assets/SRB2-2.0.exe" "*.plr" "*.dta" "*.wpn" "*.srb" "$BUILD/assets/installer"

        if [ "$BUILD" = "$BUILDPATH/srb2-cb" ]; then

            if [ -n "$ISNET" ]; then

                SRB2ASSETETAG=$(curl -X GET -sLI "$SRB2CBASSETURL" | gawk -F'etag: ' '{IGNORECASE=1} /etag/ {gsub("\r|\\"",""); print $NF}' 2> /dev/null | tail -n1)
                if [ "$SRB2ASSETETAG" != "$(7z l "$SRB2BLDROOT/assets/SRB2CB.zip" 2> /dev/null | gawk '/Comment/ {print $NF}')" ]; then

                    rm -f "$SRB2BLDROOT/assets/SRB2CB.zip"
                    curl -RL "$SRB2CBASSETURL" -o "$SRB2BLDROOT/assets/SRB2CB.zip"
                    zip -z "$SRB2BLDROOT/assets/SRB2CB.zip" << EOF
$SRB2ASSETETAG
EOF

                fi

            fi

            7z x -y "$SRB2BLDROOT/assets/SRB2CB.zip" "*.wad" -o"$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/xsrb2" ]; then

            cp -f "$BUILD/SRB2/branches/XMOD/bin/Resources/"* "$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ]; then

            if [ -n "$ISNET" ]; then

                SRB2ASSETETAG=$(curl -X GET -sLI https://archive.org/download/srb2-wads-archive/SF94%20City%20Old%20Version%208-28-10.zip | gawk -F'etag: ' '{IGNORECASE=1} /etag/ {gsub("\r|\\"",""); print $NF}' 2> /dev/null | tail -n1)
                if [ "$SRB2ASSETETAG" != "$(7z l "$SRB2BLDROOT/assets/SF94-City.zip" 2> /dev/null | gawk '/Comment/ {print $NF}')" ]; then

                    rm -f "$SRB2BLDROOT/assets/SF94-City.zip"
                    curl -RL https://archive.org/download/srb2-wads-archive/SF94%20City%20Old%20Version%208-28-10.zip -o "$SRB2BLDROOT/assets/SF94-City.zip"
                    zip -z "$SRB2BLDROOT/assets/SF94-City.zip" << EOF
$SRB2ASSETETAG
EOF

                fi

                curl -RL https://mb.srb2.org/attachments/metalsonic-zip.46 -o "$SRB2BLDROOT/assets/SF94-MetalSonic.zip"
                curl -RL https://mb.srb2.org/attachments/metalknux-zip.389 -o "$SRB2BLDROOT/assets/SF94-MetalKnux.zip"
                curl -RL https://mb.srb2.org/attachments/espio-zip.659 -o "$SRB2BLDROOT/assets/SF94-Espio.zip"
                curl -RL https://mb.srb2.org/attachments/nitemare-zip.1056 -o "$SRB2BLDROOT/assets/SF94-Nitemare.zip"
                curl -RL https://mb.srb2.org/attachments/senku-zip.1057 -o "$SRB2BLDROOT/assets/SF94-Senku.zip"
                curl -RL https://mb.srb2.org/attachments/senya-zip.363 -o "$SRB2BLDROOT/assets/SF94-Senya.zip"
                curl -RL https://mb.srb2.org/attachments/zim-rar.699 -o "$SRB2BLDROOT/assets/SF94-Zim.rar"

            fi

            7z x -y "$SRB2BLDROOT/assets/SF94-City.zip" "*.soc" "*.wad" -o"$BUILD/assets/installer"
            7z x -y "$SRB2BLDROOT/assets/SF94-MetalSonic.zip" -o"$BUILD/assets/installer"
            mv -f "$BUILD/assets/installer/metalsonic.wad" "$BUILD/assets/installer/SF94-Metalsonic.wad"
            7z x -y "$SRB2BLDROOT/assets/SF94-MetalKnux.zip" -o"$BUILD/assets/installer"
            mv -f "$BUILD/assets/installer/metalknux.wad" "$BUILD/assets/installer/SF94-Knux.wad"
            7z x -y "$SRB2BLDROOT/assets/SF94-Espio.zip" -o"$BUILD/assets/installer"
            mv -f "$BUILD/assets/installer/espio.wad" "$BUILD/assets/installer/SF94-Espio.wad"
            7z x -y "$SRB2BLDROOT/assets/SF94-Nitemare.zip" -o"$BUILD/assets/installer"
            mv -f "$BUILD/assets/installer/nitemare.wad" "$BUILD/assets/installer/SF94-Nitemare.wad"
            7z x -y "$SRB2BLDROOT/assets/SF94-Senku.zip" -o"$BUILD/assets/installer"
            mv -f "$BUILD/assets/installer/senku.wad" "$BUILD/assets/installer/SF94-Senku.wad"
            7z x -y "$SRB2BLDROOT/assets/SF94-Senya.zip" -o"$BUILD/assets/installer"
            mv -f "$BUILD/assets/installer/senya.wad" "$BUILD/assets/installer/SF94-Senya.wad"
            unrar x -y "$SRB2BLDROOT/assets/SF94-Zim.rar" "$BUILD/assets/installer"
            mv -f "$BUILD/assets/installer/Zim.wad" "$BUILD/assets/installer/SF94-Zim.wad"
            chmod 644 "$BUILD/assets/installer/"*

        elif [ "$BUILD" = "$BUILDPATH/srb2-riders" ]; then

            cp -f "$BUILD/SRB2/branches/RIDER/bin/Resources/"*.ridr "$BUILD/assets/installer"

            if [ -n "$ISNET" ]; then

                SRB2ASSETETAG=$(curl -X GET -sLI "$SRB2RIDERSMUSICASSETURL" | gawk -F'etag: ' '{IGNORECASE=1} /etag/ {gsub("\r|\\"",""); print $NF}' 2> /dev/null | tail -n1)
                if [ "$SRB2ASSETETAG" != "$(7z l "$SRB2BLDROOT/assets/SRB2RidersMusic.zip" 2> /dev/null | gawk '/Comment/ {print $NF}')" ]; then

                    rm -f "$SRB2BLDROOT/assets/SRB2RidersMusic.zip"
                    curl -RL "$SRB2RIDERSMUSICASSETURL" -o "$SRB2BLDROOT/assets/SRB2RidersMusic.zip"
                    zip -z "$SRB2BLDROOT/assets/SRB2RidersMusic.zip" << EOF
$SRB2ASSETETAG
EOF

                fi

            fi

            7z x -y "$SRB2BLDROOT/assets/SRB2RidersMusic.zip" -o"$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ]; then

            if [ -n "$ISNET" ]; then

                curl -RLC - "$SUPERSRB2KARTZASSETURL" -o "$SRB2BLDROOT/assets/SuperSRB2KartZ.zip"

            fi

            7z x -y "$SRB2BLDROOT/assets/SuperSRB2KartZ.zip" "*.kart" -o"$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/sbb2" ]; then

            cp -rf "$BUILD/SRB2/branches/FLAME/bin/Resources/BOMBFiles" "$BUILD/assets/installer"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-final-demo" ] || [ "$BUILD" = "$BUILDPATH/srb2-jte" ] || [ "$BUILD" = "$BUILDPATH/shufflarb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-live" ] || [ "$BUILD" = "$BUILDPATH/srb2-loz" ] || [ "$BUILD" = "$BUILDPATH/ssbss" ]; then

        if [ -n "$ISNET" ]; then

            curl -RLC - "$SRB2FINALDEMOASSETURL" -o "$SRB2BLDROOT/assets/SRB2FinalDemo.exe"

        fi

        unrar x -y "$SRB2BLDROOT/assets/SRB2FinalDemo.exe" "*.plr" "*.dta" "*.wpn" "*.srb" "3drend.dll" "$BUILD/assets/installer"

        if [ "$BUILD" = "$BUILDPATH/srb2-jte" ]; then

            if [ -n "$ISNET" ]; then

                curl -RLC - "$SRB2JTEASSETURL" -o "$SRB2BLDROOT/assets/SRB2JTE.zip"

            fi

            7z x -y "$SRB2BLDROOT/assets/SRB2JTE.zip" "*.wad" -o"$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/shufflarb2" ]; then

            cp -rf "$BUILD/SRB21094/branches/JTESHUFFLE/data/"* "$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/srb2-live" ]; then

            cp -rf "$BUILD/SRB21094/branches/LIVE/data/"* "$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/srb2-loz" ]; then

            cp -rf "$BUILD/SRB21094/branches/LOZ/data/"* "$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/ssbss" ]; then

            cp -rf "$BUILD/SRB21094/branches/FLAME/data/"* "$BUILD/assets/installer"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-1095" ]; then

        if [ -n "$ISNET" ]; then

            SRB21095ASSETURL=$(curl -sL "$SRB21095ASSETURL" | gawk -F'"' '/browser_download_url.*SRB2-1095-.*.zip/ {print $4}' | head -n1)
            if [ "$(curl -X GET -sLI "$SRB21095ASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/SRB21095.zip" 2> /dev/null)" ]; then

                rm -f "$SRB2BLDROOT/assets/SRB21095.zip"
                curl -RL "$SRB21095ASSETURL" -o "$SRB2BLDROOT/assets/SRB21095.zip"

            fi

        fi

        7z e -y "$SRB2BLDROOT/assets/SRB21095.zip" "*/*.plr" "*/*.dta" "*/*.wpn" "*/*.srb" -o"$BUILD/assets/installer"

    elif [ "$BUILD" = "$BUILDPATH/newmillennium" ]; then

        if [ -n "$ISNET" ]; then

            NEWMILLENNIUMASSETURL=$(curl -sL "$NEWMILLENNIUMASSETURL" | gawk -F'"' '/browser_download_url.*freedoom-.*.zip/ {print $4}' | head -n1)
            if [ "$(curl -X GET -sLI "$NEWMILLENNIUMASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/NewMillennium.zip" 2> /dev/null)" ]; then

                rm -f "$SRB2BLDROOT/assets/NewMillennium.zip"
                curl -RL "$NEWMILLENNIUMASSETURL" -o "$SRB2BLDROOT/assets/NewMillennium.zip"

            fi

        fi

        7z e -y "$SRB2BLDROOT/assets/NewMillennium.zip" "*/freedoom2.wad" -o"$BUILD/assets/installer"
        mv -f "$BUILD/assets/installer/freedoom2.wad" "$BUILD/assets/installer/DOOM2.WAD"
        cp -rf "$BUILD/Binaries/"* "$BUILD/assets/installer"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-galaxy" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-hep" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-saturn" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-neptune" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-vr" ] || [ "$BUILD" = "$BUILDPATH/blankart" ] || [ "$BUILD" = "$BUILDPATH/ring-racers" ] || [ "$BUILD" = "$BUILDPATH/ring-racers-noire" ] || [ "$BUILD" = "$BUILDPATH/ring-racers-hep" ] || [ "$BUILD" = "$BUILDPATH/ring-racers-freaky-build" ] || [ "$BUILD" = "$BUILDPATH/radio-racers" ]; then

        # Copying documentation and license file to installer path.
        cp -f "$BUILD/assets/"*.txt $(find "$BUILD" -name "README-SDL.txt" 2> /dev/null | head -n1) "$BUILD/assets/installer"

        if [ "$BUILD" = "$BUILDPATH/srb2-kart-hep" ]; then

            if [ -n "$ISNET" ]; then

                SRB2ASSETETAG=$(curl -X GET -sLI "$SRB2KARTHEPASSETURL" | gawk -F'etag: ' '{IGNORECASE=1} /etag/ {gsub("\r|\"",""); print $NF}' 2> /dev/null | tail -n1)
                if [ "$SRB2ASSETETAG" != "$(7z l "$SRB2BLDROOT/assets/SRB2KartHEP.zip" 2> /dev/null | gawk '/Comment/ {print $NF}')" ]; then

                    rm -f "$SRB2BLDROOT/assets/SRB2KartHEP.zip"
                    curl -RL "$SRB2KARTHEPASSETURL" -o "$SRB2BLDROOT/assets/SRB2KartHEP.zip"
                    zip -z "$SRB2BLDROOT/assets/SRB2KartHEP.zip" << EOF
$SRB2ASSETETAG
EOF

                fi

            fi

            7z e -y "$SRB2BLDROOT/assets/SRB2KartHEP.zip" "*/*.kart" -o"$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/srb2-kart-saturn" ]; then

            if [ -n "$ISNET" ]; then

                SRB2KARTSATURNASSETURL=$(curl -sL "$SRB2KARTSATURNASSETURL" | gawk -F'"' '/browser_download_url.*Just-Extra.*Files.zip/ {print $4}' | head -n1)
                if [ "$(curl -X GET -sLI "$SRB2KARTSATURNASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/SRB2KartSaturn.zip" 2> /dev/null)" ]; then

                    rm -f "$SRB2BLDROOT/assets/SRB2KartSaturn.zip"
                    curl -RL "$SRB2KARTSATURNASSETURL" -o "$SRB2BLDROOT/assets/SRB2KartSaturn.zip"

                fi

            fi

            7z x -y "$SRB2BLDROOT/assets/SRB2KartSaturn.zip" -o"$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/srb2-kart-neptune" ]; then

            if [ -n "$ISNET" ]; then

                SRB2KARTNEPTUNEASSETURL=$(curl -sL "$SRB2KARTNEPTUNEASSETURL" | gawk -F'"' '/browser_download_url.*64Bit.zip/ {print $4}' | head -n1)
                if [ "$(curl -X GET -sLI "$SRB2KARTNEPTUNEASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/SRB2KartNeptune.zip" 2> /dev/null)" ]; then

                    rm -f "$SRB2BLDROOT/assets/SRB2KartNeptune.zip"
                    curl -RL "$SRB2KARTNEPTUNEASSETURL" -o "$SRB2BLDROOT/assets/SRB2KartNeptune.zip"

                fi

            fi

            7z e -y "$SRB2BLDROOT/assets/SRB2KartNeptune.zip" "*/*.kart" -o"$BUILD/assets/installer"

        elif [ "$BUILD" = "$BUILDPATH/blankart" ]; then

            if [ -n "$ISNET" ] && [ "$(curl -X GET -sLI "$BLANKARTASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/BlanKart.zip" 2> /dev/null)" ]; then

                rm -f "$SRB2BLDROOT/assets/BlanKart.zip"
                curl -RL "$BLANKARTASSETURL" -o "$SRB2BLDROOT/assets/BlanKart.zip"

            fi

            # Create assets using blankart-assets repository for BlanKart.
            7z x -y "$SRB2BLDROOT/assets/BlanKart.zip" -o"$BUILD/build"

            for a in $(ls -d "$BUILD/build/blankart-assets/src/"* | gawk -F'/' '{print $NF}'); do

                7z a -y -tzip -mx=0 "$BUILD/assets/installer/$a.pk3" "$BUILD/build/blankart-assets/src/$a/"*

            done

        elif [ "$BUILD" = "$BUILDPATH/ring-racers" ] || [ "$BUILD" = "$BUILDPATH/ring-racers-noire" ] || [ "$BUILD" = "$BUILDPATH/ring-racers-hep" ] || [ "$BUILD" = "$BUILDPATH/ring-racers-freaky-build" ] || [ "$BUILD" = "$BUILDPATH/radio-racers" ]; then

            find "$BUILD/assets/installer" -type d -exec chmod -R 755 {} \;

            if [ "$BUILD" = "$BUILDPATH/ring-racers-freaky-build" ]; then

                # Temporarily until Freaky Build will be fully ported to v2.4.
                if [ "$(curl -X GET -sLI "https://github.com/KartKrewDev/RingRacers/releases/download/v2.3/Dr.Robotnik.s-Ring-Racers-v2.3-Installer.exe" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -c %s "$SRB2BLDROOT/assets/RingRacers-2.3.exe" 2> /dev/null)" ]; then

                    rm -f "$SRB2BLDROOT/assets/RingRacers-2.3.exe"
                    curl -RL "https://github.com/KartKrewDev/RingRacers/releases/download/v2.3/Dr.Robotnik.s-Ring-Racers-v2.3-Installer.exe" -o "$SRB2BLDROOT/assets/RingRacers-2.3.exe"

                fi

                7z x -y "$SRB2BLDROOT/assets/RingRacers-2.3.exe" "*.pk3" "*.dat" "data/*" "models/*" -o"$BUILD/assets/installer"
                cp -f "$BUILD/!REQUIRED ASSETS/"*.pk3 "$BUILD/assets/installer"
                find "$BUILD/assets/installer" -type d -exec chmod -R 755 {} \;

            elif [ "$BUILD" = "$BUILDPATH/radio-racers" ]; then

                if [ -n "$ISNET" ]; then

                    RADIORACERSASSETURL=$(curl -sL "$RADIORACERSASSETURL" | gawk -F'"' '/browser_download_url.*radioracers_assets.zip/ {print $4}' | head -n1)
                    if [ "$(curl -X GET -sLI "$RADIORACERSASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/RadioRacers.zip" 2> /dev/null)" ]; then

                        rm -f "$SRB2BLDROOT/assets/RadioRacers.zip"
                        curl -RL "$RADIORACERSASSETURL" -o "$SRB2BLDROOT/assets/RadioRacers.zip"

                    fi

                fi

                7z x -y "$SRB2BLDROOT/assets/RadioRacers.zip" -o"$BUILD/assets/installer"

            fi

        fi

        if [ "$GITVER" = "$GITDEFVER" ] && [ "$BUILD" != "$BUILDPATH/ring-racers-freaky-build" ]; then

            extractsrb2kartmacosassets

        fi

    elif [ "$(dirname $BUILD)" = "$BUILDPATH/srb2-custom" ]; then

        if [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "SRB2" ]; then

            extractsrb2macosassets

        elif [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "SRB2Kart" ] || [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

            extractsrb2kartmacosassets

        else

            extractsrb2macosassets

        fi

    fi
}

extractmacoscustomassets() {
    BUILDPREFIX=$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')

    # Copying documentation and license file to installer path.
    cp -f "$BUILD/assets/"*.txt $(find "$BUILD" -name "README-SDL.txt" 2> /dev/null | head -n1) "$BUILD/assets/installer"

    # Download and extract assets for custom build.
    if [ -z "$ISNET" ] && [ -n "$SRB2BLDASSETPATH" ]; then

        if [ -f "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk -F'/' '{print $NF}')" ]; then

            FILETYPE=$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk -F'.' '{print $NF}' 2> /dev/null | tail -n1)
            SRB2BLDASSETPATH="$SRB2BLDASSETPATH"

        else

            FILETYPE=$(find "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER."* 2> /dev/null | gawk -F'.' '{print $NF}' | head -n1)
            SRB2BLDASSETPATH="$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER.$FILETYPE"

        fi

    elif [ -n "$ISNET" ] && [ -n "$SRB2BLDASSETPATH" ]; then

        if [ -n "$(find "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER."* 2> /dev/null | head -n1)" ] && [ "$(curl -X GET -sLI "$SRB2BLDASSETPATH" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" = "$(stat -f %z "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER."* 2> /dev/null)" ]; then

            FILETYPE=$(find "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER."* 2> /dev/null | gawk -F'.' '{print $NF}' | head -n1)
            SRB2BLDASSETPATH="$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER.$FILETYPE"

        elif [ -n "$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk '/drive.google.com/ {print}')" ] || [ -n "$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk '/drive.usercontent.google.com/ {print}')" ]; then

            SRB2ASSETID=$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk '{gsub("https://drive.google.com/file/d/|https://drive.usercontent.google.com/download\\?id=|&export=download|/view|/edit|\\?usp=sharing",""); print}')
            SRB2BLDASSETPATH="https://drive.usercontent.google.com/download?confirm=t&id=$SRB2ASSETID"
            FILETYPE=$(curl -X GET -sLI "$SRB2BLDASSETPATH" | gawk -F'.' '/content-disposition:/ {gsub("\r|\"",""); print $NF}')

        elif [ -n "$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk '/mega.nz/ {print}')" ]; then

            MEGANZFILENAME=$(megatools dl "$SRB2BLDASSETPATH" --print-names --path "/tmp" | gawk -F'/' '/^F/ {print $NF}')
            FILETYPE=$($PRINTF "%s\n" "$MEGANZFILENAME" | gawk -F'.' '{print $NF}')

        else

            SRB2BLDASSETPATH="$SRB2BLDASSETPATH"

            if [ -n "$(curl -X GET -sLI "$SRB2BLDASSETPATH" | gawk '/HTTP\/2 200/ {print}' 2> /dev/null | head -n1)" ] || [ -f "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk -F'/' '{print $NF}')" ]; then

                FILETYPE=$(curl -X GET -sLI "$SRB2BLDASSETPATH" | gawk -F'.' '/content-disposition:/ {gsub("\r|\"",""); print $NF}' 2> /dev/null | tail -n1)

                if [ -z "$FILETYPE" ]; then

                    FILETYPE="$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk -F'.' '{print $NF}' 2> /dev/null | tail -n1)"

                fi

            else

                FILETYPE=$(find "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER."* 2> /dev/null | gawk -F'.' '{print $NF}' | head -n1)

            fi

        fi

    elif [ -z "$SRB2BLDASSETPATH" ]; then

        extractmacosassets

    fi

    if [ -n "$ISNET" ] && [ -n "$(curl -X GET -vI "$SRB2BLDASSETPATH" 2>&1 | gawk '/> Host:/ {gsub("\r",""); print $NF}')" ] && [ "$(curl -X GET -sLI "$SRB2BLDASSETPATH" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk -F'/' '{print $NF}')" 2> /dev/null)" ] && ([ "$FILETYPE" = "pk3" ] || [ "$FILETYPE" = "dta" ] || [ "$FILETYPE" = "wad" ] || [ "$FILETYPE" = "kart" ]); then

        rm -f "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk -F'/' '{print $NF}')"
        curl -RL "$SRB2BLDASSETPATH" -o "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk -F'/' '{print $NF}')"

    elif [ -n "$ISNET" ] && [ -n "$(curl -X GET -vI "$SRB2BLDASSETPATH" 2>&1 | gawk '/> Host:/ {gsub("\r",""); print $NF}')" ] && [ "$(curl -X GET -sLI "$SRB2BLDASSETPATH" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER.$FILETYPE" 2> /dev/null)" ] && ([ "$FILETYPE" != "pk3" ] && [ "$FILETYPE" != "dta" ] && [ "$FILETYPE" != "wad" ] && [ "$FILETYPE" != "kart" ]); then

        rm -f "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER.$FILETYPE"

        if [ -n "$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk '/drive.google.com/ {print}')" ] || [ -n "$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk '/drive.usercontent.google.com/ {print}')" ]; then

            curl -RL "https://drive.usercontent.google.com/download?confirm=t&id=$SRB2ASSETID" -o"$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER.$FILETYPE"

        elif [ -n "$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk '/mega.nz/ {print}')" ]; then

            mv -f "/tmp/$MEGANZFILENAME" "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER.$FILETYPE"

        else

            curl -RL "$SRB2BLDASSETPATH" -o "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER.$FILETYPE"

        fi

    fi

    if [ -f "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk -F'/' '{print $NF}')" ] && ([ "$FILETYPE" = "pk3" ] || [ "$FILETYPE" = "dta" ] || [ "$FILETYPE" = "wad" ] || [ "$FILETYPE" = "kart" ]); then

        cp -f "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk -F'/' '{print $NF}')" "$BUILD/assets/installer"

    elif [ -n "$(find "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER.$FILETYPE" 2> /dev/null | head -n1)" ]; then

        if [ "$FILETYPE" = "rar" ]; then

            if [ "$ANDROID" = "1" ]; then

                unrar x -y "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER.rar" -x"*.exe" -x"*.txt" -x"*.md" -x"*.dll" "$BUILD/android/app/src/main/assets"

            else

                unrar x -y "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER.rar" -x"*.exe" -x"*.txt" -x"*.md" -x"*.dll" "$BUILD/assets/installer"

            fi

        else

            if [ "$ANDROID" = "1" ]; then

                7z x -y "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER.$FILETYPE" -x!"*.exe" -x!"*.txt" -x!"*.md" -x!"*.dll" -o"$BUILD/android/app/src/main/assets"

            else

                7z x -y "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER.$FILETYPE" -x!"*.exe" -x!"*.txt" -x!"*.md" -x!"*.dll" -o"$BUILD/assets/installer"

            fi

        fi

        # Removing empty subdirectories.
        if [ "$ANDROID" = "1" ]; then

            for i in $(find "$BUILD/android/app/src/main/assets" -mindepth 1 -maxdepth 1 -type d); do

                if [ "$(find $i -mindepth 1 -maxdepth 1 | gawk -F'/' '{print $(NF-1)}' | wc -l)" -eq "0" ]; then

                    rm -rf "$i"

                fi

            done

        else

            for i in $(find "$BUILD/assets/installer" -mindepth 1 -maxdepth 1 -type d); do

                if [ "$(find $i -mindepth 1 -maxdepth 1 | gawk -F'/' '{print $(NF-1)}' | wc -l)" -eq "0" ]; then

                    rm -rf "$i"

                fi

            done

        fi

        if [ "$(find "$BUILD/assets/installer" -mindepth 1 -maxdepth 1 2> /dev/null | wc -l)" -eq "1" ]; then

            mv -f "$BUILD/assets/installer/"*/* "$BUILD/assets/installer"

        fi

    fi

    extractmacosextracustomassets

    # Correcting permissions for model directories.
    if [ "$ANDROID" = "1" ]; then

        find "$BUILD/android/app/src/main/assets" -type d -exec chmod -R 755 {} \;

    elif [ -n "$(find "$BUILD/assets/installer" -mindepth 1 -maxdepth 1 -type d 2> /dev/null | head -n1)" ]; then

        find "$BUILD/assets/installer" -type d -exec chmod -R 755 {} \;

    fi
}

extractmacosextracustomassets() {
    # Download and extract extra assets for custom build.
    if [ -z "$ISNET" ] && [ -n "$SRB2BLDEXTRAASSETPATH" ]; then

        if [ -f "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print $NF}')" ]; then

            FILETYPE=$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk -F'.' '{print $NF}' 2> /dev/null | tail -n1)
            SRB2BLDEXTRAASSETPATH="$SRB2BLDEXTRAASSETPATH"

        else

            FILETYPE=$(find "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras."* 2> /dev/null | gawk -F'.' '{print $NF}' | head -n1)
            SRB2BLDEXTRAASSETPATH="$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.$FILETYPE"

        fi

    elif [ -n "$ISNET" ] && [ -n "$SRB2BLDEXTRAASSETPATH" ]; then

        if [ -n "$(find "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras."* 2> /dev/null | head -n1)" ] && [ "$(curl -X GET -sLI "$SRB2BLDEXTRAASSETPATH" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" = "$(stat -f %z "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras."* 2> /dev/null)" ]; then

            FILETYPE=$(find "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras."* 2> /dev/null | gawk -F'.' '{print $NF}' | head -n1)
            SRB2BLDEXTRAASSETPATH="$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.$FILETYPE"

        elif [ -n "$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk '/drive.google.com/ {print}')" ] || [ -n "$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk '/drive.usercontent.google.com/ {print}')" ]; then

            SRB2ASSETID=$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk '{gsub("https://drive.google.com/file/d/|https://drive.usercontent.google.com/download\\?id=|&export=download|/view|/edit|\\?usp=sharing",""); print}')
            SRB2BLDEXTRAASSETPATH="https://drive.usercontent.google.com/download?confirm=t&id=$SRB2ASSETID"
            FILETYPE=$(curl -X GET -sLI "$SRB2BLDEXTRAASSETPATH" | gawk -F'.' '/content-disposition:/ {gsub("\r|\"",""); print $NF}')

        elif [ -n "$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk '/mega.nz/ {print}')" ]; then

            MEGANZFILENAME=$(megatools dl "$SRB2BLDEXTRAASSETPATH" --print-names --path "/tmp" | gawk -F'/' '/^F/ {print $NF}')
            FILETYPE=$($PRINTF "%s\n" "$MEGANZFILENAME" | gawk -F'.' '{print $NF}')

        else

            SRB2BLDEXTRAASSETPATH="$SRB2BLDEXTRAASSETPATH"

            if [ -n "$(curl -X GET -sLI "$SRB2BLDEXTRAASSETPATH" | gawk '/HTTP\/2 200/ {print}' 2> /dev/null | head -n1)" ] || [ -f "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print $NF}')" ]; then

                FILETYPE=$(curl -X GET -sLI "$SRB2BLDEXTRAASSETPATH" | gawk -F'.' '/content-disposition:/ {gsub("\r|\"",""); print $NF}' 2> /dev/null | tail -n1)

                if [ -z "$FILETYPE" ]; then

                    FILETYPE="$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk -F'.' '{print $NF}' 2> /dev/null | tail -n1)"

                fi

            else

                FILETYPE=$(find "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras."* 2> /dev/null | gawk -F'.' '{print $NF}' | head -n1)

            fi

        fi

    fi

    if [ -n "$ISNET" ] && [ -n "$(curl -X GET -vI "$SRB2BLDEXTRAASSETPATH" 2>&1 | gawk '/> Host:/ {gsub("\r",""); print $NF}')" ] && [ "$(curl -X GET -sLI "$SRB2BLDEXTRAASSETPATH" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print $NF}')" 2> /dev/null)" ] && ([ "$FILETYPE" = "pk3" ] || [ "$FILETYPE" = "dta" ] || [ "$FILETYPE" = "wad" ] || [ "$FILETYPE" = "kart" ]); then

        rm -f "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print $NF}')"
        curl -RL "$SRB2BLDEXTRAASSETPATH" -o "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print $NF}')"

    elif [ -n "$ISNET" ] && [ -n "$(curl -X GET -vI "$SRB2BLDEXTRAASSETPATH" 2>&1 | gawk '/> Host:/ {gsub("\r",""); print $NF}')" ] && [ "$(curl -X GET -sLI "$SRB2BLDEXTRAASSETPATH" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.$FILETYPE" 2> /dev/null)" ] && ([ "$FILETYPE" != "pk3" ] && [ "$FILETYPE" != "dta" ] && [ "$FILETYPE" != "wad" ] && [ "$FILETYPE" != "kart" ]); then

        rm -f "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.$FILETYPE"

        if [ -n "$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk '/drive.google.com/ {print}')" ] || [ -n "$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk '/drive.usercontent.google.com/ {print}')" ]; then

            curl -RL "https://drive.usercontent.google.com/download?confirm=t&id=$SRB2ASSETID" -o"$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.$FILETYPE"

        elif [ -n "$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk '/mega.nz/ {print}')" ]; then

            mv -f "/tmp/$MEGANZFILENAME" "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.$FILETYPE"

        else

            curl -RL "$SRB2BLDEXTRAASSETPATH" -o "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.$FILETYPE"

        fi

    fi

    if [ -f "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print $NF}')" ] && ([ "$FILETYPE" = "pk3" ] || [ "$FILETYPE" = "dta" ] || [ "$FILETYPE" = "wad" ] || [ "$FILETYPE" = "kart" ]); then

        if [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

            cp -f "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print $NF}')" "$BUILD/assets/installer/data"

        else

            cp -f "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print $NF}')" "$BUILD/assets/installer"

        fi

    elif [ -n "$(find "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.$FILETYPE" 2> /dev/null | head -n1)" ]; then

        if [ "$FILETYPE" = "rar" ]; then

            if [ "$ANDROID" = "1" ]; then

                unrar e -y "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.rar" -x"*.exe" -x"*.txt" -x"*.md" -x"*.dll" "$BUILD/android/app/src/main/assets"

            elif [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

                unrar e -y "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.rar" -x"*.exe" -x"*.txt" -x"*.md" -x"*.dll" "$BUILD/assets/installer/data"

            else

                unrar e -y "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.rar" -x"*.exe" -x"*.txt" -x"*.md" -x"*.dll" "$BUILD/assets/installer"

            fi

        else

            if [ "$ANDROID" = "1" ]; then

                7z e -y -r "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.$FILETYPE" -x!"*.exe" -x!"*.txt" -x!"*.md" -x!"*.dll" -o"$BUILD/android/app/src/main/assets"

            elif [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

                7z e -y -r "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.$FILETYPE" -x!"*.exe" -x!"*.txt" -x!"*.md" -x!"*.dll" -o"$BUILD/assets/installer/data"

            else

                7z e -y -r "$SRB2BLDROOT/assets/$BUILDPREFIX-$GITVER-extras.$FILETYPE" -x!"*.exe" -x!"*.txt" -x!"*.md" -x!"*.dll" -o"$BUILD/assets/installer"

            fi

        fi

        # Removing empty subdirectories.
        if [ "$ANDROID" = "1" ]; then

            for i in $(find "$BUILD/android/app/src/main/assets" -mindepth 1 -maxdepth 1 -type d); do

                if [ "$(find $i -mindepth 1 -maxdepth 1 | gawk -F'/' '{print $(NF-1)}' | wc -l)" -eq "0" ]; then

                    rm -rf "$i"

                fi

            done

        else

            for i in $(find "$BUILD/assets/installer" -mindepth 1 -maxdepth 1 -type d); do

                if [ "$(find $i -mindepth 1 -maxdepth 1 | gawk -F'/' '{print $(NF-1)}' | wc -l)" -eq "0" ]; then

                    rm -rf "$i"

                fi

            done

        fi

        if [ "$(find "$BUILD/assets/installer" -mindepth 1 -maxdepth 1 2> /dev/null | wc -l)" -eq "1" ]; then

            mv -f "$BUILD/assets/installer/"*/* "$BUILD/assets/installer"

        fi

    fi
}

extractsrb2macosassets() {
    if [ -n "$ISNET" ]; then

        SRB2LATESTVER=$(curl -sL "$SRB2ASSETURL" | gawk -F':|_' '/tag_name/ {gsub("\"|,| ",""); print $NF}' | head -n1)

    fi

    SRB2VER=$(gawk -F'\"' '/SRB2VERSION/ {print $2}' "$BUILD/src/version.h" 2> /dev/null || $PRINTF "%s\n" "$SRB2LATESTVER")

    if [ "$BUILD" = "$BUILDPATH/srb2-persona" ]; then

        SRB2VER=$(gawk -F'- v|- ' '/v[0-9]/ {print $2}' "$BUILD/src/config.h.in" 2> /dev/null | gawk '{gsub(" ",""); print}' | tail -n1 || $PRINTF "%s\n" "$SRB2LATESTVER")

    fi

    if [ -n "$SRB2LATESTVER" ] && ([ "$SRB2VER" != "$SRB2LATESTVER" ] && [ "$($PRINTF "$SRB2VER" | gawk '{gsub("\\.|-|[a-z]|[A-Z]",""); print}')" -lt "$($PRINTF "$SRB2LATESTVER" | gawk '{gsub("\\.|-|[a-z]|[A-Z]",""); print}')" ]); then

        if [ -n "$ISNET" ]; then

            SRB2OLDASSETURL=$(curl -sL "$SRB2ASSETURL" | gawk -F'"' '/'SRB2_release_$SRB2VER'\/.*Full.zip/ {print $4}')

            if [ -z "$SRB2OLDASSETURL" ]; then

                SRB2ASSETURL=$(curl -sL "$SRB2ASSETURL" | gawk -F'"' '/browser_download_url.*Full.zip/ {print $4}' | head -n1)
                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Couldn't fetch older assets. Downloading and extracting $BUILDNAME's latest assets. Please wait..."

            else

                SRB2ASSETURL="$SRB2OLDASSETURL"

            fi

            if [ "$(curl -X GET -sLI "$SRB2ASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/SRB2-$SRB2VER.zip" 2> /dev/null)" ]; then

                rm -f "$SRB2BLDROOT/assets/SRB2-$SRB2VER.zip"
                curl -RL "$SRB2ASSETURL" -o "$SRB2BLDROOT/assets/SRB2-$SRB2VER.zip"

            fi

        fi

        if [ "$BUILD" = "$BUILDPATH/srb2-2.2-classic" ]; then

            7z x -y "$SRB2BLDROOT/assets/SRB2-$SRB2VER.zip" "*.dat" "*.txt" "models/*" -o"$BUILD/assets/installer"

        else

            7z x -y "$SRB2BLDROOT/assets/SRB2-$SRB2VER.zip" "*.pk3" "*.dta" "*.dat" "*.txt" "models/*" -o"$BUILD/assets/installer"

        fi

    else

        if [ -n "$ISNET" ]; then

            SRB2ASSETURL=$(curl -sL "$SRB2ASSETURL" | gawk -F'"' '/browser_download_url.*Full.zip/ {print $4}' | head -n1)

            if [ "$(curl -X GET -sLI "$SRB2ASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/SRB2-Latest.zip" 2> /dev/null)" ]; then

                rm -f "$SRB2BLDROOT/assets/SRB2-Latest.zip"
                curl -RL "$SRB2ASSETURL" -o "$SRB2BLDROOT/assets/SRB2-Latest.zip"

            fi

        fi

        if [ "$BUILD" = "$BUILDPATH/srb2-2.2-classic" ]; then

            7z x -y "$SRB2BLDROOT/assets/SRB2-Latest.zip" "*.dat" "*.txt" "models/*" -o"$BUILD/assets/installer"

        else

            7z x -y "$SRB2BLDROOT/assets/SRB2-Latest.zip" "*.pk3" "*.dta" "*.dat" "*.txt" "models/*" -o"$BUILD/assets/installer"

        fi

    fi

    find "$BUILD/assets/installer" -type d -exec chmod -R 755 {} \;
}

extractsrb2kartmacosassets() {
    if [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

        if [ -n "$ISNET" ]; then

            RINGRACERSVERS=$(curl -sL "$RINGRACERSASSETURL" | gawk -F':|_' '/tag_name/ {gsub("\"|,| ",""); print $NF}')

        fi

        RINGRACERSLATESTVER=$($PRINTF "%s\n" "$RINGRACERSVERS" | head -n1)
        RINGRACERSVER=$(gawk -F'\"' '/SRB2VERSION/ {print $2}' "$BUILD/src/version.h" 2> /dev/null || $PRINTF "%s\n" "$RINGRACERSLATESTVER")
        RINGRACERSBETAVER=$(gawk -F'\"' '/BETAVERSION/ {print tolower($2)}' "$BUILD/src/version.h" 2> /dev/null || true)

        if [ -n "$ISNET" ]; then

            RINGRACERSBETAASSETURL=$(curl -sL "$RINGRACERSASSETURL" | gawk -F'"' '/browser_download_url.*'$RINGRACERSVER'.*'$RINGRACERSBETAVER'.*Installer.exe/ {print $4}')

        fi

        if ([ -n "$RINGRACERSLATESTVER" ] && ([ "v$RINGRACERSVER" != "$RINGRACERSLATESTVER" ] && [ "$($PRINTF "$RINGRACERSVER" | gawk '{gsub("\\.|-|[a-z]|[A-Z]",""); print}')" -lt "$($PRINTF "$RINGRACERSLATESTVER" | gawk '{gsub("\\.|-|[a-z]|[A-Z]",""); print}')" ])) || [ -n "$RINGRACERSBETAASSETURL" ]; then

            if [ -n "$RINGRACERSBETAVER" ] && [ -n "$RINGRACERSBETAASSETURL" ]; then

                RINGRACERSCOMBINEDVER="$RINGRACERSVER-$RINGRACERSBETAVER"

            else

                RINGRACERSCOMBINEDVER="$RINGRACERSVER"

            fi

            if [ -n "$ISNET" ]; then

                if [ -z "$RINGRACERSBETAASSETURL" ]; then

                    RINGRACERSOLDASSETURL=$(curl -sL "$RINGRACERSASSETURL" | gawk -F'"' '/browser_download_url.*'$RINGRACERSVER'.*Installer.exe/ {print $4}')

                    if [ -z "$RINGRACERSOLDASSETURL" ]; then

                        RINGRACERSASSETURL=$(curl -sL "$RINGRACERSASSETURL" | gawk -F'"' '/browser_download_url.*Installer.exe/ {print $4}' | head -n1)
                        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Couldn't fetch older assets. Downloading and extracting $BUILDNAME's latest assets. Please wait..."

                    else

                        RINGRACERSASSETURL="$RINGRACERSOLDASSETURL"

                    fi

                else

                    RINGRACERSASSETURL="$RINGRACERSBETAASSETURL"

                fi

                if [ "$(curl -X GET -sLI "$RINGRACERSASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/RingRacers-$RINGRACERSCOMBINEDVER.exe" 2> /dev/null)" ]; then

                    rm -f "$SRB2BLDROOT/assets/RingRacers-$RINGRACERSCOMBINEDVER.exe"
                    curl -RL "$RINGRACERSASSETURL" -o "$SRB2BLDROOT/assets/RingRacers-$RINGRACERSCOMBINEDVER.exe"

                fi

            fi

            if [ -n "$(7z l "$SRB2BLDROOT/assets/RingRacers-$RINGRACERSCOMBINEDVER.exe" | gawk '/Type = Rar/ {print}')" ]; then

                unrar x -y "$SRB2BLDROOT/assets/RingRacers-$RINGRACERSCOMBINEDVER.exe" "*.pk3" "*.dat" "*.txt" "data/*" "models/*" "$BUILD/assets/installer"

            else

                7z x -y "$SRB2BLDROOT/assets/RingRacers-$RINGRACERSCOMBINEDVER.exe" "*.pk3" "*.dat" "*.txt" "data/*" "models/*" -o"$BUILD/assets/installer"

            fi

        else

            if [ -n "$ISNET" ]; then

                RINGRACERSASSETURL=$(curl -sL "$RINGRACERSASSETURL" | gawk -F'"' '/browser_download_url.*Installer.exe/ {print $4}' | head -n1)

                if [ "$(curl -X GET -sLI "$RINGRACERSASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/RingRacers-Latest.exe" 2> /dev/null)" ]; then

                    rm -f "$SRB2BLDROOT/assets/RingRacers-Latest.exe"
                    curl -RL "$RINGRACERSASSETURL" -o "$SRB2BLDROOT/assets/RingRacers-Latest.exe"

                fi

            fi

            if [ -n "$(7z l "$SRB2BLDROOT/assets/RingRacers-Latest.exe" | gawk '/Type = Rar/ {print}')" ]; then

                unrar x -y "$SRB2BLDROOT/assets/RingRacers-Latest.exe" "*.pk3" "*.dat" "*.txt" "data/*" "models/*" "$BUILD/assets/installer"

            else

                7z x -y "$SRB2BLDROOT/assets/RingRacers-Latest.exe" "*.pk3" "*.dat" "*.txt" "data/*" "models/*" -o"$BUILD/assets/installer"

            fi

        fi

        find "$BUILD/assets/installer" -type d -exec chmod -R 755 {} \;

    else

        if [ -n "$ISNET" ]; then

            SRB2KARTVERS=$(curl -sL "$SRB2KARTASSETURL" | gawk -F':|_' '/tag_name/ {gsub("\"|,| ",""); print $NF}')

        fi

        SRB2KARTLATESTVER=$($PRINTF "%s\n" "$SRB2KARTVERS" | head -n1)

        if [ "$BUILD" = "$BUILDPATH/blankart" ]; then

            SRB2KARTVER=$(gawk -F'\"' '/SRB2VERSION/ {print $2}' "$BUILD/src/version.h" 2> /dev/null || $PRINTF "%s\n" "$SRB2KARTLATESTVER")

        else

            SRB2KARTVER=$(gawk -F'- [A-z]*[0-9]*' '/v[0-9]/ {print $2}' "$BUILD/src/config.h.in" 2> /dev/null | gawk '{gsub(" ",""); print}' | tail -n1 || $PRINTF "%s\n" "$SRB2KARTLATESTVER")

        fi

        if [ -n "$SRB2KARTLATESTVER" ] && ([ "$SRB2KARTVER" != "$SRB2KARTLATESTVER" ] && [ "$($PRINTF "$SRB2KARTVER" | gawk '{gsub("\\.|-|[a-z]|[A-Z]",""); print}')" -lt "$($PRINTF "$SRB2KARTLATESTVER" | gawk '{gsub("\\.|-|[a-z]|[A-Z]",""); print}')" ]); then

            if [ -n "$ISNET" ]; then

                SRB2KARTOLDASSETURL=$(curl -sL "$SRB2KARTASSETURL" | gawk -F'"' '/'$SRB2KARTVER'\/.*Installer.exe/ {print $4}')

                if [ -z "$SRB2KARTOLDASSETURL" ]; then

                    SRB2KARTASSETURL=$(curl -sL "$SRB2KARTASSETURL" | gawk -F'"' '/browser_download_url.*Installer.exe/ {print $4}' | head -n1)
                    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Couldn't fetch older assets. Downloading and extracting $BUILDNAME's latest assets. Please wait..."

                else

                    SRB2KARTASSETURL="$SRB2KARTOLDASSETURL"

                fi

                if [ "$(curl -X GET -sLI "$SRB2KARTASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/SRB2Kart-$SRB2KARTVER.exe" 2> /dev/null)" ]; then

                    rm -f "$SRB2BLDROOT/assets/SRB2Kart-$SRB2KARTVER.exe"
                    curl -RL "$SRB2KARTASSETURL" -o "$SRB2BLDROOT/assets/SRB2Kart-$SRB2KARTVER.exe"

                fi

            fi

            if [ -n "$(7z l "$SRB2BLDROOT/assets/SRB2Kart-$SRB2KARTVER.exe" | gawk '/Type = Rar/ {print}')" ]; then

                unrar x -y "$SRB2BLDROOT/assets/SRB2Kart-$SRB2KARTVER.exe" "*.kart" "*.srb" "*.dat" "mdls/*" "$BUILD/assets/installer"

            else

                7z x -y "$SRB2BLDROOT/assets/SRB2Kart-$SRB2KARTVER.exe" "*.kart" "*.srb" "*.dat" "mdls/*" -o"$BUILD/assets/installer"

            fi

        else

            if [ -n "$ISNET" ]; then

                SRB2KARTASSETURL=$(curl -sL "$SRB2KARTASSETURL" | gawk -F'"' '/browser_download_url.*Installer.exe/ {print $4}' | head -n1)

                if [ "$(curl -X GET -sLI "$SRB2KARTASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/SRB2Kart-Latest.exe" 2> /dev/null)" ]; then

                    rm -f "$SRB2BLDROOT/assets/SRB2Kart-Latest.exe"
                    curl -RL "$SRB2KARTASSETURL" -o "$SRB2BLDROOT/assets/SRB2Kart-Latest.exe"

                fi

            fi

            if [ -n "$(7z l "$SRB2BLDROOT/assets/SRB2Kart-Latest.exe" | gawk '/Type = Rar/ {print}')" ]; then

                unrar x -y "$SRB2BLDROOT/assets/SRB2Kart-Latest.exe" "*.kart" "*.srb" "*.dat" "mdls/*" "$BUILD/assets/installer"

            else

                7z x -y "$SRB2BLDROOT/assets/SRB2Kart-Latest.exe" "*.kart" "*.srb" "*.dat" "mdls/*" -o"$BUILD/assets/installer"

            fi

        fi

        find "$BUILD/assets/installer" -type d -exec chmod -R 755 {} \;

    fi
}

fetchupdatebuild() {
    ISNET=$(curl -vI https://github.com 2>&1 | gawk '/> Host:/ {gsub("\r",""); print $NF}')

    if [ "$(dirname $BUILD)" = "$BUILDPATH/srb2-custom" ] && [ "$UPGRADE" != "1" ]; then

        GIT="git clone $GITOPTS $($PRINTF $SRB2BLDGITPATH | gawk '{gsub(".git$",""); print}').git --recursive $GITVER"

    else

        GIT="git clone $GITOPTS $GITURL --recursive"

    fi

    # Download or update build's source code.
    if [ ! -d "$BUILD/.git" ] && [ -n "$ISNET" ]; then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading $BUILDNAME's source code. Please wait..."
        $GIT "$BUILD"
        git -C "$BUILD" checkout -q $($PRINTF "$GITVER" | gawk '{print $NF}') --

    elif [ -d "$BUILD/.git" ] && [ -n "$GITURL" ] && [ $(git -C "$BUILD" remote -v 2> /dev/null | gawk '/fetch/ {print $2}') != "$GITURL" ] && [ -n "$ISNET" ]; then

        # Replace build, if variable GITURL was updated to new Git repository.
        if [ -f "$BUILD/.comrev" ] && [ -n "$(cat "$BUILD/.comrev")" ]; then

            CONF=$(cat "$BUILD/.comrev")

        fi

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Removing existing source at path $BUILD. Please wait..."
        sleep 1
        rm -rf "$BUILD"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading $BUILDNAME's source code. Please wait..."
        $GIT "$BUILD"
        git -C "$BUILD" checkout -q $($PRINTF "$GITVER" | gawk '{print $NF}') --
        $PRINTF "%s\n" "$CONF" > "$BUILD/.comrev"

    elif [ -d "$BUILD/.git" ]; then

        if [ "$SRB2BLDDEVMODE" != "1" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Cleaning up $BUILDNAME's source code. Please wait..."
            cleansource

        fi

        GITCURVER=$(git -C "$BUILD" rev-parse --abbrev-ref HEAD)

        if [ -n "$GITVER" ]; then

            git -C "$BUILD" checkout -q $($PRINTF "$GITVER" | gawk '{print $NF}') --

        fi

        if [ -n "$ISNET" ] && [ "$SRB2BLDDEVMODE" != "1" ] || [ "$UPGRADE" = "1" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating $BUILDNAME's source code. Please wait..."
            git -C "$BUILD" submodule update --init --recursive
            git -C "$BUILD" pull --recurse-submodules --rebase --autostash

        fi

        git -C "$BUILD" checkout -q "$GITCURVER" --

    fi
}

flatpak() {
    clear

    # Blocking access to this option for users that have OS other than Linux since Flatpaks are Linux exclusive.
    if [ "$OS" != "Linux" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Currently building Flatpaks is only available for Linux. Exiting."
        exit

    fi

    # Remove musl variable for building Flatpaks.
    if [ "$LIBC" = "musl" ]; then

        unset LIBC

    fi

    # Set Flatpak user installation path, if not exported to shell.
    if [ -z "$FLATPAK_USER_DIR" ]; then

        FLATPAK_USER_DIR="$HOME/.local/share/flatpak"

    fi

    # We have to set this in order to make Flatpak in Docker/Podman container.
    FLATPAK=1

    checkuseropt

    # Set current working directory.
    LNXPWD="$(pwd)"

    choosebuild

    buildvar

    fetchupdatebuild

    choosebranchcommit

    preparebuild

    setsudo

    preparecontainer

    containerentry

    sudo_ping

    settrap

    containerrun

    # Export commit revision name before creating Flatpak.
    export VERSION="$GITVER-$(git -C "$BUILD" rev-parse --short HEAD)"

    # Set path to Flatpak command.
    FLATPAKBIN="$(sh -c "command -v flatpak 2> /dev/null") --user"

    # Add Flathub repository for Flatpak.
    $FLATPAKBIN remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo
    $SUDO $($PRINTF "%s\n" "$FLATPAKBIN" | gawk '{print $1}') remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo 2> /dev/null || true

    # Install Flatpak platform and SDK.
    FLATPAKARCH="$ARCH"
    FLATPAKPLATFORM=$($FLATPAKBIN remote-info flathub org.freedesktop.Platform 2>&1 | gawk '{gsub(" ","\n"); gsub(",",""); print}' | gawk '/org\.freedesktop\.Platform\// {gsub("//","/'$FLATPAKARCH'/"); print}' | sort -V | tail -n1)
    FLATPAKSDK=$($FLATPAKBIN remote-info flathub org.freedesktop.Sdk 2>&1 | gawk '{gsub(" ","\n"); gsub(",",""); print}' | gawk '/org\.freedesktop\.Sdk\// {gsub("//","/'$FLATPAKARCH'/"); print}' | sort -V | tail -n1)

    # Determine name of the flatpak.
    if [ "$(dirname $BUILD)" = "$BUILDPATH/srb2-custom" ]; then

        SRB2CASSETDIR=$(gawk -F'"' '/\/usr\/local/ {print $2}' $BUILD/src/*/i_system.c* | gawk -F'/' '/games/ {print $NF}' | gawk '!/games/ {print}' 2> /dev/null | head -n1)
        FLATPAKNAME="org.srb2bld."$SRB2CASSETDIR"C"$($PRINTF $BUILD | gawk -F'/' '{gsub("-","_"); gsub("\\.",""); print $NF}')""

    else

        FLATPAKNAME="org.srb2bld.$($PRINTF $BUILD | gawk -F'/' '{gsub("-","_"); gsub("\\.",""); print $NF}')"

    fi

    # Create flatpak recipe.

    # Set variables for each SRB2/SRB2Kart/Ring Racers build.
    if [ -n "$(gawk -F'\"' '/DEFAULTDIR/ {gsub(" |\\.",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null | head -n1)" ]; then

        SRB2CONFDIR=".$(gawk -F'\"' '/DEFAULTDIR/ {gsub(" |\\.",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null | head -n1)"

    else

        SRB2CONFDIR=".srb2$GITVERCONF"

    fi

    if [ "$BUILD" = "$BUILDPATH/srb2-2.0" ] || [ "$BUILD" = "$BUILDPATH/srb2-cb" ] || [ "$BUILD" = "$BUILDPATH/xsrb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ] || [ "$BUILD" = "$BUILDPATH/srb2-riders" ] || [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ] || [ "$BUILD" = "$BUILDPATH/sbb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-final-demo" ] || [ "$BUILD" = "$BUILDPATH/srb2-1095" ] || [ "$BUILD" = "$BUILDPATH/srb2-jte" ] || [ "$BUILD" = "$BUILDPATH/shufflarb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-live" ] || [ "$BUILD" = "$BUILDPATH/ssbss" ]; then

        cat > "$BUILD/build/$FLATPAKNAME.json" << FLATPAK
{
  "app-id": "$FLATPAKNAME",
  "name": "$FLATPAKNAME",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "$($PRINTF $FLATPAKPLATFORM | gawk -F'/' '{print $NF}')",
  "sdk": "org.freedesktop.Sdk",
  "command": "AppRun",
  "finish-args": [
    "--allow=multiarch",
    "--share=ipc",
    "--share=network",
    "--socket=fallback-x11",
    "--socket=pulseaudio",
    "--socket=wayland",
    "--device=all",
    "--persist=$SRB2CONFDIR"
  ],
  "add-extensions": {
    "org.freedesktop.Platform.Compat.i386": {
      "directory": "lib/i386-linux-gnu",
      "version": "$($PRINTF $FLATPAKPLATFORM | gawk -F'/' '{print $NF}')"
    },
    "org.freedesktop.Platform.GL32.default": {
      "directory": "lib/i386-linux-gnu/GL",
      "version": "$($PRINTF $FLATPAKPLATFORM | gawk -F'/' '{print $NF}')",
      "no-autodownload": "true"
    }
  },
  "modules": [
    {
      "name": "$FLATPAKNAME",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "dir",
          "path": "$BUILD/build/AppDir/usr"
        }
      ],
      "build-commands": [
        "mkdir -p /app/bin /app/lib/i386-linux-gnu/GL /app/games /app/share",
        "cp -rf bin/* /app/bin",
        "printf '#!/bin/sh\n\nexport SDL_SOUNDFONTS=\"\$SDL_SOUNDFONTS\"\nexport SDL_FORCE_SOUNDFONTS=1\nexport SRB2WADDIR=/app/games/\$(ls /app/games)\n\n$(ls $BUILD/build/AppDir/usr/bin) \"\$@\"\n\nif [ \"\$?\" = \"127\" ]; then\n\n    zenity --error --text \"i386 compatibilty extension not installed:\n     org.freedesktop.Platform.Compat.i386\n\nIn order to run this Flatpak, please first install this extension with command:\n<b>flatpak --user install org.freedesktop.Platform.Compat.i386</b>\"\n\nfi\n' > /app/bin/AppRun",
        "chmod 755 /app/bin/AppRun",
        "cp -rf lib/* /app/lib",
        "cp -rf games/* /app/games",
        "cp -rf share/* /app/share",
        "mv -f /app/share/applications/*-software.desktop /app/share/applications/$FLATPAKNAME-software.desktop",
        "mv -f /app/share/applications/*-opengl.desktop /app/share/applications/$FLATPAKNAME-opengl.desktop",
        "mv -f \$(find /app/share/icons/hicolor -name *.png 2> /dev/null | gawk '!/scalable/ {print}' | head -n1) \$(find /app/share/icons/hicolor -name apps 2> /dev/null | gawk '!/scalable/ {print}' | head -n1)/$FLATPAKNAME.png"
      ]
    }
  ]
}
FLATPAK

    elif [ "$BUILD" = "$BUILDPATH/srb2-loz" ]; then

        cat > "$BUILD/build/$FLATPAKNAME.json" << FLATPAK
{
  "app-id": "$FLATPAKNAME",
  "name": "$FLATPAKNAME",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "$($PRINTF $FLATPAKPLATFORM | gawk -F'/' '{print $NF}')",
  "sdk": "org.freedesktop.Sdk",
  "command": "AppRun",
  "finish-args": [
    "--allow=multiarch",
    "--share=ipc",
    "--share=network",
    "--socket=fallback-x11",
    "--socket=pulseaudio",
    "--socket=wayland",
    "--device=all",
    "--persist=.srb2fd$GITVERCONF"
  ],
  "add-extensions": {
    "org.freedesktop.Platform.Compat.i386": {
      "directory": "lib/i386-linux-gnu",
      "version": "$($PRINTF $FLATPAKPLATFORM | gawk -F'/' '{print $NF}')"
    },
    "org.freedesktop.Platform.GL32.default": {
      "directory": "lib/i386-linux-gnu/GL",
      "version": "$($PRINTF $FLATPAKPLATFORM | gawk -F'/' '{print $NF}')",
      "no-autodownload": "true"
    }
  },
  "modules": [
    {
      "name": "$FLATPAKNAME",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "dir",
          "path": "$BUILD/build/AppDir/usr"
        }
      ],
      "build-commands": [
        "mkdir -p /app/bin /app/lib/i386-linux-gnu/GL /app/games /app/share",
        "cp -rf bin/* /app/bin",
        "printf '#!/bin/sh\n\nexport SDL_SOUNDFONTS=\"\$SDL_SOUNDFONTS\"\nexport SDL_FORCE_SOUNDFONTS=1\n\ncd /app/games/\$(ls /app/games)\n\n$(ls $BUILD/build/AppDir/usr/bin) -opengl \"\$@\"\n\nif [ \"\$?\" = \"127\" ]; then\n\n    zenity --error --text \"i386 compatibilty extension not installed:\n     org.freedesktop.Platform.Compat.i386\n\nIn order to run this Flatpak, please first install this extension with command:\n<b>flatpak --user install org.freedesktop.Platform.Compat.i386</b>\"\n\nfi\n' > /app/bin/AppRun",
        "chmod 755 /app/bin/AppRun",
        "cp -rf lib/* /app/lib",
        "cp -rf games/* /app/games",
        "cp -rf share/* /app/share",
        "mv -f /app/share/applications/*-software.desktop /app/share/applications/$FLATPAKNAME-software.desktop",
        "mv -f /app/share/applications/*-opengl.desktop /app/share/applications/$FLATPAKNAME-opengl.desktop",
        "mv -f \$(find /app/share/icons/hicolor -name *.png 2> /dev/null | gawk '!/scalable/ {print}' | head -n1) \$(find /app/share/icons/hicolor -name apps 2> /dev/null | gawk '!/scalable/ {print}' | head -n1)/$FLATPAKNAME.png"
      ]
    }
  ]
}
FLATPAK

    elif [ "$BUILD" = "$BUILDPATH/newmillennium" ]; then

        cat > "$BUILD/build/$FLATPAKNAME.json" << FLATPAK
{
  "app-id": "$FLATPAKNAME",
  "name": "$FLATPAKNAME",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "$($PRINTF $FLATPAKPLATFORM | gawk -F'/' '{print $NF}')",
  "sdk": "org.freedesktop.Sdk",
  "command": "AppRun",
  "finish-args": [
    "--allow=multiarch",
    "--share=ipc",
    "--share=network",
    "--socket=fallback-x11",
    "--socket=pulseaudio",
    "--socket=wayland",
    "--device=all",
    "--persist=.newmillennium$GITVERCONF"
  ],
  "add-extensions": {
    "org.freedesktop.Platform.Compat.i386": {
      "directory": "lib/i386-linux-gnu",
      "version": "$($PRINTF $FLATPAKPLATFORM | gawk -F'/' '{print $NF}')"
    },
    "org.freedesktop.Platform.GL32.default": {
      "directory": "lib/i386-linux-gnu/GL",
      "version": "$($PRINTF $FLATPAKPLATFORM | gawk -F'/' '{print $NF}')",
      "no-autodownload": "true"
    }
  },
  "modules": [
    {
      "name": "$FLATPAKNAME",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "dir",
          "path": "$BUILD/build/AppDir/usr"
        }
      ],
      "build-commands": [
        "mkdir -p /app/bin /app/lib/i386-linux-gnu/GL /app/games /app/share",
        "cp -rf bin/* /app/bin",
        "printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH=\$(dirname \$(file -L \$(find -L /usr/lib32 /lib -name libGL.so.[0-9] 2> /dev/null) | gawk -F\":\" \"/32-bit/ {print \$1}\") 2> /dev/null):\$LD_LIBRARY_PATH\nexport LIBGL_DRIVERS_PATH=/app/lib/dri\nexport __EGL_VENDOR_LIBRARY_DIRS=/etc/glvnd/egl_vendor.d:/usr/share/glvnd/egl_vendor.d\nexport __GLX_VENDOR_LIBRARY_NAME=mesa\nexport GALLIUM_DRIVER=llvmpipe\nexport MESA_LOADER_DRIVER_OVERRIDE=llvmpipe\nexport LIBGL_ALWAYS_SOFTWARE=1\nexport __NV_PRIME_RENDER_OFFLOAD=0\nexport SDL_SOUNDFONTS=\"\$SDL_SOUNDFONTS\"\nexport SDL_FORCE_SOUNDFONTS=1\nexport DBUS_FATAL_WARNINGS=0\n\ncd /app/games/\$(ls /app/games)\n\n$(ls $BUILD/build/AppDir/usr/bin) \"\$@\"\n\nif [ \"\$?\" = \"127\" ]; then\n\n    zenity --error --text \"i386 compatibilty extension not installed:\n     org.freedesktop.Platform.Compat.i386\n\nIn order to run this Flatpak, please first install this extension with command:\n<b>flatpak --user install org.freedesktop.Platform.Compat.i386</b>\"\n\nfi\n' > /app/bin/AppRun",
        "chmod 755 /app/bin/AppRun",
        "cp -rf lib/* /app/lib",
        "cp -rf games/* /app/games",
        "cp -rf share/* /app/share",
        "mv -f /app/share/applications/*.desktop /app/share/applications/$FLATPAKNAME-software.desktop",
        "mv -f \$(find /app/share/icons/hicolor -name *.png 2> /dev/null | gawk '!/scalable/ {print}' | head -n1) \$(find /app/share/icons/hicolor -name apps 2> /dev/null | gawk '!/scalable/ {print}' | head -n1)/$FLATPAKNAME.png"
      ]
    }
  ]
}
FLATPAK

    elif [ "$BUILD" = "$BUILDPATH/wadcli" ] || [ "$BUILD" = "$BUILDPATH/kartmaker" ] || [ "$BUILD" = "$BUILDPATH/neptunefm" ] || [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ] || [ "$BUILD" = "$BUILDPATH/followermaker" ]; then

        if [ "$BUILD" = "$BUILDPATH/wadcli" ]; then

            FLATPAKCMD="wadcli"

        elif [ "$BUILD" = "$BUILDPATH/neptunefm" ]; then

            FLATPAKCMD="neptunefm"

        elif [ "$BUILD" = "$BUILDPATH/followermaker" ]; then

            FLATPAKCMD="followermaker"

        else

            FLATPAKCMD="kartmaker"

        fi

        cat > "$BUILD/build/$FLATPAKNAME.json" << FLATPAK
{
  "app-id": "$FLATPAKNAME",
  "name": "$FLATPAKNAME",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "$($PRINTF $FLATPAKPLATFORM | gawk -F'/' '{print $NF}')",
  "sdk": "org.freedesktop.Sdk",
  "command": "$FLATPAKCMD",
  "finish-args": [
    "--share=ipc",
    "--share=network",
    "--socket=fallback-x11",
    "--socket=pulseaudio",
    "--socket=wayland",
    "--device=all"
  ],
  "modules": [
    {
      "name": "$FLATPAKNAME",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "dir",
          "path": "$BUILD/build/AppDir/usr"
        }
      ],
      "build-commands": [
        "mkdir -p /app/bin /app/lib /app/share",
        "cp -rf bin/* /app/bin",
        "cp -rf share/* /app/share",
        "mv -f /app/share/applications/*.desktop /app/share/applications/$FLATPAKNAME.desktop",
        "mv -f \$(find /app/share/icons/hicolor -name *.png 2> /dev/null | gawk '!/scalable/ {print}' | head -n1) \$(find /app/share/icons/hicolor -name apps 2> /dev/null | gawk '!/scalable/ {print}' | head -n1)/$FLATPAKNAME.png"
      ]
    }
  ]
}
FLATPAK

    elif [ "$BUILD" = "$BUILDPATH/slade" ]; then

        # Changing paths for GTK+ modules for Flatpak.
        gawk -i inplace '{gsub("^\".*/usr/lib","\"/app/lib"); print}' "$BUILD/build/AppDir/usr/lib/gdk-pixbuf/loaders.cache"

        cat > "$BUILD/build/$FLATPAKNAME.json" << FLATPAK
{
  "app-id": "$FLATPAKNAME",
  "name": "$FLATPAKNAME",
  "runtime": "org.gnome.Platform",
  "runtime-version": "43",
  "sdk": "org.gnome.Sdk",
  "command": "AppRun",
  "finish-args": [
    "--share=ipc",
    "--share=network",
    "--socket=fallback-x11",
    "--socket=pulseaudio",
    "--socket=wayland",
    "--device=all",
    "--filesystem=host",
    "--metadata=X-DConf=migrate-path=/net/mancubus/SLADE/"
  ],
  "modules": [
    {
      "name": "$FLATPAKNAME",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "dir",
          "path": "$BUILD/build/AppDir/usr"
        }
      ],
      "build-commands": [
        "mkdir -p /app/bin /app/lib /app/share",
        "cp -rf bin/* /app/bin",
        "rm -rf share/slade3",
        "printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH=/app/lib:/app/lib/gtk-3.0/modules:/app/lib/gdk-pixbuf/loaders:\$LD_LIBRARY_PATH\nexport GTK_PATH=/app/lib/slade3/gtk-3.0\nexport GIO_MODULE_DIR=/app/lib/gio/modules\nexport GIO_EXTRA_MODULES=/app/lib/gio/modules\nexport GDK_PIXBUF_MODULEDIR=/app/lib/gdk-pixbuf/loaders\nexport GDK_PIXBUF_MODULE_FILE=/app/lib/gdk-pixbuf/loaders.cache\nexport XDG_DATA_DIRS=/app/share:/app/share/mime:/run/host/usr/share\nexport KDE_FULL_SESSION=false\n\nexec /app/bin/slade \"\$@\"\n' > /app/bin/AppRun",
        "chmod 755 /app/bin/AppRun",
        "cp -rf lib/* /app/lib",
        "cp -rf share/* /app/share",
        "mv -f /app/share/applications/*.desktop /app/share/applications/$FLATPAKNAME.desktop",
        "mv -f \$(find /app/share/icons/hicolor -name *.png 2> /dev/null | gawk '!/scalable/ {print}' | head -n1) \$(find /app/share/icons/hicolor -name apps 2> /dev/null | gawk '!/scalable/ {print}' | head -n1)/$FLATPAKNAME.png"
      ]
    }
  ]
}
FLATPAK

    elif [ "$BUILD" = "$BUILDPATH/ultimate-zone-builder" ] || [ "$BUILD" = "$BUILDPATH/ultimate-gksz-builder" ] || [ "$BUILD" = "$BUILDPATH/ultimate-lowee-builder" ] || [ "$BUILD" = "$BUILDPATH/high-voltage-ring" ]; then

        if [ "$BUILD" = "$BUILDPATH/ultimate-zone-builder" ]; then

            UZBSHARE="ultimatezonebuilder"
            UZBBIN="uzb"

        elif [ "$BUILD" = "$BUILDPATH/ultimate-gksz-builder" ]; then

            UZBSHARE="ultimategkszbuilder"
            UZBBIN="ugb"

        elif [ "$BUILD" = "$BUILDPATH/ultimate-lowee-builder" ]; then

            UZBSHARE="ultimateloweebuilder"
            UZBBIN="ulb"

        elif [ "$BUILD" = "$BUILDPATH/high-voltage-ring" ]; then

            UZBSHARE="highvoltagering"
            UZBBIN="hvr"

        fi

        cat > "$BUILD/build/$FLATPAKNAME.json" << FLATPAK
{
  "app-id": "$FLATPAKNAME",
  "name": "$FLATPAKNAME",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "$($PRINTF $FLATPAKPLATFORM | gawk -F'/' '{print $NF}')",
  "sdk": "org.freedesktop.Sdk",
  "command": "AppRun",
  "finish-args": [
    "--share=ipc",
    "--share=network",
    "--socket=fallback-x11",
    "--socket=pulseaudio",
    "--socket=wayland",
    "--device=all"
  ],
  "modules": [
    {
      "name": "$FLATPAKNAME",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "dir",
          "path": "$BUILD/build/AppDir/usr"
        }
      ],
      "build-commands": [
        "mkdir -p /app/bin /app/lib /app/share/$UZBSHARE",
        "cp -rf bin/* /app/share/$UZBSHARE",
        "printf '#!/bin/sh\n\ncd /app/share/$UZBSHARE\n\nexec /app/share/$UZBSHARE/$UZBBIN.bin \"\$@\"\n' > /app/bin/AppRun",
        "chmod 755 /app/bin/AppRun",
        "cp -rf lib/* /app/lib",
        "cp -rf share/* /app/share",
        "mv -f /app/share/applications/*.desktop /app/share/applications/$FLATPAKNAME.desktop",
        "mv -f \$(find /app/share/icons/hicolor -name *.png 2> /dev/null | gawk '!/scalable/ {print}' | head -n1) \$(find /app/share/icons/hicolor -name apps 2> /dev/null | gawk '!/scalable/ {print}' | head -n1)/$FLATPAKNAME.png"
      ]
    }
  ]
}
FLATPAK

    elif [ "$BUILD" = "$BUILDPATH/aseprite" ]; then

        cat > "$BUILD/build/$FLATPAKNAME.json" << FLATPAK
{
  "app-id": "$FLATPAKNAME",
  "name": "$FLATPAKNAME",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "$($PRINTF $FLATPAKPLATFORM | gawk -F'/' '{print $NF}')",
  "sdk": "org.freedesktop.Sdk",
  "command": "aseprite",
  "finish-args": [
    "--share=ipc",
    "--share=network",
    "--socket=fallback-x11",
    "--socket=pulseaudio",
    "--socket=wayland",
    "--device=all"
  ],
  "modules": [
    {
      "name": "$FLATPAKNAME",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "dir",
          "path": "$BUILD/build/AppDir/usr"
        }
      ],
      "build-commands": [
        "mkdir -p /app/bin /app/lib /app/share/aseprite",
        "cp -rf bin/* /app/bin",
        "printf '#!/bin/sh\n\nexec /app/lib/p7zip/7z \"\$@\"\n' > /app/bin/7z",
        "chmod 755 /app/bin/7z",
        "cp -rf lib/* /app/lib",
        "cp -rf share/* /app/share",
        "mv -f /app/share/applications/*.desktop /app/share/applications/$FLATPAKNAME.desktop",
        "mv -f \$(find /app/share/icons/hicolor -name *.png 2> /dev/null | gawk '!/scalable/ {print}' | head -n1) \$(find /app/share/icons/hicolor -name apps 2> /dev/null | gawk '!/scalable/ {print}' | head -n1)/$FLATPAKNAME.png"
      ]
    }
  ]
}
FLATPAK

    else

        if [ -n "$(gawk -F'"' '/envstr = I_GetEnv\(".*"\)\) != NULL\) && isWadPathOk\(envstr\)\)/ {print $2}' "$BUILD/src/sdl/i_system.c"*)" ]; then

            WADDIR=$(gawk -F'"' '/envstr = I_GetEnv\(".*"\)\) != NULL\) && isWadPathOk\(envstr\)\)/ {print $2}' "$BUILD/src/sdl/i_system.c"*)

        else

            WADDIR="SRB2WADDIR"

        fi

        cat > "$BUILD/build/$FLATPAKNAME.json" << FLATPAK
{
  "app-id": "$FLATPAKNAME",
  "name": "$FLATPAKNAME",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "$($PRINTF $FLATPAKPLATFORM | gawk -F'/' '{print $NF}')",
  "sdk": "org.freedesktop.Sdk",
  "command": "AppRun",
  "finish-args": [
    "--share=ipc",
    "--share=network",
    "--socket=fallback-x11",
    "--socket=pulseaudio",
    "--socket=wayland",
    "--device=all",
    "--persist=$SRB2CONFDIR"
  ],
  "modules": [
    {
      "name": "$FLATPAKNAME",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "dir",
          "path": "$BUILD/build/AppDir/usr"
        }
      ],
      "build-commands": [
        "mkdir -p /app/bin /app/lib /app/games /app/share",
        "cp -rf bin/* /app/bin",
        "printf '#!/bin/sh\n\nexport SDL_SOUNDFONTS=\"\$SDL_SOUNDFONTS\"\nexport SDL_FORCE_SOUNDFONTS=1\nexport $WADDIR=/app/games/\$(ls /app/games)\n\n$(ls $BUILD/build/AppDir/usr/bin) \"\$@\"\n' > /app/bin/AppRun",
        "chmod 755 /app/bin/AppRun",
        "cp -rf lib/* /app/lib",
        "cp -rf games/* /app/games",
        "cp -rf share/* /app/share",
        "mv -f /app/share/applications/*-software.desktop /app/share/applications/$FLATPAKNAME-software.desktop",
        "mv -f /app/share/applications/*-opengl.desktop /app/share/applications/$FLATPAKNAME-opengl.desktop",
        "mv -f \$(find /app/share/icons/hicolor -name *.png 2> /dev/null | gawk '!/scalable/ {print}' | head -n1) \$(find /app/share/icons/hicolor -name apps 2> /dev/null | gawk '!/scalable/ {print}' | head -n1)/$FLATPAKNAME.png"
      ]
    }
  ]
}
FLATPAK

    fi

    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $BUILDNAME's Flatpak. Please wait..."

    # Build Flatpak.
    cd "$BUILD" || exit

    if [ -x "$(command -v flatpak-builder 2> /dev/null)" ]; then

        flatpak-builder -y -v --user --ccache --install-deps-from="flathub" --jobs="$NCPU" --state-dir="$BUILD/build" --force-clean --repo="$BUILD/build/srb2bld-repo" "$BUILD/build/flatpak-build" "$BUILD/build/$FLATPAKNAME.json"

    else

        $FLATPAKBIN install -y flathub org.flatpak.Builder
        $FLATPAKBIN run --command="flatpak" --env="XDG_DATA_DIRS=$XDG_DATA_DIRS" --env="FLATPAK_USER_DIR=$FLATPAK_USER_DIR" --env="XDG_RUNTIME_DIR=/run/user/$(id -u)" --filesystem="$FLATPAK_USER_DIR" org.flatpak.Builder --user remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo
        $FLATPAKBIN run --command="flatpak-builder" --env="XDG_DATA_DIRS=$XDG_DATA_DIRS" --env="FLATPAK_USER_DIR=$FLATPAK_USER_DIR" --env="XDG_RUNTIME_DIR=/run/user/$(id -u)" --filesystem="$FLATPAK_USER_DIR" org.flatpak.Builder -y -v --user --ccache --disable-rofiles-fuse --install-deps-from="flathub" --jobs="$NCPU" --state-dir="$BUILD/build" --force-clean --repo="$BUILD/build/srb2bld-repo" "$BUILD/build/flatpak-build" "$BUILD/build/$FLATPAKNAME.json"

    fi

    $($PRINTF "%s\n" "$FLATPAKBIN" | gawk '{print $1}') build-bundle -v "$BUILD/build/srb2bld-repo" "$BUILD/$($PRINTF "%s\n" "$BUILDNAME" | gawk '{gsub(" ","_"); print}')-$VERSION-$ARCH.flatpak" "$FLATPAKNAME"

    # Set name of Flatpak in message.
    FLATPAKNAME=$(find "$BUILD" -name "*.flatpak" 2> /dev/null | gawk -F'/' '{print $NF}')

    # Move created Flatpak to working directory.
    mv -f "$BUILD/$FLATPAKNAME" "$LNXPWD" 2> /dev/null

    $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Flatpak for $BUILDNAME is done. Look for \"$FLATPAKNAME\" in \"$LNXPWD\" path and install file with \"flatpak --user install $FLATPAKNAME\""

    if [ "$BUILD" = "$BUILDPATH/srb2-2.0" ] || [ "$BUILD" = "$BUILDPATH/srb2-cb" ] || [ "$BUILD" = "$BUILDPATH/xsrb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ] || [ "$BUILD" = "$BUILDPATH/srb2-riders" ] || [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ] || [ "$BUILD" = "$BUILDPATH/sbb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-final-demo" ] || [ "$BUILD" = "$BUILDPATH/srb2-1095" ] || [ "$BUILD" = "$BUILDPATH/srb2-jte" ] || [ "$BUILD" = "$BUILDPATH/shufflarb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-live" ] || [ "$BUILD" = "$BUILDPATH/srb2-loz" ] || [ "$BUILD" = "$BUILDPATH/newmillennium" ]; then

        $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "For built Flatpak bundles for 32-bit builds, you need to install Flatpak \"org.freedesktop.Platform.Compat.i386\" with command \"flatpak --user install org.freedesktop.Platform.Compat.i386/$($PRINTF "%s\n" "$FLATPAKPLATFORM" | gawk -F'/' '{print $2"/"$3}')\"."

    fi
}

installdepsglibc() {
    if [ -x "$(command -v doas 2> /dev/null)" ]; then

        SUDO="doas"

    else

        SUDO="sudo"

    fi

    # Creating cache to find packages matching missing library.
    if [ -n "$ISNET" ] && [ -n "$(LD_LIBRARY_PATH=$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib ldd $SRB2BINARYLNXPATH 2>&1 2> /dev/null | gawk '/not found/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {print $1}' | head -n1)" ]; then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Refreshing package database for $BUILDNAME to find packages matching missing library. Please wait..."

        if [ -n "$ISREADONLY" ]; then

            if [ -x "$(command -v brew 2> /dev/null)" ]; then

                brew update

            elif [ -x "$(command -v rpm-ostree 2> /dev/null)" ]; then

                if [ -z "$(toolbox list --containers | gawk '/fedora/ {print}' | head -n1)" ]; then

                    toolbox create --assumeyes

                fi

            elif [ -x "$(command -v nix 2> /dev/null)" ]; then

                if [ ! -x "$(command -v nix-index 2> /dev/null)" ]; then

                    nix profile remove '.*nix-index' --extra-experimental-features 'nix-command flakes' 2> /dev/null && nix profile install "nixpkgs/release-$VERSION_ID#nix-index" --extra-experimental-features 'nix-command flakes'

                fi

                if [ ! -f "$HOME/.cache/nix-index/files" ] && [ ! -f "$XDG_CACHE_HOME/nix-index/files" ]; then

                    nix-index

                fi

            fi

        else

            if [ -x "$(command -v emerge 2> /dev/null)" ]; then

                if [ ! -x "$(command -v e-file 2> /dev/null)" ]; then

                    $SUDO emerge pfl

                fi

            elif [ -x "$(command -v pacman 2> /dev/null)" ]; then

                $SUDO pacman -Fy

            elif [ -x "$(command -v apt-get 2> /dev/null)" ]; then

                if [ ! -x "$(command -v apt-file 2> /dev/null)" ]; then

                    $SUDO apt-get install -y apt-file

                fi

                $SUDO apt-file update

            elif [ -x "$(command -v xbps-install 2> /dev/null)" ]; then

                if [ ! -x "$(command -v xlocate 2> /dev/null)" ]; then

                    $SUDO xbps-install -y xtools

                fi

                xlocate -S

            elif [ -x "$(command -v nix 2> /dev/null)" ]; then

                if [ ! -x "$(command -v nix-index 2> /dev/null)" ]; then

                    $SUDO nix profile remove '.*nix-index' --extra-experimental-features 'nix-command flakes' 2> /dev/null && $SUDO nix profile install "nixpkgs/release-$VERSION_ID#nix-index" --extra-experimental-features 'nix-command flakes'

                fi

                if [ ! -f "$HOME/.cache/nix-index/files" ] && [ ! -f "$XDG_CACHE_HOME/nix-index/files" ]; then

                    nix-index

                fi

            elif [ -x "$(command -v brew 2> /dev/null)" ]; then

                brew update

            fi

        fi

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing missing dependencies for $BUILDNAME to the system. Please wait..."
        PACKAGE=$(for l in $(LD_LIBRARY_PATH="$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib" ldd "$SRB2BINARYLNXPATH" 2>&1 2> /dev/null | gawk '/not found/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {gsub(".so.*|-[0-9]\\.[0-9].so.*|[0-9]\\.[0-9].so.*",".so"); print $1}' | sort -u); do

            if [ -n "$ISREADONLY" ]; then

                if [ -x "$(command -v brew 2> /dev/null)" ]; then

                    l=$(LD_LIBRARY_PATH="$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib" ldd "$SRB2BINARYLNXPATH" 2>&1 2> /dev/null | gawk '/not found/ && /'$(printf "%s\n" "$l" | gawk '{gsub(".so","*"); print}')'/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {print $1}' | head -n1)
                    curl -sL "https://packages.debian.org/search?suite=default&section=all&arch=any&searchon=contents&keywords=$($PRINTF "%s\n" "$l" | gawk '{gsub("\\+","\\+"); print}')" | gawk '-F">|</a>' '/<\/a> \[[a-z]*[0-9]*\]/ {gsub("-dev|-[0-9].[0-9]-|0",""); gsub("libminiupnpc[0-9][0-9]","miniupnpc"); gsub("libsdl","sdl"); gsub("-","_"); gsub("lua_ham","lua"); gsub("wxgtk.*","wxwidgets"); gsub("libc\\+\\+.*","llvm"); gsub("sdl1.2_compat_shim","sdl12-compat"); gsub("sdl_mixer1.2","sdl_mixer"); print $2}' | head -n1

                elif [ -x "$(command -v rpm-ostree 2> /dev/null)" ]; then

                    VERSION_ID=$(gawk -F'=' '/VERSION_ID/ {print $2}' /etc/os-release)

                    toolbox run dnf provides -q "/usr/lib$IS64/$l" | gawk '/.fc'$VERSION_ID'.|.el'$($PRINTF "%s\n" $VERSION_ID | gawk -F'\\.' '{print $1}')'./ {print $1}' | gawk -F'\\.| ' '{gsub("-[0-9]|:[0-9]",""); print $1"."$NF}'

                elif [ -x "$(PATH=/usr/sbin:$PATH command -v transactional-update 2> /dev/null)" ]; then

                    l="$($PRINTF "%s\n" "$l" | gawk '{gsub(".so$","*.so.*"); print}')"

                    zypper -q search --provides "$l" | gawk -F'|' '!/Name|32bit/ {print $2}' | gawk 'NF{print}'

                elif [ -x "$(command -v nix 2> /dev/null)" ]; then

                    nix-locate --top-level --regex "$($PRINTF "%s\n" "$l" | gawk '{gsub(".so.*|-[0-9]\\.[0-9].so.*|[0-9]\\.[0-9].so.*",""); print "/lib/"$0".*.so|/wx/"$0".*.so"}')" 2>&1 | gawk '{if (/\/lib\/libz\.so|\/lib\/libSDL2_mixer\.so/) {gsub("^","nixos."); gsub("SDL2_mixer_2_0","SDL2_mixer"); print $1;exit} else if (/[0-9]\.[0-9]\/lib|[0-9]\.[0-9][0-9]\/lib|[0-9]\.[0-9]\/wx|[0-9]\.[0-9][0-9]\/wx|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/lib|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/wx/ && !/libstdc\+\+[0-9]|lzfse|SDL2_.*|\/lib\/libz/) {gsub("^","nixos."); print $1;exit}}'

                fi

            else

                if [ -x "$(command -v emerge 2> /dev/null)" ]; then

                    p=$(e-file --plain "/usr/lib/$l" | gawk 'NR==1 {pkg=$0} /Installed Versions: -/ {print pkg}')

                    if [ -z "$p" ]; then

                        e-file --plain "/usr/lib64/$l" | gawk 'NR==1 {pkg=$0} /Installed Versions: -/ {print pkg}'

                    else

                        $PRINTF "%s\n" "$p"

                    fi

                elif [ -x "$(command -v pacman 2> /dev/null)" ]; then

                    pacman -Fqx "$l" | gawk -F'/' '!/lib32-/ {print $NF}'

                elif [ -x "$(command -v apt-get 2> /dev/null)" ]; then

                    apt-file -l find "$l" | gawk 'NF{print}'

                elif [ -x "$(command -v zypper 2> /dev/null)" ]; then

                    l="$($PRINTF "%s\n" "$l" | gawk '{gsub(".so$","*.so.*"); print}')"

                    zypper -q search --provides "$l" | gawk -F'|' '!/Name|32bit/ {print $2}' | gawk 'NF{print}'

                elif [ -x "$(command -v dnf 2> /dev/null)" ]; then

                    VERSION_ID=$(gawk -F'"' '/VERSION_ID/ {print $2}' /etc/os-release)

                    dnf provides -q "/usr/lib$IS64/$l" | gawk '/.fc'$VERSION_ID'.|.el'$($PRINTF "%s\n" $VERSION_ID | gawk -F'\\.' '{print $1}')'./ {print $1}'

                elif [ -x "$(command -v xbps-install 2> /dev/null)" ]; then

                    xlocate "$l" | gawk '!/-32bit-/ {print $1}' | gawk '!a[$0]++ {print}'

                elif [ -x "$(command -v nix 2> /dev/null)" ]; then

                    nix-locate --top-level --regex "$($PRINTF "%s\n" "$l" | gawk '{gsub(".so.*|-[0-9]\\.[0-9].so.*|[0-9]\\.[0-9].so.*",""); print "/lib/"$0".*.so|/wx/"$0".*.so"}')" 2>&1 | gawk '{if (/\/lib\/libz\.so|\/lib\/libSDL2_mixer\.so/) {gsub("^","nixos."); gsub("SDL2_mixer_2_0","SDL2_mixer"); print $1;exit} else if (/[0-9]\.[0-9]\/lib|[0-9]\.[0-9][0-9]\/lib|[0-9]\.[0-9]\/wx|[0-9]\.[0-9][0-9]\/wx|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/lib|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/wx/ && !/libstdc\+\+[0-9]|lzfse|SDL2_.*|\/lib\/libz/) {gsub("^","nixos."); print $1;exit}}'

                elif [ -x "$(command -v brew 2> /dev/null)" ]; then

                    l=$(LD_LIBRARY_PATH="$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib" ldd "$SRB2BINARYLNXPATH" 2>&1 2> /dev/null | gawk '/not found/ && /'$(printf "%s\n" "$l" | gawk '{gsub(".so","*"); print}')'/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {print $1}' | head -n1)
                    curl -sL "https://packages.debian.org/search?suite=default&section=all&arch=any&searchon=contents&keywords=$($PRINTF "%s\n" "$l" | gawk '{gsub("\\+","\\+"); print}')" | gawk '-F">|</a>' '/<\/a> \[[a-z]*[0-9]*\]/ {gsub("-dev|-[0-9].[0-9]-|0",""); gsub("libminiupnpc[0-9][0-9]","miniupnpc"); gsub("libsdl","sdl"); gsub("-","_"); gsub("lua_ham","lua"); gsub("wxgtk.*","wxwidgets"); gsub("libc\\+\\+.*","llvm"); gsub("sdl1.2_compat_shim","sdl12-compat"); gsub("sdl_mixer1.2","sdl_mixer"); print $2}' | head -n1

                fi

            fi

        done)

        PACKAGE=$($PRINTF "%s\n" "$PACKAGE" | gawk '!a[$0]++ {print}')

        # Installing missing libraries for glibc based distros.
        if [ -n "$PACKAGE" ]; then

            if [ -x "$(command -v brew 2> /dev/null)" ]; then

                PACKAGE=$($PRINTF "%s\n" "$PACKAGE" | gawk -F'/' '{print $NF}' | sort -u)

                if [ -f "$BUILD/build/AppDir/usr/lib/libminiupnpc.so.17" ]; then

                    cp -f "$BUILD/build/AppDir/usr/lib/libminiupnpc.so.17" "/home/linuxbrew/.linuxbrew/lib"

                fi

                brew install $PACKAGE || true

            elif [ -n "$ISREADONLY" ]; then

                if [ -x "$(command -v rpm-ostree 2> /dev/null)" ]; then

                    rpm-ostree install -A --allow-inactive -y $PACKAGE || true

                elif [ -x "$(PATH=/usr/sbin:$PATH command -v transactional-update 2> /dev/null)" ]; then

                    $SUDO transactional-update pkg install -y $PACKAGE && $SUDO transactional-update apply || true

                elif [ -x "$(command -v nix 2> /dev/null)" ]; then

                    PACKAGE=$($PRINTF "%s\n" "$PACKAGE" | gawk '!/wxGTK\.out/ {gsub("sdl","SDL"); print}' | sort -u)

                    PACKAGENIXREMOVE=$(for l in $(nix profile list --extra-experimental-features 'nix-command flakes' | gawk -F'#| ' '{print $3}'); do

                        $PRINTF "%s\n" "$l"

                    done)

                    PACKAGENIXREMOVE=$($PRINTF "%s\n" "$PACKAGENIXREMOVE" | gawk '!/wxGTK\.out|wxGTK[0-9][0-9]]-gtk3\.out/ {gsub("sdl","SDL"); print}' | sort -u)
                    nix profile remove $PACKAGENIXREMOVE --extra-experimental-features 'nix-command flakes' 2> /dev/null && nix profile install $PACKAGE --extra-experimental-features 'nix-command flakes' || true

                else

                    $PRINTF "$NOTICE\n\n%s\n\e[0m" "Script can't detect package manager. Please install below missing libraries manually on your system using package manager or compile them from source:"
                    LD_LIBRARY_PATH="$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib" ldd "$SRB2BINARYLNXPATH" 2>&1 2> /dev/null | gawk '/not found/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {print $1}' | sort -u
                    exit

                fi

            else

                if [ -x "$(command -v emerge 2> /dev/null)" ]; then

                    $SUDO emerge $PACKAGE || true

                elif [ -x "$(command -v pacman 2> /dev/null)" ]; then

                    $SUDO pacman -S --needed --noconfirm $PACKAGE || true

                elif [ -x "$(command -v apt-get 2> /dev/null)" ]; then

                    $SUDO apt-get install -y $PACKAGE || true

                elif [ -x "$(command -v zypper 2> /dev/null)" ]; then

                    $SUDO zypper install -y $PACKAGE || true

                elif [ -x "$(command -v dnf 2> /dev/null)" ]; then

                    $SUDO dnf install --best --skip-broken -y $PACKAGE || true

                elif [ -x "$(command -v xbps-install 2> /dev/null)" ]; then

                    PACKAGE=$($PRINTF "%s\n" "$PACKAGE" | gawk '{gsub(" ","\n"); print}' | gawk -F'-' '{printf " "$1}')
                    $SUDO xbps-install -y $PACKAGE || true

                elif [ -x "$(command -v nix 2> /dev/null)" ]; then

                    PACKAGE=$($PRINTF "%s\n" "$PACKAGE" | gawk '!/wxGTK\.out/ {gsub("sdl","SDL"); print}' | sort -u)
                    PACKAGENIXREMOVE=$(for l in $($SUDO nix profile list --extra-experimental-features 'nix-command flakes' | gawk -F'#| ' '{print $3}'); do

                        $PRINTF "%s\n" "$l"

                    done)
                    PACKAGENIXREMOVE=$($PRINTF "%s\n" "$PACKAGENIXREMOVE" | gawk '!/wxGTK\.out|wxGTK[0-9][0-9]]-gtk3\.out/ {gsub("sdl","SDL"); print}' | sort -u)

                    $SUDO nix profile remove $PACKAGENIXREMOVE --extra-experimental-features 'nix-command flakes' 2> /dev/null && $SUDO nix profile install $PACKAGE --extra-experimental-features 'nix-command flakes' || true

                elif [ -x "$(command -v brew 2> /dev/null)" ]; then

                    PACKAGE=$($PRINTF "%s\n" "$PACKAGE" | gawk -F'/' '{print $NF}' | sort -u)

                    if [ -f "$BUILD/build/AppDir/usr/lib/libminiupnpc.so.17" ]; then

                        cp -f "$BUILD/build/AppDir/usr/lib/libminiupnpc.so.17" "/home/linuxbrew/.linuxbrew/lib"

                    fi

                    brew install $PACKAGE || true

                else

                    $PRINTF "$NOTICE\n\n%s\n\e[0m" "Script can't detect package manager. Please install below missing libraries manually on your system using package manager or compile them from source:"
                    LD_LIBRARY_PATH="$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib" ldd "$SRB2BINARYLNXPATH" 2>&1 2> /dev/null | gawk '/not found/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {print $1}' | sort -u
                    exit

                fi

            fi

        fi

    fi

    if [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u -| -u$| --user -| --user$/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk 'match($0, /\/home\/'$USER'\/.local/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$ISREADONLY" ]; then

        unset SUDO

    fi
}

installdepsmusl() {
    if [ -x "$(command -v doas 2> /dev/null)" ]; then

        SUDO="doas"

    else

        SUDO="sudo"

    fi

    # Creating cache to find packages matching missing library.
    if [ -n "$ISNET" ] && [ "$LIBC" = "musl" ] && [ -n "$(LD_LIBRARY_PATH=$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib ldd $SRB2BINARYLNXPATH 2>&1 | gawk -F':| ' '/No such file or directory/ && !/symbol not found/ {print $5}' | sort -u)" ]; then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing missing dependencies for $BUILDNAME to the system. Please wait..."

        if [ -x "$(command -v emerge 2> /dev/null)" ]; then

            if [ ! -x "$(command -v e-file 2> /dev/null)" ]; then

                $SUDO emerge pfl

            fi

        elif [ -x "$(command -v xbps-install 2> /dev/null)" ]; then

            if [ ! -x "$(command -v xlocate 2> /dev/null)" ]; then

                $SUDO xbps-install -y xtools

            fi

            xlocate -S

        fi

        PACKAGE=$(for l in $(LD_LIBRARY_PATH="$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib" ldd "$SRB2BINARYLNXPATH" 2>&1 | gawk -F':| ' '/No such file or directory/ && !/symbol not found/ {print $5}' | sort -u); do

            if [ -x "$(command -v emerge 2> /dev/null)" ]; then

                p=$(e-file --plain "/usr/lib/$l" | gawk 'NR==1 {pkg=$0} /Installed Versions: -/ {print pkg}')

                if [ -z "$p" ]; then

                    e-file --plain "/usr/lib64/$l" | gawk 'NR==1 {pkg=$0} /Installed Versions: -/ {print pkg}'

                else

                    $PRINTF "%s\n" "$p"

                fi

            elif [ -x "$(command -v apk 2> /dev/null)" ]; then

                l="$($PRINTF "%s\n" "$l" | gawk '{gsub(".so.*",".so"); print}')"

                curl -Ls https://pkgs.alpinelinux.org/contents?file="$l" | gawk -F'"|>|<' '/package/ && !/sdl2-compat/ {print $5}' | sort -u

            elif [ -x "$(command -v xbps-install 2> /dev/null)" ]; then

                l="$($PRINTF "%s\n" "$l" | gawk '{gsub("liblua.*","libluajit.*"); print}')"

                xlocate "$l" | gawk '!/-32bit-|primus/ {print $1}' | gawk '!a[$0]++ {print}'

            fi

        done)

        PACKAGE=$($PRINTF "%s\n" "$PACKAGE" | gawk '!a[$0]++ {print}')

        # Installing missing libraries for musl based distros.
        if [ -n "$PACKAGE" ]; then

            if [ -n "$ISREADONLY" ]; then

                if [ -x "$(command -v nix 2> /dev/null)" ]; then

                    VERSION_ID=$(gawk -F'"' '/VERSION_ID/ {print $2}' /etc/os-release)

                    PACKAGE=$($PRINTF "%s\n" "$PACKAGE" | gawk '!/nixos\.wxGTK\.out/ {gsub("nixos.|[a-z]*/","") && gsub("^| "," nixpkgs.") && gsub("sdl","SDL"); print}' | sort -u)
                    nix profile remove '.*nix-index' --extra-experimental-features 'nix-command flakes' 2> /dev/null && nix profile install "nixpkgs/release-$VERSION_ID#nix-index" --extra-experimental-features 'nix-command flakes'

                elif [ -x "$(command -v brew 2> /dev/null)" ]; then

                    PACKAGE=$($PRINTF "%s\n" "$PACKAGE" | gawk -F'/' '{print $NF}' | sort -u)

                    if [ -f "$BUILD/build/AppDir/usr/lib/libminiupnpc.so.17" ]; then

                        cp -f "$BUILD/build/AppDir/usr/lib/libminiupnpc.so.17" "/home/linuxbrew/.linuxbrew/lib"

                    fi

                    brew install $PACKAGE || true

                else

                    $PRINTF "$NOTICE\n\n%s\n\e[0m" "Script can't detect package manager. Please install below missing libraries manually on your system using package manager or compile them from source:"
                    LD_LIBRARY_PATH="$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib" ldd "$SRB2BINARYLNXPATH" 2>&1 | gawk -F':| ' '/No such file or directory/ && !/symbol not found/ {print $5}' | sort -u
                    exit

                fi

            else

                if [ -x "$(command -v emerge 2> /dev/null)" ]; then

                    $SUDO emerge $PACKAGE || true

                elif [ -x "$(command -v apk 2> /dev/null)" ]; then

                    $SUDO apk add --force-broken-world $PACKAGE 2> /dev/null

                elif [ -x "$(command -v xbps-install 2> /dev/null)" ]; then

                    if [ ! -f "$(xbps-query -f libexecinfo 2> /dev/null | head -n1)" ]; then

                        $SUDO xbps-install -y libexecinfo

                    fi

                    PACKAGE=$($PRINTF "%s\n" "$PACKAGE" | gawk '{gsub(" ","\n"); print}' | gawk -F'-' '{printf " "$1}')
                    $SUDO xbps-install -y $PACKAGE 2> /dev/null

                else

                    $PRINTF "$NOTICE\n\n%s\n\e[0m" "Script can't detect package manager. Please install below missing libraries manually on your system using package manager or compile them from source:"
                    LD_LIBRARY_PATH="$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib" ldd "$SRB2BINARYLNXPATH" 2>&1 | gawk -F':| ' '/No such file or directory/ && !/symbol not found/ {print $5}' | sort -u
                    exit

                fi

            fi

        fi

        # Since Alpine 3.17 building and installing libexecinfo through abuild is required.
        if [ -x "$(command -v apk 2> /dev/null)" ] && [ ! -f /usr/lib/libexecinfo.so.1 ]; then

            curl -RL http://dl-cdn.alpinelinux.org/alpine/v3.16/main/$(apk --print-arch)/libexecinfo-1.1-r1.apk -o /tmp/libexecinfo-1.1-r1.apk
            $SUDO apk add /tmp/libexecinfo-1.1-r1.apk

        fi

    fi

    if [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u -| -u$| --user -| --user$/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk 'match($0, /\/home\/'$USER'\/.local/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$ISREADONLY" ]; then

        unset SUDO

    fi
}

installtolinux() {
    # Saving configuration flags to variable.
    if [ -n "$(cat "$BUILD/conf")" ]; then

        CONF=$(cat "$BUILD/conf")

    fi

    # Adding path to commit revision file.
    COMREVFILEPATH="$BUILD/.comrev"

    SRB2LNXICONSIZE=$(find "$BUILD/build/AppDir/usr/share/icons/hicolor/"*/apps -mindepth 1 -maxdepth 1 2> /dev/null | gawk -F'hicolor/|/apps' '{print $2}' | gawk '!a[$0]++ {print}' | head -n1)

    # Making missing directory paths.
    if [ "$LNXOSNAME" != "NixOS" ]; then

        if [ "$SRB2BLDPREFIX" = "/usr/local" ]; then

            if [ ! -d "/usr/local/bin" ] && [ ! -d "/usr/local/share/applications" ] && [ ! -d "/usr/local/share/icons/hicolor/$SRB2LNXICONSIZE/apps" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Creating /usr/local/bin, /usr/local/share/applications, /usr/local/share/icons/hicolor/$SRB2LNXICONSIZE/apps and /usr/local/share/games directory paths. Please wait..."
                $SUDO install -d "/usr/local/bin"
                $SUDO install -d "/usr/local/share/applications"
                $SUDO install -d "/usr/local/share/icons/hicolor/$SRB2LNXICONSIZE/apps"
                $SUDO install -d "/usr/local/share/games"

            fi

        else

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Creating $SRB2BLDPREFIX/bin, $SRB2BLDPREFIX/share/applications, $SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps and $SRB2BLDPREFIX/share/games directory paths. Please wait..."
            install -d "$SRB2BLDPREFIX/bin"
            install -d "$SRB2BLDPREFIX/share/applications"
            install -d "$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps"
            install -d "$SRB2BLDPREFIX/share/games"

        fi

    fi

    removeduplicate

    # Installing build.
    if [ "$BUILD" = "$BUILDPATH/srb2" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2 binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.2-classic" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2Classic"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2c"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-2.2-classic-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-2.2-classic-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2classic.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2c binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/build/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.2-beta6" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2Beta"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2beta"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-2.2-beta6-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-2.2-beta6-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2beta.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2beta binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-uncapped-plus" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2UncappedPlus"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2ucp"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-uncapped-plus-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-uncapped-plus-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2uncappedplus.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2ucp binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-netplus" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2NetPlus"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2np"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-netplus-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-netplus-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2netplus.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2np binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-reveries" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2Reveries"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2r"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-reveries-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-reveries-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2reveries.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2r binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-tsourdt3rd" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2TSoURDt3rd"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2tsourdt3rd"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-tsourdt3rd-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-tsourdt3rd-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2tsourdt3rd.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2tsourdt3rd binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-edit" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2Edit"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2edit"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-edit-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-edit-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2edit.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2edit binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-ggj" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2GGJ"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2ggj"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-ggj-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-ggj-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2ggj.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2ggj binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-destructive-illusion" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2DestructiveIllusion"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2di"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-destructive-illusion-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-destructive-illusion-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2destructiveillusion.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2di binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-vr" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2VR"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2vr"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-vr-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-vr-opengl.desktop"
        SRB2DESKTOPOPENVRLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-vr-openvr.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2vr.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2vr binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.1-legacy" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2legacy"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2legacy"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-2.1-legacy-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-2.1-legacy-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2legacy.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2legacy binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-fusion-advance" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2FusionAdvance"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2fa"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-fusion-advance-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-fusion-advance-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2fusionadvance.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2fa binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-thokker" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2Thokker"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2thk"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-thokker-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-thokker-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2thokker.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2thk binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-top-down" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2TopDown"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2td"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-top-down-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-top-down-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2topdown.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2td binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/sonic-smash-brawl" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SonicSmashBrawl"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/ssb"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/sonic-smash-brawl-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/sonic-smash-brawl-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/sonicsmashbrawl.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's ssb binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.0" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2-2.0"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2_2.0"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-2.0-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-2.0-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2_2.0.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2_2.0 binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYDEBUGLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH.debug" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO chmod 755 "$SRB2BINARYLNXPATH.debug"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/lsdlsrb2" "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 $(find "$BUILD" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYDEBUGLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-cb" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2CB"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2cb"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-cb-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-cb-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2cb.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2cb binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/lsdlsrb2" "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/xsrb2" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/XSRB2"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/xsrb2"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/xsrb2-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/xsrb2-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/xsrb2.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's xsrb2 binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYDEBUGLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH.debug" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO chmod 755 "$SRB2BINARYLNXPATH.debug"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/lsdlxsrb2" "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 $(find "$BUILD" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYDEBUGLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2SF94Serv"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2sf94serv"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-sf94-serv-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-sf94-serv-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2sf94serv.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2sf94serv binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYDEBUGLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH.debug" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO chmod 755 "$SRB2BINARYLNXPATH.debug"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/SF94SRB2" "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 $(find "$BUILD" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYDEBUGLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-riders" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2Riders"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2riders"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-riders-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-riders-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2riders.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2riders binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYDEBUGLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH.debug" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO chmod 755 "$SRB2BINARYLNXPATH.debug"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/lsdlsrb2" "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 $(find "$BUILD" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYDEBUGLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SuperSRB2KartZ"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/supersrb2kartz"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/super-srb2-kart-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/super-srb2-kart-z-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/supersrb2kartz.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's supersrb2kartz binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYDEBUGLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH.debug" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO chmod 755 "$SRB2BINARYLNXPATH.debug"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/lsdlsrb2" "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 $(find "$BUILD" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYDEBUGLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/sbb2" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SBB2"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/sbb2"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/sbb2-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/sbb2-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/sbb2.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's sbb2 binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYDEBUGLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH.debug" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO chmod 755 "$SRB2BINARYLNXPATH.debug"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/lsdlsbb2" "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 $(find "$BUILD" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYDEBUGLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-final-demo" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2FinalDemo"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2fd"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-final-demo-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-final-demo-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2finaldemo.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2fd binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-1095" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB21095"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb21095"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-1095-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-1095-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb21095.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb21095 binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-jte" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2JTE"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2jte"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-jte-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-jte-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2jte.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2jte binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/shufflarb2" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SHUFFLARB2"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/shufflarb2"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/shufflarb2-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/shufflarb2-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/shufflarb2.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's shufflarb2 binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/lsdlsrb2" "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-live" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2Live"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2live"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-live-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-live-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2live.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2live binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/lsdlsrb2" "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-loz" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2LoZ"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2loz"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-loz-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-loz-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2loz.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2loz binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\ncd '$SRB2ASSETLNXPATH'\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/lsdlsrb2" "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/ssbss" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SSBSS"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/ssbss"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/ssbss-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/ssbss-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/ssbss.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's ssbss binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport SRB2WADDIR='$SRB2ASSETLNXPATH'\nexport LD_LIBRARY_PATH='$SRB2ASSETLNXPATH'\nexport DBUS_FATAL_WARNINGS=0\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/lsdlsrb2" "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/newmillennium" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/NewMillennium"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/newmillennium"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/newmillennium.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/newmillennium.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's newmillennium binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" = "musl" ]; then

                LDMUSL="$SRB2ASSETLNXPATH/ld-musl-i386.so.1"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH=$(dirname $(file -L $(find -L /usr/lib32 /lib -name libGL.so.[0-9] 2> /dev/null) | gawk -F'\'':'\'' '\''/32-bit/ {print $1}'\'') 2> /dev/null):'$SRB2ASSETLNXPATH'\nexport LIBGL_DRIVERS_PATH='$SRB2ASSETLNXPATH'/dri\nexport __EGL_VENDOR_LIBRARY_DIRS=/etc/glvnd/egl_vendor.d:/usr/share/glvnd/egl_vendor.d\nexport __GLX_VENDOR_LIBRARY_NAME=mesa\nexport GALLIUM_DRIVER=llvmpipe\nexport MESA_LOADER_DRIVER_OVERRIDE=llvmpipe\nexport LIBGL_ALWAYS_SOFTWARE=1\nexport __NV_PRIME_RENDER_OFFLOAD=0\nexport DBUS_FATAL_WARNINGS=0\n\ncd '$SRB2ASSETLNXPATH'\n\nexec '$LDMUSL' '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/NewMillennium" "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/lib"/* "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-persona" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2Persona"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2p"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-persona-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-persona-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2persona.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2p binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2Kart"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2kart"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-kart-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-kart-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2kart.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2kart binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-galaxy" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2KartGalaxy"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2kartgalaxy"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-kart-galaxy-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-kart-galaxy-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2kartgalaxy.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2kartgalaxy binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-hep" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2KartHEP"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2karthep"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-kart-hep-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-kart-hep-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2karthep.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2karthep binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-saturn" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2KartSaturn"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2kartsaturn"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-kart-saturn-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-kart-saturn-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2kartsaturn.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2kartsaturn binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-neptune" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2KartNeptune"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2kartneptune"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-kart-neptune-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-kart-neptune-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2kartneptune.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2kartneptune binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-vr" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2KartVR"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/srb2kartvr"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-kart-vr-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-kart-vr-opengl.desktop"
        SRB2DESKTOPOPENVRLNXPATH="$SRB2BLDPREFIX/share/applications/srb2-kart-vr-openvr.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/srb2kartvr.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's srb2kartvr binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/blankart" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/SRB2Kart-V2"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/blankart"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/blankart-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/blankart-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/blankart.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's blankart binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/build/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/ring-racers" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/RingRacers"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/ringracers"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/ring-racers-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/ring-racers-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/ringracers.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's ringracers binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/build/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/ring-racers-noire" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/RingRacersNoire"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/ringracersnoire"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/ring-racers-noire-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/ring-racers-noire-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/ringracersnoire.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's ringracersnoire binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/build/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/ring-racers-hep" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/RingRacersHEP"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/ringracershep"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/ring-racers-hep-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/ring-racers-hep-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/ringracershep.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's ringracershep binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/build/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/ring-racers-freaky-build" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/RingRacersFreakyBuild"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/ringracersfreakybuild"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/ring-racers-freaky-build-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/ring-racers-freaky-build-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/ringracersfreakybuild.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's ringracersfreakybuild binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/build/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/radio-racers" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/RadioRacers"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/radioracers"
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/radio-racers-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/radio-racers-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/radioracers.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's radioracers binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -type f 2> /dev/null | head -n1) "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 $(find "$BUILD/build/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$SRB2BINARYDEBUGLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"/* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$(dirname $BUILD)" = "$BUILDPATH/srb2-custom" ]; then

        SRB2CASSETDIR=$(gawk -F'"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)
        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/games/"$SRB2CASSETDIR"C"$CUSTOMDIR""
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/$($PRINTF "%s\n" "$SRB2CASSETDIR" | gawk '{print tolower($0)}')c"$CUSTOMDIR""
        SRB2BINARYDEBUGLNXPATH=""$SRB2BINARYLNXPATH".debug"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/$($PRINTF "%s\n" "$SRB2CASSETDIR" | gawk '{print tolower($0)}')c"$CUSTOMDIR"-software.desktop"
        SRB2DESKTOPOPENGLLNXPATH="$SRB2BLDPREFIX/share/applications/$($PRINTF "%s\n" "$SRB2CASSETDIR" | gawk '{print tolower($0)}')c"$CUSTOMDIR"-opengl.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/$($PRINTF "%s\n" "$SRB2CASSETDIR" | gawk '{print tolower($0)}')c"$CUSTOMDIR".png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's $($PRINTF "%s\n" "$SRB2CASSETDIR" | gawk '{print tolower($0)}')c"$CUSTOMDIR" binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 $(find "$BUILD/build/AppDir/usr/bin" -mindepth 1 -maxdepth 1 -type f ! -name "*.debug" 2> /dev/null) "$SRB2BINARYLNXPATH"

            if [ -f "$(find "$BUILD/bin" "$BUILD/build/bin" -type f -name "*.debug" 2> /dev/null)" ]; then

                $SUDO install -Dm755 $(find "$BUILD/bin" "$BUILD/build/bin" -type f -name "*.debug" 2> /dev/null) "$SRB2BINARYDEBUGLNXPATH"

            fi

            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf $(
                $SUDO find "$BUILD/build/AppDir/usr/games" -mindepth 2 -maxdepth 2 -type f -regex ".*\.[a-z]*[0-9]*" 2> /dev/null
                $SUDO find "$BUILD/build/AppDir/usr/games" -mindepth 2 -maxdepth 2 -type d 2> /dev/null
            ) "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/wadcli" ]; then

        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/wadcli"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/wadcli.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/wadcli.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's wadcli binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/wadcli" "$SRB2BINARYLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/kartmaker" ]; then

        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/kartmaker"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/kartmaker.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/kartmaker.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's kartmaker binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/kartmaker" "$SRB2BINARYLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/neptunefm" ]; then

        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/neptunefm"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/neptunefm.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/neptunefm.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's neptunefm binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/neptunefm" "$SRB2BINARYLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ]; then

        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/kartmaker_rr"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/kartmaker-ring-racers.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/kartmakerringracers.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's kartmaker_rr binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/kartmaker" "$SRB2BINARYLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/followermaker" ]; then

        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/followermaker"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/followermaker.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/followermaker.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's followermaker binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/followermaker" "$SRB2BINARYLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/slade" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/slade3"
        SRB2LIBRARYLNXPATH="$SRB2BLDPREFIX/lib/slade3"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/slade"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/slade.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/slade.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's slade binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            if [ "$LIBC" != "musl" ]; then

                $SUDO install -d "$SRB2ASSETLNXPATH/mime" "$SRB2ASSETLNXPATH/icons" "$SRB2LIBRARYLNXPATH"
                printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH='$SRB2LIBRARYLNXPATH':'$SRB2LIBRARYLNXPATH'/gtk-3.0/modules\nexport GTK_PATH='$SRB2LIBRARYLNXPATH'/gtk-3.0\nexport GIO_MODULE_DIR='$SRB2LIBRARYLNXPATH'/gio/modules\nexport GIO_EXTRA_MODULES='$SRB2LIBRARYLNXPATH'/gio/modules\nexport GDK_PIXBUF_MODULEDIR='$SRB2LIBRARYLNXPATH'/gdk-pixbuf/loaders\nexport GDK_PIXBUF_MODULE_FILE='$SRB2LIBRARYLNXPATH'/gdk-pixbuf/loaders.cache\nexport XDG_DATA_DIRS='$SRB2ASSETLNXPATH':'$SRB2ASSETLNXPATH'/mime:$XDG_DATA_DIRS\nexport KDE_FULL_SESSION=false\n\nexec '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
                $SUDO install -Dm644 "$BUILD/build/AppDir/usr/lib/"*.so* -t "$SRB2LIBRARYLNXPATH"
                $SUDO install -Dm644 "$BUILD/build/AppDir/usr/lib/gtk-3.0/modules/"* -t "$SRB2LIBRARYLNXPATH/gtk-3.0/modules"
                $SUDO install -Dm644 "$BUILD/build/AppDir/usr/lib/gio/modules/"* -t "$SRB2LIBRARYLNXPATH/gio/modules"
                $SUDO install -Dm644 "$BUILD/build/AppDir/usr/lib/gdk-pixbuf/loaders/"* -t "$SRB2LIBRARYLNXPATH/gdk-pixbuf/loaders"
                $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/glib-2.0/schemas/"* -t "$SRB2ASSETLNXPATH/glib-2.0/schemas"
                $SUDO cp -rf "$BUILD/build/AppDir/usr/share/mime/"* "$SRB2ASSETLNXPATH/mime"
                $SUDO cp -rf "$BUILD/build/AppDir/usr/share/icons/"* "$SRB2ASSETLNXPATH/icons"
                LD_LIBRARY_PATH="$SRB2LIBRARYLNXPATH" GIO_MODULE_DIR="$SRB2LIBRARYLNXPATH/gio/modules" GIO_EXTRA_MODULES="$SRB2LIBRARYLNXPATH/gio/modules" GDK_PIXBUF_MODULEDIR="$SRB2LIBRARYLNXPATH/gdk-pixbuf/loaders" $(find / -type f -name "gdk-pixbuf-query-loaders*" -executable -o -type l -xtype f -name "gdk-pixbuf-query-loaders*" -executable 2> /dev/null | head -n1) | $SUDO tee "$SRB2LIBRARYLNXPATH/gdk-pixbuf/loaders.cache" > /dev/null

            else

                $SUDO install -d "$SRB2ASSETLNXPATH"
                printf '#!/bin/sh\n\nexport XDG_DATA_DIRS=/usr/share:/usr/local/share:$XDG_DATA_DIRS\nexport KDE_FULL_SESSION=false\n\nexec '$SRB2ASSETLNXPATH'/'$($PRINTF "%s\n" $SRB2BINARYLNXPATH | gawk -F'/' '{print $NF}')'.bin "$@"\n' | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null

            fi

            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/slade" "$SRB2ASSETLNXPATH/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            $SUDO install -Dm644 $(find "$BUILD/build" -type f -name slade.pk3 2> /dev/null | head -n1) -t "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/ultimate-zone-builder" ] || [ "$BUILD" = "$BUILDPATH/ultimate-gksz-builder" ] || [ "$BUILD" = "$BUILDPATH/ultimate-lowee-builder" ] || [ "$BUILD" = "$BUILDPATH/high-voltage-ring" ]; then

        if [ "$BUILD" = "$BUILDPATH/ultimate-zone-builder" ]; then

            UZBSHARE="ultimatezonebuilder"
            UZBBIN="uzb"

        elif [ "$BUILD" = "$BUILDPATH/ultimate-gksz-builder" ]; then

            UZBSHARE="ultimategkszbuilder"
            UZBBIN="ugb"

        elif [ "$BUILD" = "$BUILDPATH/ultimate-lowee-builder" ]; then

            UZBSHARE="ultimateloweebuilder"
            UZBBIN="ulb"

        elif [ "$BUILD" = "$BUILDPATH/high-voltage-ring" ]; then

            UZBSHARE="highvoltagering"
            UZBBIN="hvr"

        fi

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/$UZBSHARE"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/$UZBBIN"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/$UZBSHARE.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/$UZBSHARE.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's $UZBBIN binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            cat << UZB | $SUDO tee "$SRB2BINARYLNXPATH" > /dev/null
#!/bin/sh

cd "$SRB2ASSETLNXPATH"

PRINTF=\$(which -a printf 2> /dev/null | gawk '/bin/ {print}' | head -n1)
UZBLIBRARIES=\$(DISPLAY= "$SRB2ASSETLNXPATH/$UZBBIN.bin" 2>&1 | gawk -F':' '{IGNORECASE=1} /Error/ && /no such file or directory/ && !/ld-linux/ || /undefined symbol|symbol not found/ {print \$2}' | gawk '{print \$NF}')

if [ -n "\$UZBLIBRARIES" ]; then

    \$PRINTF "\e[1;93m\n%s\n\e[0m" "$BUILDNAME wasn't run in Mono bundle successfully due to error:
\$(DISPLAY= "$SRB2ASSETLNXPATH/$UZBBIN.bin" 2>&1 | gawk -F':' '{IGNORECASE=1} /Error/ && /no such file or directory/ && !/ld-linux/ || /undefined symbol|symbol not found/ {print \$2}')

Mono command will start $(printf "%s\n" "$UZBBIN" | gawk '{print toupper($0)}') instead."

    if [ -x "\$(command -v mono)" ]; then

        UZBLIBRARIES=\$(DISPLAY= MONO_LOG_LEVEL=debug mono Builder.exe 2>&1 | gawk -F''\''' '/DllImport unable to load library/ {print \$2}' | uniq)

        mono Builder.exe "\$@" || [ -n "\$UZBLIBRARIES" ] && \$PRINTF "\e[1;93m\n%s\n\e[0m" "$BUILDNAME didn't run successfully. Please check if you have these libraries in your path and install them if they are not there:
"\$UZBLIBRARIES"

Exiting..."

    else

        \$PRINTF "\e[1;93m\n%s\n\e[0m" "Please install \"mono\" to run program."
        exit 1

    fi

else

    if [ "\$(ldd --version 2>&1 | gawk 'match(\$0, /musl/) {print substr(\$0, RSTART, RLENGTH)}' | gawk '!a[\$0]++ {print}')" = "musl" ] && ([ ! -f "/lib/libgcompat.so.0" ] && [ ! -f "/usr/lib/libgcompat.so.0" ]); then

        \$PRINTF "\e[1;93m\n%s\n\e[0m" "Please install \"gcompat\" to run program."
        exit 1

    fi

    "$SRB2ASSETLNXPATH/$UZBBIN.bin" "\$@" || [ "\$?" != "137" ] && (([ ! -x "\$(command -v mono)" ] && (([ "\$(command -v zenity)" ] && zenity --warning --text "Please install \"mono\" to run program." || exit 1) || \$PRINTF "\e[1;93m\n%s\n\e[0m" "Please install \"mono\" to run program." && exit 1)) || mono Builder.exe "\$@")

fi

UZB

            $SUDO chmod 755 "$SRB2BINARYLNXPATH"
            $SUDO install -d "$SRB2ASSETLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/bin/"* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* "$SRB2ICONLNXPATH"

        fi

    elif [ "$BUILD" = "$BUILDPATH/aseprite" ]; then

        SRB2ASSETLNXPATH="$SRB2BLDPREFIX/share/aseprite"
        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/bin/aseprite"
        SRB2DESKTOPLNXPATH="$SRB2BLDPREFIX/share/applications/aseprite.desktop"
        SRB2ICONLNXPATH="$SRB2BLDPREFIX/share/icons/hicolor/$SRB2LNXICONSIZE/apps/aseprite.png"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's aseprite binary, assets, icons and desktop file to the system. Please wait..."

        if [ "$LNXOSNAME" != "NixOS" ]; then

            $SUDO install -Dm755 "$BUILD/build/AppDir/usr/bin/aseprite" "$SRB2BINARYLNXPATH"
            $SUDO cp -rf "$BUILD/build/AppDir/usr/share/aseprite"* "$SRB2ASSETLNXPATH"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/applications/"* -t "$SRB2BLDPREFIX/share/applications"
            $SUDO install -Dm644 "$BUILD/build/AppDir/usr/share/icons/hicolor/$SRB2LNXICONSIZE/apps/icon.png" "$SRB2ICONLNXPATH"

        fi

    fi

    # Create flake for NixOS.
    if [ "$LNXOSNAME" = "NixOS" ]; then

        NIXOSFLAKEBUILDPATH="/tmp/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')"

        if [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u -| -u$| --user -| --user$/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk 'match($0, /\/home\/'$USER'\/.local/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$ISREADONLY" ]; then

            NIXOSINSTALLPREFIXPATH="\$HOME/.nix-profile"

        else

            NIXOSINSTALLPREFIXPATH="/nix/var/nix/profiles/default"

        fi

        cp -rf "$BUILD/build/AppDir" "$NIXOSFLAKEBUILDPATH"

        if [ "$BUILD" = "$BUILDPATH/wadcli" ]; then

            # Setting path to interpreter.
            if [ -z "$(ldd "$NIXOSFLAKEBUILDPATH/usr/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')" 2>&1 2> /dev/null)" ]; then

                $SUDO patchelf --set-interpreter $(ldd "$BUILD/build/AppDir/usr/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')" 2>&1 | gawk '/ld-linux.*/ {print $3}') "$NIXOSFLAKEBUILDPATH/usr/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')" 2> /dev/null || true

            fi

            cat > "$NIXOSFLAKEBUILDPATH/flake.nix" << NIX
{
  inputs = {
    nixpkgs.url = "github:NixOS/nixpkgs";
  };

  outputs = { self, nixpkgs }:
    let
      # Update the localFile to the actual path where the binary is located.
      localFile = ./usr;
    in
    {
      defaultPackage.$ARCH-linux =
        with import nixpkgs { system = "$ARCH-linux"; };

        stdenv.mkDerivation rec {
          name = "$($PRINTF "%s\n" "$BUILDNAME" | gawk '{gsub(" ","-"); print tolower($0)}')-\${version}";

          version = "$(git -C "$BUILD" rev-parse --short HEAD)";

          # Set src to the localFile path
          src = localFile;

          nativeBuildInputs = [
            autoPatchelfHook
          ];

          sourceRoot = ".";

          installPhase = ''
            install -d "\$out/bin"
            printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH=$NIXOSINSTALLPREFIXPATH/lib/wadcli\n\nexec $NIXOSINSTALLPREFIXPATH/share/wadcli/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin \"\$@\"\n' > "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            chmod 755 "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            install -d "\$out/share/wadcli"
            install -Dm755 "\$src/bin/"* "\$out/share/wadcli/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            install -Dm644 "\$src/lib/"* -t "\$out/lib/wadcli"
            install -Dm644 "\$src/share/applications/"* -t "\$out/share/applications"
            install -Dm644 "\$src/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* -t "\$out/share/icons/hicolor/$SRB2LNXICONSIZE/apps"
          '';
        };
    };
}
NIX

        elif [ "$BUILD" = "$BUILDPATH/kartmaker" ] || [ "$BUILD" = "$BUILDPATH/neptunefm" ] || [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ] || [ "$BUILD" = "$BUILDPATH/followermaker" ]; then

            # Setting path to interpreter.
            if [ -z "$(ldd "$NIXOSFLAKEBUILDPATH/usr/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')" 2>&1 2> /dev/null)" ]; then

                $SUDO patchelf --set-interpreter $(ldd "$BUILD/build/AppDir/usr/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')" 2>&1 | gawk '/ld-linux.*/ {print $3}') "$NIXOSFLAKEBUILDPATH/usr/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')" 2> /dev/null || true

            fi

            cat > "$NIXOSFLAKEBUILDPATH/flake.nix" << NIX
{
  inputs = {
    nixpkgs.url = "github:NixOS/nixpkgs";
  };

  outputs = { self, nixpkgs }:
    let
      # Update the localFile to the actual path where the binary is located.
      localFile = ./usr;
    in
    {
      defaultPackage.$ARCH-linux =
        with import nixpkgs { system = "$ARCH-linux"; };

        stdenv.mkDerivation rec {
          name = "$($PRINTF "%s\n" "$BUILDNAME" | gawk '{gsub(" ","-"); print tolower($0)}')-\${version}";

          version = "$(git -C "$BUILD" rev-parse --short HEAD)";

          # Set src to the localFile path
          src = localFile;

          nativeBuildInputs = [
            autoPatchelfHook
          ];

          sourceRoot = ".";

          installPhase = ''
            install -d "\$out/bin"
            printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH=$NIXOSINSTALLPREFIXPATH/lib/kartmaker\n\nexec $NIXOSINSTALLPREFIXPATH/share/kartmaker/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin \"\$@\"\n' > "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            chmod 755 "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            install -d "\$out/share/kartmaker"
            install -Dm755 "\$src/bin/"* "\$out/share/kartmaker/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            install -Dm644 "\$src/share/applications/"* -t "\$out/share/applications"
            install -Dm644 "\$src/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* -t "\$out/share/icons/hicolor/$SRB2LNXICONSIZE/apps"
          '';
        };
    };
}
NIX

        elif [ "$BUILD" = "$BUILDPATH/slade" ]; then

            install -Dm644 $(find "$BUILD/build" -type f -name slade.pk3 2> /dev/null | head -n1) -t "$NIXOSFLAKEBUILDPATH/usr/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')"

            # Setting path to interpreter.
            if [ -z "$(ldd "$NIXOSFLAKEBUILDPATH/usr/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')" 2>&1 2> /dev/null)" ]; then

                $SUDO patchelf --set-interpreter $(ldd "$BUILD/build/AppDir/usr/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')" 2>&1 | gawk '/ld-linux.*/ {print $3}') "$NIXOSFLAKEBUILDPATH/usr/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')" 2> /dev/null || true

            fi

            cat > "$NIXOSFLAKEBUILDPATH/flake.nix" << NIX
{
  inputs = {
    nixpkgs.url = "github:NixOS/nixpkgs";
  };

  outputs = { self, nixpkgs }:
    let
      # Update the localFile to the actual path where the binary is located.
      localFile = ./usr;
    in
    {
      defaultPackage.$ARCH-linux =
        with import nixpkgs { system = "$ARCH-linux"; };

        stdenv.mkDerivation rec {
          name = "$($PRINTF "%s\n" "$BUILDNAME" | gawk '{gsub(" ","-"); print tolower($0)}')-\${version}";

          version = "$(git -C "$BUILD" rev-parse --short HEAD)";

          # Set src to the localFile path
          src = localFile;

          nativeBuildInputs = [
            autoPatchelfHook
          ];

          buildInputs = [
            gdk-pixbuf
          ];

          sourceRoot = ".";

          installPhase = ''
            install -d "\$out/bin" "\$out/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')" "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/mime"
            printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH=$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2LIBRARYLNXPATH" | gawk -F'/' '{print $NF}'):$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2LIBRARYLNXPATH" | gawk -F'/' '{print $NF}')/gtk-3.0/modules\nexport GIO_MODULE_DIR=$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2LIBRARYLNXPATH" | gawk -F'/' '{print $NF}')/gio/modules\nexport GIO_EXTRA_MODULES=$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2LIBRARYLNXPATH" | gawk -F'/' '{print $NF}')/gio/modules\nexport GDK_PIXBUF_MODULEDIR=$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2LIBRARYLNXPATH" | gawk -F'/' '{print $NF}')/gdk-pixbuf/loaders\nexport GDK_PIXBUF_MODULE_FILE=$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2LIBRARYLNXPATH" | gawk -F'/' '{print $NF}')/gdk-pixbuf/loaders.cache\nexport XDG_DATA_DIRS=$NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}'):$NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/mime:/run/current-system/sw/share:$XDG_DATA_DIRS\nexport KDE_FULL_SESSION=false\n\nexec $NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin \"\$@\"\n' > "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            chmod 755 "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            install -Dm755 "\$src/bin/"* "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            install -Dm644 "\$src/lib/"*.so* -t "\$out/lib/$($PRINTF "%s\n" "$SRB2LIBRARYLNXPATH" | gawk -F'/' '{print $NF}')"
            install -Dm644 "\$src/lib/gtk-3.0/modules/"* -t "\$out/lib/$($PRINTF "%s\n" "$SRB2LIBRARYLNXPATH" | gawk -F'/' '{print $NF}')/gtk-3.0/modules"
            install -Dm644 "\$src/lib/gio/modules/"* -t "\$out/lib/$($PRINTF "%s\n" "$SRB2LIBRARYLNXPATH" | gawk -F'/' '{print $NF}')/gio/modules"
            install -Dm644 "\$src/lib/gdk-pixbuf/loaders/"* -t "\$out/lib/$($PRINTF "%s\n" "$SRB2LIBRARYLNXPATH" | gawk -F'/' '{print $NF}')/gdk-pixbuf/loaders"
            install -Dm644 "\$src/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/slade.pk3" "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')"
            install -Dm644 "\$src/share/glib-2.0/schemas/"* -t "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/glib-2.0/schemas"
            cp -rf "\$src/share/mime/"* "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/mime"
            install -Dm644 "\$src/share/applications/"* -t "\$out/share/applications"
            install -Dm644 "\$src/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* -t "\$out/share/icons/hicolor/$SRB2LNXICONSIZE/apps"
            LD_LIBRARY_PATH="\$out/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')" GIO_MODULE_DIR="\$out/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/gio/modules" GIO_EXTRA_MODULES="\$out/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/gio/modules" GDK_PIXBUF_MODULEDIR="\$out/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/gdk-pixbuf/loaders" gdk-pixbuf-query-loaders > "\$out/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/gdk-pixbuf/loaders.cache"
          '';
        };
    };
}
NIX

        elif [ "$BUILD" = "$BUILDPATH/ultimate-zone-builder" ] || [ "$BUILD" = "$BUILDPATH/ultimate-gksz-builder" ] || [ "$BUILD" = "$BUILDPATH/ultimate-lowee-builder" ] || [ "$BUILD" = "$BUILDPATH/high-voltage-ring" ]; then

            cat > "$NIXOSFLAKEBUILDPATH/flake.nix" << NIX
{
  inputs = {
    nixpkgs.url = "github:NixOS/nixpkgs";
  };

  outputs = { self, nixpkgs }:
    let
      # Update the localFile to the actual path where the binary is located.
      localFile = ./usr;
    in
    {
      defaultPackage.$ARCH-linux =
        with import nixpkgs { system = "$ARCH-linux"; };

        stdenv.mkDerivation rec {
          name = "$($PRINTF "%s\n" "$BUILDNAME" | gawk '{gsub(" ","-"); print tolower($0)}')-\${version}";

          version = "$(git -C "$BUILD" rev-parse --short HEAD)";

          # Set src to the localFile path
          src = localFile;

          sourceRoot = ".";

          installPhase = ''
            install -d "\$out/bin"
            printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH=$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')\n\ncd $NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')\n\nmono Builder.exe \"\$@\" || ([ ! -x "\$(command -v mono)" ] && (([ "\$(command -v zenity)" ] && zenity --warning --text "Please install \\\"mono\\\" to run program." || exit 1) || $PRINTF "\\\e[1;93m\\\n%s\\\n\\\e[0m" "Please install \\\"mono\\\" to run program." && exit 1))\n' > "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            chmod 755 "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            install -d "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')"
            cp -rf "\$src/bin/"* "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')"
            install -Dm644 "\$src/lib/"* -t "\$out/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')"
            install -Dm644 "\$src/share/applications/"* -t "\$out/share/applications"
            install -Dm644 "\$src/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* -t "\$out/share/icons/hicolor/$SRB2LNXICONSIZE/apps"
          '';
        };
    };
}
NIX

        elif [ "$BUILD" = "$BUILDPATH/srb2-2.0" ] || [ "$BUILD" = "$BUILDPATH/srb2-cb" ] || [ "$BUILD" = "$BUILDPATH/xsrb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ] || [ "$BUILD" = "$BUILDPATH/srb2-riders" ] || [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ] || [ "$BUILD" = "$BUILDPATH/sbb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-final-demo" ] || [ "$BUILD" = "$BUILDPATH/srb2-1095" ] || [ "$BUILD" = "$BUILDPATH/srb2-jte" ] || [ "$BUILD" = "$BUILDPATH/shufflarb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-live" ] || [ "$BUILD" = "$BUILDPATH/srb2-loz" ] || [ "$BUILD" = "$BUILDPATH/ssbss" ] || [ "$BUILD" = "$BUILDPATH/newmillennium" ]; then

            cat > "$NIXOSFLAKEBUILDPATH/flake.nix" << NIX
{
  inputs = {
    nixpkgs.url = "github:NixOS/nixpkgs";
  };

  outputs = { self, nixpkgs }:
    let
      # Update the localFile to the actual path where the binary is located.
      localFile = ./usr;
    in
    {
      defaultPackage.$ARCH-linux =
        with import nixpkgs { system = "$ARCH-linux"; };

        pkgsi686Linux.stdenv.mkDerivation rec {
          name = "$($PRINTF "%s\n" "$BUILDNAME" | gawk '{gsub(" ","-"); print tolower($0)}')-\${version}";

          version = "$(git -C "$BUILD" rev-parse --short HEAD)";

          # Set src to the localFile path
          src = localFile;

          sourceRoot = ".";

          nativeBuildInputs = [
            autoPatchelfHook
            pkgsi686Linux.zlib
            pkgsi686Linux.zstd
          ];

          installPhase = ''
            install -d "\$out/bin" "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')" "\$out/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')"
            printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH=$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}'):/nix/var/nix/profiles/system/sw/lib\nexport LIBGL_DRIVERS_PATH=$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/dri\nexport __EGL_VENDOR_LIBRARY_DIRS=/etc/glvnd/egl_vendor.d:/usr/share/glvnd/egl_vendor.d\nexport __GLX_VENDOR_LIBRARY_NAME=mesa\nexport GALLIUM_DRIVER=llvmpipe\nexport MESA_LOADER_DRIVER_OVERRIDE=llvmpipe\nexport LIBGL_ALWAYS_SOFTWARE=1\nexport __NV_PRIME_RENDER_OFFLOAD=0\nexport DBUS_FATAL_WARNINGS=0\nexport SRB2WADDIR=$NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')\n\ncd $NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')\n\nexec $NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin \"\$@\"\n' > "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH=$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}'):/nix/var/nix/profiles/system/sw/lib\nexport LIBGL_DRIVERS_PATH=$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/dri\nexport __EGL_VENDOR_LIBRARY_DIRS=/etc/glvnd/egl_vendor.d:/usr/share/glvnd/egl_vendor.d\nexport __GLX_VENDOR_LIBRARY_NAME=mesa\nexport GALLIUM_DRIVER=llvmpipe\nexport MESA_LOADER_DRIVER_OVERRIDE=llvmpipe\nexport LIBGL_ALWAYS_SOFTWARE=1\nexport __NV_PRIME_RENDER_OFFLOAD=0\nexport DBUS_FATAL_WARNINGS=0\export SRB2WADDIR=$NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')\n\ncd $NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')\n\nexec $NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')-debug.bin \"\$@\"\n' > "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').debug"
            chmod 755 "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            chmod 755 "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').debug"
            install -Dm755 \$(find "\$src/bin" -type f 2> /dev/null | gawk '!/\.debug/ {print}' | head -n1) "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            install -Dm755 \$(find "\$src/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')-debug.bin" || true
            cp -rf "\$src/games/"*/* "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')"
            cp -rf "\$src/lib/"* "\$out/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')"
            install -Dm644 "\$src/share/applications/"* -t "\$out/share/applications"
            install -Dm644 "\$src/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* -t "\$out/share/icons/hicolor/$SRB2LNXICONSIZE/apps"
          '';
        };
    };
}
NIX

        elif [ "$BUILD" = "$BUILDPATH/aseprite" ]; then

            # Setting path to interpreter.
            if [ -z "$(ldd "$NIXOSFLAKEBUILDPATH/usr/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')" 2>&1 2> /dev/null)" ]; then

                $SUDO patchelf --set-interpreter $(ldd "$BUILD/build/AppDir/usr/bin/"* 2>&1 | gawk '/ld-linux.*/ {print $3}') "$NIXOSFLAKEBUILDPATH/usr/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')" 2> /dev/null || true

            fi

            cat > "$NIXOSFLAKEBUILDPATH/flake.nix" << NIX

{
  inputs = {
    nixpkgs.url = "github:NixOS/nixpkgs";
  };

  outputs = { self, nixpkgs }:
    let
      # Update the localFile to the actual path where the binary is located.
      localFile = ./usr;
    in
    {
      defaultPackage.$ARCH-linux =
        with import nixpkgs { system = "$ARCH-linux"; };

        stdenv.mkDerivation rec {
          name = "$($PRINTF "%s\n" "$BUILDNAME" | gawk '{gsub(" ","-"); print tolower($0)}')-\${version}";

          version = "$(git -C "$BUILD" rev-parse --short HEAD)";

          # Set src to the localFile path
          src = localFile;

          sourceRoot = ".";

          nativeBuildInputs = [
            autoPatchelfHook
          ];

          installPhase = ''
            install -d "\$out/bin" "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')" "\$out/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')"
            printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH=$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')\n\nexec $NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin \"\$@\"\n' > "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            chmod 755 "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            install -Dm755 "\$src/bin/aseprite" "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            cp -rf "\$src/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/"* "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')"
            cp -rf "\$src/lib/"* "\$out/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')"
            install -Dm644 "\$src/share/applications/"* -t "\$out/share/applications"
            install -Dm644 "\$src/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* -t "\$out/share/icons/hicolor/$SRB2LNXICONSIZE/apps"
          '';
        };
    };
}
NIX

        else

            if [ -n "$(gawk -F'"' '/envstr = I_GetEnv\(".*"\)\) != NULL\) && isWadPathOk\(envstr\)\)/ {print $2}' "$BUILD/src/sdl/i_system.c"*)" ]; then

                WADDIR=$(gawk -F'"' '/envstr = I_GetEnv\(".*"\)\) != NULL\) && isWadPathOk\(envstr\)\)/ {print $2}' "$BUILD/src/sdl/i_system.c"*)

            else

                WADDIR="SRB2WADDIR"

            fi

            # Copy debug binary files.
            if [ -x "$(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1)" ]; then

                cp -f $(find "$BUILD/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "$NIXOSFLAKEBUILDPATH/usr/bin"

            fi

            # Setting path to interpreter.
            if [ -z "$(ldd "$NIXOSFLAKEBUILDPATH/usr/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')" 2>&1 2> /dev/null)" ]; then

                $SUDO patchelf --set-interpreter $(ldd "$BUILD/build/AppDir/usr/bin/"* 2>&1 | gawk '/ld-linux.*/ {print $3}') "$NIXOSFLAKEBUILDPATH/usr/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')" 2> /dev/null || true

            fi

            cat > "$NIXOSFLAKEBUILDPATH/flake.nix" << NIX

{
  inputs = {
    nixpkgs.url = "github:NixOS/nixpkgs";
  };

  outputs = { self, nixpkgs }:
    let
      # Update the localFile to the actual path where the binary is located.
      localFile = ./usr;
    in
    {
      defaultPackage.$ARCH-linux =
        with import nixpkgs { system = "$ARCH-linux"; };

        stdenv.mkDerivation rec {
          name = "$($PRINTF "%s\n" "$BUILDNAME" | gawk '{gsub(" ","-"); print tolower($0)}')-\${version}";

          version = "$(git -C "$BUILD" rev-parse --short HEAD)";

          # Set src to the localFile path.
          src = localFile;

          sourceRoot = ".";

          nativeBuildInputs = [
            autoPatchelfHook
          ];

          buildInputs = [
            libglvnd
            xorg.libXi
            systemdLibs
          ];

          autoPatchelfIgnoreMissingDeps = true;

          dontBuild = true;

          installPhase = ''
            install -d "\$out/bin"
            printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH=\${lib.makeLibraryPath buildInputs}:$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')\nexport $WADDIR=$NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')\n\nexec $NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin \"\$@\"\n' > "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            printf '#!/bin/sh\n\nexport LD_LIBRARY_PATH=\${lib.makeLibraryPath buildInputs}:$NIXOSINSTALLPREFIXPATH/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')\nexport $WADDIR=$NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')\n\nexec $NIXOSINSTALLPREFIXPATH/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')-debug.bin \"\$@\"\n' > "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').debug"
            chmod 755 "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')"
            chmod 755 "\$out/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').debug"
            install -Dm755 \$(find "\$src/bin" -type f 2> /dev/null | gawk '!/\.debug/ {print}' | head -n1) "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}').bin"
            install -Dm755 \$(find "\$src/bin" -type f -name "*.debug" 2> /dev/null | head -n1) "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')-debug.bin" || true
            cp -rf "\$src/games/"*/* "\$out/share/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')"
            install -Dm644 "\$src/lib/"* -t "\$out/lib/$($PRINTF "%s\n" "$SRB2ASSETLNXPATH" | gawk -F'/' '{print $NF}')"
            install -Dm644 "\$src/share/applications/"* -t "\$out/share/applications"
            install -Dm644 "\$src/share/icons/hicolor/$SRB2LNXICONSIZE/apps/"* -t "\$out/share/icons/hicolor/$SRB2LNXICONSIZE/apps"
          '';
        };
    };
}
NIX

        fi

        cd "/tmp" || exit
        $SUDO nix profile install -vv --extra-experimental-features 'nix-command flakes' "$NIXOSFLAKEBUILDPATH"
        SRB2NIXPATH="$(readlink -f $(command -v $($PRINTF "%s\n" $($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}'))) | gawk -F'/' '{print "/nix/store/"$4}')"
        rm -rf "$NIXOSFLAKEBUILDPATH"

    fi

    installtolist

    if [ "$LNXOSNAME" != "NixOS" ]; then

        # Refreshing menu icons.
        if [ "$OS" != "Darwin" ] && [ -x "$(command -v gtk-update-icon-cache 2> /dev/null)" ]; then

            $SUDO gtk-update-icon-cache -qft "$SRB2BLDPREFIX/share/icons/hicolor"

        elif [ -x "$(find /usr/bin -name "kbuildsycoca*" -mindepth 1 -maxdepth 1 2> /dev/null | head -n1)" ]; then

            $SUDO "$(find /usr/bin -name "kbuildsycoca*" -mindepth 1 -maxdepth 1 2> /dev/null | head -n1)" --noincremental

        fi

    fi

    # Install missing libraries and patching them to be linked against libSDL2_mixerX.
    LD_LIBRARY_PATH="$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib" ldd "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.so" 2>&1 2> /dev/null | gawk '/not found/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {print $1}' | sort -u | while read -r l; do

        if [ -x "$(command -v brew 2> /dev/null)" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing dependencies for libSDL2_mixer_ext.so. Please wait..."
            l=$(LD_LIBRARY_PATH="$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib" ldd "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.so" 2>&1 2> /dev/null | gawk '/not found/ && /'$($PRINTF "%s\n" "$l" | gawk '{gsub(".so.*",".so"); print}')'/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {print $1}' | head -n1)
            PACKAGE=$(curl -sL "https://packages.debian.org/search?suite=default&section=all&arch=any&searchon=contents&keywords=$($PRINTF "%s\n" "$l" | gawk '{gsub("\\+","\\+"); print}')" | gawk '-F">|</a>' '/<\/a> \[[a-z]*[0-9]*\]/ {gsub("-dev|-[0-9].[0-9]-|0|libpng12",""); gsub("libminiupnpc[0-9][0-9]","miniupnpc"); gsub("libsdl","sdl"); gsub("-","_"); gsub("lua_ham","lua"); gsub("wxgtk.*","wxwidgets"); gsub("libc\\+\\+.*","llvm"); gsub("sdl1.2_compat_shim","sdl12-compat"); gsub("sdl_mixer1.2","sdl_mixer"); gsub("libfluidsynth3","fluid-synth"); print $2}' | head -n1)

            PACKAGE=$($PRINTF "%s\n" "$PACKAGE" | gawk -F'/' '{print $NF}' | sort -u)

            brew install $PACKAGE || true

        else

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Patching paths to dependencies for libSDL2_mixer_ext.so. Please wait..."
            $SUDO patchelf --replace-needed "$l" $(find -L $SRB2BLDPREFIX/lib /home/linuxbrew/.linuxbrew/lib /nix/store /usr/lib64 /usr/lib -name $($PRINTF "%s\n" "$l" | gawk '{gsub(".so.*",""); print $0"*so*"}' | head -n1) 2> /dev/null | gawk '{if (/^\/home\/'$USER'\/.nix-portable\/store|^\/home\/linuxbrew\/.linuxbrew\/lib|^\/home\/'$USER'\/.local\/lib\/|^\/var\/home\/'$USER'\/.local\/lib\/|^\/usr\/local\/lib|^\/usr\/lib\/|^\/usr\/lib64|^\/usr\/lib32/ && !/slade3/) {print;exit} else if (/[0-9]\.[0-9]\/lib|[0-9]\.[0-9][0-9]\/lib|[0-9]\.[0-9]\/wx|[0-9]\.[0-9][0-9]\/wx|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/lib|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/wx|\/lib\/libz.so/ && !/libstdc\+\+[0-9]|lzfse|SDL2_.*/) {print;exit}}') "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.so" 2> /dev/null || true

        fi

    done

    installdepsglibc

    if [ -n "$(ldd $SRB2BINARYLNXPATH 2>&1 2> /dev/null | gawk '/not found/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {print $1}' | head -n1)" ]; then

        # Setting path to interpreter.
        if [ -z "$(ldd "$SRB2BINARYLNXPATH" 2>&1 2> /dev/null)" ]; then

            $SUDO patchelf --set-interpreter $(ldd "$SRB2BINARYLNXPATH" 2>&1 2> /dev/null | gawk '/ld-linux.*/ {print $3}') "$SRB2BINARYLNXPATH" || true

        fi

        # Setting rpath for homebrew only Linux OS and Steam Deck OS to avoid issues with broken compiled binary and library libSDL2_mixer_ext.so.
        if [ -x "$(command -v brew 2> /dev/null)" ]; then

            $SUDO patchelf --set-rpath "/home/linuxbrew/.linuxbrew/lib:$SRB2BLDPREFIX/lib" "$SRB2BINARYLNXPATH"

            if [ -f "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.so" ]; then

                $SUDO patchelf --set-rpath "/home/linuxbrew/.linuxbrew/lib" "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.so"

            fi

            if [ -d "$SRB2LIBRARYLNXPATH" ]; then

                $SUDO patchelf --set-rpath "/home/linuxbrew/.linuxbrew/lib:$SRB2BLDPREFIX/lib:$SRB2LIBRARYLNXPATH" "$SRB2BINARYLNXPATH"

            fi

        else

            # Patching compiled binary, in order to libraries to be found.
            n=0
            while [ "$n" -lt 3 ]; do

                n=$((n + 1))

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Patching paths to dependencies for $BUILDNAME. Please wait..."

                ldd "$SRB2BINARYLNXPATH" 2>&1 2> /dev/null | gawk '/not found/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {print $1}' | sort -u | while read -r l; do

                    VERSION=$($PRINTF "%s\n" "$l" | gawk 'match($0, /-[0-9]\.[0-9]|[0-9]\.[0-9]/) {gsub(".so.*|-",""); print substr($0, RSTART)}')

                    if [ -n "$VERSION" ]; then

                        $SUDO patchelf --replace-needed "$l" $(find -L $SRB2BLDPREFIX/lib /home/linuxbrew/.linuxbrew/lib /nix/store /usr/lib64 /usr/lib -name $($PRINTF "%s\n" "$l" | gawk '{gsub(".so.*|-'$VERSION'.*so.*|'$VERSION'.*so.*",""); print $0"*'$VERSION'*so*"}' | head -n1) 2> /dev/null | gawk '{if (/^\/home\/'$USER'\/.nix-portable\/store|^\/home\/linuxbrew\/.linuxbrew\/lib|^\/home\/'$USER'\/.local\/lib\/|^\/var\/home\/'$USER'\/.local\/lib\/|^\/usr\/local\/lib|^\/usr\/lib\/|^\/usr\/lib64|^\/usr\/lib32/ && !/slade3/) {print;exit} else if (/[0-9]\.[0-9]\/lib|[0-9]\.[0-9][0-9]\/lib|[0-9]\.[0-9]\/wx|[0-9]\.[0-9][0-9]\/wx|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/lib|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/wx|\/lib\/libz.so/ && !/libstdc\+\+[0-9]|lzfse|SDL2_.*/ || /SDL2_mixer/) {print;exit}}') "$SRB2BINARYLNXPATH" 2> /dev/null || true

                    else

                        $SUDO patchelf --replace-needed "$l" $(find -L $SRB2BLDPREFIX/lib /home/linuxbrew/.linuxbrew/lib /nix/store /usr/lib64 /usr/lib -name $($PRINTF "%s\n" "$l" | gawk '{gsub(".so.*",""); print $0"*so*"}' | head -n1) 2> /dev/null | gawk '{if (/^\/home\/'$USER'\/.nix-portable\/store|^\/home\/linuxbrew\/.linuxbrew\/lib|^\/home\/'$USER'\/.local\/lib\/|^\/var\/home\/'$USER'\/.local\/lib\/|^\/usr\/local\/lib|^\/usr\/lib\/|^\/usr\/lib64|^\/usr\/lib32/ && !/slade3/) {print;exit} else if (/[0-9]\.[0-9]\/lib|[0-9]\.[0-9][0-9]\/lib|[0-9]\.[0-9]\/wx|[0-9]\.[0-9][0-9]\/wx|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/lib|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/wx|\/lib\/libz.so/ && !/libstdc\+\+[0-9]|lzfse|SDL2_.*/ || /SDL2_mixer/) {print;exit}}') "$SRB2BINARYLNXPATH" 2> /dev/null || true

                    fi

                done

                # Additional patching, if still there are missing paths to libraries to be added to binary.
                ldd "$SRB2BINARYLNXPATH" 2>&1 2> /dev/null | gawk '/not found/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {print $1}' | sort -u | while read -r l; do

                    VERSION=$($PRINTF "%s\n" "$l" | gawk 'match($0, /-[0-9]\.[0-9]|[0-9]\.[0-9]/) {gsub(".so.*|-",""); print substr($0, RSTART)}')

                    if [ -n "$VERSION" ]; then

                        $SUDO patchelf --add-needed $(find -L $SRB2BLDPREFIX/lib /home/linuxbrew/.linuxbrew/lib /nix/store /usr/lib64 /usr/lib -name $($PRINTF "%s\n" "$l" | gawk '{gsub(".so.*|-'$VERSION'.*so.*|'$VERSION'.*so.*",""); print $0"*'$VERSION'*so*"}' | head -n1) 2> /dev/null | gawk '{if (/^\/home\/'$USER'\/.nix-portable\/store|^\/home\/linuxbrew\/.linuxbrew\/lib|^\/home\/'$USER'\/.local\/lib\/|^\/var\/home\/'$USER'\/.local\/lib\/|^\/usr\/local\/lib|^\/usr\/lib\/|^\/usr\/lib64|^\/usr\/lib32/ && !/slade3/) {print;exit} else if (/[0-9]\.[0-9]\/lib|[0-9]\.[0-9][0-9]\/lib|[0-9]\.[0-9]\/wx|[0-9]\.[0-9][0-9]\/wx|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/lib|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/wx|\/lib\/libz.so/ && !/libstdc\+\+[0-9]|lzfse|SDL2_.*/) {print;exit}}') "$SRB2BINARYLNXPATH" 2> /dev/null || true

                    else

                        $SUDO patchelf --add-needed $(find -L $SRB2BLDPREFIX/lib /home/linuxbrew/.linuxbrew/lib /nix/store /usr/lib64 /usr/lib -name $($PRINTF "%s\n" "$l" | gawk '{gsub(".so.*",""); print $0"*so*"}' | head -n1) 2> /dev/null | gawk '{if (/^\/home\/'$USER'\/.nix-portable\/store|^\/home\/linuxbrew\/.linuxbrew\/lib|^\/home\/'$USER'\/.local\/lib\/|^\/var\/home\/'$USER'\/.local\/lib\/|^\/usr\/local\/lib|^\/usr\/lib\/|^\/usr\/lib64|^\/usr\/lib32/ && !/slade3/) {print;exit} else if (/[0-9]\.[0-9]\/lib|[0-9]\.[0-9][0-9]\/lib|[0-9]\.[0-9]\/wx|[0-9]\.[0-9][0-9]\/wx|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/lib|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/wx|\/lib\/libz.so/ && !/libstdc\+\+[0-9]|lzfse|SDL2_.*/) {print;exit}}') "$SRB2BINARYLNXPATH" 2> /dev/null || true

                    fi

                done

                installdepsglibc

                if [ -z "$(LD_LIBRARY_PATH=$SRB2BLDPREFIX/lib ldd "$SRB2BINARYLNXPATH" 2>&1 2> /dev/null | gawk '/not found/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {print $1}' | head -n1)" ]; then

                    break

                fi

            done

        fi

        if [ -z "$(LD_LIBRARY_PATH=$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib ldd "$SRB2BINARYLNXPATH" 2>&1 2> /dev/null | gawk '/not found/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {print $1}' | head -n1)" ]; then

            $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Installation of $BUILDNAME's dependencies is successful."

        else

            $PRINTF "$NOTICE\n\n%s\n\e[0m" "Script couldn't install some packages for missing libraries listed below. Please install them manually on your system using package manager or compile them from source:"
            LD_LIBRARY_PATH="$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib" ldd "$SRB2BINARYLNXPATH" 2>&1 2> /dev/null | gawk '/not found/ && !/GLIBC/ && !/symbol not found/ && !/\/usr\/local\/bin/ {print $1}' | sort -u
            exit

        fi

    fi

    # Set binary path for SLADE for checking if required libraries are installed.
    if [ "$LIBC" = "musl" ] && [ "$BUILD" = "$BUILDPATH/slade" ]; then

        SRB2BINARYLNXPATH="$SRB2BLDPREFIX/share/slade3/slade.bin"

    fi

    installdepsmusl

    if [ "$LIBC" = "musl" ] && [ -n "$(ldd $SRB2BINARYLNXPATH 2>&1 | gawk -F':| ' '/No such file or directory/ && !/symbol not found/ {print $5}' | sort -u)" ]; then

        # Setting path to interpreter.
        if [ -z "$(ldd "$SRB2BINARYLNXPATH" 2>&1 2> /dev/null)" ]; then

            $SUDO patchelf --set-interpreter $(ldd "$SRB2BINARYLNXPATH" 2>&1 | gawk '/ld-musl.*/ {print $3}') "$SRB2BINARYLNXPATH" || true

        fi

        # Setting rpath for homebrew only Linux OS and Steam Deck OS to avoid issues with broken compiled binary and library libSDL2_mixer_ext.so.
        if [ -x "$(command -v brew 2> /dev/null)" ]; then

            $SUDO patchelf --set-rpath "/home/linuxbrew/.linuxbrew/lib:$SRB2BLDPREFIX/lib" "$SRB2BINARYLNXPATH"

            if [ -f "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.so" ]; then

                $SUDO patchelf --set-rpath "/home/linuxbrew/.linuxbrew/lib" "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.so"

            fi

            if [ -d "$SRB2LIBRARYLNXPATH" ]; then

                $SUDO patchelf --set-rpath "/home/linuxbrew/.linuxbrew/lib:$SRB2BLDPREFIX/lib:$SRB2LIBRARYLNXPATH" "$SRB2BINARYLNXPATH"

            fi

        else

            # Patching compiled binary, in order to libraries be found.
            n=0
            while [ "$n" -lt 3 ]; do

                n=$((n + 1))

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Patching paths to dependencies for $BUILDNAME. Please wait..."

                ldd "$SRB2BINARYLNXPATH" 2>&1 | gawk -F':| ' '/No such file or directory/ && !/symbol not found/ {print $5}' | sort -u | while read -r l; do

                    VERSION=$($PRINTF "%s\n" "$l" | gawk 'match($0, /-[0-9]\.[0-9]|[0-9]\.[0-9]/) {gsub(".so.*|-",""); print substr($0, RSTART)}')

                    if [ -n "$VERSION" ]; then

                        $SUDO patchelf --replace-needed "$l" $(find -L $SRB2BLDPREFIX/lib /home/linuxbrew/.linuxbrew/lib /nix/store /usr/lib64 /usr/lib -name $($PRINTF "%s\n" "$l" | gawk '{gsub(".so.*|-'$VERSION'.*so.*|'$VERSION'.*so.*",""); print $0"*'$VERSION'*so*"}' | head -n1) 2> /dev/null | gawk '{if (/^\/home\/'$USER'\/.nix-portable\/store|^\/home\/linuxbrew\/.linuxbrew\/lib|^\/home\/'$USER'\/.local\/lib\/|^\/var\/home\/'$USER'\/.local\/lib\/|^\/usr\/local\/lib|^\/usr\/lib\/|^\/usr\/lib64|^\/usr\/lib32/ && !/slade3/) {print;exit} else if (/[0-9]\.[0-9]\/lib|[0-9]\.[0-9][0-9]\/lib|[0-9]\.[0-9]\/wx|[0-9]\.[0-9][0-9]\/wx|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/lib|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/wx|\/lib\/libz.so/ && !/libstdc\+\+[0-9]|lzfse|SDL2_.*/) {print;exit}}') "$SRB2BINARYLNXPATH" 2> /dev/null || true

                    else

                        $SUDO patchelf --replace-needed "$l" $(find -L $SRB2BLDPREFIX/lib /home/linuxbrew/.linuxbrew/lib /nix/store /usr/lib64 /usr/lib -name $($PRINTF "%s\n" "$l" | gawk '{gsub(".so.*",""); print $0"*so*"}' | head -n1) 2> /dev/null | gawk '{if (/^\/home\/'$USER'\/.nix-portable\/store|^\/home\/linuxbrew\/.linuxbrew\/lib|^\/home\/'$USER'\/.local\/lib\/|^\/var\/home\/'$USER'\/.local\/lib\/|^\/usr\/local\/lib|^\/usr\/lib\/|^\/usr\/lib64|^\/usr\/lib32/ && !/slade3/) {print;exit} else if (/[0-9]\.[0-9]\/lib|[0-9]\.[0-9][0-9]\/lib|[0-9]\.[0-9]\/wx|[0-9]\.[0-9][0-9]\/wx|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/lib|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/wx|\/lib\/libz.so/ && !/libstdc\+\+[0-9]|lzfse|SDL2_.*/) {print;exit}}') "$SRB2BINARYLNXPATH" 2> /dev/null || true

                    fi

                done

                # Additional patching, if still there are missing paths to libraries to be added to binary.
                ldd "$SRB2BINARYLNXPATH" 2>&1 | gawk -F':| ' '/No such file or directory/ && !/symbol not found/ {print $5}' | sort -u | while read -r l; do

                    VERSION=$($PRINTF "%s\n" "$l" | gawk 'match($0, /-[0-9]\.[0-9]|[0-9]\.[0-9]/) {gsub(".so.*|-",""); print substr($0, RSTART)}')

                    if [ -n "$VERSION" ]; then

                        $SUDO patchelf --add-needed $(find -L $SRB2BLDPREFIX/lib /home/linuxbrew/.linuxbrew/lib /nix/store /usr/lib64 /usr/lib -name $($PRINTF "%s\n" "$l" | gawk '{gsub(".so.*|-'$VERSION'.*so.*|'$VERSION'.*so.*",""); print $0"*'$VERSION'*so*"}' | head -n1) 2> /dev/null | gawk '{if (/^\/home\/'$USER'\/.nix-portable\/store|^\/home\/linuxbrew\/.linuxbrew\/lib|^\/home\/'$USER'\/.local\/lib\/|^\/var\/home\/'$USER'\/.local\/lib\/|^\/usr\/local\/lib|^\/usr\/lib\/|^\/usr\/lib64|^\/usr\/lib32/ && !/slade3/) {print;exit} else if (/[0-9]\.[0-9]\/lib|[0-9]\.[0-9][0-9]\/lib|[0-9]\.[0-9]\/wx|[0-9]\.[0-9][0-9]\/wx|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/lib|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/wx|\/lib\/libz.so/ && !/libstdc\+\+[0-9]|lzfse|SDL2_.*/) {print;exit}}') "$SRB2BINARYLNXPATH" 2> /dev/null || true

                    else

                        $SUDO patchelf --add-needed $(find -L $SRB2BLDPREFIX/lib /home/linuxbrew/.linuxbrew/lib /nix/store /usr/lib64 /usr/lib -name $($PRINTF "%s\n" "$l" | gawk '{gsub(".so.*",""); print $0"*so*"}' | head -n1) 2> /dev/null | gawk '{if (/^\/home\/'$USER'\/.nix-portable\/store|^\/home\/linuxbrew\/.linuxbrew\/lib|^\/home\/'$USER'\/.local\/lib\/|^\/var\/home\/'$USER'\/.local\/lib\/|^\/usr\/local\/lib|^\/usr\/lib\/|^\/usr\/lib64|^\/usr\/lib32/ && !/slade3/) {print;exit} else if (/[0-9]\.[0-9]\/lib|[0-9]\.[0-9][0-9]\/lib|[0-9]\.[0-9]\/wx|[0-9]\.[0-9][0-9]\/wx|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/lib|[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]\/wx|\/lib\/libz.so/ && !/libstdc\+\+[0-9]|lzfse|SDL2_.*/) {print;exit}}') "$SRB2BINARYLNXPATH" 2> /dev/null || true

                    fi

                done

                installdepsmusl

                if [ -z "$(LD_LIBRARY_PATH=$SRB2BLDPREFIX/lib ldd "$SRB2BINARYLNXPATH" 2>&1 | gawk -F':| ' '/No such file or directory/ && !/symbol not found/ {print $5}' | sort -u)" ]; then

                    break

                fi

            done

        fi

        if [ -z "$(LD_LIBRARY_PATH=$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib ldd "$SRB2BINARYLNXPATH" 2>&1 | gawk -F':| ' '/No such file or directory/ && !/symbol not found/ {print $5}' | sort -u)" ]; then

            $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Installation of $BUILDNAME's dependencies is successful."

        else

            $PRINTF "$NOTICE\n\n%s\n\e[0m" "Script couldn't install some packages for missing libraries listed below. Please install them manually on your system using package manager or compile them from source:"
            LD_LIBRARY_PATH="$SRB2BLDPREFIX/lib:/home/linuxbrew/.linuxbrew/lib" ldd "$SRB2BINARYLNXPATH" 2>&1 | gawk -F':| ' '/No such file or directory/ && !/symbol not found/ {print $5}' | sort -u
            exit

        fi

    fi
}

installtolist() {
    # Making list of installed files.
    if [ ! -d "$SRB2BLDROOT/installed" ]; then

        mkdir -p "$SRB2BLDROOT/installed"

    fi

    if [ "$(dirname $BUILD)" = "$BUILDPATH/srb2-custom" ]; then

        INSTALLFILEPATH="$SRB2BLDROOT/installed/srb2-custom/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')"

        if [ ! -d "$SRB2BLDROOT/installed/srb2-custom" ]; then

            mkdir -p "$SRB2BLDROOT/installed/srb2-custom"

        fi

    else

        INSTALLFILEPATH="$SRB2BLDROOT/installed/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')"

    fi

    if [ "$LNXOSNAME" = "NixOS" ]; then

        cat > "$INSTALLFILEPATH" << INSTALL
$SRB2NIXPATH
$COMREVFILEPATH
---------------
$CONF
INSTALL

    else

        cat > "$INSTALLFILEPATH" << INSTALL
$SRB2ASSETLNXPATH
$SRB2LIBRARYLNXPATH
$SRB2BINARYLNXPATH
$SRB2BINARYDEBUGLNXPATH
$SRB2DESKTOPLNXPATH
$SRB2DESKTOPOPENGLLNXPATH
$SRB2DESKTOPOPENVRLNXPATH
$SRB2ICONLNXPATH
$SRB2WINPATH
$SRB2WINMENUPATH
$SRB2MACPATH
$SRB2MACLINK
$SRB2MACBIN
$COMREVFILEPATH
---------------
$CONF
INSTALL

    fi

    gawk -i inplace 'NF{print}' "$INSTALLFILEPATH"

    COMREV=$(git -C "$BUILD" rev-parse --short HEAD)
    $PRINTF "$COMREV\n$GITVERCONF" > "$BUILD/.comrev"

    if [ "$LNXOSNAME" = "NixOS" ]; then

        SRB2PATH="\"$SRB2NIXPATH/bin/$($PRINTF "%s\n" "$SRB2BINARYLNXPATH" | gawk -F'/' '{print $NF}')\""

    elif [ -n "$SRB2BINARYLNXPATH" ]; then

        SRB2PATH="\"$SRB2BINARYLNXPATH\""

    elif [ -n "$SRB2MACPATH" ]; then

        SRB2PATH="\"$SRB2MACPATH\" and \"$SRB2MACLINK\""

    elif [ -n "$SRB2WINPATH" ]; then

        SRB2PATH="\"$SRB2WINPATH\""

    fi

    $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Installation of $BUILDNAME is successful and is located at $SRB2PATH path."
}

installtomacos() {
    # Exporting environment variables for compiling, installing game and libraries on macOS.
    export MACOSX_DEPLOYMENT_TARGET="$MACOSVER"
    export SDKROOT="$SDKROOT"
    export PATH="$SRB2BLDROOT/libraries/depot_tools:$MACPORTPREFIX/bin:$HOMEBREWPREFIX/bin:$PATH"

    if [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" != "RingRacers" ]; then

        export LIBRARY_PATH="$SRB2BLDPREFIX/lib:$MACPORTPREFIX/lib:$HOMEBREWPREFIX/lib:$LIBRARY_PATH"
        export C_INCLUDE_PATH="$SRB2BLDPREFIX/include:$MACPORTPREFIX/include:$HOMEBREWPREFIX/include:$C_INCLUDE_PATH"
        export CPLUS_INCLUDE_PATH="$C_INCLUDE_PATH"
        export PKG_CONFIG_PATH="$SRB2BLDPREFIX/lib/pkgconfig:$MACPORTPREFIX/lib/pkgconfig:$HOMEBREWPREFIX/lib/pkgconfig:$PKG_CONFIG_PATH"

    fi

    export STOW_DIR="$SRB2BLDPREFIX/stow"
    export VCPKG_ROOT="$SRB2BLDROOT/libraries/vcpkg"

    # Have commit revision as part of name for App Bundle.
    COMREV=$(git -C "$BUILD" rev-parse --short HEAD)

    # Change prefix depending on, if library is in $HOMEBREWPREFIX/lib or $MACPORTPREFIX/lib or $SRB2BLDPREFIX/lib.
    if [ -f "$HOMEBREWPREFIX/lib/libSDL2.dylib" ]; then

        LIBSDL2PREFIX="$HOMEBREWPREFIX"

    elif [ -f "$MACPORTPREFIX/lib/libSDL2.dylib" ]; then

        LIBSDL2PREFIX="$MACPORTPREFIX"

    else

        LIBSDL2PREFIX="$SRB2BLDPREFIX"

    fi

    if [ -f "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib" ]; then

        LIBSDL2MIXERPREFIX="$HOMEBREWPREFIX"

    elif [ -f "$MACPORTPREFIX/lib/libSDL2_mixer.dylib" ]; then

        LIBSDL2MIXERPREFIX="$MACPORTPREFIX"

    else

        LIBSDL2MIXERPREFIX="$SRB2BLDPREFIX"

    fi

    if [ -f "$HOMEBREWPREFIX/lib/libopenal.dylib" ]; then

        LIBOPENALPREFIX="$HOMEBREWPREFIX"

    elif [ -f "$MACPORTPREFIX/lib/libopenal.dylib" ]; then

        LIBOPENALPREFIX="$MACPORTPREFIX"

    else

        LIBOPENALPREFIX="$SRB2BLDPREFIX"

    fi

    if [ -f "$HOMEBREWPREFIX/lib/libgme.dylib" ]; then

        LIBGMEPREFIX="$HOMEBREWPREFIX"

    elif [ -f "$MACPORTPREFIX/lib/libgme.dylib" ]; then

        LIBGMEPREFIX="$MACPORTPREFIX"

    else

        LIBGMEPREFIX="$SRB2BLDPREFIX"

    fi

    if [ -f "$HOMEBREWPREFIX/lib/libopenmpt.dylib" ]; then

        LIBOPENMPTPREFIX="$HOMEBREWPREFIX"

    elif [ -f "$MACPORTPREFIX/lib/libopenmpt.dylib" ]; then

        LIBOPENMPTPREFIX="$MACPORTPREFIX"

    else

        LIBOPENMPTPREFIX="$SRB2BLDPREFIX"

    fi

    if [ -f "$HOMEBREWPREFIX/lib/libpng.dylib" ]; then

        LIBPNGPREFIX="$HOMEBREWPREFIX"

    elif [ -f "$MACPORTPREFIX/lib/libpng.dylib" ]; then

        LIBPNGPREFIX="$MACPORTPREFIX"

    else

        LIBPNGPREFIX="$SRB2BLDPREFIX"

    fi

    if [ -f "$HOMEBREWPREFIX/lib/libmpg123.dylib" ]; then

        LIBMPG123PREFIX="$HOMEBREWPREFIX"

    elif [ -f "$MACPORTPREFIX/lib/libmpg123.dylib" ]; then

        LIBMPG123PREFIX="$MACPORTPREFIX"

    else

        LIBMPG123PREFIX="$SRB2BLDPREFIX"

    fi

    if [ -f "$HOMEBREWPREFIX/lib/libmodplug.dylib" ]; then

        LIBMODPLUGPREFIX="$HOMEBREWPREFIX"

    elif [ -f "$MACPORTPREFIX/lib/libmodplug.dylib" ]; then

        LIBMODPLUGPREFIX="$MACPORTPREFIX"

    else

        LIBMODPLUGPREFIX="$SRB2BLDPREFIX"

    fi

    # Download and extract assets.
    if [ -z "$(find "$BUILD/build/assets/installer/"* -mindepth 1 -maxdepth 1 2> /dev/null | head -n1)" ] && ([ "$BUILD" != "$BUILDPATH/wadcli" ] && [ "$BUILD" != "$BUILDPATH/kartmaker" ] && [ "$BUILD" != "$BUILDPATH/neptunefm" ] && [ "$BUILD" != "$BUILDPATH/kartmaker-ring-racers" ] && [ "$BUILD" != "$BUILDPATH/followermaker" ] && [ "$BUILD" != "$BUILDPATH/slade" ] && [ "$BUILD" != "$BUILDPATH/ultimate-zone-builder" ] && [ "$BUILD" != "$BUILDPATH/ultimate-gksz-builder" ] && [ "$BUILD" != "$BUILDPATH/ultimate-lowee-builder" ] && [ "$BUILD" != "$BUILDPATH/high-voltage-ring" ] && [ "$BUILD" != "$BUILDPATH/aseprite" ]); then

        if [ -n "$ISNET" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading and extracting $BUILDNAME's assets. Please wait..."

        else

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Extracting $BUILDNAME's assets. Please wait..."

        fi

        if [ "$GITVER" != "$GITDEFVER" ] || [ "$(dirname $BUILD)" = "$BUILDPATH/srb2-custom" ]; then

            extractmacoscustomassets

        else

            extractmacosassets

        fi

    fi

    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Patching $BUILDNAME's source code. Please wait..."

    if [ "$BUILD" != "$BUILDPATH/srb2-2.0" ] && [ "$BUILD" != "$BUILDPATH/srb2-cb" ] && [ "$BUILD" != "$BUILDPATH/xsrb2" ] && [ "$BUILD" != "$BUILDPATH/srb2-sf94-serv" ] && [ "$BUILD" != "$BUILDPATH/srb2-riders" ] && [ "$BUILD" != "$BUILDPATH/super-srb2-kart-z" ] && [ "$BUILD" != "$BUILDPATH/sbb2" ] && [ "$BUILD" != "$BUILDPATH/srb2-final-demo" ] && [ "$BUILD" != "$BUILDPATH/srb2-1095" ] && [ "$BUILD" != "$BUILDPATH/srb2-jte" ] && [ "$BUILD" != "$BUILDPATH/shufflarb2" ] && [ "$BUILD" != "$BUILDPATH/srb2-live" ] && [ "$BUILD" != "$BUILDPATH/srb2-loz" ] && [ "$BUILD" != "$BUILDPATH/newmillennium" ] && [ "$BUILD" != "$BUILDPATH/wadcli" ] && [ "$BUILD" != "$BUILDPATH/kartmaker" ] && [ "$BUILD" != "$BUILDPATH/neptunefm" ] && [ "$BUILD" != "$BUILDPATH/kartmaker-ring-racers" ] && [ "$BUILD" != "$BUILDPATH/followermaker" ] && [ "$BUILD" != "$BUILDPATH/slade" ] && [ "$BUILD" != "$BUILDPATH/ultimate-zone-builder" ] && [ "$BUILD" != "$BUILDPATH/hig-voltage-ring" ] && [ "$BUILD" != "$BUILDPATH/aseprite" ]; then

        # Patching CMakeLists.txt to prevent macOS from loading external frameworks prior to libraries installed by Homebrew.
        gawk -i inplace '{gsub("add_definitions\\(-DMACOSX\\)","add_definitions(-DMACOSX)\n        set(CMAKE_FIND_FRAMEWORK LAST)"); print}' "$BUILD/CMakeLists.txt"
        gawk -i inplace '{gsub("set\\(CMAKE_C_FLAGS \\${CMAKE_C_FLAGS} -Wno-trigraphs\\)",""); print}' "$BUILD/src/CMakeLists.txt"

        if [ -f "$BUILD/assets/CMakeLists.txt" ]; then

            # Removing patch.pk3 and README-SDL.txt from CMakeLists.txt, if they are nonexistent.
            if [ ! -f "$BUILD/assets/installer/patch.pk3" ]; then

                gawk -i inplace '{gsub("\"patch.pk3\"",""); print}' "$BUILD/assets/CMakeLists.txt"

            fi

            if [ ! -f "$BUILD/assets/installer/README-SDL.txt" ]; then

                gawk -i inplace '{gsub("\"README-SDL.txt\"",""); print}' "$BUILD/assets/CMakeLists.txt"

            fi

            # Dynamically adding required assets from assets/installer to assets/CMakeLists.txt.
            gawk -i inplace -v home="$BUILD" '
BEGIN {
    # Dynamically generate PK3 entries from folder names.
    asset_path = home "/assets/installer"
    cmd = "find \"" asset_path "\" -mindepth 1 -type f -mindepth 1 -maxdepth 2 -type f 2> /dev/null | gawk -F'\''installer/'\'' '\''!/kartmaker|models|CMakeLists.txt/ {print $NF}'\''"
    while ( (cmd | getline dir) > 0 ) {
        pk3_entries = pk3_entries "        \"" dir "\"\n"
    }
    close(cmd)
}

/^set\(SRB2_ASSETS_GAME/ {
    print $0

    # Add dynamic PK3 entries if any folders exist.
    if (pk3_entries) {
        printf "%s", pk3_entries
    }

    # Preserve empty line before closing parenthesis.
    print ""
    in_block = 1
    next
}

in_block && /^)/ {
    print $0
    in_block = 0
    next
}

in_block {
    next
}

{
    print
}
' "$BUILD/assets/CMakeLists.txt"

        fi

    fi

    # Dirty workaround for Ring Racers HEP buffer overflow from Hep options menu.
    if [ "$BUILD" = "$BUILDPATH/ring-racers-hep" ]; then

        export CFLAGS="-D_FORTIFY_SOURCE=0"

    fi

    if [ "$BUILD" = "$BUILDPATH/srb2-2.2-classic" ]; then

        # Renamed target of dir to match SRB2.
        gawk -i inplace '{gsub("SRB2SDL2","SRB2"); print}' "$BUILD/assets/CMakeLists.txt" "$BUILD/src/dedicated/CMakeLists.txt"

        # Corrected path to b_bot.h.
        gawk -i inplace '{gsub("#include \"b_bot.h\"","#include \"../b_bot.h\""); print}' "$BUILD/src/netcode/d_netcmd.c"

        # Replace MD5 hashes after creating assets.
        for a in $(ls "$BUILD/assets/installer/"*.pk3 | gawk -F'/' '{gsub(".pk3",""); print $NF}'); do

            HASH=$(gawk -F'"' '/#define ASSET_HASH_'$($PRINTF "$a" | gawk '{print toupper($0)}')'_PK3/ {print $2}' "$BUILD/src/config.h.in")
            if [ -n "$HASH" ]; then

                gawk -i inplace '{gsub("'$HASH'","'$(md5sum "$BUILD/assets/installer/$a.pk3" | gawk '{print $1}')'"); print}' "$BUILD/src/config.h.in"

            fi

        done

    # Patching SRB2 Uncapped Plus' source code to fix error with implicit declaration of function R_ResetFirstLerp is invalid in C99 [-Werror,-Wimplicit-function-declaration]. Thanks Lach for help with this.
    elif [ "$BUILD" = "$BUILDPATH/srb2-uncapped-plus" ]; then

        gawk -i inplace '{gsub("#include \"doomdef.h\"","#include \"r_fps.h\"\n#include \"doomdef.h\""); print}' "$BUILD/src/p_setup.c"

    elif [ "$BUILD" = "$BUILDPATH/srb2-reveries" ]; then

        # Adding missing files to CMakeLists.txt due to linking errors.
        gawk -i inplace '{gsub("p_floor.c","p_floor.c\n\tp_haptic.c"); print}' "$BUILD/src/CMakeLists.txt"
        gawk -i inplace '{gsub("ogl_sdl.c","ogl_sdl.c\n\ti_gamepad.c"); print}' "$BUILD/src/sdl/CMakeLists.txt"

    elif [ "$BUILD" = "$BUILDPATH/srb2-edit" ]; then

        # Adding missing file lua_custombuild.c to CMakeLists.txt due to linking errors.
        gawk -i inplace '{gsub("lua_script.c","lua_script.c\n\tlua_custombuild.c"); print}' "$BUILD/src/CMakeLists.txt"

        # Fixing "error: expected identifier enum { false = 0, true = 1 };".
        gawk -i inplace 'BEGIN{RS=""; ORS="\n\n"} /#ifndef __cplusplus\n#ifndef _WIN32/ {suppress=1} /#ifndef INT8_MIN/ {suppress=0} !suppress' "$BUILD/src/doomtype.h"

    elif [ "$BUILD" = "$BUILDPATH/srb2-destructive-illusion" ]; then

        # Fixing "undefined reference to strcmpi".
        gawk -i inplace '{gsub("strcmpi","strcasecmp"); print}' "$BUILD/src/d_netcmd.c"
        gawk -i inplace '{gsub("strcmpi","strcasecmp"); print}' "$BUILD/src/d_netfil.c"
        gawk -i inplace '{gsub("strcmpi","strcasecmp"); print}' "$BUILD/src/w_wad.c"

    # Replacing MD5 hash to load srb2ggj.pk3.
    elif [ "$BUILD" = "$BUILDPATH/srb2-ggj" ]; then

        gawk -i inplace '{gsub("'$(gawk -F'"' '/#define ASSET_HASH_SRB2GGJ_PK3/ {print $2}' "$BUILD/src/config.h.in")'","'$(md5sum "$BUILD/assets/installer/srb2ggj.pk3" | gawk '{print $1}')'"); print}' "$BUILD/src/config.h.in"

    elif [ "$BUILD" = "$BUILDPATH/srb2-thokker" ]; then

        # Corrected path extracted assets in CmakeLists.txt.
        gawk -i inplace '{gsub("\\${CMAKE_CURRENT_SOURCE_DIR}","${CMAKE_CURRENT_SOURCE_DIR}/installer"); gsub("else\\(\\)","else()\n\tget_target_property(outname SRB2SDL2 OUTPUT_NAME)"); gsub("DESTINATION \\.","DESTINATION \"${outname}.app/Contents/Resources\""); gsub("\\${CMAKE_CURRENT_SOURCE_DIR}/installer/music.dta","${CMAKE_CURRENT_SOURCE_DIR}/installer/music.dta\n${CMAKE_CURRENT_SOURCE_DIR}/installer/thokker.thk"); print}' "$BUILD/assets/CMakeLists.txt"

        # Setting proper binary name.
        gawk -i inplace '{gsub("SRB2_SDL2_EXE_NAME srb2","SRB2_SDL2_EXE_NAME \"Sonic Robo Blast 2 Thokker\""); print}' "$BUILD/CMakeLists.txt"

        gawk -i inplace '{gsub("#target_link_libraries\\(SRB2SDL2 PRIVATE SRB2Core\\)","target_link_libraries(SRB2SDL2 PRIVATE \"-framework CoreFoundation\")"); gsub("RUNTIME DESTINATION .","BUNDLE DESTINATION .\n\tRUNTIME DESTINATION ."); print}' "$BUILD/src/sdl/CMakeLists.txt"

        gawk -i inplace '{gsub("size_t strlcat\\(char \\*dst, const char \\*src, size_t siz\\)","#ifndef __APPLE__\nsize_t strlcat(char *dst, const char *src, size_t siz)"); print}' "$BUILD/src/string.c"

        $PRINTF "%s\n" "#endif" >> "$BUILD/src/string.c"

    elif [ "$BUILD" = "$BUILDPATH/srb2-top-down" ]; then

        # Change path to CMakeLists.txt for assets to be found by Cmake.
        gawk -i inplace '{gsub("add_subdirectory\\(assets\\)","add_subdirectory(assets/installer)"); print}' "$BUILD/CMakeLists.txt"

        # Renaming SRB2 Top Down .app filename to proper name to avoid issue of not copying compiled game and icons.
        gawk -i inplace '{gsub("Sonic Robo Blast 2","Sonic Robo Blast 2 Top Down"); print}' "$BUILD/src/sdl/CMakeLists.txt"

        # Replacing condition, so assets are installed to .app file.
        gawk -i inplace '{gsub("CLANG","${CMAKE_SYSTEM} MATCHES Darwin"); print}' "$BUILD/assets/CMakeLists.txt"

    elif [ "$BUILD" = "$BUILDPATH/sonic-smash-brawl" ]; then

        # Removing this line, because these target properties can't be found and they are not essential.
        gawk -i inplace '{gsub("set_target_properties\\(SRB2SDL2 PROPERTIES VERSION \\${SRB2_VERSION}\\)",""); print}' "$BUILD/src/sdl/CMakeLists.txt"

        # Renaming SRB2 Top Down .app filename to proper name to avoid issue of not copying compiled game and icons.
        gawk -i inplace '{gsub("Sonic Robo Blast 2","Sonic Smash Brawl"); print}' "$BUILD/src/sdl/CMakeLists.txt"

    # Patching SRB2 Persona's source code to fix error with implicit declaration of function W_GetNumForNameMusic is invalid in C99 [-Werror,-Wimplicit-function-declaration].
    elif [ "$BUILD" = "$BUILDPATH/srb2-persona" ]; then

        gawk -i inplace '/\/\/ W_GetNumForNameMusic/ {suppress=1} /\/\/ Like W_GetNumForName/ {suppress=0} !suppress' "$BUILD/src/w_wad.c"
        gawk -i inplace -v RS="^$" '{gsub("\\/\\/\\/ ------------------------\n\nstatic lumpnum_t S_GetMusicLumpNum\\(const char \\*mname\\)","\nlumpnum_t W_GetNumForNameMusic(const char *name)\n{\n\tlumpnum_t i;\n\n\ti = W_CheckNumForName(name);\n\n\treturn i;\n}\n\nstatic lumpnum_t S_GetMusicLumpNum(const char *mname)"); print}' "$BUILD/src/s_sound.c"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-hep" ]; then

        # Adding missing file d_protocol.c and d_protocol.h to CMakeLists.txt due to linking errors.
        gawk -i inplace '{gsub("d_netfil.c","d_netfil.c\n\td_protocol.c"); gsub("d_netfil.h","d_netfil.h\n\td_protocol.h"); print}' "$BUILD/src/CMakeLists.txt"

        # Adding missing asset snowy_files.kart to CMakeLists.txt.
        gawk -i inplace '{gsub("srb2.srb;\\\\","srb2.srb;\\\nsnowy_files.kart;\\"); print}' "$BUILD/assets/CMakeLists.txt"

        # Fixed compilation issues "error: incompatible pointer to integer conversion initializing 'int32_t' (aka 'int') with an expression of type 'void *' [-Wint-conversion]".
        gawk -i inplace '/consvar_t cv_fakelocalskin =/ {sub(/CV_SAVE, NULL, 0, NULL/, "CV_SAVE, NULL, 0, 0"); sub(/NULL};$/, "0};");}1' "$BUILD/src/d_netcmd.c"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-saturn" ]; then

        # Enable #include <poll.h> to fix error: use of undeclared identifier 'POLLIN'.
        #        gawk -i inplace '{gsub("#include <signal.h>","#include <signal.h>\n#include <poll.h>"); print}' "$BUILD/src/sdl/i_system.cpp"

        # Patching error use of undeclared identifier 'errno'.
        #        gawk -i inplace '/^#ifdef __unix__$/,/^#endif$/ {if (/^#ifdef|^#endif/) next; print; next} 1' "$BUILD/src/sdl/i_main.c"

        # Adding support to compiling c++ source files in CMakeLists.txt.
        #        gawk -i inplace '{gsub("LANGUAGES C\\)","LANGUAGES C CXX)"); print}' "$BUILD/CMakeLists.txt"

        # Correcting filenames of from c to c++ source files.
        #        gawk -i inplace '{gsub("z_zone.c$","z_zone.cpp"); gsub("r_bsp.c$","r_bsp.cpp"); gsub("r_draw.c$","r_draw.cpp"); gsub("r_fps.c$","r_fps.cpp"); gsub("r_main.c$","r_main.cpp"); gsub("r_patch.c$","r_patch.cpp"); gsub("r_patchrotation.c$","r_patchrotation.cpp");  gsub("r_plane.c$","r_plane.cpp"); gsub("r_segs.c$","r_segs.cpp"); gsub("r_things.c$","r_things.cpp"); gsub("p_maputl.c$","p_maputl.cpp"); gsub("hw_main.c$","hw_main.cpp"); print}' "$BUILD/src/CMakeLists.txt"
        #        gawk -i inplace '{gsub("i_system.c$","i_system.cpp"); gsub("p_maputl.c$","p_maputl.cpp"); gsub("hw_main.c$","hw_main.cpp"); print}' "$BUILD/src/sdl/CMakeLists.txt"

        # Adding missing headers and source files for undefined symbols errors.
        #        gawk -i inplace '{gsub("#include \"m_perfstats.h\"","#include \"m_perfstats.h\"\n#include \"r_data.h\"\nCV_PossibleValue_t Color_cons_t[];\n#include \"r_skins.h\"\nCV_PossibleValue_t Forceskin_cons_t[];"); print}' "$BUILD/src/d_netcmd.c"
        #        gawk -i inplace '{gsub("g_game.c$","g_game.c\n\tg_demo.c"); gsub("g_game.h","g_game.h\n\tg_demo.h"); print}' "$BUILD/src/CMakeLists.txt"

        set +e
        curl -RLC - "https://gist.githubusercontent.com/Bijman/e39d5f63b68a7e4251dfe30449b3a7d2/raw" -o "$BUILD/srb2kartsaturnmacoscompilation.patch"
        patch -Np1 -d "$BUILD" -i "$BUILD/srb2kartsaturnmacoscompilation.patch"
        set -e

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-neptune" ]; then

        # Enable #include <poll.h> to fix error: use of undeclared identifier 'POLLIN'.
        gawk -i inplace '{gsub("#include <signal.h>","#include <signal.h>\n#include <poll.h>"); print}' "$BUILD/src/sdl/i_system.c"

        # Patching error use of undeclared identifier 'errno'.
        gawk -i inplace '/^#ifdef __unix__$/,/^#endif$/ {if (/^#ifdef|^#endif/) next; print; next} 1' "$BUILD/src/sdl/i_main.c"

        # Enable subdirectory assets to allow cmake to copy assets.
        gawk -i inplace '{gsub("#add_subdirectory\\(assets\\)","add_subdirectory(assets)"); print}' "$BUILD/CMakeLists.txt"

        # Adding missing assets to CMakeLists.txt.
        gawk -i inplace -v RS="" '{gsub("set\\(SRB2_ASSET_HASHED\n\"srb2.srb;\\\\","set(SRB2_ASSET_HASHED\n\"srb2.srb;\\\nextra.kart;\\\nextra2.kart;\\\nkv.kart;\\\nneptune.kart;\\"); print}' "$BUILD/assets/CMakeLists.txt"

    elif [ "$BUILD" = "$BUILDPATH/blankart" ]; then

        # Fixing linking error "Undefined symbols for architecture x86_64: "OSX_GetResourcesPath(char*)", referenced from:_I_LocateWad in i_system.cpp.o".
        gawk -i inplace '{gsub("void OSX_GetResourcesPath\\(char \\* buffer\\);","#ifdef __cplusplus\nextern \"C\" {\n#endif\n\nvoid OSX_GetResourcesPath(char * buffer);\n\n#ifdef __cplusplus\n}\n#endif\n"); print}' "$BUILD/src/sdl/macosx/mac_resources.h"

        # Removing code from src/libdivide.h to fix "error: no member named 'denom' in 'divider<T, ALGO>'".
        gawk -i inplace '/bool operator==\(const divider<T, ALGO> &other\) const {/ {suppress=1} /bool operator!=\(const divider<T, ALGO> &other\) const { return !\(\*this == other\); }/ {suppress=0} !suppress' "$BUILD/src/libdivide.h"

        # Replace XXH3 hashes after creating assets.
        for a in $(ls "$BUILD/assets/installer/"*.pk3 | gawk -F'/' '{gsub(".pk3",""); print $NF}'); do

            HASH=$(gawk -F'0x' '/#define ASSET_HASH_'$($PRINTF "$a" | gawk '{print toupper($0)}')'_PK3/ {print $2}' "$BUILD/src/d_main.cpp")
            if [ -n "$HASH" ]; then

                gawk -i inplace '{gsub("'$HASH'","'$(xxhsum -H3 --tag "$BUILD/assets/installer/$a.pk3" | gawk '{print $NF}')'"); print}' "$BUILD/src/d_main.cpp"

            fi

        done

        # Replacement for "models" to "mdls" in assets/CMakeLists.txt.
        gawk -i inplace '{gsub("models","mdls"); print}' "$BUILD/assets/CMakeLists.txt"

        # Patching BlanKart to remove uncommitted changes message from main menu.
        gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "$BUILD/src/m_menu.c"

    elif [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

        # Patching SRB2 Ring Racers' builds to remove uncommitted changes message from main menu.
        gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "$BUILD/src/f_finale.c"
        gawk -i inplace '{gsub("!.*UNCOMMITTED CHANGES.*!",""); print}' "$BUILD/src/d_netcmd.c"

        # Fixing issue of out of range error with hex escape \x85A by changing to octal equivalent.
        gawk -i inplace '{gsub("CONS_Printf\\(\"\\\\x85Access denied.\\\\n\"\\);","CONS_Printf(\"\\205Access denied.\\n\");"); print}' "$BUILD/src/d_netcmd.c"

        # Fixing error: implicit instantiation of undefined template 'std::char_traits<std::byte>'.
        gawk -i inplace '{gsub("js = json::from_ubjson\\(slice\\).template get<StandingsJson>\\(\\);","auto char_span = tcb::span(reinterpret_cast<const char*>(slice.data()), slice.size());\n\t\tjs = json::from_ubjson(char_span).template get<StandingsJson>();"); print}' "$BUILD/src/g_demo.cpp"

        # Fixing error: no member named 'denom' in 'divider<T, ALGO>' for Ring Racers Noire, HEP, Freaky Build, Radio Racers.
        gawk -i inplace '{gsub(/other\.denom/, "other.div.denom")}1' "$BUILD/src/libdivide.h"

        # Dirty workaround for buffer overflow from Noa options menu for Ring Racers HEP.
        if [ "$BUILD" = "$BUILDPATH/ring-racers-hep" ]; then

            gawk -i inplace '{gsub("include\\(CheckCXXCompilerFlag\\)","include(CheckCXXCompilerFlag)\n\nset(CMAKE_C_FLAGS \"${CMAKE_C_FLAGS} -D_FORTIFY_SOURCE=0\")\nset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -D_FORTIFY_SOURCE=0\")"); print}' "$BUILD/CMakeLists.txt"

        elif [ "$BUILD" = "$BUILDPATH/radio-racers" ]; then

            # Fixed in src/radioracers/hud/rr_hud.cpp: error: 'CONST' was not declared in this scope and error: cannot bind non-const lvalue reference of type 'tic_t&' {aka 'unsigned int&'}.
            gawk -i inplace '{gsub("CONST","const"); gsub(/size_t& frame = emoteFrameMap\[emote\];/,"&\n    std::unordered_map<emote_t*, tic_t> emoteLastUpdate;");gsub(/size_t& frame = chatEmoteFrameMap\[emote\];/,"&\n    std::unordered_map<emote_t*, tic_t> chatEmoteLastUpdate;"); print}' "$BUILD/src/radioracers/hud/rr_hud.cpp"

        fi

    # Replace path to liblzf in Makefile.
    elif [ "$BUILD" = "$BUILDPATH/wadcli" ]; then

        cd "$BUILD" || exit
        gawk -i inplace '{gsub("_LDLIBS=-l:liblzf.so","_LDLIBS=-L'$SRB2BLDPREFIX'/lib"); print}' "$BUILD/makefile"

    elif [ "$BUILD" = "$BUILDPATH/kartmaker" ] || [ "$BUILD" = "$BUILDPATH/neptunefm" ] || [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ] || [ "$BUILD" = "$BUILDPATH/followermaker" ]; then

        cd "$BUILD" || exit

        # Replacing build script for some kartmaker builds.
        if [ -n "$ISNET" ] && [ "$BUILD" != "$BUILDPATH/neptunefm" ] && [ "$BUILD" != "$BUILDPATH/kartmaker-ring-racers" ] && [ "$BUILD" != "$BUILDPATH/followermaker" ]; then

            curl -RL https://raw.githubusercontent.com/BombchuLink/kartmaker/master/build.sh -o "$BUILD/build.sh"
            chmod 755 "$BUILD/build.sh"

        fi

        # Replacing shebang #!/bin/env sh to #!/bin/sh due to run error with build script.
        gawk -i inplace '{gsub("#!/bin/env sh","#!/bin/sh"); print}' "$BUILD/build.sh"

    fi

    # Modify the build's configuration names to avoid conflicts between installed builds.
    if [ "$BUILD" = "$BUILDPATH/srb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-uncapped-plus" ] || [ "$BUILD" = "$BUILDPATH/srb2-netplus" ] || [ "$BUILD" = "$BUILDPATH/srb2-reveries" ] || [ "$BUILD" = "$BUILDPATH/srb2-tsourdt3rd" ] || [ "$BUILD" = "$BUILDPATH/srb2-edit" ] || [ "$BUILD" = "$BUILDPATH/srb2-ggj" ] || [ "$BUILD" = "$BUILDPATH/srb2-destructive-illusion" ] || [ "$BUILD" = "$BUILDPATH/srb2-vr" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \"srb2\"","#define DEFAULTDIR \"srb2'$GITVERCONF'\""); print}' "$BUILD/src/doomdef.h"

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.2-classic" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \"srb2classic\"","#define DEFAULTDIR \"srb2classic'$GITVERCONF'\""); print}' "$BUILD/src/doomdef.h"

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.2-beta6" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \"srb2beta\"","#define DEFAULTDIR \"srb2beta'$GITVERCONF'\""); print}' "$BUILD/src/doomdef.h"

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.1-legacy" ] || [ "$BUILD" = "$BUILDPATH/srb2-fusion-advance" ] || [ "$BUILD" = "$BUILDPATH/srb2-thokker" ] || [ "$BUILD" = "$BUILDPATH/srb2-top-down" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \"srb2_21\"","#define DEFAULTDIR \"srb2_2.1'$GITVERCONF'\""); print}' "$BUILD/src/doomdef.h"

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.0" ] || [ "$BUILD" = "$BUILDPATH/srb2-cb" ] || [ "$BUILD" = "$BUILDPATH/xsrb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ] || [ "$BUILD" = "$BUILDPATH/srb2-riders" ] || [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ] || [ "$BUILD" = "$BUILDPATH/sbb2" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \"srb2\"","#define DEFAULTDIR \"srb2_2.0'$GITVERCONF'\""); print}' "$BUILD/src/doomdef.h"

    elif [ "$BUILD" = "$BUILDPATH/srb2-final-demo" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \"srb21094\"","#define DEFAULTDIR \"srb2fd'$GITVERCONF'\""); print}' "$BUILD/src/doomdef.h"

    elif [ "$BUILD" = "$BUILDPATH/srb2-1095" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \"srb21095\"","#define DEFAULTDIR \"srb21095'$GITVERCONF'\""); print}' "$BUILD/src/doomdef.h"

    elif [ "$BUILD" = "$BUILDPATH/srb2-jte" ] || [ "$BUILD" = "$BUILDPATH/shufflarb2" ] || [ "$BUILD" = "$BUILDPATH/srb2-live" ] || [ "$BUILD" = "$BUILDPATH/srb2-loz" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \"srb2\"","#define DEFAULTDIR \"srb2fd'$GITVERCONF'\""); print}' "$BUILD/src/doomdef.h"

    elif [ "$BUILD" = "$BUILDPATH/srb2-persona" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \"srb2\"","#define DEFAULTDIR \"srb2persona'$GITVERCONF'\""); print}' "$BUILD/src/doomdef.h"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-galaxy" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-hep" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-saturn" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-neptune" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-vr" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \"srb2kart\"","#define DEFAULTDIR \"srb2kart'$GITVERCONF'\""); print}' "$BUILD/src/doomdef.h"

    elif [ "$BUILD" = "$BUILDPATH/blankart" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \"srb2kart-v2\"","#define DEFAULTDIR \"srb2kart-v2'$GITVERCONF'\""); print}' "$BUILD/src/doomdef.h"

    elif [ "$BUILD" = "$BUILDPATH/ring-racers" ] || [ "$BUILD" = "$BUILDPATH/ring-racers-noire" ] || [ "$BUILD" = "$BUILDPATH/ring-racers-hep" ] || [ "$BUILD" = "$BUILDPATH/ring-racers-freaky-build" ] || [ "$BUILD" = "$BUILDPATH/radio-racers" ]; then

        gawk -i inplace '{gsub("#define DEFAULTDIR \"ringracers\"","#define DEFAULTDIR \"ringracers'$GITVERCONF'\""); print}' "$BUILD/src/doomdef.h"

    elif [ "$(dirname $BUILD)" = "$BUILDPATH/srb2-custom" ]; then

        SRB2CCONFDIR=$(gawk -F'\"' '/DEFAULTDIR/ {gsub(" |\\.",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null | head -n1)
        gawk -i inplace '{gsub("#define DEFAULTDIR \"'$SRB2CCONFDIR'\"","#define DEFAULTDIR \"'$SRB2CCONFDIR'c'$CUSTOMDIR''$GITVERCONF'\""); print}' "$BUILD/src/doomdef.h"

    fi

    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Preparing and displaying $BUILDNAME's configure options for compilation. Please wait..."

    # Display content of Makefile for a good view of available compilation flags.
    if [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

        BLDCMD="cmake -S $BUILD -B $BUILD/build --preset ninja-x64_osx_vcpkg-release -DVCPKG_TARGET_TRIPLET=x64-osx -DCMAKE_C_COMPILER=gcc -DCMAKE_CXX_COMPILER=g++ -DCMAKE_OSX_SYSROOT=$SDKROOT -DCMAKE_OSX_DEPLOYMENT_TARGET=$MACOSVERSLADE -DCMAKE_POLICY_VERSION_MINIMUM=$CMAKEPOLVER -DCMAKE_BUILD_TYPE=Release -DCPACK_PACKAGE_DESCRIPTION_SUMMARY=\"$BUILDNAME\" -DCPACK_PACKAGE_FILE_NAME=\"$BUILDNAME\" -DSRB2_SDL2_EXE_NAME=\"$BUILDNAME\" -DCPACK_PACKAGE_VENDOR=srb2bld -DSRB2_CONFIG_ASSET_DIRECTORY=$BUILD/assets/installer -DSRB2_CPACK_GENERATOR=DragNDrop -DCMAKE_INSTALL_PREFIX=$SRB2BLDPREFIX -DSRB2_CONFIG_ENABLE_WEBM_MOVIES=ON -G 'Unix Makefiles'"
        eval $BLDCMD -LAH 2>&1 | gawk '{if(f)print} /-- Cache values/{f=1}' 2> /dev/null

    elif [ "$BUILD" = "$BUILDPATH/wadcli" ]; then

        cat "$BUILD/README.md"
        BLDCMD="make -k -j$NCPU -C $BUILD"

    elif [ "$BUILD" = "$BUILDPATH/kartmaker" ] || [ "$BUILD" = "$BUILDPATH/neptunefm" ] || [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ] || [ "$BUILD" = "$BUILDPATH/followermaker" ]; then

        BLDCMD="$BUILD/build.sh"

    elif [ "$BUILD" = "$BUILDPATH/slade" ]; then

        if [ -n "$(command -v port 2> /dev/null)" ]; then

            export WXWIDGETSPREFIX="$MACPORTPREFIX"

        else

            export WXWIDGETSPREFIX="$HOMEBREWPREFIX"

        fi

        BLDCMD="cmake -S $BUILD -B $BUILD/build -DwxWidgets_CONFIG_EXECUTABLE=$(command -v $MACPORTPREFIX/Library/Frameworks/wxWidgets.framework/Versions/wxWidgets/*/bin/wx-config wx-config wx-config-gtk3 2> /dev/null | head -n1) -DCMAKE_OSX_SYSROOT=$SDKROOT -DCMAKE_OSX_DEPLOYMENT_TARGET=$MACOSVERSLADE -DCMAKE_POLICY_VERSION_MINIMUM=$CMAKEPOLVER -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=$SRB2BLDPREFIX -DwxWidgets_INCLUDE_DIRS=$WXWIDGETSPREFIX/include -DwxWidgets_LIBRARIES=$WXWIDGETSPREFIX/lib -DMPG123_INCLUDE_DIR=$LIBMPG123PREFIX/include -DMPG123_LIBRARIES=$LIBMPG123PREFIX/lib/libmpg123.dylib"
        eval $BLDCMD -LAH 2>&1 | gawk '{if(f)print} /-- Cache values/{f=1}' 2> /dev/null

    elif [ "$BUILD" = "$BUILDPATH/aseprite" ]; then

        LIBSKIATMPDIR="$(mktemp -d)"

        if [ "$ARCH" = "x86_64" ]; then

            LIBSKIAPATH="$LIBSKIATMPDIR/libskia/out/Release-x64"

        elif [ "$ARCH" = "i386" ] || [ "$ARCH" = "i486" ] || [ "$ARCH" = "i686" ]; then

            LIBSKIAPATH="$LIBSKIATMPDIR/libskia/out/Release-x86"

        elif [ "$ARCH" = "arm64" ]; then

            LIBSKIAPATH="$LIBSKIATMPDIR/libskia/out/Release-arm64"

        fi

        BLDCMD="cmake -S $BUILD -B $BUILD/build -G Ninja -DBUILD_SHARED_LIBS=OFF -DCMAKE_BUILD_TYPE=Release -DCMAKE_OSX_ARCHITECTURES=$ARCH -DCMAKE_OSX_DEPLOYMENT_TARGET=$MACOSVER -DCMAKE_POLICY_VERSION_MINIMUM=$CMAKEPOLVER -DCMAKE_OSX_SYSROOT=$SDKROOT -DBUILD_TESTING=OFF -DCLIP_TESTS=OFF -DCMARK_TESTS=OFF -DENABLE_TEST=OFF -DENABLE_TESTS=OFF -DFMT_CUDA_TEST=OFF -DFMT_TEST=OFF -DJSON11_BUILD_TESTS=OFF -DLAF_WITH_TESTS=OFF -DOBSERVABLE_TESTS=OFF -DPNG_TESTS=OFF -DUNDO_TESTS=OFF -Dtinyxml2_BUILD_TESTING=OFF -DLAF_BACKEND=skia -DSKIA_DIR=$LIBSKIATMPDIR/libskia -DSKIA_LIBRARY_DIR=$LIBSKIAPATH -DSKIA_LIBRARY=$LIBSKIAPATH/libskia.a -DCMAKE_PREFIX_PATH=$LIBSKIAPATH"
        eval $BLDCMD -LAH 2>&1 | gawk '{if(f)print} /-- Cache values/{f=1}' 2> /dev/null

    else

        if [ "$BUILD" = "$BUILDPATH/srb2-kart-saturn" ] || [ "$BUILD" = "$BUILDPATH/blankart" ]; then

            MACOSVER="10.15"

        fi

        BLDCMD="cmake -S $BUILD -B $BUILD/build -DCMAKE_OSX_SYSROOT=$SDKROOT -DCMAKE_OSX_DEPLOYMENT_TARGET=$MACOSVER -DCMAKE_POLICY_VERSION_MINIMUM=$CMAKEPOLVER -DCMAKE_BUILD_TYPE=Release -DCMAKE_OSX_ARCHITECTURES=$ARCH -DCPACK_PACKAGE_DESCRIPTION_SUMMARY=\"$BUILDNAME\" -DCPACK_PACKAGE_FILE_NAME=\"$BUILDNAME\" -DSRB2_SDL2_EXE_NAME=\"$BUILDNAME\" -DSRB2_EXE_NAME=\"$BUILDNAME\" -DCPACK_PACKAGE_VENDOR=srb2bld -DSRB2_CONFIG_ASSET_DIRECTORY=$BUILD/assets/installer -DSRB2_ASSET_DIRECTORY=$BUILD/assets/installer -DSRB2_CONFIG_EXTERNAL_ASSETS=ON -DSRB2_CONFIG_SHARED_INTERNAL_LIBRARIES=ON -DSRB2_CONFIG_SYSTEM_LIBRARIES=ON -DSRB2_CONFIG_USE_GME=ON -DSRB2_CPACK_GENERATOR=DragNDrop -DCMAKE_INSTALL_PREFIX=$SRB2BLDPREFIX -DCMAKE_EXE_LINKER_FLAGS_RELEASE=-headerpad_max_install_names -DCMAKE_MODULE_LINKER_FLAGS_RELEASE=-headerpad_max_install_names -DCMAKE_SHARED_LINKER_FLAGS_RELEASE=-headerpad_max_install_names -DSDL2_INCLUDE_DIR=$LIBSDL2PREFIX/include/SDL2 -DSDL2_LIBRARY=$LIBSDL2PREFIX/lib/libSDL2.dylib -DSDL2_MIXER_INCLUDE_DIR=$LIBSDL2MIXERPREFIX/include/SDL2 -DSDL2_MIXER_LIBRARY=$LIBSDL2MIXERPREFIX/lib/libSDL2_mixer.dylib -DGME_INCLUDE_DIR=$LIBGMEPREFIX/include/gme -DGME_LIBRARY=$LIBGMEPREFIX/lib/libgme.dylib -DOPENMPT_INCLUDE_DIR=$LIBOPENMPTPREFIX/include/libopenmpt -DOPENMPT_LIBRARY=$LIBOPENMPTPREFIX/lib/libopenmpt.dylib -DPNG_PNG_INCLUDE_DIR=$LIBPNGPREFIX/include -DPNG_LIBRARY=$LIBPNGPREFIX/lib/libpng.dylib -DMODPLUG_INCLUDE_DIR=$LIBMODPLUGPREFIX/include -DMODPLUG_LIBRARY=$LIBMODPLUGPREFIX/lib/libmodplug.dylib -DCMAKE_SKIP_RPATH=ON -DCMAKE_SKIP_INSTALL_RPATH=ON"
        eval $BLDCMD -LAH 2>&1 | gawk '{if(f)print} /-- Cache values/{f=1}' 2> /dev/null

    fi

    # Upgrade build. Making sure, that there are only used compilation flags.
    if [ -n "$UPGRADEBUILD" ] && [ -z "$CUSTOMDIR" ]; then

        export CONF="$(gawk '/---------------/ {gsub("---------------",""); getline; print}' "$SRB2BLDROOT/installed/$UPGRADEBUILD")"

    elif [ -n "$UPGRADEBUILD" ] && [ -n "$CUSTOMDIR" ]; then

        export CONF="$(gawk '/---------------/ {gsub("---------------",""); getline; print}' "$SRB2BLDROOT/installed/$CUSTOMDIR")"

    # Otherwise set compilation flags, build and install as usual.
    else

        # Warning for MacOS users.
        $PRINTF "$NOTICE\n%s\n\e[0m" "WARNING for macOS users! This script makes changes from rpath to absolute paths within some libraries installed from Homebrew, MacPorts or compiled (mostly should affects libraries compiled by user), that are associated with SRB2 binary, so installing or making App Bundles would be successful. In the future this could make unexpected results with apps or SRB2 builds, that depend on those libraries. Possible changes that would be applied. Save those below commands to text file and revert those changes after process:

        sudo ln -sf /Library/Developer/CommandLineTools/usr/lib/clang/*/lib/darwin/libclang_rt.ubsan_osx_dynamic.dylib "$SRB2BLDPREFIX/lib/libclang_rt.ubsan_osx_dynamic.dylib"
        sudo install_name_tool -change "@rpath/libclang_rt.ubsan_osx_dynamic.dylib" "$SRB2BLDPREFIX/lib/libclang_rt.ubsan_osx_dynamic.dylib" "$SRB2BLDPREFIX/lib/libgme.dylib"

        sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "$SRB2BLDPREFIX/lib/libbrotlicommon.dylib" "$SRB2BLDPREFIX/lib/libbrotlidec.dylib"
        sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "$SRB2BLDPREFIX/lib/libbrotlicommon.dylib" "$SRB2BLDPREFIX/lib/libbrotlienc.dylib"
        sudo install_name_tool -change "@rpath/libbrotlicommon.1.dylib" "$SRB2BLDPREFIX/lib/libbrotlicommon.dylib" "$SRB2BLDPREFIX/lib/libbrotlidec.dylib"
        sudo install_name_tool -change "@rpath/libbrotlicommon.1.dylib" "$SRB2BLDPREFIX/lib/libbrotlicommon.dylib" "$SRB2BLDPREFIX/lib/libbrotlienc.dylib"

        sudo install_name_tool -change "@rpath/libSDL2-2.0.dylib" "$SRB2BLDPREFIX/lib/libSDL2.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib"
        sudo install_name_tool -change "libSDL2-2.0.dylib" "$SRB2BLDPREFIX/lib/libSDL2.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib"

        sudo install_name_tool -change "@rpath/libmodplug.dylib" "$SRB2BLDPREFIX/lib/libmodplug.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib"
        sudo install_name_tool -change "libmodplug.dylib" "$SRB2BLDPREFIX/lib/libmodplug.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib"

        sudo install_name_tool -change "@rpath/libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libvorbis.dylib"
        sudo install_name_tool -change "@rpath/libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libvorbisfile.dylib"
        sudo install_name_tool -change "@rpath/libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libopenmpt.dylib"
        sudo install_name_tool -change "@rpath/libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib"
        sudo install_name_tool -change "libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libvorbis.dylib"
        sudo install_name_tool -change "libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libvorbisfile.dylib"
        sudo install_name_tool -change "libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libopenmpt.dylib"
        sudo install_name_tool -change "libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib"

        sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "$HOMEBREWPREFIX/lib/libbrotlicommon.dylib" "$HOMEBREWPREFIX/lib/libbrotlidec.dylib"
        sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "$HOMEBREWPREFIX/lib/libbrotlicommon.dylib" "$HOMEBREWPREFIX/lib/libbrotlienc.dylib"
        sudo install_name_tool -change "@rpath/libbrotlicommon.1.dylib" "$HOMEBREWPREFIX/lib/libbrotlicommon.dylib" "$HOMEBREWPREFIX/lib/libbrotlidec.dylib"
        sudo install_name_tool -change "@rpath/libbrotlicommon.1.dylib" "$HOMEBREWPREFIX/lib/libbrotlicommon.dylib" "$HOMEBREWPREFIX/lib/libbrotlienc.dylib"

        sudo install_name_tool -change "@rpath/libSDL2-2.0.dylib" "$HOMEBREWPREFIX/lib/libSDL2.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib"
        sudo install_name_tool -change "libSDL2-2.0.dylib" "$HOMEBREWPREFIX/lib/libSDL2.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib"

        sudo install_name_tool -change "@rpath/libmodplug.dylib" "$HOMEBREWPREFIX/lib/libmodplug.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib"
        sudo install_name_tool -change "libmodplug.dylib" "$HOMEBREWPREFIX/lib/libmodplug.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib"

        sudo install_name_tool -change "@rpath/libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libvorbis.dylib"
        sudo install_name_tool -change "@rpath/libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libvorbisfile.dylib"
        sudo install_name_tool -change "@rpath/libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libopenmpt.dylib"
        sudo install_name_tool -change "@rpath/libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib"
        sudo install_name_tool -change "libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libvorbis.dylib"
        sudo install_name_tool -change "libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libvorbisfile.dylib"
        sudo install_name_tool -change "libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libopenmpt.dylib"
        sudo install_name_tool -change "libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib"

        sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "$MACPORTPREFIX/lib/libbrotlicommon.dylib" "$MACPORTPREFIX/lib/libbrotlidec.dylib"
        sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "$MACPORTPREFIX/lib/libbrotlicommon.dylib" "$MACPORTPREFIX/lib/libbrotlienc.dylib"
        sudo install_name_tool -change "@rpath/libbrotlicommon.1.dylib" "$MACPORTPREFIX/lib/libbrotlicommon.dylib" "$MACPORTPREFIX/lib/libbrotlidec.dylib"
        sudo install_name_tool -change "@rpath/libbrotlicommon.1.dylib" "$MACPORTPREFIX/lib/libbrotlicommon.dylib" "$MACPORTPREFIX/lib/libbrotlienc.dylib"

        sudo install_name_tool -change "@rpath/libSDL2-2.0.dylib" "$MACPORTPREFIX/lib/libSDL2.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer.dylib"
        sudo install_name_tool -change "libSDL2-2.0.dylib" "$MACPORTPREFIX/lib/libSDL2.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer.dylib"

        sudo install_name_tool -change "@rpath/libmodplug.dylib" "$MACPORTPREFIX/lib/libmodplug.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer.dylib"
        sudo install_name_tool -change "libmodplug.dylib" "$MACPORTPREFIX/lib/libmodplug.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer.dylib"

        sudo install_name_tool -change "@rpath/libgme.0.dylib" "$HOMEBREWPREFIX/lib/libSDL2.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer_ext.dylib"
        sudo install_name_tool -change "libgme.0.dylib" "$HOMEBREWPREFIX/lib/libSDL2.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer_ext.dylib"

        sudo install_name_tool -change "@rpath/libgme.0.dylib" "$MACPORTPREFIX/lib/libSDL2.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer_ext.dylib"
        sudo install_name_tool -change "libgme.0.dylib" "$MACPORTPREFIX/lib/libSDL2.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer_ext.dylib"

        sudo install_name_tool -change "@rpath/libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libvorbis.dylib"
        sudo install_name_tool -change "@rpath/libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libvorbisfile.dylib"
        sudo install_name_tool -change "@rpath/libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libopenmpt.dylib"
        sudo install_name_tool -change "@rpath/libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer.dylib"
        sudo install_name_tool -change "libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libvorbis.dylib"
        sudo install_name_tool -change "libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libvorbisfile.dylib"
        sudo install_name_tool -change "libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libopenmpt.dylib"
        sudo install_name_tool -change "libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer.dylib"

Press y/yes to continue, or n/no or ctrl+c to quit."

        $PRINTF "$PROMPT\n%s\e[0m" "> "
        read -r CONFIRM

        if [ "$CONFIRM" = y ] || [ "$CONFIRM" = Y ] || [ "$CONFIRM" = yes ] || [ "$CONFIRM" = Yes ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please enter $BUILDNAME's space separated compilation flags and then press enter, or just press enter to begin compiling. Default command and flags for compilation:"
            $PRINTF "$NOTICE%s\n\e[0m" "$BLDCMD [YOUR-COMPILATION-FLAGS-WILL-BE-HERE]"

            # Add compilation flags.
            $PRINTF "$PROMPT\n%s\e[0m" "> "
            read -r CONF

        else

            $PRINTF "$NOTICE\n%s\n\e[0m" "Exiting shell script."
            exit

        fi

        # Some checks, if the build's certain compilation flags were entered.
        if [ -n "$($PRINTF "%s\n" "$CONF" | gawk 'match($0, /SRB2_CONFIG_HAVE_PNG=OFF|SRB2_CONFIG_HAVE_PNG:BOOL=OFF/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$CONF" | gawk 'match($0, /SRB2_CONFIG_HAVE_PNG=OFF|SRB2_CONFIG_HAVE_PNG:BOOL=OFF/) {print substr($0, RSTART, RLENGTH)}')" ]; then

            ISPNG=

        else

            ISPNG=libpng

        fi

        if [ -n "$($PRINTF "%s\n" "$CONF" | gawk 'match($0, /SRB2_CONFIG_HAVE_GME=OFF|SRB2_CONFIG_USE_GME=OFF|SRB2_CONFIG_HAVE_GME:BOOL=OFF|SRB2_CONFIG_USE_GME:BOOL=OFF/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$CONF" | gawk 'match($0, /SRB2_CONFIG_HAVE_GME=OFF|SRB2_CONFIG_USE_GME=OFF|SRB2_CONFIG_HAVE_GME:BOOL=OFF|SRB2_CONFIG_USE_GME:BOOL=OFF/) {print substr($0, RSTART, RLENGTH)}')" ]; then

            ISGME=

        else

            ISGME=libgme

        fi

        if [ -n "$($PRINTF "%s\n" "$CONF" | gawk 'match($0, /SRB2_CONFIG_HAVE_OPENMPT=OFF|SRB2_CONFIG_HAVE_OPENMPT:BOOL=OFF/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$CONF" | gawk 'match($0, /SRB2_CONFIG_HAVE_OPENMPT=OFF|SRB2_CONFIG_HAVE_OPENMPT:BOOL=OFF/) {print substr($0, RSTART, RLENGTH)}')" ]; then

            ISOPENMPT=

        else

            ISOPENMPT=libopenmpt

        fi

        if [ -n "$($PRINTF "%s\n" "$CONF" | gawk 'match($0, /SRB2_CONFIG_SDL2_USEMIXER=OFF|SRB2_CONFIG_SDL2_USEMIXER:BOOL=OFF/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$CONF" | gawk 'match($0, /SRB2_CONFIG_SDL2_USEMIXER=OFF|SRB2_CONFIG_SDL2_USEMIXER:BOOL=OFF/) {print substr($0, RSTART, RLENGTH)}')" ]; then

            ISSDL2MIXER=

        else

            ISSDL2MIXER=libsdl2_mixer

        fi

        if [ -n "$($PRINTF "%s\n" "$CONF" | gawk 'match($0, /SRB2_CONFIG_HAVE_MIXERX=ON|SRB2_CONFIG_HAVE_MIXERX:BOOL=ON/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$CONF" | gawk 'match($0, /SRB2_CONFIG_HAVE_MIXERX=ON|SRB2_CONFIG_HAVE_MIXERX:BOOL=ON/) {print substr($0, RSTART, RLENGTH)}')" ]; then

            ISSDL2MIXERX=libsdl2_mixerx

        else

            ISSDL2MIXERX=

        fi

        if [ -n "$($PRINTF "%s\n" "$CONF" | gawk 'match($0, /SRB2_CONFIG_HAVE_DISCORDRPC=ON|SRB2_CONFIG_HAVE_DISCORDRPC:BOOL=ON|SRB2_CONFIG_ENABLE_DISCORDRPC=ON|SRB2_CONFIG_ENABLE_DISCORDRPC:BOOL=ON/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$CONF" | gawk 'match($0, /SRB2_CONFIG_HAVE_DISCORDRPC=ON|SRB2_CONFIG_HAVE_DISCORDRPC:BOOL=ON/) {print substr($0, RSTART, RLENGTH)}')" ]; then

            ISDISCORDRPC=libdiscord-rpc

        else

            ISDISCORDRPC=

        fi

    fi

    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing missing dependencies. Please wait..."
    sudo_ping

    # Fixing permission conflicts between compiled libraries and installed from package manager.
    if [ "$(stat -f %u "$SRB2BLDPREFIX/stow" 2> /dev/null)" = "0" ]; then

        sudo chown -R "$USER" "$SRB2BLDPREFIX/stow"

    fi

    if [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

        # Download vcpkg's source code, build and install it.
        if [ ! -d "$SRB2BLDROOT/libraries/vcpkg/.git" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading vcpkg's source code. Please wait..."
            git clone $GITOPTS https://github.com/microsoft/vcpkg.git --recursive --branch "$MACOSVCPKGVER" "$SRB2BLDROOT/libraries/vcpkg"

        else

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up vcpkg's source code. Please wait..."

            if [ -n "$ISNET" ]; then

                git -C "$SRB2BLDROOT/libraries/vcpkg" clean -dffx
                git -C "$SRB2BLDROOT/libraries/vcpkg" reset --hard
                git -C "$SRB2BLDROOT/libraries/vcpkg" pull --recurse-submodules --rebase --autostash

            fi

        fi

        "$SRB2BLDROOT/libraries/vcpkg/bootstrap-vcpkg.sh" -disableMetrics

    elif [ "$BUILD" = "$BUILDPATH/wadcli" ]; then

        # Download liblzf's source code, build and install it.
        if [ ! -d "$SRB2BLDROOT/libraries/liblzf/.git" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading liblzf's source code. Please wait..."
            git clone $GITOPTS https://salsa.debian.org/debian/liblzf.git --recursive --branch "$MACOSLZFVER" "$SRB2BLDROOT/libraries/liblzf"

        else

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up liblzf's source code. Please wait..."
            git -C "$SRB2BLDROOT/libraries/liblzf" clean -qdffx -e .comrev
            git -C "$SRB2BLDROOT/libraries/liblzf" reset -q --hard
            git -C "$SRB2BLDROOT/libraries/liblzf" checkout -q master

            if [ -n "$ISNET" ]; then

                git -C "$SRB2BLDROOT/libraries/liblzf" pull --recurse-submodules --rebase --autostash

            fi

            git -C "$SRB2BLDROOT/libraries/liblzf" checkout -q "$MACOSLZFVER"

        fi

        if [ ! -f "$SRB2BLDPREFIX/lib/liblzf.a" ] || ([ -n "$(cat "$SRB2BLDROOT/libraries/liblzf/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/liblzf" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/liblzf/.comrev" 2> /dev/null)" ]); then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing liblzf. Please wait..."
            cd "$SRB2BLDROOT/libraries/liblzf" || exit
            cp -rf "$SRB2BLDROOT/libraries/liblzf/debian/extras/"* "$SRB2BLDROOT/libraries/liblzf"
            patch -Np1 -d "$SRB2BLDROOT/libraries/liblzf" -i "$SRB2BLDROOT/libraries/liblzf/debian/patches/"*.patch
            CC="/usr/bin/gcc" CXX="/usr/bin/g++" CFLAGS="-mmacos-version-min=$MACOSVER" CXXFLAGS="-mmacos-version-min=$MACOSVER" LDFLAGS="-mmacos-version-min=$MACOSVER" "$SRB2BLDROOT/libraries/liblzf/configure" --prefix="$SRB2BLDPREFIX/stow/liblzf" --includedir="$SRB2BLDPREFIX/stow/liblzf/include/liblzf"
            make -k -j"$NCPU" -C "$SRB2BLDROOT/libraries/liblzf"

            if [ -d "$SRB2BLDPREFIX/stow/liblzf" ]; then

                sudo -E stow -Dv --adopt liblzf
                sudo rm -rf "$SRB2BLDPREFIX/stow/liblzf"

            fi

            sudo make -C "$SRB2BLDROOT/libraries/liblzf" install
            sudo -E stow -v --adopt liblzf

            git -C "$SRB2BLDROOT/libraries/liblzf" clean -qdffx -e .comrev
            git -C "$SRB2BLDROOT/libraries/liblzf" reset -q --hard

            COMREV=$(git -C "$SRB2BLDROOT/libraries/liblzf" rev-parse --short HEAD)
            $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/liblzf/.comrev"
            cd "$BUILD" || exit

        fi

    elif [ "$BUILD" = "$BUILDPATH/kartmaker" ] || [ "$BUILD" = "$BUILDPATH/neptunefm" ] || [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ] || [ "$BUILD" = "$BUILDPATH/followermaker" ]; then

        $PRINTF "$NOTICE%s\n\e[0m" "No dependencies to install for kartmaker/NeptuneFM/followermaker."

    elif [ "$BUILD" = "$BUILDPATH/slade" ]; then

        # Install package using port command, if detected.
        if [ -n "$(command -v port 2> /dev/null)" ]; then

            sudo port selfupdate && sudo port -Nfc install ftgl glew fluidsynth gtk3 freeimage sfml libmodplug webp $(port -q search --regex --name "wxwidgets-[0-9]" | tail -n1) lua
            export WXWIDGETSPREFIX="$MACPORTPREFIX"

        else

            brew update && brew install -f ftgl glew fluid-synth gtk+ freeimage sfml libmodplug wxwidgets webp lua
            export WXWIDGETSPREFIX="$HOMEBREWPREFIX"

        fi

    elif [ "$BUILD" = "$BUILDPATH/aseprite" ]; then

        # Install package using port command, if detected.
        if [ -n "$(command -v port 2> /dev/null)" ]; then

            sudo port selfupdate && sudo port -Nfc install $(port -q search --regex --name "^python[0-9]*$" | tail -n1) ninja

        else

            brew update && brew install -f python3 ninja

        fi

        # Unset environment variables for conflicting libraries and header files.
        unset LIBRARY_PATH C_INCLUDE_PATH CPLUS_INCLUDE_PATH PKG_CONFIG_PATH

        # Download Google Depot Tools' source code, build and install it.
        if [ ! -d "$SRB2BLDROOT/libraries/depot_tools/.git" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading Google Depot Tools' source code. Please wait..."
            git clone $GITOPTS https://chromium.googlesource.com/chromium/tools/depot_tools.git --recursive --branch "$MACOSDEPOTTOOLSVER" "$SRB2BLDROOT/libraries/depot_tools"

        else

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up Google Depot Tools' source code. Please wait..."
            git -C "$SRB2BLDROOT/libraries/depot_tools" clean -qdffx -e .comrev
            git -C "$SRB2BLDROOT/libraries/depot_tools" reset -q --hard
            git -C "$SRB2BLDROOT/libraries/depot_tools" checkout -q main

            if [ -n "$ISNET" ]; then

                git -C "$SRB2BLDROOT/libraries/depot_tools" pull --recurse-submodules --rebase --autostash

            fi

            git -C "$SRB2BLDROOT/libraries/depot_tools" checkout -q "$MACOSDEPOTTOOLSVER"

        fi

        if [ -n "$(cat "$SRB2BLDROOT/libraries/depot_tools/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/depot_tools" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/depot_tools/.comrev" 2> /dev/null)" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing depot_tools. Please wait..."

            git -C "$SRB2BLDROOT/libraries/depot_tools" clean -qdffx -e .comrev
            git -C "$SRB2BLDROOT/libraries/depot_tools" reset -q --hard

            COMREV=$(git -C "$SRB2BLDROOT/libraries/depot_tools" rev-parse --short HEAD)
            $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/depot_tools/.comrev"

        fi

        # Download libskia's source code, build and install it.
        if ([ ! -f "$LIBSKIAPATH/libskia.a" ] && [ ! -f "$HOMEBREWPREFIX/lib/libskia.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libskia.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libskia/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libskia" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libskia/.comrev" 2> /dev/null)" ]); then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libskia. Please wait..."

            if [ "$ARCH" = "arm64" ]; then

                if [ -n "$ISNET" ]; then

                    LIBSKIAASSETURL=$(curl -sL "https://api.github.com/repos/aseprite/skia/releases/latest" | gawk -F'"' '/browser_download_url.*Skia-macOS-Release-arm64.zip/ {print $4}')
                    if [ "$(curl -X GET -sLI "$LIBSKIAASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/libraries/Skia-macOS-Release-arm64.zip" 2> /dev/null)" ]; then

                        rm -f "$SRB2BLDROOT/libraries/Skia-macOS-Release-arm64.zip"
                        curl -RL "$LIBSKIAASSETURL" -o "$SRB2BLDROOT/libraries/Skia-macOS-Release-arm64.zip"

                    fi

                fi

                7z x -y "$SRB2BLDROOT/libraries/Skia-macOS-Release-arm64.zip" -o"$LIBSKIATMPDIR/libskia"

            else

                if [ -n "$ISNET" ]; then

                    LIBSKIAASSETURL=$(curl -sL "https://api.github.com/repos/aseprite/skia/releases/latest" | gawk -F'"' '/browser_download_url.*Skia-macOS-Release-x64.zip/ {print $4}')
                    if [ "$(curl -X GET -sLI "$LIBSKIAASSETURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/libraries/Skia-macOS-Release-x64.zip" 2> /dev/null)" ]; then

                        rm -f "$SRB2BLDROOT/libraries/Skia-macOS-Release-x64.zip"
                        curl -RL "$LIBSKIAASSETURL" -o "$SRB2BLDROOT/libraries/Skia-macOS-Release-x64.zip"

                    fi

                fi

                7z x -y "$SRB2BLDROOT/libraries/Skia-macOS-Release-x64.zip" -o"$LIBSKIATMPDIR/libskia"

            fi

        fi

    else

        # Download libpng's source code, build and install it.
        if [ "$ISPNG" = "libpng" ]; then

            if [ ! -d "$SRB2BLDROOT/libraries/libpng/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libpng's source code. Please wait..."
                git clone $GITOPTS git://git.code.sf.net/p/libpng/code.git --recursive --branch "v$MACOSPNGVER" "$SRB2BLDROOT/libraries/libpng"

            else

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libpng's source code. Please wait..."
                git -C "$SRB2BLDROOT/libraries/libpng" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libpng" reset -q --hard
                git -C "$SRB2BLDROOT/libraries/libpng" checkout -q master

                if [ -n "$ISNET" ]; then

                    git -C "$SRB2BLDROOT/libraries/libpng" pull --recurse-submodules --rebase --autostash

                fi

                git -C "$SRB2BLDROOT/libraries/libpng" checkout -q "v$MACOSPNGVER"

            fi

            if ([ ! -f "$SRB2BLDPREFIX/lib/libpng.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libpng.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libpng.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libpng/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libpng" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libpng/.comrev" 2> /dev/null)" ]); then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libpng. Please wait..."
                cd "$SRB2BLDROOT/libraries/libpng" || exit
                "$SRB2BLDROOT/libraries/libpng/configure" --prefix="$SRB2BLDPREFIX/stow/libpng"
                make -k -j"$NCPU"

                if [ -d "$SRB2BLDPREFIX/stow/libpng" ]; then

                    sudo -E stow -Dv --adopt libpng
                    sudo rm -rf "$SRB2BLDPREFIX/stow/libpng"

                fi

                sudo -E make install
                sudo -E stow -v --adopt libpng

                git -C "$SRB2BLDROOT/libraries/libpng" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libpng" reset -q --hard

                COMREV=$(git -C "$SRB2BLDROOT/libraries/libpng" rev-parse --short HEAD)
                $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libpng/.comrev"

            fi

        fi

        # Download libogg's source code, build and install it.
        if [ "$ISOPENMPT" = "libopenmpt" ] || [ "$ISSDL2MIXER" = "libsdl2_mixer" ] || [ "$ISSDL2MIXERX" = "libsdl2_mixerx" ]; then

            if [ ! -d "$SRB2BLDROOT/libraries/libogg/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libogg's source code. Please wait..."
                git clone $GITOPTS https://gitlab.xiph.org/xiph/ogg.git --recursive --branch "v$MACOSOGGVER" "$SRB2BLDROOT/libraries/libogg"

            else

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libogg's source code. Please wait..."
                git -C "$SRB2BLDROOT/libraries/libogg" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libogg" reset -q --hard
                git -C "$SRB2BLDROOT/libraries/libogg" checkout -q master

                if [ -n "$ISNET" ]; then

                    git -C "$SRB2BLDROOT/libraries/libogg" pull --recurse-submodules --rebase --autostash

                fi

                git -C "$SRB2BLDROOT/libraries/libogg" checkout -q "v$MACOSOGGVER"

            fi

            if ([ ! -f "$SRB2BLDPREFIX/lib/libogg.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libogg.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libogg.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libogg/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libogg" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libogg/.comrev" 2> /dev/null)" ]); then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libogg. Please wait..."
                mkdir -p "$SRB2BLDROOT/libraries/libogg/build"
                cmake -S "$SRB2BLDROOT/libraries/libogg" -B "$SRB2BLDROOT/libraries/libogg/build" -DCMAKE_OSX_DEPLOYMENT_TARGET="$MACOSVER" -DCMAKE_POLICY_VERSION_MINIMUM="$CMAKEPOLVER" -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=true -DCMAKE_INSTALL_PREFIX="$SRB2BLDPREFIX/stow/libogg" -DCMAKE_MACOSX_RPATH=OFF
                cmake --build "$SRB2BLDROOT/libraries/libogg/build" -j"$NCPU" --config Release

                if [ -d "$SRB2BLDPREFIX/stow/libogg" ]; then

                    sudo -E stow -Dv --adopt libogg
                    sudo rm -rf "$SRB2BLDPREFIX/stow/libogg"

                fi

                sudo -E cmake --install "$SRB2BLDROOT/libraries/libogg/build"
                sudo -E stow -v --adopt libogg

                git -C "$SRB2BLDROOT/libraries/libogg" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libogg" reset -q --hard

                COMREV=$(git -C "$SRB2BLDROOT/libraries/libogg" rev-parse --short HEAD)
                $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libogg/.comrev"

            fi

        fi

        # Download libvorbis' source code, build and install it.
        if [ "$ISOPENMPT" = "libopenmpt" ] || [ "$ISSDL2MIXER" = "libsdl2_mixer" ] || [ "$ISSDL2MIXERX" = "libsdl2_mixerx" ]; then

            if [ ! -d "$SRB2BLDROOT/libraries/libvorbis/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libvorbis' source code. Please wait..."
                git clone $GITOPTS https://gitlab.xiph.org/xiph/vorbis.git --recursive --branch "v$MACOSVORBISVER" "$SRB2BLDROOT/libraries/libvorbis"

            else

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libvorbis' source code. Please wait..."
                git -C "$SRB2BLDROOT/libraries/libvorbis" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libvorbis" reset -q --hard
                git -C "$SRB2BLDROOT/libraries/libvorbis" checkout -q master

                if [ -n "$ISNET" ]; then

                    git -C "$SRB2BLDROOT/libraries/libvorbis" pull --recurse-submodules --rebase --autostash

                fi

                git -C "$SRB2BLDROOT/libraries/libvorbis" checkout -q "v$MACOSVORBISVER"

            fi

            if ([ ! -f "$SRB2BLDPREFIX/lib/libvorbis.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libvorbis.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libvorbis.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libvorbis/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libvorbis" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libvorbis/.comrev" 2> /dev/null)" ]); then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libvorbis. Please wait..."
                cd "$SRB2BLDROOT/libraries/libvorbis" || exit
                gawk -i inplace '{gsub("-force_cpusubtype_ALL",""); print}' "$SRB2BLDROOT/libraries/libvorbis/configure.ac"
                "$SRB2BLDROOT/libraries/libvorbis/autogen.sh"
                "$SRB2BLDROOT/libraries/libvorbis/configure" --prefix="$SRB2BLDPREFIX/stow/libvorbis"
                make -k -j"$NCPU"

                if [ -d "$SRB2BLDPREFIX/stow/libvorbis" ]; then

                    sudo -E stow -Dv --adopt libvorbis
                    sudo rm -rf "$SRB2BLDPREFIX/stow/libvorbis"

                fi

                sudo -E make install
                sudo -E stow -v --adopt libvorbis

                git -C "$SRB2BLDROOT/libraries/libvorbis" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libvorbis" reset -q --hard

                COMREV=$(git -C "$SRB2BLDROOT/libraries/libvorbis" rev-parse --short HEAD)
                $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libvorbis/.comrev"
                cd "$BUILD" || exit

            fi

        fi

        # Download libmpg123's source code, build and install it.
        if [ "$ISOPENMPT" = "libopenmpt" ] || [ "$ISSDL2MIXER" = "libsdl2_mixer" ] || [ "$ISSDL2MIXERX" = "libsdl2_mixerx" ]; then

            if [ ! -d "$SRB2BLDROOT/libraries/libmpg123/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libmpg123's source code. Please wait..."
                git clone $GITOPTS https://github.com/madebr/mpg123.git --recursive --branch "$MACOSMPG123VER" "$SRB2BLDROOT/libraries/libmpg123"

            else

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libmpg123's source code. Please wait..."
                git -C "$SRB2BLDROOT/libraries/libmpg123" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libmpg123" reset -q --hard
                git -C "$SRB2BLDROOT/libraries/libmpg123" checkout -q master

                if [ -n "$ISNET" ]; then

                    git -C "$SRB2BLDROOT/libraries/libmpg123" pull --recurse-submodules --rebase --autostash

                fi

                git -C "$SRB2BLDROOT/libraries/libmpg123" checkout -q "$MACOSMPG123VER"

            fi

            if ([ ! -f "$SRB2BLDPREFIX/lib/libmpg123.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libmpg123.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libmpg123.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libmpg123/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libmpg123" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libmpg123/.comrev" 2> /dev/null)" ]); then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libmpg123. Please wait..."
                cd "$SRB2BLDROOT/libraries/libmpg123" || exit
                autoreconf -vif
                PKG_CONFIG_PATH="" CPLUS_INCLUDE_PATH="" C_INCLUDE_PATH="" LIBRARY_PATH="" "$SRB2BLDROOT/libraries/libmpg123/configure" --prefix="$SRB2BLDPREFIX/stow/libmpg123"
                make -k -j"$NCPU"

                if [ -d "$SRB2BLDPREFIX/stow/libmpg123" ]; then

                    sudo -E stow -Dv --adopt libmpg123
                    sudo rm -rf "$SRB2BLDPREFIX/stow/libmpg123"

                fi

                sudo -E make install
                sudo -E stow -v --adopt libmpg123

                git -C "$SRB2BLDROOT/libraries/libmpg123" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libmpg123" reset -q --hard

                COMREV=$(git -C "$SRB2BLDROOT/libraries/libmpg123" rev-parse --short HEAD)
                $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libmpg123/.comrev"
                cd "$BUILD" || exit

            fi

        fi

        # Download libSDL's source code, build and install it.
        if [ "$BUILD" = "$BUILDPATH/srb2-2.2-classic" ]; then

            MACOSSDLVER="$MACOSSDL3VER"

        else

            MACOSSDLVER="$MACOSSDL2VER"

        fi

        if [ ! -d "$SRB2BLDROOT/libraries/libsdl/.git" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libSDL's source code. Please wait..."
            git clone $GITOPTS https://github.com/libsdl-org/SDL.git --recursive --branch "$MACOSSDLVER" "$SRB2BLDROOT/libraries/libsdl"

        else

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libSDL's source code. Please wait..."
            git -C "$SRB2BLDROOT/libraries/libsdl" clean -qdffx -e .comrev
            git -C "$SRB2BLDROOT/libraries/libsdl" reset -q --hard
            git -C "$SRB2BLDROOT/libraries/libsdl" checkout -q main

            if [ -n "$ISNET" ]; then

                git -C "$SRB2BLDROOT/libraries/libsdl" pull --recurse-submodules --rebase --autostash

            fi

            git -C "$SRB2BLDROOT/libraries/libsdl" checkout -q "$MACOSSDLVER"

        fi

        if ([ ! -f "$SRB2BLDPREFIX/lib/libSDL3.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libSDL3.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libSDL3.dylib" ] && [ ! -f "$SRB2BLDPREFIX/lib/libSDL2.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libSDL2.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libSDL2.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libsdl/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libsdl" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libsdl/.comrev" 2> /dev/null)" ]); then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libSDL. Please wait..."
            cd "$SRB2BLDROOT/libraries/libsdl" || exit

            if [ "$BUILD" = "$BUILDPATH/srb2-2.2-classic" ]; then

                git -C "$SRB2BLDROOT/libraries/libsdl" checkout -q "$MACOSSDL3VER"
                CFLAGS="" cmake -S "$SRB2BLDROOT/libraries/libsdl" -B "$SRB2BLDROOT/libraries/libsdl/build" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX="$SRB2BLDPREFIX/stow/libsdl3"
                cmake --build "$SRB2BLDROOT/libraries/libsdl/build" -j"$NCPU" --config Release

                if [ -d "$SRB2BLDPREFIX/stow/libsdl3" ]; then

                    sudo -E stow -Dv --adopt libsdl3
                    sudo rm -rf "$SRB2BLDPREFIX/stow/libsdl3"

                fi

                sudo -E cmake --install "$SRB2BLDROOT/libraries/libsdl/build"
                sudo -E stow -v --adopt libsdl3

            else

                git -C "$SRB2BLDROOT/libraries/libsdl" checkout -q "$MACOSSDL2VER"
                "$SRB2BLDROOT/libraries/libsdl/configure" --prefix="$SRB2BLDPREFIX/stow/libsdl2" --enable-rpath=no
                make -k -j"$NCPU"

                if [ -d "$SRB2BLDPREFIX/stow/libsdl2" ]; then

                    sudo -E stow -Dv --adopt libsdl2
                    sudo rm -rf "$SRB2BLDPREFIX/stow/libsdl2"

                fi

                sudo -E make install
                sudo -E stow -v --adopt libsdl2

            fi

            git -C "$SRB2BLDROOT/libraries/libsdl" clean -qdffx -e .comrev
            git -C "$SRB2BLDROOT/libraries/libsdl" reset -q --hard

            COMREV=$(git -C "$SRB2BLDROOT/libraries/libsdl" rev-parse --short HEAD)
            $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libsdl/.comrev"

        fi

        # Download libopenmpt's source code, build and install it.
        if [ "$ISOPENMPT" = "libopenmpt" ]; then

            if [ ! -d "$SRB2BLDROOT/libraries/libopenmpt/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libopenmpt's source code. Please wait..."
                git clone $GITOPTS https://github.com/OpenMPT/openmpt.git --recursive --branch "libopenmpt-$MACOSOPENMPTVER" "$SRB2BLDROOT/libraries/libopenmpt"

            else

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libopenmpt's source code. Please wait..."
                sudo -E git -C "$SRB2BLDROOT/libraries/libopenmpt" clean -qdffx -e .comrev
                sudo -E git -C "$SRB2BLDROOT/libraries/libopenmpt" reset -q --hard
                git -C "$SRB2BLDROOT/libraries/libopenmpt" checkout -q master

                if [ -n "$ISNET" ]; then

                    git -C "$SRB2BLDROOT/libraries/libopenmpt" pull --recurse-submodules --rebase --autostash

                fi

                git -C "$SRB2BLDROOT/libraries/libopenmpt" checkout -qf "libopenmpt-$MACOSOPENMPTVER"

            fi

            if ([ ! -f "$SRB2BLDPREFIX/lib/libopenmpt.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libopenmpt.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libopenmpt.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libopenmpt/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libopenmpt" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libopenmpt/.comrev" 2> /dev/null)" ]); then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libopenmpt. Please wait..."
                cd "$SRB2BLDROOT/libraries/libopenmpt" || exit
                sudo mkdir -p "$SRB2BLDPREFIX/stow/libopenmpt/lib"
                gawk -i inplace '{gsub("DYNLINK=1","DYNLINK=0"); gsub("TEST=1","TEST=0"); gsub("SOSUFFIX=.so","SOSUFFIX=.dylib"); gsub("STATIC_LIB=1","STATIC_LIB=0"); gsub("EXAMPLES=1","EXAMPLES=0"); gsub("OPENMPT123=1","OPENMPT123=0"); print}' "$SRB2BLDROOT/libraries/libopenmpt/Makefile"
                gawk -i inplace '{gsub("\\$\\(INSTALL_DATA\\) bin/libopenmpt.pc \\$\\(DESTDIR\\)\\$\\(PREFIX\\)/lib/pkgconfig/libopenmpt.pc|\\$\\(INSTALL_LIB\\) bin/\\$\\(LIBOPENMPT_SONAME\\) \\$\\(DESTDIR\\)\\$\\(PREFIX\\)/lib/\\$\\(LIBOPENMPT_SONAME\\)|\\$\\(INSTALL_LIB\\) bin/libopenmpt\\$\\(SOSUFFIX\\) \\$\\(DESTDIR\\)\\$\\(PREFIX\\)/lib/libopenmpt\\$\\(SOSUFFIX\\)",""); print}' "$SRB2BLDROOT/libraries/libopenmpt/Makefile"
                gawk -i inplace '{gsub("bin/libopenmpt","'$SRB2BLDPREFIX'/stow/libopenmpt/lib/libopenmpt"); print}' "$SRB2BLDROOT/libraries/libopenmpt/Makefile"

                sudo -E make -j"$NCPU" NO_PORTAUDIO=1 NO_PORTAUDIOCPP=1 NO_SNDFILE=1 NO_FLAC=1 NO_PULSEAUDIO=1
                sudo -E make PREFIX="$SRB2BLDPREFIX/stow/libopenmpt" install
                sudo -E stow -v --adopt libopenmpt

                sudo -E git -C "$SRB2BLDROOT/libraries/libopenmpt" clean -qdffx -e .comrev
                sudo -E git -C "$SRB2BLDROOT/libraries/libopenmpt" reset -q --hard

                COMREV=$(git -C "$SRB2BLDROOT/libraries/libopenmpt" rev-parse --short HEAD)
                $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libopenmpt/.comrev"
                cd "$BUILD" || exit

            fi

        fi

        # Download libgme's source code, build and install it.
        if [ "$ISGME" = "libgme" ]; then

            if [ ! -d "$SRB2BLDROOT/libraries/libgme/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libgme's source code. Please wait..."
                git clone $GITOPTS https://bitbucket.org/mpyne/game-music-emu.git --recursive --branch "$MACOSGMEVER" "$SRB2BLDROOT/libraries/libgme"

            else

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libgme's source code. Please wait..."
                git -C "$SRB2BLDROOT/libraries/libgme" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libgme" reset -q --hard
                git -C "$SRB2BLDROOT/libraries/libgme" checkout -q master

                if [ -n "$ISNET" ]; then

                    git -C "$SRB2BLDROOT/libraries/libgme" pull --recurse-submodules --rebase --autostash

                fi

                git -C "$SRB2BLDROOT/libraries/libgme" checkout -q "$MACOSGMEVER"

            fi

            if ([ ! -f "$SRB2BLDPREFIX/lib/libgme.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libgme.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libgme.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libgme/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libgme" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libgme/.comrev" 2> /dev/null)" ]); then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libgme. Please wait..."
                mkdir -p "$SRB2BLDROOT/libraries/libgme/build"
                cmake -S "$SRB2BLDROOT/libraries/libgme" -B "$SRB2BLDROOT/libraries/libgme/build" -DCMAKE_OSX_DEPLOYMENT_TARGET="$MACOSVER" -DCMAKE_POLICY_VERSION_MINIMUM="$CMAKEPOLVER" -DCMAKE_BUILD_TYPE=Release -DGME_YM2612_EMU=MAME -DENABLE_UBSAN=OFF -DCMAKE_INSTALL_PREFIX="$SRB2BLDPREFIX/stow/libgme" -DCMAKE_MACOSX_RPATH=OFF
                cmake --build "$SRB2BLDROOT/libraries/libgme/build" -j"$NCPU" --config Release

                if [ -d "$SRB2BLDPREFIX/stow/libgme" ]; then

                    sudo -E stow -Dv --adopt libgme
                    sudo rm -rf "$SRB2BLDPREFIX/stow/libgme"

                fi

                sudo -E cmake --install "$SRB2BLDROOT/libraries/libgme/build"
                sudo -E stow -v --adopt libgme

                git -C "$SRB2BLDROOT/libraries/libgme" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libgme" reset -q --hard

                COMREV=$(git -C "$SRB2BLDROOT/libraries/libgme" rev-parse --short HEAD)
                $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libgme/.comrev"

            fi

        fi

        # Download libsndfile's source code, build and install it.
        if [ ! -d "$SRB2BLDROOT/libraries/libsndfile/.git" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libsndfile's source code. Please wait..."
            git clone $GITOPTS https://github.com/libsndfile/libsndfile.git --recursive --branch "$MACOSSNDFILEVER" "$SRB2BLDROOT/libraries/libsndfile"

        else

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libsndfile's source code. Please wait..."
            git -C "$SRB2BLDROOT/libraries/libsndfile" clean -qdffx -e .comrev
            git -C "$SRB2BLDROOT/libraries/libsndfile" reset -q --hard
            git -C "$SRB2BLDROOT/libraries/libsndfile" checkout -q master

            if [ -n "$ISNET" ]; then

                git -C "$SRB2BLDROOT/libraries/libsndfile" pull --recurse-submodules --rebase --autostash

            fi

            git -C "$SRB2BLDROOT/libraries/libsndfile" checkout -q "$MACOSSNDFILEVER"

        fi

        if [ ! -f $SRB2BLDPREFIX/lib/libsndfile.dylib ] || ([ -n "$(cat "$SRB2BLDROOT/libraries/libsndfile/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libsndfile" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libsndfile/.comrev" 2> /dev/null)" ]); then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libsndfile. Please wait..."
            cd "$SRB2BLDROOT/libraries/libsndfile" || exit
            cmake -S "$SRB2BLDROOT/libraries/libsndfile" -B "$SRB2BLDROOT/libraries/libsndfile/build" -DCMAKE_OSX_DEPLOYMENT_TARGET="$MACOSVER" -DCMAKE_POLICY_VERSION_MINIMUM="$CMAKEPOLVER" -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON -DCMAKE_INSTALL_PREFIX="$SRB2BLDPREFIX/stow/libsndfile" -DCMAKE_MACOSX_RPATH=OFF -DENABLE_EXTERNAL_LIBS=OFF
            cmake --build "$SRB2BLDROOT/libraries/libsndfile/build" -j"$NCPU" --config Release

            if [ -d "$SRB2BLDPREFIX/stow/libsndfile" ]; then

                sudo -E stow -Dv --adopt libsndfile
                sudo rm -rf "$SRB2BLDPREFIX/stow/libsndfile"

            fi

            sudo -E cmake --install "$SRB2BLDROOT/libraries/libsndfile/build"
            sudo -E stow -v --adopt libsndfile

            git -C "$SRB2BLDROOT/libraries/libsndfile" clean -qdffx -e .comrev
            git -C "$SRB2BLDROOT/libraries/libsndfile" reset -q --hard

            COMREV=$(git -C "$SRB2BLDROOT/libraries/libsndfile" rev-parse --short HEAD)
            $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libsndfile/.comrev"

        fi

        # Download libfluidsynth's source code, build and install it.
        if [ ! -d "$SRB2BLDROOT/libraries/libfluidsynth/.git" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libfluidsynth's source code. Please wait..."
            git clone $GITOPTS https://github.com/FluidSynth/fluidsynth.git --recursive --branch "$MACOSFLUIDSYNTHVER" "$SRB2BLDROOT/libraries/libfluidsynth"

        else

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libfluidsynth's source code. Please wait..."
            git -C "$SRB2BLDROOT/libraries/libfluidsynth" clean -qdffx -e .comrev
            git -C "$SRB2BLDROOT/libraries/libfluidsynth" reset -q --hard
            git -C "$SRB2BLDROOT/libraries/libfluidsynth" checkout -q master

            if [ -n "$ISNET" ]; then

                git -C "$SRB2BLDROOT/libraries/libfluidsynth" submodule update --init --recursive
                git -C "$SRB2BLDROOT/libraries/libfluidsynth" pull --recurse-submodules --rebase --autostash

            fi

            git -C "$SRB2BLDROOT/libraries/libfluidsynth" checkout -q "$MACOSFLUIDSYNTHVER"

        fi

        if [ ! -f "$SRB2BLDPREFIX/lib/libfluidsynth.dylib" ] || ([ -n "$(cat "$SRB2BLDROOT/libraries/libfluidsynth/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libfluidsynth" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libfluidsynth/.comrev" 2> /dev/null)" ]); then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libfluidsynth. Please wait..."
            cmake -S "$SRB2BLDROOT/libraries/libfluidsynth" -B "$SRB2BLDROOT/libraries/libfluidsynth/build" -DCMAKE_OSX_DEPLOYMENT_TARGET="$MACOSVER" -DCMAKE_POLICY_VERSION_MINIMUM="$CMAKEPOLVER" -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON -DCMAKE_INSTALL_PREFIX="$SRB2BLDPREFIX/stow/libfluidsynth" -DCMAKE_MACOSX_RPATH=OFF -Denable-framework=OFF -Denable-sdl2=OFF -DSndFile_DIR:PATH="$SRB2BLDPREFIX/lib/cmake/SndFile"
            cmake --build "$SRB2BLDROOT/libraries/libfluidsynth/build" -j"$NCPU" --config Release

            if [ -d "$SRB2BLDPREFIX/stow/libfluidsynth" ]; then

                sudo -E stow -Dv --adopt libfluidsynth
                sudo rm -rf "$SRB2BLDPREFIX/stow/libfluidsynth"

            fi

            sudo -E cmake --install "$SRB2BLDROOT/libraries/libfluidsynth/build"
            sudo -E stow -v --adopt libfluidsynth

            git -C "$SRB2BLDROOT/libraries/libfluidsynth" clean -qdffx -e .comrev
            git -C "$SRB2BLDROOT/libraries/libfluidsynth" reset -q --hard

            COMREV=$(git -C "$SRB2BLDROOT/libraries/libfluidsynth" rev-parse --short HEAD)
            $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libfluidsynth/.comrev"

        fi

        # Download libmodplug's source code, build and install it.
        if [ "$ISOPENMPT" = "libopenmpt" ] || [ "$ISSDL2MIXER" = "libsdl2_mixer" ] || [ "$ISSDL2MIXERX" = "libsdl2_mixerx" ]; then

            if [ ! -d "$SRB2BLDROOT/libraries/libmodplug/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libmodplug's source code. Please wait..."
                git clone $GITOPTS https://github.com/Konstanty/libmodplug.git --recursive --branch "$MACOSMODPLUGVER" "$SRB2BLDROOT/libraries/libmodplug"

            else

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libmodplug's source code. Please wait..."
                git -C "$SRB2BLDROOT/libraries/libmodplug" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libmodplug" reset -q --hard
                git -C "$SRB2BLDROOT/libraries/libmodplug" checkout -q master

                if [ -n "$ISNET" ]; then

                    git -C "$SRB2BLDROOT/libraries/libmodplug" pull --recurse-submodules --rebase --autostash

                fi

                git -C "$SRB2BLDROOT/libraries/libmodplug" checkout -q "$MACOSMODPLUGVER"

            fi

            if ([ ! -f "$SRB2BLDPREFIX/lib/libmodplug.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libmodplug.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libmodplug.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libmodplug/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libmodplug" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libmodplug/.comrev" 2> /dev/null)" ]); then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libmodplug. Please wait..."
                mkdir -p "$SRB2BLDROOT/libraries/libmodplug/build"
                cmake -S "$SRB2BLDROOT/libraries/libmodplug" -B "$SRB2BLDROOT/libraries/libmodplug/build" -DCMAKE_OSX_DEPLOYMENT_TARGET="$MACOSVER" -DCMAKE_POLICY_VERSION_MINIMUM="$CMAKEPOLVER" -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON -DCMAKE_INSTALL_PREFIX="$SRB2BLDPREFIX/stow/libmodplug" -DCMAKE_MACOSX_RPATH=OFF
                cmake --build "$SRB2BLDROOT/libraries/libmodplug/build" -j"$NCPU" --config Release

                if [ -d "$SRB2BLDPREFIX/stow/libmodplug" ]; then

                    sudo -E stow -Dv --adopt libmodplug
                    sudo rm -rf "$SRB2BLDPREFIX/stow/libmodplug"

                fi

                sudo -E cmake --install "$SRB2BLDROOT/libraries/libmodplug/build"
                sudo -E stow -v --adopt libmodplug

                git -C "$SRB2BLDROOT/libraries/libmodplug" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libmodplug" reset -q --hard

                COMREV=$(git -C "$SRB2BLDROOT/libraries/libmodplug" rev-parse --short HEAD)
                $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libmodplug/.comrev"

            fi

        fi

        # Download libSDL2_mixer's source code, build and install it.
        if [ "$ISSDL2MIXERX" != "libsdl2_mixerx" ] && [ "$ISSDL2MIXER" = "libsdl2_mixer" ]; then

            if [ ! -d "$SRB2BLDROOT/libraries/libsdl2-mixer/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libSDL2_mixer's source code. Please wait..."
                git clone $GITOPTS https://github.com/libsdl-org/SDL_mixer.git --recursive --branch "$MACOSSDL2MIXERVER" "$SRB2BLDROOT/libraries/libsdl2-mixer"

            else

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libSDL2_mixer's source code. Please wait..."
                git -C "$SRB2BLDROOT/libraries/libsdl2-mixer" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libsdl2-mixer" reset -q --hard
                git -C "$SRB2BLDROOT/libraries/libsdl2-mixer" checkout -q main

                if [ -n "$ISNET" ]; then

                    git -C "$SRB2BLDROOT/libraries/libsdl2-mixer" pull --recurse-submodules

                fi

                git -C "$SRB2BLDROOT/libraries/libsdl2-mixer" checkout -q "$MACOSSDL2MIXERVER"

            fi

            if ([ ! -f "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libSDL2_mixer.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libsdl2-mixer/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libsdl2-mixer" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libsdl2-mixer/.comrev" 2> /dev/null)" ]); then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libSDL2_mixer. Please wait..."
                cd "$SRB2BLDROOT/libraries/libsdl2-mixer" || exit
                "$SRB2BLDROOT/libraries/libsdl2-mixer/configure" \
                    --disable-dependency-tracking \
                    --disable-music-flac \
                    --disable-music-flac-shared \
                    --enable-music-midi \
                    --disable-music-midi-fluidsynth \
                    --disable-music-midi-fluidsynth-shared \
                    --enable-music-midi-native \
                    --disable-music-midi-timidity \
                    --enable-music-mod \
                    --disable-music-mod-mikmod \
                    --disable-music-mod-mikmod-shared \
                    --enable-music-mod-modplug \
                    --disable-music-mod-modplug-shared \
                    --enable-music-mp3 \
                    --enable-music-mp3-mpg123 \
                    --disable-music-mp3-mpg123-shared \
                    --enable-music-ogg \
                    --disable-music-ogg-shared \
                    --disable-music-opus \
                    --disable-music-opus-shared \
                    --enable-music-wave \
                    --prefix="$SRB2BLDPREFIX/stow/libsdl2-mixer"
                make -k -j"$NCPU"

                if [ -d "$SRB2BLDPREFIX/stow/libsdl2-mixer" ]; then

                    sudo -E stow -Dv --adopt libsdl2-mixer
                    sudo rm -rf "$SRB2BLDPREFIX/stow/libsdl2-mixer"

                fi

                sudo -E make install
                sudo -E stow -v --adopt libsdl2-mixer

                git -C "$SRB2BLDROOT/libraries/libsdl2-mixer" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libsdl2-mixer" reset -q --hard

                COMREV=$(git -C "$SRB2BLDROOT/libraries/libsdl2-mixer" rev-parse --short HEAD)
                $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libsdl2-mixer/.comrev"
                cd "$BUILD" || exit

            fi

        fi

        # Download libSDL2_mixerX's source code, build and install it.
        if [ "$ISSDL2MIXERX" = "libsdl2_mixerx" ]; then

            if [ ! -d "$SRB2BLDROOT/libraries/libsdl2-mixerx/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libSDL2_mixerX's source code. Please wait..."
                git clone $GITOPTS https://github.com/WohlSoft/SDL-Mixer-X.git --recursive --branch "$MACOSSDL2MIXERXVER" "$SRB2BLDROOT/libraries/libsdl2-mixerx"

            else

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libSDL2_mixerX's source code. Please wait..."
                git -C "$SRB2BLDROOT/libraries/libsdl2-mixerx" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libsdl2-mixerx" reset -q --hard
                git -C "$SRB2BLDROOT/libraries/libsdl2-mixerx" checkout -q master

                if [ -n "$ISNET" ]; then

                    git -C "$SRB2BLDROOT/libraries/libsdl2-mixerx" pull --recurse-submodules --rebase --autostash

                fi

                git -C "$SRB2BLDROOT/libraries/libsdl2-mixerx" checkout -q "$MACOSSDL2MIXERXVER"

            fi

            if ([ ! -f "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libSDL2_mixer_ext.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libSDL2_mixer_ext.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libsdl2-mixerx/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libsdl2-mixerx" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libsdl2-mixerx/.comrev" 2> /dev/null)" ]); then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libSDL2_mixerX. Please wait..."
                mkdir -p "$SRB2BLDROOT/libraries/libsdl2-mixerx/build"
                cmake -S "$SRB2BLDROOT/libraries/libsdl2-mixerx" -B "$SRB2BLDROOT/libraries/libsdl2-mixerx/build" -DCMAKE_OSX_DEPLOYMENT_TARGET="$MACOSVER" -DCMAKE_POLICY_VERSION_MINIMUM="$CMAKEPOLVER" -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON -DDOWNLOAD_AUDIO_CODECS_DEPENDENCY=OFF -DAUDIO_CODECS_BUILD_LOCAL_SDL2=OFF -DUSE_SYSTEM_SDL2=ON -DSDL_MIXER_X_STATIC=OFF -DUSE_GME=ON -DUSE_MIDI=ON -DUSE_MIDI_FLUIDSYNTH=ON -DUSE_MIDI_FLUIDLITE=OFF -DUSE_MIDI_TIMIDITY=ON -DUSE_MIDI_OPNMIDI=OFF -DUSE_MIDI_ADLMIDI=OFF -DUSE_MIDI_EDMIDI=OFF -DUSE_MIDI_NATIVE=OFF -DUSE_SYSTEM_AUDIO_LIBRARIES=ON -DMIXERX_ENABLE_LGPL=ON -DMIXERX_ENABLE_GPL=ON -DUSE_FLAC=OFF -DUSE_MP3_MPG123=OFF -DGME_INCLUDE_DIR="$LIBGMEPREFIX/include/gme" -DGME_LIBRARY="$LIBGMEPREFIX/lib/libgme.dylib" -DCMAKE_PREFIX_PATH="$LIBSDL2MIXERPREFIX/lib/cmake/SDL2" -DSDL2_DIR="$LIBSDL2MIXERPREFIX/lib/cmake/SDL2" -DCMAKE_INSTALL_PREFIX="$SRB2BLDPREFIX/stow/libsdl2-mixerx" -DCMAKE_MACOSX_RPATH=OFF
                cmake --build "$SRB2BLDROOT/libraries/libsdl2-mixerx/build" -j"$NCPU" --config Release

                if [ -d "$SRB2BLDPREFIX/stow/libsdl2-mixerx" ]; then

                    sudo -E stow -Dv --adopt libsdl2-mixerx
                    sudo rm -rf "$SRB2BLDPREFIX/stow/libsdl2-mixerx"

                fi

                sudo -E cmake --install "$SRB2BLDROOT/libraries/libsdl2-mixerx/build"
                sudo -E stow -v --adopt libsdl2-mixerx

                git -C "$SRB2BLDROOT/libraries/libsdl2-mixerx" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libsdl2-mixerx" reset -q --hard

                COMREV=$(git -C "$SRB2BLDROOT/libraries/libsdl2-mixerx" rev-parse --short HEAD)
                $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libsdl2-mixerx/.comrev"

            fi

        fi

        # Download libopenal's source code, build and install it.
        if [ "$BUILD" = "$BUILDPATH/blankart" ]; then

            if [ ! -d "$SRB2BLDROOT/libraries/libopenal/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libopenal's source code. Please wait..."
                git clone $GITOPTS https://github.com/kcat/openal-soft.git --recursive --branch "$MACOSOPENALVER" "$SRB2BLDROOT/libraries/libopenal"

            else

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libopenal's source code. Please wait..."
                git -C "$SRB2BLDROOT/libraries/libopenal" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libopenal" reset -q --hard
                git -C "$SRB2BLDROOT/libraries/libopenal" checkout -q master

                if [ -n "$ISNET" ]; then

                    git -C "$SRB2BLDROOT/libraries/libopenal" pull --recurse-submodules --rebase --autostash

                fi

                git -C "$SRB2BLDROOT/libraries/libopenal" checkout -q "$MACOSOPENALVER"

            fi

            if ([ ! -f "$SRB2BLDPREFIX/lib/libopenal.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libopenal.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libopenal.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libopenal/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libopenal" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libopenal/.comrev" 2> /dev/null)" ]); then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libopenal. Please wait..."
                mkdir -p "$SRB2BLDROOT/libraries/libopenal/build"
                cmake -S "$SRB2BLDROOT/libraries/libopenal" -B "$SRB2BLDROOT/libraries/libopenal/build" -DCMAKE_OSX_DEPLOYMENT_TARGET="$MACOSVER" -DCMAKE_POLICY_VERSION_MINIMUM="$CMAKEPOLVER" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX="$SRB2BLDPREFIX/stow/libopenal" -DCMAKE_MACOSX_RPATH=OFF
                cmake --build "$SRB2BLDROOT/libraries/libopenal/build" -j"$NCPU" --config Release

                if [ -d "$SRB2BLDPREFIX/stow/libopenal" ]; then

                    sudo -E stow -Dv --adopt libopenal
                    sudo rm -rf "$SRB2BLDPREFIX/stow/libopenal"

                fi

                sudo -E cmake --install "$SRB2BLDROOT/libraries/libopenal/build"
                sudo -E stow -v --adopt libopenal

                git -C "$SRB2BLDROOT/libraries/libopenal" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libopenal" reset -q --hard

                COMREV=$(git -C "$SRB2BLDROOT/libraries/libopenal" rev-parse --short HEAD)
                $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libopenal/.comrev"

            fi

        fi

        # Download DiscordRPC's source code, build and install it.
        if [ "$ISDISCORDRPC" = "libdiscord-rpc" ] && ([ "$BUILD" = "$BUILDPATH/srb2-uncapped-plus" ] || [ "$BUILD" = "$BUILDPATH/srb2-netplus" ] || [ "$BUILD" = "$BUILDPATH/srb2-reveries" ] || [ "$BUILD" = "$BUILDPATH/srb2-tsourdt3rd" ] || [ "$BUILD" = "$BUILDPATH/srb2-vr" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-galaxy" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-hep" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-saturn" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-neptune" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-vr" ] || [ "$BUILD" = "$BUILDPATH/blankart" ] || [ "$(dirname $BUILD)" = "$BUILDPATH/srb2-custom" ]); then

            if [ ! -d "$SRB2BLDROOT/libraries/discord-rpc/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading DiscordRPC's source code. Please wait..."
                git clone $GITOPTS https://github.com/discord/discord-rpc.git --recursive --branch "$MACOSDISCORDRPCVER" "$SRB2BLDROOT/libraries/discord-rpc"

            else

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up DiscordRPC's source code. Please wait..."
                git -C "$SRB2BLDROOT/libraries/discord-rpc" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/discord-rpc" reset -q --hard
                git -C "$SRB2BLDROOT/libraries/discord-rpc" checkout -q master

                if [ -n "$ISNET" ]; then

                    git -C "$SRB2BLDROOT/libraries/discord-rpc" pull --recurse-submodules --rebase --autostash

                fi

                git -C "$SRB2BLDROOT/libraries/discord-rpc" checkout -q "$MACOSDISCORDRPCVER"

            fi

            if ([ ! -f "$SRB2BLDPREFIX/lib/libdiscord-rpc.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libdiscord-rpc.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libdiscord-rpc.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/discord-rpc/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/discord-rpc" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/discord-rpc/.comrev" 2> /dev/null)" ]); then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing DiscordRPC. Please wait..."
                mkdir -p "$SRB2BLDROOT/libraries/discord-rpc/build"
                cmake -S "$SRB2BLDROOT/libraries/discord-rpc" -B "$SRB2BLDROOT/libraries/discord-rpc/build" -DCMAKE_OSX_DEPLOYMENT_TARGET="$MACOSVER" -DCMAKE_POLICY_VERSION_MINIMUM="$CMAKEPOLVER" -DCMAKE_BUILD_TYPE=Release -DBUILD_EXAMPLES=OFF -DBUILD_SHARED_LIBS=ON -DCMAKE_INSTALL_PREFIX="$SRB2BLDPREFIX/stow/discord-rpc" -DCMAKE_MACOSX_RPATH=OFF
                cmake --build "$SRB2BLDROOT/libraries/discord-rpc/build" -j"$NCPU" --config Release

                if [ -d "$SRB2BLDPREFIX/stow/discord-rpc" ]; then

                    sudo -E stow -Dv --adopt discord-rpc
                    sudo rm -rf "$SRB2BLDPREFIX/stow/discord-rpc"

                fi

                sudo -E cmake --install "$SRB2BLDROOT/libraries/discord-rpc/build"
                sudo -E stow -v --adopt discord-rpc

                git -C "$SRB2BLDROOT/libraries/discord-rpc" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/discord-rpc" reset -q --hard

                COMREV=$(git -C "$SRB2BLDROOT/libraries/discord-rpc" rev-parse --short HEAD)
                $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/discord-rpc/.comrev"

            fi

        fi

        # Download libopenvr's source code, build and install it.
        if ([ "$BUILD" = "$BUILDPATH/srb2-vr" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-vr" ]); then

            if [ ! -d "$SRB2BLDROOT/libraries/libopenvr/.git" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libopenvr's source code. Please wait..."
                git clone $GITOPTS https://github.com/ValveSoftware/openvr.git --recursive --branch "v$MACOSOPENVRVER" "$SRB2BLDROOT/libraries/libopenvr"

            else

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libopenvr's source code. Please wait..."
                git -C "$SRB2BLDROOT/libraries/libopenvr" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libopenvr" reset -q --hard
                git -C "$SRB2BLDROOT/libraries/libopenvr" checkout -q master

                if [ -n "$ISNET" ]; then

                    git -C "$SRB2BLDROOT/libraries/libopenvr" pull --recurse-submodules --rebase --autostash

                fi

                git -C "$SRB2BLDROOT/libraries/libopenvr" checkout -q "v$MACOSOPENVRVER"

            fi

            if ([ ! -f "$SRB2BLDPREFIX/lib/libopenvr_api.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libopenvr_api.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libopenvr_api.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libopenvr/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libopenvr" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libopenvr/.comrev" 2> /dev/null)" ]); then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libopenvr. Please wait..."
                mkdir -p "$SRB2BLDROOT/libraries/libopenvr/build"
                cp -rf "$SRB2BLDROOT/libraries/libopenvr/src/vrcommon" "$SRB2BLDROOT/libraries/libopenvr/src/vrcore"
                cmake -S "$SRB2BLDROOT/libraries/libopenvr" -B "$SRB2BLDROOT/libraries/libopenvr/build" -DCMAKE_OSX_DEPLOYMENT_TARGET="$MACOSVER" -DCMAKE_POLICY_VERSION_MINIMUM="$CMAKEPOLVER" -DCMAKE_BUILD_TYPE=Release -DBUILD_UNIVERSAL=OFF -DBUILD_SHARED=ON -DCMAKE_INSTALL_PREFIX="$SRB2BLDPREFIX/stow/libopenvr" -DCMAKE_MACOSX_RPATH=OFF
                cmake --build "$SRB2BLDROOT/libraries/libopenvr/build" -j"$NCPU" --config Release

                if [ -d "$SRB2BLDPREFIX/stow/libopenvr" ]; then

                    sudo -E stow -Dv --adopt libopenvr
                    sudo rm -rf "$SRB2BLDPREFIX/stow/libopenvr"

                fi

                sudo -E cmake --install "$SRB2BLDROOT/libraries/libopenvr/build"
                sudo -E stow -v --adopt libopenvr

                git -C "$SRB2BLDROOT/libraries/libopenvr" clean -qdffx -e .comrev
                git -C "$SRB2BLDROOT/libraries/libopenvr" reset -q --hard

                COMREV=$(git -C "$SRB2BLDROOT/libraries/libopenvr" rev-parse --short HEAD)
                $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libopenvr/.comrev"

            fi

        fi

        # Download libminiupnpc's source code, build and install it.
        if [ ! -d "$SRB2BLDROOT/libraries/libminiupnpc/.git" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Downloading libminiupnpc's source code. Please wait..."
            git clone $GITOPTS https://github.com/miniupnp/miniupnp.git --recursive --branch "$MACOSMINIUPNPCVER" "$SRB2BLDROOT/libraries/libminiupnpc"

        else

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Updating and cleaning up libminiupnpc's source code. Please wait..."
            git -C "$SRB2BLDROOT/libraries/libminiupnpc" clean -qdffx -e .comrev
            git -C "$SRB2BLDROOT/libraries/libminiupnpc" reset -q --hard
            git -C "$SRB2BLDROOT/libraries/libminiupnpc" checkout -q master

            if [ -n "$ISNET" ]; then

                git -C "$SRB2BLDROOT/libraries/libminiupnpc" pull --recurse-submodules --rebase --autostash

            fi

            git -C "$SRB2BLDROOT/libraries/libminiupnpc" checkout -q "$MACOSMINIUPNPCVER"

        fi

        if ([ ! -f "$SRB2BLDPREFIX/lib/libminiupnpc.dylib" ] && [ ! -f "$HOMEBREWPREFIX/lib/libminiupnpc.dylib" ] && [ ! -f "$MACPORTPREFIX/lib/libminiupnpc.dylib" ]) || ([ -n "$(cat "$SRB2BLDROOT/libraries/libminiupnpc/.comrev" 2> /dev/null)" ] && [ "$(git -C "$SRB2BLDROOT/libraries/libminiupnpc" rev-parse --short HEAD)" != "$(cat "$SRB2BLDROOT/libraries/libminiupnpc/.comrev" 2> /dev/null)" ]); then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building and installing libminiupnpc. Please wait..."
            cmake -S "$SRB2BLDROOT/libraries/libminiupnpc/miniupnpc" -B "$SRB2BLDROOT/libraries/libminiupnpc/build" -DCMAKE_OSX_DEPLOYMENT_TARGET="$MACOSVER" -DCMAKE_POLICY_VERSION_MINIMUM="$CMAKEPOLVER" -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON -DCMAKE_INSTALL_PREFIX="$SRB2BLDPREFIX/stow/libminiupnpc" -DCMAKE_MACOSX_RPATH=OFF
            cmake --build "$SRB2BLDROOT/libraries/libminiupnpc/build" -j"$NCPU" --config Release

            if [ -d "$SRB2BLDPREFIX/stow/libminiupnpc" ]; then

                sudo -E stow -Dv --adopt libminiupnpc
                sudo rm -rf "$SRB2BLDPREFIX/stow/libminiupnpc"

            fi

            sudo -E cmake --install "$SRB2BLDROOT/libraries/libminiupnpc/build"
            sudo -E stow -v --adopt libminiupnpc

            git -C "$SRB2BLDROOT/libraries/libminiupnpc" clean -qdffx -e .comrev
            git -C "$SRB2BLDROOT/libraries/libminiupnpc" reset -q --hard

            COMREV=$(git -C "$SRB2BLDROOT/libraries/libminiupnpc" rev-parse --short HEAD)
            $PRINTF "%s\n" "$COMREV" > "$SRB2BLDROOT/libraries/libminiupnpc/.comrev"

        fi

    fi

    # Fixing permission conflicts between compiled libraries and installed from package manager.
    if [ "$(stat -f %u "$SRB2BLDPREFIX/stow" 2> /dev/null)" = "0" ]; then

        sudo chown -R "$USER" "$SRB2BLDPREFIX/stow"

    fi

    # Unset variable GITVERCONF, if git branch SRB2BLDGITVER is not specified.
    if [ "$GITVERCONF" = "$GITDEFVER" ] && [ -z "$SRB2BLDGITVER" ]; then

        unset GITVERCONF

    fi

    # Compile the build's source code.
    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $BUILDNAME. Please wait..."

    if [ "$BUILD" = "$BUILDPATH/wadcli" ] || [ "$BUILD" = "$BUILDPATH/kartmaker" ] || [ "$BUILD" = "$BUILDPATH/neptunefm" ] || [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ] || [ "$BUILD" = "$BUILDPATH/followermaker" ]; then

        # Unsetting MACOSX_DEPLOYMENT_TARGET due to compiling errors on kartmaker/followermaker for macOS 10.9.
        unset MACOSX_DEPLOYMENT_TARGET
        eval $BLDCMD $CONF

    else

        # Move CMakeLists.txt to be found by Cmake.
        if [ "$BUILD" = "$BUILDPATH/srb2-top-down" ]; then

            cp -f "$BUILD/assets/CMakeLists.txt" "$BUILD/assets/installer"

        fi

        eval $BLDCMD $CONF
        cmake --build "$BUILD/build" -j"$NCPU" --config Release

    fi

    if [ "$BUILD" != "$BUILDPATH/wadcli" ] && [ "$BUILD" != "$BUILDPATH/kartmaker" ] && [ "$BUILD" != "$BUILDPATH/neptunefm" ] && [ "$BUILD" != "$BUILDPATH/kartmaker-ring-racers" ] && [ "$BUILD" != "$BUILDPATH/followermaker" ] && [ "$BUILD" != "$BUILDPATH/slade" ] && [ "$BUILD" != "$BUILDPATH/ultimate-zone-builder" ] && [ "$BUILD" != "$BUILDPATH/ultimate-gksz-builder" ] && [ "$BUILD" != "$BUILDPATH/ultimate-lowee-builder" ] && [ "$BUILD" != "$BUILDPATH/high-voltage-ring" ] && [ "$BUILD" != "$BUILDPATH/aseprite" ]; then

        # Get app icon.
        mkdir -p "$BUILD/build/bin/$BUILDNAME.app/Contents/Resources"

        if [ "$BUILD" = "$BUILDPATH/srb2-2.2-classic" ]; then

            makeicns -in "$BUILD/src/win32/srb2classic.ico" -64 -out "$BUILD/build/bin/$BUILDNAME.app/Contents/Resources/Srb2mac.icns" 2> /dev/null

        else

            makeicns -in "$BUILD/src/win32/Srb2win.ico" -64 -out "$BUILD/build/bin/$BUILDNAME.app/Contents/Resources/Srb2mac.icns" 2> /dev/null

        fi

        if [ -f "$BUILD/build/bin/$BUILDNAME.app/Contents/Info.plist" ]; then

            gawk -i inplace -v RS= '{sub("<key>CFBundleIconFile</key>\n	<string></string>","<key>CFBundleIconFile</key>\n	<string>Srb2mac</string>"); print}' "$BUILD/build/bin/$BUILDNAME.app/Contents/Info.plist"

        fi

        # Create $SRB2BLDPREFIX/lib, if does not exist.
        if [ ! -d "$SRB2BLDPREFIX/lib" ]; then

            sudo mkdir -p "$SRB2BLDPREFIX/lib"

        fi

        # Fix paths of installed libraries.
        if [ -f "$(find /Library/Developer/CommandLineTools/usr/lib/clang -name libclang_rt.ubsan_osx_dynamic.dylib 2> /dev/null | head -n1)" ]; then

            sudo ln -sf /Library/Developer/CommandLineTools/usr/lib/clang/$(clang -v 2>&1 | gawk -F'Apple clang version|\\(| ' '/version/ {print $3}')/lib/darwin/libclang_rt.ubsan_osx_dynamic.dylib "$SRB2BLDPREFIX/lib/libclang_rt.ubsan_osx_dynamic.dylib"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libbrotlicommon.dylib" ]; then

            sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "$SRB2BLDPREFIX/lib/libbrotlicommon.dylib" "$SRB2BLDPREFIX/lib/libbrotlidec.dylib"
            sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "$SRB2BLDPREFIX/lib/libbrotlicommon.dylib" "$SRB2BLDPREFIX/lib/libbrotlienc.dylib"
            sudo install_name_tool -change "@rpath/libbrotlicommon.1.dylib" "$SRB2BLDPREFIX/lib/libbrotlicommon.dylib" "$SRB2BLDPREFIX/lib/libbrotlidec.dylib"
            sudo install_name_tool -change "@rpath/libbrotlicommon.1.dylib" "$SRB2BLDPREFIX/lib/libbrotlicommon.dylib" "$SRB2BLDPREFIX/lib/libbrotlienc.dylib"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libbrotlicommon.dylib" ]; then

            sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "$HOMEBREWPREFIX/lib/libbrotlicommon.dylib" "$HOMEBREWPREFIX/lib/libbrotlidec.dylib"
            sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "$HOMEBREWPREFIX/lib/libbrotlicommon.dylib" "$HOMEBREWPREFIX/lib/libbrotlienc.dylib"
            sudo install_name_tool -change "@rpath/libbrotlicommon.1.dylib" "$HOMEBREWPREFIX/lib/libbrotlicommon.dylib" "$HOMEBREWPREFIX/lib/libbrotlidec.dylib"
            sudo install_name_tool -change "@rpath/libbrotlicommon.1.dylib" "$HOMEBREWPREFIX/lib/libbrotlicommon.dylib" "$HOMEBREWPREFIX/lib/libbrotlienc.dylib"

        fi

        if [ -f "$MACPORTPREFIX/lib/libbrotlicommon.dylib" ]; then

            sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "$MACPORTPREFIX/lib/libbrotlicommon.dylib" "$MACPORTPREFIX/lib/libbrotlidec.dylib"
            sudo install_name_tool -change "@loader_path/libbrotlicommon.1.dylib" "$MACPORTPREFIX/lib/libbrotlicommon.dylib" "$MACPORTPREFIX/lib/libbrotlienc.dylib"
            sudo install_name_tool -change "@rpath/libbrotlicommon.1.dylib" "$MACPORTPREFIX/lib/libbrotlicommon.dylib" "$MACPORTPREFIX/lib/libbrotlidec.dylib"
            sudo install_name_tool -change "@rpath/libbrotlicommon.1.dylib" "$MACPORTPREFIX/lib/libbrotlicommon.dylib" "$MACPORTPREFIX/lib/libbrotlienc.dylib"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libfluidsynth.dylib" ]; then

            sudo install_name_tool -change "@rpath/libsndfile.1.dylib" "$SRB2BLDPREFIX/lib/libsndfile.dylib" "$SRB2BLDPREFIX/lib/libfluidsynth.dylib"
            sudo install_name_tool -change "libsndfile.1.dylib" "$SRB2BLDPREFIX/lib/libsndfile.dylib" "$SRB2BLDPREFIX/lib/libfluidsynth.dylib"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libfluidsynth.dylib" ]; then

            sudo install_name_tool -change "@rpath/libsndfile.1.dylib" "$HOMEBREWPREFIX/lib/libsndfile.dylib" "$HOMEBREWPREFIX/lib/libfluidsynth.dylib"
            sudo install_name_tool -change "libsndfile.1.dylib" "$HOMEBREWPREFIX/lib/libsndfile.dylib" "$HOMEBREWPREFIX/lib/libfluidsynth.dylib"

        fi

        if [ -f "$MACPORTPREFIX/lib/libfluidsynth.dylib" ]; then

            sudo install_name_tool -change "@rpath/libsndfile.1.dylib" "$MACPORTPREFIX/lib/libsndfile.dylib" "$MACPORTPREFIX/lib/libfluidsynth.dylib"
            sudo install_name_tool -change "libsndfile.1.dylib" "$MACPORTPREFIX/lib/libsndfile.dylib" "$MACPORTPREFIX/lib/libfluidsynth.dylib"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib" ]; then

            sudo install_name_tool -change "@rpath/libSDL2-2.0.dylib" "$SRB2BLDPREFIX/lib/libSDL2.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "libSDL2-2.0.dylib" "$SRB2BLDPREFIX/lib/libSDL2.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "@rpath/libmodplug.dylib" "$SRB2BLDPREFIX/lib/libmodplug.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "libmodplug.dylib" "$SRB2BLDPREFIX/lib/libmodplug.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "@rpath/libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer.dylib"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib" ]; then

            sudo install_name_tool -change "@rpath/libSDL2-2.0.dylib" "$HOMEBREWPREFIX/lib/libSDL2.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "libSDL2-2.0.dylib" "$HOMEBREWPREFIX/lib/libSDL2.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "@rpath/libmodplug.dylib" "$HOMEBREWPREFIX/lib/libmodplug.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "libmodplug.dylib" "$HOMEBREWPREFIX/lib/libmodplug.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "@rpath/libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer.dylib"

        fi

        if [ -f "$MACPORTPREFIX/lib/libSDL2_mixer.dylib" ]; then

            sudo install_name_tool -change "@rpath/libSDL2-2.0.dylib" "$MACPORTPREFIX/lib/libSDL2.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "libSDL2-2.0.dylib" "$MACPORTPREFIX/lib/libSDL2.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "@rpath/libmodplug.dylib" "$MACPORTPREFIX/lib/libmodplug.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "libmodplug.dylib" "$MACPORTPREFIX/lib/libmodplug.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "@rpath/libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer.dylib"
            sudo install_name_tool -change "libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer.dylib"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.dylib" ]; then

            sudo install_name_tool -change "@rpath/libgme.0.dylib" "$SRB2BLDPREFIX/lib/libgme.0.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.dylib"
            sudo install_name_tool -change "libgme.0.dylib" "$SRB2BLDPREFIX/lib/libgme.0.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.dylib"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libSDL2_mixer_ext.dylib" ]; then

            sudo install_name_tool -change "@rpath/libgme.0.dylib" "$HOMEBREWPREFIX/lib/libSDL2.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer_ext.dylib"
            sudo install_name_tool -change "libgme.0.dylib" "$HOMEBREWPREFIX/lib/libSDL2.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer_ext.dylib"

        fi

        if [ -f "$MACPORTPREFIX/lib/libSDL2_mixer_ext.dylib" ]; then

            sudo install_name_tool -change "@rpath/libgme.0.dylib" "$MACPORTPREFIX/lib/libSDL2.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer_ext.dylib"
            sudo install_name_tool -change "libgme.0.dylib" "$MACPORTPREFIX/lib/libSDL2.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer_ext.dylib"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libvorbis.dylib" ]; then

            sudo install_name_tool -change "@rpath/libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libvorbis.dylib"
            sudo install_name_tool -change "libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libvorbis.dylib"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libvorbis.dylib" ]; then

            sudo install_name_tool -change "@rpath/libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libvorbis.dylib"
            sudo install_name_tool -change "libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libvorbis.dylib"

        fi

        if [ -f "$MACPORTPREFIX/lib/libvorbis.dylib" ]; then

            sudo install_name_tool -change "@rpath/libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libvorbis.dylib"
            sudo install_name_tool -change "libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libvorbis.dylib"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libvorbisfile.dylib" ]; then

            sudo install_name_tool -change "@rpath/libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libvorbisfile.dylib"
            sudo install_name_tool -change "libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libvorbisfile.dylib"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libvorbisfile.dylib" ]; then

            sudo install_name_tool -change "@rpath/libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libvorbisfile.dylib"
            sudo install_name_tool -change "libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libvorbisfile.dylib"

        fi

        if [ -f "$MACPORTPREFIX/lib/libvorbisfile.dylib" ]; then

            sudo install_name_tool -change "@rpath/libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libvorbisfile.dylib"
            sudo install_name_tool -change "libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libvorbisfile.dylib"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libopenmpt.dylib" ]; then

            sudo install_name_tool -change "@rpath/libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libopenmpt.dylib"
            sudo install_name_tool -change "libogg.0.dylib" "$SRB2BLDPREFIX/lib/libogg.dylib" "$SRB2BLDPREFIX/lib/libopenmpt.dylib"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libopenmpt.dylib" ]; then

            sudo install_name_tool -change "@rpath/libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libopenmpt.dylib"
            sudo install_name_tool -change "libogg.0.dylib" "$HOMEBREWPREFIX/lib/libogg.dylib" "$HOMEBREWPREFIX/lib/libopenmpt.dylib"

        fi

        if [ -f "$MACPORTPREFIX/lib/libopenmpt.dylib" ]; then

            sudo install_name_tool -change "@rpath/libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libopenmpt.dylib"
            sudo install_name_tool -change "libogg.0.dylib" "$MACPORTPREFIX/lib/libogg.dylib" "$MACPORTPREFIX/lib/libopenmpt.dylib"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libgme.dylib" ]; then

            sudo install_name_tool -change "@rpath/libclang_rt.ubsan_osx_dynamic.dylib" "$SRB2BLDPREFIX/lib/libclang_rt.ubsan_osx_dynamic.dylib" "$SRB2BLDPREFIX/lib/libgme.dylib"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libgme.dylib" ]; then

            sudo install_name_tool -change "@rpath/libclang_rt.ubsan_osx_dynamic.dylib" "$SRB2BLDPREFIX/lib/libclang_rt.ubsan_osx_dynamic.dylib" "$HOMEBREWPREFIX/lib/libgme.dylib"

        fi

        if [ -f "$MACPORTPREFIX/lib/libgme.dylib" ]; then

            sudo install_name_tool -change "@rpath/libclang_rt.ubsan_osx_dynamic.dylib" "$SRB2BLDPREFIX/lib/libclang_rt.ubsan_osx_dynamic.dylib" "$MACPORTPREFIX/lib/libgme.dylib"

        fi

        # Fix linking of libraries to build's binary.
        if [ -f "$SRB2BLDPREFIX/lib/libSDL2.dylib" ]; then

            install_name_tool -change "@rpath/libSDL2-2.0.dylib" "$SRB2BLDPREFIX/lib/libSDL2.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libSDL2-2.0.dylib" "$SRB2BLDPREFIX/lib/libSDL2.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libSDL2.dylib" ]; then

            install_name_tool -change "@rpath/libSDL2-2.0.dylib" "$HOMEBREWPREFIX/lib/libSDL2.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libSDL2-2.0.dylib" "$HOMEBREWPREFIX/lib/libSDL2.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$MACPORTPREFIX/lib/libSDL2.dylib" ]; then

            install_name_tool -change "@rpath/libSDL2-2.0.dylib" "$MACPORTPREFIX/lib/libSDL2.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libSDL2-2.0.dylib" "$MACPORTPREFIX/lib/libSDL2.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libSDL3.dylib" ]; then

            install_name_tool -change "@rpath/libSDL3.0.dylib" "$SRB2BLDPREFIX/lib/libSDL3.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libSDL3.0.dylib" "$SRB2BLDPREFIX/lib/libSDL3.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libSDL3.dylib" ]; then

            install_name_tool -change "@rpath/libSDL3.0.dylib" "$HOMEBREWPREFIX/lib/libSDL3.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libSDL3.0.dylib" "$HOMEBREWPREFIX/lib/libSDL3.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$MACPORTPREFIX/lib/libSDL3.dylib" ]; then

            install_name_tool -change "@rpath/libSDL3.0.dylib" "$MACPORTPREFIX/lib/libSDL3.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libSDL3.0.dylib" "$MACPORTPREFIX/lib/libSDL3.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libmodplug.dylib" ]; then

            install_name_tool -change "@rpath/libmodplug.dylib" "$SRB2BLDPREFIX/lib/libmodplug.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libmodplug.dylib" "$SRB2BLDPREFIX/lib/libmodplug.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libmodplug.dylib" ]; then

            install_name_tool -change "@rpath/libmodplug.dylib" "$HOMEBREWPREFIX/lib/libmodplug.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libmodplug.dylib" "$HOMEBREWPREFIX/lib/libmodplug.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$MACPORTPREFIX/lib/libmodplug.dylib" ]; then

            install_name_tool -change "@rpath/libmodplug.dylib" "$MACPORTPREFIX/lib/libmodplug.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libmodplug.dylib" "$MACPORTPREFIX/lib/libmodplug.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libopenmpt.dylib" ]; then

            install_name_tool -change "bin/libopenmpt.dylib" "$SRB2BLDPREFIX/lib/libopenmpt.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libopenmpt.dylib" "$SRB2BLDPREFIX/lib/libopenmpt.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libopenmpt.dylib" ]; then

            install_name_tool -change "bin/libopenmpt.dylib" "$HOMEBREWPREFIX/lib/libopenmpt.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libopenmpt.dylib" "$HOMEBREWPREFIX/lib/libopenmpt.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$MACPORTPREFIX/lib/libopenmpt.dylib" ]; then

            install_name_tool -change "bin/libopenmpt.dylib" "$MACPORTPREFIX/lib/libopenmpt.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libopenmpt.dylib" "$MACPORTPREFIX/lib/libopenmpt.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libgme.dylib" ]; then

            install_name_tool -change "@rpath/libgme.0.dylib" "$SRB2BLDPREFIX/lib/libgme.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libgme.0.dylib" "$SRB2BLDPREFIX/lib/libgme.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libgme.dylib" ]; then

            install_name_tool -change "@rpath/libgme.0.dylib" "$HOMEBREWPREFIX/lib/libgme.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libgme.0.dylib" "$HOMEBREWPREFIX/lib/libgme.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$MACPORTPREFIX/lib/libgme.dylib" ]; then

            install_name_tool -change "@rpath/libgme.0.dylib" "$MACPORTPREFIX/lib/libgme.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libgme.0.dylib" "$MACPORTPREFIX/lib/libgme.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libsndfile.dylib" ]; then

            install_name_tool -change "@rpath/libsndfile.1.dylib" "$SRB2BLDPREFIX/lib/libsndfile.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libsndfile.1.dylib" "$SRB2BLDPREFIX/lib/libsndfile.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libsndfile.dylib" ]; then

            install_name_tool -change "@rpath/libsndfile.1.dylib" "$HOMEBREWPREFIX/lib/libsndfile.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libsndfile.1.dylib" "$HOMEBREWPREFIX/lib/libsndfile.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$MACPORTPREFIX/lib/libsndfile.dylib" ]; then

            install_name_tool -change "@rpath/libsndfile.1.dylib" "$MACPORTPREFIX/lib/libsndfile.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libsndfile.1.dylib" "$MACPORTPREFIX/lib/libsndfile.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libpng.dylib" ]; then

            install_name_tool -change "@rpath/libpng16.16.dylib" "$SRB2BLDPREFIX/lib/libpng.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libpng16.16.dylib" "$SRB2BLDPREFIX/lib/libpng.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libpng.dylib" ]; then

            install_name_tool -change "@rpath/libpng16.16.dylib" "$HOMEBREWPREFIX/lib/libpng.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libpng16.16.dylib" "$HOMEBREWPREFIX/lib/libpng.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$MACPORTPREFIX/lib/libpng.dylib" ]; then

            install_name_tool -change "@rpath/libpng16.16.dylib" "$MACPORTPREFIX/lib/libpng.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libpng16.16.dylib" "$MACPORTPREFIX/lib/libpng.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.dylib" ]; then

            install_name_tool -change "@rpath/libSDL2_mixer_ext.2.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libSDL2_mixer_ext.2.dylib" "$SRB2BLDPREFIX/lib/libSDL2_mixer_ext.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libSDL2_mixer_ext.dylib" ]; then

            install_name_tool -change "@rpath/libSDL2_mixer_ext.2.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer_ext.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libSDL2_mixer_ext.2.dylib" "$HOMEBREWPREFIX/lib/libSDL2_mixer_ext.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$MACPORTPREFIX/lib/libSDL2_mixer_ext.dylib" ]; then

            install_name_tool -change "@rpath/libSDL2_mixer_ext.2.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer_ext.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libSDL2_mixer_ext.2.dylib" "$MACPORTPREFIX/lib/libSDL2_mixer_ext.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libopenal.dylib" ]; then

            install_name_tool -change "@rpath/libopenal.1.dylib" "$SRB2BLDPREFIX/lib/libopenal.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libopenal.1.dylib" "$SRB2BLDPREFIX/lib/libopenal.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libopenal.dylib" ]; then

            install_name_tool -change "@rpath/libopenal.1.dylib" "$HOMEBREWPREFIX/lib/libopenal.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libopenal.1.dylib" "$HOMEBREWPREFIX/lib/libopenal.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$MACPORTPREFIX/lib/libopenal.dylib" ]; then

            install_name_tool -change "@rpath/libopenal.1.dylib" "$MACPORTPREFIX/lib/libopenal.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libopenal.1.dylib" "$MACPORTPREFIX/lib/libopenal.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libdiscord-rpc.dylib" ]; then

            install_name_tool -change "@rpath/libdiscord-rpc.dylib" "$SRB2BLDPREFIX/lib/libdiscord-rpc.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libdiscord-rpc.dylib" "$SRB2BLDPREFIX/lib/libdiscord-rpc.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libdiscord-rpc.dylib" ]; then

            install_name_tool -change "@rpath/libdiscord-rpc.dylib" "$HOMEBREWPREFIX/lib/libdiscord-rpc.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libdiscord-rpc.dylib" "$HOMEBREWPREFIX/lib/libdiscord-rpc.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$MACPORTPREFIX/lib/libdiscord-rpc.dylib" ]; then

            install_name_tool -change "@rpath/libdiscord-rpc.dylib" "$MACPORTPREFIX/lib/libdiscord-rpc.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libdiscord-rpc.dylib" "$MACPORTPREFIX/lib/libdiscord-rpc.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libopenvr_api.dylib" ]; then

            install_name_tool -change "@rpath/libopenvr_api.dylib" "$SRB2BLDPREFIX/lib/libopenvr_api.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libopenvr_api.dylib" "$SRB2BLDPREFIX/lib/libopenvr_api.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libopenvr_api.dylib" ]; then

            install_name_tool -change "@rpath/libopenvr_api.dylib" "$HOMEBREWPREFIX/lib/libopenvr_api.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libopenvr_api.dylib" "$HOMEBREWPREFIX/lib/libopenvr_api.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$MACPORTPREFIX/lib/libopenvr_api.dylib" ]; then

            install_name_tool -change "@rpath/libopenvr_api.dylib" "$MACPORTPREFIX/lib/libopenvr_api.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"
            install_name_tool -change "libopenvr_api.dylib" "$MACPORTPREFIX/lib/libopenvr_api.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$SRB2BLDPREFIX/lib/libminiupnpc.dylib" ] && [ -n "$(otool -L "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME" | gawk '/libminiupnpc.*.dylib/ {print $1}')" ]; then

            install_name_tool -change $(otool -L "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME" | gawk '/libminiupnpc.*.dylib/ {print $1}') "$SRB2BLDPREFIX/lib/libminiupnpc.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$HOMEBREWPREFIX/lib/libminiupnpc.dylib" ] && [ -n "$(otool -L "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME" | gawk '/libminiupnpc.*.dylib/ {print $1}')" ]; then

            install_name_tool -change $(otool -L "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME" | gawk '/libminiupnpc.*.dylib/ {print $1}') "$HOMEBREWPREFIX/lib/libminiupnpc.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

        if [ -f "$MACPORTPREFIX/lib/libminiupnpc.dylib" ] && [ -n "$(otool -L "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME" | gawk '/libminiupnpc.*.dylib/ {print $1}')" ]; then

            install_name_tool -change $(otool -L "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME" | gawk '/libminiupnpc.*.dylib/ {print $1}') "$MACPORTPREFIX/lib/libminiupnpc.dylib" "$BUILD/build/bin/$BUILDNAME.app/Contents/MacOS/$BUILDNAME"

        fi

    fi

    # Building App Bundle.
    if [ "$APPBUNDLE" = "1" ]; then

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Building $BUILDNAME's App Bundle. Please wait..."

        if [ "$BUILD" = "$BUILDPATH/srb2-thokker" ]; then

            cmake --install "$BUILD/build" --prefix "$BUILD/build/package"
            mkdir -p "$BUILD/build/package/Sonic Robo Blast 2 Thokker.app/Contents/Frameworks"
            cp -Lrf $(otool -L "$BUILD/build/package/Sonic Robo Blast 2 Thokker.app/Contents/MacOS/Sonic Robo Blast 2 Thokker" | gawk '/'$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk '{gsub("/","\\/"); print}')'/ && /.dylib/ {print $1}') "$BUILD/build/package/Sonic Robo Blast 2 Thokker.app/Contents/Frameworks"
            cp -Lrf $(otool -L $(otool -L "$BUILD/build/package/Sonic Robo Blast 2 Thokker.app/Contents/MacOS/Sonic Robo Blast 2 Thokker" | gawk '/'$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk '{gsub("/","\\/"); print}')'/ && /.dylib/ {print $1}') | gawk '/'$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk '{gsub("/","\\/"); print}')'/ && /.dylib/ && !/:/ {print $1}' | sort -u) "$BUILD/build/package/Sonic Robo Blast 2 Thokker.app/Contents/Frameworks"

            cat << THOKKER | tee "$BUILD/build/package/srb2thk" > /dev/null
#!/bin/sh

export DYLD_LIBRARY_PATH="/Applications/Sonic Robo Blast 2 Thokker.app/Contents/Frameworks"
export SRB2WADDIR="/Applications/Sonic Robo Blast 2 Thokker.app/Contents/Resources"

"/Applications/Sonic Robo Blast 2 Thokker.app/Contents/MacOS/Sonic Robo Blast 2 Thokker"

THOKKER

            cat << README | tee "$BUILD/build/package/README" > /dev/null
Put files to "Applications" folder and run SRB2 Thokker with srb2thk script.

README

            chmod 755 "$BUILD/build/package/srb2thk"
            mkdir -p "$BUILD/build/package"
            cd "$BUILD/build/package" || exit
            ln -sf /Applications Application
            cp -f "$BUILD/LICENSE" "$BUILD/build/package"
            cd "$BUILD" || exit
            hdiutil create -volname "$BUILDNAME" -srcfolder "$BUILD/build/package" "$BUILD/build/package/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')-$GITVER-$COMREV.dmg"

        elif [ "$BUILD" = "$BUILDPATH/wadcli" ]; then

            mkdir -p "$BUILD/build"
            cd "$BUILD/build" || exit
            ln -sf /Applications Application
            cp -f "$BUILD/LICENSE" "$BUILD/wadcli" "$BUILD/build"
            cd "$BUILD" || exit
            hdiutil create -volname "$BUILDNAME" -srcfolder "$BUILD/build" "$BUILD/build/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')-$GITVER-$COMREV.dmg"

        elif [ "$BUILD" = "$BUILDPATH/kartmaker" ] || [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ]; then

            mkdir -p "$BUILD/build"
            cd "$BUILD/build" || exit
            ln -sf /Applications Application
            cp -f "$BUILD/LICENSE"* "$BUILD/build"
            cd "$BUILD" || exit
            hdiutil create -volname "$BUILDNAME" -srcfolder "$BUILD/build" "$BUILD/build/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')-$GITVER-$COMREV.dmg"

        elif [ "$BUILD" = "$BUILDPATH/neptunefm" ]; then

            mkdir -p "$BUILD/build"
            cd "$BUILD/build" || exit
            ln -sf /Applications Application
            cp -f "$BUILD/LICENSE.txt" "$BUILD/NeptuneFM" "$BUILD/build"
            cd "$BUILD" || exit
            hdiutil create -volname "$BUILDNAME" -srcfolder "$BUILD/build" "$BUILD/build/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')-$GITVER-$COMREV.dmg"

        elif [ "$BUILD" = "$BUILDPATH/followermaker" ]; then

            mkdir -p "$BUILD/build"
            cd "$BUILD/build" || exit
            ln -sf /Applications Application
            cp -f "$BUILD/LICENSE.txt" "$BUILD/followermaker" "$BUILD/build"
            cd "$BUILD" || exit
            hdiutil create -volname "$BUILDNAME" -srcfolder "$BUILD/build" "$BUILD/build/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')-$GITVER-$COMREV.dmg"

        elif [ "$BUILD" = "$BUILDPATH/slade" ]; then

            mkdir -p "$BUILD/build/appbundle-build" "$BUILD/build/slade.app/Contents/Frameworks"
            cp -rf "$BUILD/build/slade.app" "$BUILD/build/appbundle-build/$BUILDNAME.app"
            cd "$BUILD/build/appbundle-build" || exit
            ln -sf /Applications Application
            cp -f "$BUILD/LICENSE" "$BUILD/build/appbundle-build"
            cd "$BUILD/build" || exit
            hdiutil create -volname "$BUILDNAME" -srcfolder "$BUILD/build/appbundle-build" "$BUILD/build/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')-$GITVER-$COMREV.dmg"

        elif [ "$BUILD" = "$BUILDPATH/aseprite" ]; then

            ASEPRITEDMGURL="https://www.aseprite.org/$(curl -sL https://aseprite.org/trial | gawk -F'href="|"' '/\.dmg/ {print $4}')"
            if [ -n "$ISNET" ] && [ "$(curl -X GET -sLI "$ASEPRITEDMGURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/Aseprite-trial-macOS.dmg" 2> /dev/null)" ]; then

                rm -f "$SRB2BLDROOT/assets/Aseprite-trial-macOS.dmg"
                curl -RL "$ASEPRITEDMGURL" -o "$SRB2BLDROOT/assets/Aseprite-trial-macOS.dmg"

            fi

            mkdir -p "$BUILD/build/appbundle-build" "$BUILD/build/appbundle-mount"
            yes y | PAGER=cat hdiutil attach -quiet -nobrowse -noverify -noautoopen -mountpoint "$BUILD/build/appbundle-mount" "$SRB2BLDROOT/assets/Aseprite-trial-macOS.dmg" > /dev/null
            cp -rf "$BUILD/build/appbundle-mount/Aseprite.app" "$BUILD/build/appbundle-build"
            hdiutil detach -quiet "$BUILD/build/appbundle-mount"
            cd "$BUILD/build/appbundle-build" || exit
            ln -sf /Applications Application
            cp -f "$BUILD/EULA.txt" "$BUILD/build/appbundle-build"
            cp -f "$BUILD/build/bin/aseprite" "$BUILD/build/appbundle-build/Aseprite.app/Contents/MacOS"
            rm -rf "$BUILD/build/appbundle-build/Aseprite.app/Contents/Resources/data"
            cp -rf "$BUILD/build/bin/data" "$BUILD/build/appbundle-build/Aseprite.app/Contents/Resources"
            git clone $GITOPTS https://github.com/DragonDePlatino/Kart-Builder.git "$BUILD/build/appbundle-build/Aseprite.app/Contents/Resources/data/extensions/kart-builder"
            cd "$BUILD/build" || exit
            hdiutil create -volname "$BUILDNAME" -srcfolder "$BUILD/build/appbundle-build" "$BUILD/build/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')-$GITVER-$COMREV.dmg"

        else

            cmake --build "$BUILD/build" -t package -j"$NCPU"

        fi

    # Installing build's binary, assets, libraries, icons and desktop file to the system.
    else

        SRB2MACPATH="$SRB2BLDPREFIX/$BUILDNAME.app"

        removeduplicate

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's binary, assets, libraries, icons and desktop file to the system. Please wait..."

        if [ ! -d "$SRB2BLDPREFIX" ]; then

            sudo mkdir -p "$SRB2BLDPREFIX"

        fi

        if [ "$BUILD" = "$BUILDPATH/wadcli" ]; then

            sudo mv -fv "$BUILD/wadcli" "$SRB2BLDPREFIX"

        elif [ "$BUILD" = "$BUILDPATH/kartmaker" ]; then

            sudo mv -fv "$BUILD/build/kartmaker" "$SRB2BLDPREFIX"

        elif [ "$BUILD" = "$BUILDPATH/neptunefm" ]; then

            sudo mv -fv "$BUILD/NeptuneFM" "$SRB2BLDPREFIX/neptunefm"

        elif [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ]; then

            sudo mv -fv "$BUILD/kartmaker" "$SRB2BLDPREFIX/kartmaker_rr"

        elif [ "$BUILD" = "$BUILDPATH/followermaker" ]; then

            sudo mv -fv "$BUILD/followermaker" "$SRB2BLDPREFIX"

        elif [ "$BUILD" = "$BUILDPATH/slade" ]; then

            sudo rm -rf "$SRB2BLDPREFIX/$BUILDNAME.app"
            sudo mv -fv "$BUILD/build/slade.app" "$SRB2BLDPREFIX/$BUILDNAME.app"

        elif [ "$BUILD" = "$BUILDPATH/aseprite" ]; then

            ASEPRITEDMGURL="https://www.aseprite.org/$(curl -sL https://aseprite.org/trial | gawk -F'href="|"' '/\.dmg/ {print $4}')"
            if [ -n "$ISNET" ] && [ "$(curl -X GET -sLI "$ASEPRITEDMGURL" | gawk -F'Content-Length: ' '{IGNORECASE=1} /Content-Length/ {gsub("\r",""); print $NF}' 2> /dev/null | tail -n1)" != "$(stat -f %z "$SRB2BLDROOT/assets/Aseprite-trial-macOS.dmg" 2> /dev/null)" ]; then

                rm -f "$SRB2BLDROOT/assets/Aseprite-trial-macOS.dmg"
                curl -RL "$ASEPRITEDMGURL" -o "$SRB2BLDROOT/assets/Aseprite-trial-macOS.dmg"

            fi

            mkdir -p "$BUILD/build/install-build" "$BUILD/build/appbundle-mount"
            yes y | PAGER=cat hdiutil attach -quiet -nobrowse -noverify -noautoopen -mountpoint "$BUILD/build/appbundle-mount" "$SRB2BLDROOT/assets/Aseprite-trial-macOS.dmg" > /dev/null
            cp -rf "$BUILD/build/appbundle-mount/Aseprite.app" "$BUILD/build/install-build"
            hdiutil detach -quiet "$BUILD/build/appbundle-mount"
            cp -f "$BUILD/build/bin/aseprite" "$BUILD/build/install-build/Aseprite.app/Contents/MacOS"
            rm -rf "$BUILD/build/install-build/Aseprite.app/Contents/Resources/data"
            cp -rf "$BUILD/build/bin/data" "$BUILD/build/install-build/Aseprite.app/Contents/Resources"
            git clone $GITOPTS https://github.com/DragonDePlatino/Kart-Builder.git "$BUILD/build/install-build/Aseprite.app/Contents/Resources/data/extensions/kart-builder"
            sudo rm -rf "$SRB2BLDPREFIX/$BUILDNAME.app"
            sudo mv -fv "$BUILD/build/install-build/Aseprite.app" "$SRB2BLDPREFIX/$BUILDNAME.app"

        else

            sudo -E cmake --install "$BUILD/build"

            if [ "$BUILD" = "$BUILDPATH/srb2-thokker" ]; then

                sudo mkdir -p "$SRB2BLDPREFIX/Sonic Robo Blast 2 Thokker.app/Contents/Frameworks"

                sudo cp -Lrf $(otool -L "$SRB2BLDPREFIX/Sonic Robo Blast 2 Thokker.app/Contents/MacOS/Sonic Robo Blast 2 Thokker" | gawk '/'$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk '{gsub("/","\\/"); print}')'/ && /.dylib/ {print $1}') "$SRB2BLDPREFIX/Sonic Robo Blast 2 Thokker.app/Contents/Frameworks"

                sudo cp -Lrf $(otool -L $(otool -L "$SRB2BLDPREFIX/Sonic Robo Blast 2 Thokker.app/Contents/MacOS/Sonic Robo Blast 2 Thokker" | gawk '/'$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk '{gsub("/","\\/"); print}')'/ && /.dylib/ {print $1}') | gawk '/'$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk '{gsub("/","\\/"); print}')'/ && /.dylib/ && !/:/ {print $1}' | sort -u) "$SRB2BLDPREFIX/Sonic Robo Blast 2 Thokker.app/Contents/Frameworks"

                cat << THOKKER | sudo tee "$SRB2BLDPREFIX/srb2thk" > /dev/null
#!/bin/sh

export DYLD_LIBRARY_PATH="$SRB2BLDPREFIX/Sonic Robo Blast 2 Thokker.app/Contents/Frameworks"
export SRB2WADDIR="$SRB2BLDPREFIX/Sonic Robo Blast 2 Thokker.app/Contents/Resources"

"$SRB2BLDPREFIX/Sonic Robo Blast 2 Thokker.app/Contents/MacOS/Sonic Robo Blast 2 Thokker"

THOKKER

                sudo chmod 755 "$SRB2BLDPREFIX/srb2thk"

            fi

        fi

        # Saving configuration flags for future upgrades.
        $PRINTF "%s\n" "$CONF" > "$BUILD/conf"

        if [ -n "$(cat "$BUILD/conf")" ]; then

            CONF=$(cat "$BUILD/conf")

        fi

        # Adding path to commit revision file.
        COMREVFILEPATH="$BUILD/.comrev"

        # Making symbolic link to .app file in /Applications.
        if [ "$BUILD" = "$BUILDPATH/srb2-thokker" ]; then

            SRB2MACBIN="$SRB2BLDPREFIX/srb2thk"
            SRB2MACLINK="/Applications/$BUILDNAME.app"

        elif [ "$BUILD" = "$BUILDPATH/wadcli" ]; then

            SRB2MACPATH="$SRB2BLDPREFIX/wadcli"
            SRB2MACLINK="/usr/local/bin/wadcli"

        elif [ "$BUILD" = "$BUILDPATH/kartmaker" ]; then

            SRB2MACPATH="$SRB2BLDPREFIX/kartmaker"
            SRB2MACLINK="/usr/local/bin/kartmaker"

        elif [ "$BUILD" = "$BUILDPATH/neptunefm" ]; then

            SRB2MACPATH="$SRB2BLDPREFIX/neptunefm"
            SRB2MACLINK="/usr/local/bin/neptunefm"

        elif [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ]; then

            SRB2MACPATH="$SRB2BLDPREFIX/kartmaker_rr"
            SRB2MACLINK="/usr/local/bin/kartmaker_rr"

        elif [ "$BUILD" = "$BUILDPATH/followermaker" ]; then

            SRB2MACPATH="$SRB2BLDPREFIX/followermaker"
            SRB2MACLINK="/usr/local/bin/followermaker"

        else

            SRB2MACLINK="/Applications/$BUILDNAME.app"

        fi

        sudo rm -f "$SRB2MACLINK"

        if [ "$BUILD" = "$BUILDPATH/srb2-thokker" ]; then

            sudo ln -sf "$SRB2MACBIN" "$SRB2MACLINK"

        else

            sudo ln -sf "$SRB2MACPATH" "$SRB2MACLINK"

        fi

    fi
}

installtowindows() {
    # Saving configuration flags to variable.
    if [ -n "$(cat "$BUILD/conf")" ]; then

        CONF=$(cat "$BUILD/conf")

    fi

    # Adding path to commit revision file.
    COMREVFILEPATH="$BUILD/.comrev"

    # Installing build's binary, assets, libraries, icons and desktop files to the system.
    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Installing $BUILDNAME's binary, assets, libraries, icons and desktop files to the system. Please wait..."

    if [ "$BUILD" = "$BUILDPATH/srb2" ]; then

        SRB2WINDIR="SRB2"
        SRB2WINMENUDIR="Sonic Robo Blast 2"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.2-classic" ]; then

        SRB2WINDIR="SRB2 v2.2 Classic"
        SRB2WINMENUDIR="Sonic Robo Blast 2 v2.2 Classic"
        SRB2WINBIN=$(find "$BUILD/build/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/build/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.2-beta6" ]; then

        SRB2WINDIR="SRB2 v2.2 Beta 6"
        SRB2WINMENUDIR="Sonic Robo Blast 2 v2.2 Beta 6"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-uncapped-plus" ]; then

        SRB2WINDIR="SRB2 Uncapped Plus"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Uncapped PLUS"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-netplus" ]; then

        SRB2WINDIR="SRB2 NetPlus"
        SRB2WINMENUDIR="Sonic Robo Blast 2 NetPlus"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-reveries" ]; then

        SRB2WINDIR="SRB2 Reveries"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Reveries"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-tsourdt3rd" ]; then

        SRB2WINDIR="SRB2 TSoURDt3rd"
        SRB2WINMENUDIR="Sonic Robo Blast 2 TSoURDt3rd"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-edit" ]; then

        SRB2WINDIR="SRB2 Edit"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Edit"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-ggj" ]; then

        SRB2WINDIR="SRB2 GGJ"
        SRB2WINMENUDIR="Sonic Robo Blast 2 The Great Galactic Journey"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-destructive-illusion" ]; then

        SRB2WINDIR="SRB2 Destructive Illusion"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Destructive Illusion"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-vr" ]; then

        SRB2WINDIR="SRB2 VR"
        SRB2WINMENUDIR="Sonic Robo Blast 2 VR"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -openvr -win" > "$SRB2WINPATH/$SRB2WINDIR (OpenVR).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.1-legacy" ]; then

        SRB2WINDIR="SRB2 v2.1 Legacy"
        SRB2WINMENUDIR="Sonic Robo Blast 2 v2.1 Legacy"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-fusion-advance" ]; then

        SRB2WINDIR="SRB2 Fusion Advance"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Fusion Advance"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-thokker" ]; then

        SRB2WINDIR="SRB2 Thokker"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Thokker"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-top-down" ]; then

        SRB2WINDIR="SRB2 Top Down"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Top Down"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/sonic-smash-brawl" ]; then

        SRB2WINDIR="Sonic Smash Brawl"
        SRB2WINMENUDIR="Sonic Smash Brawl"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-2.0" ]; then

        SRB2WINDIR="SRB2 v2.0"
        SRB2WINMENUDIR="Sonic Robo Blast 2 v2.0"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        touch "$SRB2WINPATH/md2.dat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-cb" ]; then

        SRB2WINDIR="SRB2 Community Build"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Community Build"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        touch "$SRB2WINPATH/md2.dat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/xsrb2" ]; then

        SRB2WINDIR="XSRB2"
        SRB2WINMENUDIR="X Sonic Robo Blast 2"
        SRB2WINBIN=$(find "$BUILD/SRB2/branches/XMOD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/SRB2/branches/XMOD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        touch "$SRB2WINPATH/md2.dat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-sf94-serv" ]; then

        SRB2WINDIR="SRB2 SF94-Serv"
        SRB2WINMENUDIR="Sonic Robo Blast 2 SF94-Serv"
        SRB2WINBIN=$(find "$BUILD/SRB2/branches/SF94/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/SRB2/branches/SF94/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        touch "$SRB2WINPATH/md2.dat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-riders" ]; then

        SRB2WINDIR="SRB2 Riders"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Riders"
        SRB2WINBIN=$(find "$BUILD/SRB2/branches/RIDER/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/SRB2/branches/RIDER/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        touch "$SRB2WINPATH/md2.dat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/super-srb2-kart-z" ]; then

        SRB2WINDIR="Super SRB2 Kart Z"
        SRB2WINMENUDIR="Super Sonic Robo Blast 2 Kart Z"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        touch "$SRB2WINPATH/md2.dat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/sbb2" ]; then

        SRB2WINDIR="SBB2"
        SRB2WINMENUDIR="Super Bomberman Blast 2"
        SRB2WINBIN=$(find "$BUILD/SRB2/branches/FLAME/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/SRB2/branches/FLAME/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        touch "$SRB2WINPATH/md2.dat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-final-demo" ]; then

        SRB2WINDIR="SRB2 Final Demo"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Final Demo"
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-1095" ]; then

        SRB2WINDIR="SRB2 1095"
        SRB2WINMENUDIR="Sonic Robo Blast 2 1095"
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-jte" ]; then

        SRB2WINDIR="SRB2 JTE"
        SRB2WINMENUDIR="Sonic Robo Blast 2 JTE"
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/shufflarb2" ]; then

        SRB2WINDIR="ShufflarB2"
        SRB2WINMENUDIR="ShufflarB2"
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINBIN=$(find "$BUILD/SRB21094/branches/JTESHUFFLE/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/SRB21094/branches/JTESHUFFLE/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-live" ]; then

        SRB2WINDIR="SRB2 Live"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Live"
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINBIN=$(find "$BUILD/SRB21094/branches/LIVE/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/SRB21094/branches/LIVE/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-loz" ]; then

        SRB2WINDIR="SRB2 LoZ"
        SRB2WINMENUDIR="Sonic Robo Blast 2 LoZ"
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINBIN=$(find "$BUILD/SRB21094/branches/LOZ/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/SRB21094/branches/LOZ/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/ssbss" ]; then

        SRB2WINDIR="SSBSS"
        SRB2WINMENUDIR="Super Smash Bros Sonic Showdown"
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINBIN=$(find "$BUILD/SRB21094/branches/FLAME/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/SRB21094/branches/FLAME/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/newmillennium" ]; then

        SRB2WINDIR="NewMillennium"
        SRB2WINMENUDIR="NewMillennium"
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINBIN="NewMillennium"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f "$BUILD/build/$SRB2WINBIN.exe" "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        cp -f "$BUILD/Code/WIN32/Srb2win.ico" "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-persona" ]; then

        SRB2WINDIR="SRB2 Persona"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Persona"
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart" ]; then

        SRB2WINDIR="SRB2 Kart"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Kart"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-galaxy" ]; then

        SRB2WINDIR="SRB2 Kart Galaxy"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Kart Galaxy"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-hep" ]; then

        SRB2WINDIR="SRB2 Kart HEP"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Kart HEP"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-saturn" ]; then

        SRB2WINDIR="SRB2 Kart Saturn"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Kart Saturn"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-neptune" ]; then

        SRB2WINDIR="SRB2 Kart Neptune"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Kart Neptune"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/srb2-kart-vr" ]; then

        SRB2WINDIR="SRB2 Kart VR"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Kart VR"
        SRB2WINBIN=$(find "$BUILD/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -openvr -win" > "$SRB2WINPATH/$SRB2WINDIR (OpenVR).bat"

    elif [ "$BUILD" = "$BUILDPATH/blankart" ]; then

        SRB2WINDIR="BlanKart"
        SRB2WINMENUDIR="BlanKart"
        SRB2WINBIN=$(find "$BUILD/build/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/build/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/ring-racers" ]; then

        SRB2WINDIR="Ring Racers"
        SRB2WINMENUDIR="Dr. Robotnik's Ring Racers"
        SRB2WINBIN=$(find "$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software -noexchndl" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl -noexchndl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/ring-racers-noire" ]; then

        SRB2WINDIR="Ring Racers Noire"
        SRB2WINMENUDIR="Dr. Robotnik's Ring Racers Noire"
        SRB2WINBIN=$(find "$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software -noexchndl" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl -noexchndl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/ring-racers-hep" ]; then

        SRB2WINDIR="Ring Racers HEP"
        SRB2WINMENUDIR="Dr. Robotnik's Ring Racers HEP"
        SRB2WINBIN=$(find "$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software -noexchndl" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl -noexchndl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/ring-racers-freaky-build" ]; then

        SRB2WINDIR="Ring Racers Freaky Build"
        SRB2WINMENUDIR="Dr. Robotnik's Ring Racers Freaky Build"
        SRB2WINBIN=$(find "$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software -noexchndl" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl -noexchndl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$BUILD" = "$BUILDPATH/radio-racers" ]; then

        SRB2WINDIR="Radio Racers"
        SRB2WINMENUDIR="Radio Racers"
        SRB2WINBIN=$(find "$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" -name "$SRB2WINBIN" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN -software -noexchndl" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
        $PRINTF "@echo off\nstart $SRB2WINBIN -opengl -noexchndl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

    elif [ "$(dirname $BUILD)" = "$BUILDPATH/srb2-custom" ]; then

        SRB2WINDIR="SRB2 Custom $CUSTOMDIR"
        SRB2WINMENUDIR="Sonic Robo Blast 2 Custom $CUSTOMDIR"
        SRB2WINBIN=$(find "$BUILD/bin" "$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Games/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f $(find "$BUILD/bin" "$BUILD/build/ninja-x86_mingw_static_vcpkg-release/bin" -name "*.exe" -type f 2> /dev/null) "$SRB2WINPATH"
        cp -rf "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR/"* "$SRB2WINPATH"
        cp -f "$BUILD/build/AppDir/usr/lib/"*.dll "$SRB2WINPATH" 2> /dev/null || true

        if [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

            $PRINTF "@echo off\nstart $SRB2WINBIN -software -noexchndl" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
            $PRINTF "@echo off\nstart $SRB2WINBIN -opengl -noexchndl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

        else

            $PRINTF "@echo off\nstart $SRB2WINBIN -software" > "$SRB2WINPATH/$SRB2WINDIR (Software).bat"
            $PRINTF "@echo off\nstart $SRB2WINBIN -opengl" > "$SRB2WINPATH/$SRB2WINDIR (OpenGL).bat"

        fi

    elif [ "$BUILD" = "$BUILDPATH/wadcli" ]; then

        SRB2WINDIR="wadcli"
        SRB2WINMENUDIR="wadcli"
        SRB2WINBIN="$(find "$BUILD" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)"
        SRB2WINPATH="$HOME/SRB2 Software/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f "$BUILD/$SRB2WINBIN" "$SRB2WINPATH"
        cp -f "$BUILD/build/icon.ico" "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN" > "$SRB2WINPATH/$SRB2WINDIR.bat"

    elif [ "$BUILD" = "$BUILDPATH/kartmaker" ]; then

        SRB2WINDIR="kartmaker"
        SRB2WINMENUDIR="kartmaker (SRB2 Kart)"
        SRB2WINBIN="$(find "$BUILD" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)"
        SRB2WINPATH="$HOME/SRB2 Software/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f "$BUILD/build/$SRB2WINBIN" "$SRB2WINPATH"
        cp -f "$BUILD/build/icon.ico" "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN" > "$SRB2WINPATH/$SRB2WINDIR.bat"

    elif [ "$BUILD" = "$BUILDPATH/neptunefm" ]; then

        SRB2WINDIR="NeptuneFM"
        SRB2WINMENUDIR="NeptuneFM (SRB2 Kart)"
        SRB2WINBIN="$(find "$BUILD" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)"
        SRB2WINPATH="$HOME/SRB2 Software/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f "$BUILD/$SRB2WINBIN" "$SRB2WINPATH"
        cp -f "$BUILD/build/icon.ico" "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN" > "$SRB2WINPATH/$SRB2WINDIR.bat"

    elif [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ]; then

        SRB2WINDIR="kartmakerringracers"
        SRB2WINMENUDIR="kartmaker (Ring Racers)"
        SRB2WINBIN="$(find "$BUILD" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)"
        SRB2WINPATH="$HOME/SRB2 Software/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f "$BUILD/$SRB2WINBIN" "$SRB2WINPATH"
        cp -f "$BUILD/build/icon.ico" "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN" > "$SRB2WINPATH/$SRB2WINDIR.bat"

    elif [ "$BUILD" = "$BUILDPATH/followermaker" ]; then

        SRB2WINDIR="followermaker"
        SRB2WINMENUDIR="followermaker (Ring Racers)"
        SRB2WINBIN="$(find "$BUILD" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)"
        SRB2WINPATH="$HOME/SRB2 Software/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f "$BUILD/$SRB2WINBIN" "$SRB2WINPATH"
        cp -f "$BUILD/build/icon.ico" "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN" > "$SRB2WINPATH/$SRB2WINDIR.bat"

    elif [ "$BUILD" = "$BUILDPATH/slade" ]; then

        SRB2WINDIR="SLADE"
        SRB2WINMENUDIR="SLADE"
        SRB2WINBIN=$(find "$BUILD" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Software/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        mkdir -p "$SRB2WINPATH"
        cp -f "$BUILD/$SRB2WINBIN" "$SRB2WINPATH"
        cp -f "$BUILD/build/icon.png" "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN" > "$SRB2WINPATH/$SRB2WINDIR.bat"

    elif [ "$BUILD" = "$BUILDPATH/ultimate-zone-builder" ]; then

        SRB2WINDIR="Ultimate Zone Builder"
        SRB2WINMENUDIR="Ultimate Zone Builder"
        SRB2WINBIN=$(find "$BUILD/Build" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Software"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        rm -rf "$BUILD/Build/AppDir" "$BUILD/Build/builder"
        mkdir -p "$SRB2WINPATH/$SRB2WINDIR"
        cp -rf "$BUILD/Build/"* "$SRB2WINPATH/$SRB2WINDIR"
        $PRINTF "@echo off\nstart $SRB2WINBIN" > "$SRB2WINPATH/$SRB2WINDIR/$SRB2WINDIR.bat"

    elif [ "$BUILD" = "$BUILDPATH/ultimate-gksz-builder" ]; then

        SRB2WINDIR="Ultimate GKSZ Builder"
        SRB2WINMENUDIR="Ultimate GKSZ Builder"
        SRB2WINBIN=$(find "$BUILD/Build" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Software"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        rm -rf "$BUILD/Build/AppDir" "$BUILD/Build/builder"
        mkdir -p "$SRB2WINPATH/$SRB2WINDIR"
        cp -rf "$BUILD/Build/"* "$SRB2WINPATH/$SRB2WINDIR"
        $PRINTF "@echo off\nstart $SRB2WINBIN" > "$SRB2WINPATH/$SRB2WINDIR/$SRB2WINDIR.bat"

    elif [ "$BUILD" = "$BUILDPATH/ultimate-lowee-builder" ]; then

        SRB2WINDIR="Ultimate Lowee Builder"
        SRB2WINMENUDIR="Ultimate Lowee Builder"
        SRB2WINBIN=$(find "$BUILD/Build" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Software"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        rm -rf "$BUILD/Build/AppDir" "$BUILD/Build/builder"
        mkdir -p "$SRB2WINPATH/$SRB2WINDIR"
        cp -rf "$BUILD/Build/"* "$SRB2WINPATH/$SRB2WINDIR"
        $PRINTF "@echo off\nstart $SRB2WINBIN" > "$SRB2WINPATH/$SRB2WINDIR/$SRB2WINDIR.bat"

    elif [ "$BUILD" = "$BUILDPATH/high-voltage-ring" ]; then

        SRB2WINDIR="High Voltage Ring"
        SRB2WINMENUDIR="High Voltage Ring"
        SRB2WINBIN=$(find "$BUILD/Build" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Software"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        rm -rf "$BUILD/Build/AppDir" "$BUILD/Build/builder"
        mkdir -p "$SRB2WINPATH/$SRB2WINDIR"
        cp -rf "$BUILD/Build/"* "$SRB2WINPATH/$SRB2WINDIR"
        $PRINTF "@echo off\nstart $SRB2WINBIN" > "$SRB2WINPATH/$SRB2WINDIR/$SRB2WINDIR.bat"

    elif [ "$BUILD" = "$BUILDPATH/aseprite" ]; then

        SRB2WINDIR="Aseprite"
        SRB2WINMENUDIR="Aseprite"
        SRB2WINBIN=$(find "$BUILD/build" -name "*.exe" -type f 2> /dev/null | gawk -F'/' '{print $NF}' | head -n1)
        SRB2WINPATH="$HOME/SRB2 Software/$SRB2WINDIR"
        SRB2WINMENUPATH="$HOME/Start Menu/Programs/$SRB2WINMENUDIR"
        rm -rf "$BUILD/build/AppDir"
        mkdir -p "$SRB2WINPATH"
        cp -rf "$BUILD/build" "$SRB2WINPATH"
        cp -f "$BUILD/build/icon.png" "$SRB2WINPATH"
        $PRINTF "@echo off\nstart $SRB2WINBIN" > "$SRB2WINPATH/$SRB2WINDIR.bat"

    fi

    # Using VBScript to create menu entry for Windows.
    if [ "$BUILD" = "$BUILDPATH/wadcli" ] || [ "$BUILD" = "$BUILDPATH/kartmaker" ] || [ "$BUILD" = "$BUILDPATH/neptunefm" ] || [ "$BUILD" = "$BUILDPATH/kartmaker-ring-racers" ] || [ "$BUILD" = "$BUILDPATH/followermaker" ] || [ "$BUILD" = "$BUILDPATH/slade" ] || [ "$BUILD" = "$BUILDPATH/ultimate-zone-builder" ] || [ "$BUILD" = "$BUILDPATH/ultimate-gksz-builder" ] || [ "$BUILD" = "$BUILDPATH/ultimate-lowee-builder" ] || [ "$BUILD" = "$BUILDPATH/high-voltage-ring" ] || [ "$BUILD" = "$BUILDPATH/aseprite" ]; then

        cat > "$BUILD/build/CreateShortcut.vbs" << WINMENUSHORTCUT
Set oWS = CreateObject("WScript.Shell")
strHomeFolder = oWS.ExpandEnvironmentStrings("%USERPROFILE%")

Set oFSO = CreateObject("Scripting.FileSystemObject")
oFSO.CreateFolder strHomeFolder & "\\Start Menu\\Programs\\$SRB2WINMENUDIR"

Set oWS = WScript.CreateObject("WScript.Shell")
sLinkFile = strHomeFolder & "\\Start Menu\\Programs\\$SRB2WINMENUDIR\\$SRB2WINDIR.bat.lnk"
Set oLink = oWS.CreateShortcut(sLinkFile)
oLink.TargetPath = strHomeFolder & "\\SRB2 Software\\$SRB2WINDIR\\$SRB2WINDIR.bat"
oLink.WorkingDirectory = strHomeFolder & "\\SRB2 Software\\$SRB2WINDIR"
oLink.IconLocation = strHomeFolder & "\\SRB2 Software\\$SRB2WINDIR\\icon.ico"
oLink.Save
WINMENUSHORTCUT

    elif [ "$BUILD" = "$BUILDPATH/newmillennium" ]; then

        cat > "$BUILD/build/CreateShortcut.vbs" << WINMENUSHORTCUT
Set oWS = CreateObject("WScript.Shell")
strHomeFolder = oWS.ExpandEnvironmentStrings("%USERPROFILE%")

Set oFSO = CreateObject("Scripting.FileSystemObject")
oFSO.CreateFolder strHomeFolder & "\\Start Menu\\Programs\\$SRB2WINMENUDIR"

Set oWS = WScript.CreateObject("WScript.Shell")
sLinkFile = strHomeFolder & "\\Start Menu\\Programs\\$SRB2WINMENUDIR\\$SRB2WINDIR (Software).bat.lnk"
Set oLink = oWS.CreateShortcut(sLinkFile)
oLink.TargetPath = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR\\$SRB2WINDIR (Software).bat"
oLink.WorkingDirectory = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR"
oLink.IconLocation = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR\\Srb2win.ico"
oLink.Save

sLinkFile = strHomeFolder & "\\Start Menu\\Programs\\$SRB2WINMENUDIR\\$SRB2WINDIR (OpenGL).bat.lnk"
Set oLink = oWS.CreateShortcut(sLinkFile)
oLink.TargetPath = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR\\$SRB2WINDIR (OpenGL).bat"
oLink.WorkingDirectory = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR"
oLink.IconLocation = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR\\Srb2win.ico"
oLink.Save
WINMENUSHORTCUT

    else

        cat > "$BUILD/build/CreateShortcut.vbs" << WINMENUSHORTCUT
Set oWS = CreateObject("WScript.Shell")
strHomeFolder = oWS.ExpandEnvironmentStrings("%USERPROFILE%")

Set oFSO = CreateObject("Scripting.FileSystemObject")
oFSO.CreateFolder strHomeFolder & "\\Start Menu\\Programs\\$SRB2WINMENUDIR"

Set oWS = WScript.CreateObject("WScript.Shell")
sLinkFile = strHomeFolder & "\\Start Menu\\Programs\\$SRB2WINMENUDIR\\$SRB2WINDIR (Software).bat.lnk"
Set oLink = oWS.CreateShortcut(sLinkFile)
oLink.TargetPath = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR\\$SRB2WINDIR (Software).bat"
oLink.WorkingDirectory = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR"
oLink.IconLocation = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR\\$SRB2WINBIN"
oLink.Save

sLinkFile = strHomeFolder & "\\Start Menu\\Programs\\$SRB2WINMENUDIR\\$SRB2WINDIR (OpenGL).bat.lnk"
Set oLink = oWS.CreateShortcut(sLinkFile)
oLink.TargetPath = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR\\$SRB2WINDIR (OpenGL).bat"
oLink.WorkingDirectory = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR"
oLink.IconLocation = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR\\$SRB2WINBIN"
oLink.Save
WINMENUSHORTCUT

    fi

    if [ "$BUILD" = "$BUILDPATH/srb2-vr" ] || [ "$BUILD" = "$BUILDPATH/srb2-kart-vr" ]; then

        cat >> "$BUILD/build/CreateShortcut.vbs" << WINMENUSHORTCUT
sLinkFile = strHomeFolder & "\\Start Menu\\Programs\\$SRB2WINMENUDIR\\$SRB2WINDIR (OpenVR).bat.lnk"
Set oLink = oWS.CreateShortcut(sLinkFile)
oLink.TargetPath = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR\\$SRB2WINDIR (OpenVR).bat"
oLink.WorkingDirectory = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR"
oLink.IconLocation = strHomeFolder & "\\SRB2 Games\\$SRB2WINDIR\\$SRB2WINBIN"
oLink.Save
WINMENUSHORTCUT

    fi

    cscript "$BUILD/build/CreateShortcut.vbs" 2> /dev/null
}

listasset() {
    clear

    if [ -z "$(find "$SRB2BLDROOT/assets" -mindepth 1 -type f 2> /dev/null | sort)" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Can't find downloaded assets."
        exit

    fi

    # List downloaded assets.
    $PRINTF "$PROMPT%s\n\e[0m" "$(find "$SRB2BLDROOT/assets" -mindepth 1 -maxdepth 1 -type f 2> /dev/null | gawk -F'/' '{print $NF}' | sort)"
}

listbuild() {
    clear

    if [ -z "$(find "$SRB2BLDROOT/builds" -mindepth 1 -maxdepth 1 -type d 2> /dev/null | sort)" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Can't find downloaded builds."
        exit

    fi

    # List downloaded source code.
    $PRINTF "$PROMPT%s\n\e[0m" "$(find "$SRB2BLDROOT/builds" ! -iname srb2-custom -mindepth 1 -maxdepth 1 -type d 2> /dev/null | gawk -F'/' '{print $NF}' | sort)"
    $PRINTF "$PROMPT"srb2-custom"\n\e[0m$(for c in $(find "$SRB2BLDROOT/builds/srb2-custom" -mindepth 1 -maxdepth 1 -type d 2> /dev/null | gawk -F'/' '{print $NF}'); do $PRINTF "%s\n" ""$c; done)\n"
}

listconfig() {
    clear

    if [ -z "$(find "$SRB2BLDROOT/installed" -mindepth 1 -type f 2> /dev/null | sort)" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Can't find installed builds."
        exit

    fi

    # List configuration flags for installed build.
    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose installed build by typing number and then pressing enter. Press enter or ctrl+c to quit."
    array=$(find "$SRB2BLDROOT/installed" -mindepth 1 -maxdepth 1 2> /dev/null | sort)
    arrayname=$($PRINTF "%s\n" "$array" | gawk -F'/' '{print $NF}')
    count="$($PRINTF "%s\n" "$array" | wc -l)"
    n=""
    $PRINTF "%s\n" "$arrayname" | gawk '{print NR")", $0}'
    while true; do

        $PRINTF "#? "
        read -r n

        if [ -n "$n" ] && [ "$n" -eq "$n" ] && [ "$n" -gt 0 ] && [ "$n" -le "$count" ]; then

            if [ "$($PRINTF "%s\n" "$array" | gawk NR=="${n}" | gawk -F'/' '{print $NF}')" = "srb2-custom" ]; then

                while true; do

                    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose custom build by typing number and then pressing enter. Press enter or ctrl+c to quit."
                    array=$($PRINTF "$(find "$SRB2BLDROOT/installed/srb2-custom" -mindepth 1 -maxdepth 1 -type f 2> /dev/null | sort)\nBack" | gawk 'NF{print}')
                    arrayname=$($PRINTF "$array" | gawk -F'/' '{print $NF}')
                    count="$($PRINTF "%s\n" "$array" | wc -l)"
                    n=""
                    $PRINTF "%s\n" "$arrayname" | gawk '{print NR")", $0}'
                    $PRINTF "#? "
                    read -r n

                    if [ -n "$n" ] && [ "$n" -eq "$n" ] && [ "$n" -gt 0 ] && [ "$n" -le "$count" ]; then

                        if [ "$($PRINTF "%s\n" "$array" | gawk NR=="${n}" | gawk -F'/' '{print $NF}')" = "Back" ]; then

                            exec "$0" --listconfig

                        fi

                        CONF=$($PRINTF "%s\n" "$array" | gawk NR=="${n}")
                        $PRINTF "%s\n" ""
                        $PRINTF "$PROMPT%s\n\e[0m" "$(gawk '/---------------/ {gsub("---------------",""); getline; print}' "$CONF")"

                    else

                        $PRINTF "$NOTICE\n%s\n\e[0m" "No option has been chosen."
                        exit

                    fi

                done

            fi

            CONF=$($PRINTF "%s\n" "$array" | gawk NR=="${n}")
            $PRINTF "%s\n" ""
            $PRINTF "$PROMPT%s\n\e[0m" "$(gawk '/---------------/ {gsub("---------------",""); getline; print}' "$CONF")"
            break

        else

            $PRINTF "$NOTICE\n%s\n\e[0m" "No option has been chosen."
            exit

        fi

    done
}

listdep() {
    clear

    if [ -z "$(find "$SRB2BLDROOT/libraries" -mindepth 1 -maxdepth 1 -type d 2> /dev/null)" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Can't find dependencies."
        exit

    fi

    # List downloaded source code.
    $PRINTF "$PROMPT%s\n\e[0m" "$(find "$SRB2BLDROOT/libraries" ! -iname srb2-custom -mindepth 1 -maxdepth 1 -type d 2> /dev/null | gawk -F'/' '{print $NF}' | sort)"
}

listinstalled() {
    clear

    if [ -z "$(find "$SRB2BLDROOT/installed" -mindepth 1 -type f 2> /dev/null | sort)" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Can't find installed builds."
        exit

    fi

    # List files for installed build.
    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose installed build by typing number and then pressing enter. Press enter or ctrl+c to quit."
    array=$(find "$SRB2BLDROOT/installed" -mindepth 1 -maxdepth 1 2> /dev/null | sort)
    arrayname=$($PRINTF "%s\n" "$array" | gawk -F'/' '{print $NF}')
    count="$($PRINTF "%s\n" "$array" | wc -l)"
    n=""
    $PRINTF "%s\n" "$arrayname" | gawk '{print NR")", $0}'
    while true; do

        $PRINTF "#? "
        read -r n

        if [ -n "$n" ] && [ "$n" -eq "$n" ] && [ "$n" -gt 0 ] && [ "$n" -le "$count" ]; then

            if [ "$($PRINTF "%s\n" "$array" | gawk NR=="${n}" | gawk -F'/' '{print $NF}')" = "srb2-custom" ]; then

                while true; do

                    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Please choose custom build by typing number and then pressing enter. Press enter or ctrl+c to quit."
                    array=$($PRINTF "$(find "$SRB2BLDROOT/installed/srb2-custom" -mindepth 1 -maxdepth 1 -type f 2> /dev/null | sort)\nBack" | gawk 'NF{print}')
                    arrayname=$($PRINTF "$array" | gawk -F'/' '{print $NF}')
                    count="$($PRINTF "%s\n" "$array" | wc -l)"
                    n=""
                    $PRINTF "%s\n" "$arrayname" | gawk '{print NR")", $0}'
                    $PRINTF "#? "
                    read -r n

                    if [ -n "$n" ] && [ "$n" -eq "$n" ] && [ "$n" -gt 0 ] && [ "$n" -le "$count" ]; then

                        if [ "$($PRINTF "%s\n" "$array" | gawk NR=="${n}" | gawk -F'/' '{print $NF}')" = "Back" ]; then

                            exec "$0" --listinstalled

                        fi

                        CONF=$($PRINTF "%s\n" "$array" | gawk NR=="${n}")
                        $PRINTF "%s\n" ""
                        $PRINTF "$PROMPT%s\n\e[0m" "$(gawk '/^\//,/---------------/ {gsub("---------------",""); print}' "$CONF")"

                    else

                        $PRINTF "$NOTICE\n%s\n\e[0m" "No option has been chosen."
                        exit

                    fi

                done

            fi

            CONF=$($PRINTF "%s\n" "$array" | gawk NR=="${n}")
            $PRINTF "%s\n" ""
            $PRINTF "$PROMPT%s\n\e[0m" "$(gawk '/^\//,/---------------/ {gsub("---------------",""); print}' "$CONF")"
            break

        else

            $PRINTF "$NOTICE\n%s\n\e[0m" "No option has been chosen."
            exit

        fi

    done
}

preparebuild() {
    # Make directories for storing essential files.
    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Preparing directories to store $BUILDNAME's source code, assets and libraries. Please wait..."
    if [ "$OS" = "Darwin" ]; then

        mkdir -p "$SRB2BLDROOT/builds" "$SRB2BLDROOT/assets" "$SRB2BLDROOT/libraries" "$BUILD/assets/installer"

    else

        mkdir -p "$SRB2BLDROOT/builds" "$SRB2BLDROOT/assets" "$SRB2BLDROOT/libraries" "$BUILD/build/AppDir/usr/bin" "$BUILD/build/AppDir/usr/games" "$BUILD/build/AppDir/usr/lib" "$BUILD/build/AppDir/usr/share/applications"

        if [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "SRB2Kart" ]; then

            ASSETAPPDIR="SRB2Kart"

        elif [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

            ASSETAPPDIR="RingRacers"

        elif [ "$BUILD" != "$BUILDPATH/wadcli" ] && [ "$BUILD" != "$BUILDPATH/kartmaker" ] && [ "$BUILD" != "$BUILDPATH/neptunefm" ] && [ "$BUILD" != "$BUILDPATH/kartmaker-ring-racers" ] && [ "$BUILD" != "$BUILDPATH/followermaker" ] && [ "$BUILD" != "$BUILDPATH/slade" ] && [ "$BUILD" != "$BUILDPATH/ultimate-zone-builder" ] && [ "$BUILD" != "$BUILDPATH/ultimate-gksz-builder" ] && [ "$BUILD" != "$BUILDPATH/ultimate-lowee-builder" ] && [ "$BUILD" != "$BUILDPATH/high-voltage-ring" ] && [ "$BUILD" != "$BUILDPATH/aseprite" ]; then

            ASSETAPPDIR="SRB2"

        fi

    fi

    mkdir -p "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"
    cd "$BUILD" || exit

    if [ "$BUILD" != "$BUILDPATH/wadcli" ] && [ "$BUILD" != "$BUILDPATH/kartmaker" ] && [ "$BUILD" != "$BUILDPATH/neptunefm" ] && [ "$BUILD" != "$BUILDPATH/kartmaker-ring-racers" ] && [ "$BUILD" != "$BUILDPATH/followermaker" ] && [ "$BUILD" != "$BUILDPATH/slade" ] && [ "$BUILD" != "$BUILDPATH/ultimate-zone-builder" ] && [ "$BUILD" != "$BUILDPATH/ultimate-gksz-builder" ] && [ "$BUILD" != "$BUILDPATH/ultimate-lowee-builder" ] && [ "$BUILD" != "$BUILDPATH/high-voltage-ring" ] && [ "$BUILD" != "$BUILDPATH/aseprite" ]; then

        if [ "$GITVER" != "$GITDEFVER" ]; then

            # Set branch in build's configuration directory name.
            GITVERCONF="$GITVER"

            # Set asset's path, if branch was set to other than default.
            if [ -z "$SRB2BLDASSETPATH" ] || [ "$(dirname $BUILD)" != "$BUILDPATH/srb2-custom" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\e[0m" "Please enter $BUILDNAME's assets path, or just press enter to download and extract the latest SRB2/SRB2Kart/Ring Racers stable release assets. Supported links/paths:
	- websites with direct link to file, for example, \"https://github.com/STJr/SRB2/releases/download/SRB2_release_2.2.10/SRB2-v2210-Full.zip\",
	- mega.nz,
	- drive.google.com,
	- dropbox.com,
	- full path to downloaded single asset file in format .pk3, .kart, etc. or archived file in formats supported by p7zip (https://www.7-zip.org) or full path to directory with build's assets, for example $HOME/Downloads/SRB2.zip for Linux and macOS or C:\Downloads\SRB2.zip for Windows.
"
                $PRINTF "$PROMPT\n%s\e[0m" "> "
                read -r SRB2BLDASSETPATH

            fi

            # Assume default branch and latest SRB2/SRB2Kart/Ring Racers assets, if entered nothing in prompt.
            if [ -z "$SRB2BLDASSETPATH" ] && [ -z "$UPGRADEBUILD" ]; then

                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Assuming the latest SRB2/SRB2Kart/Ring Racers release assets for $BUILDNAME."
                GITVER="$GITDEFVER"

            # Set to custom asset's path locally or remotely.
            else

                # Fixing Windows path to source code to be found by script.
                if [ "$OS" = "Windows" ]; then

                    SRB2BLDASSETPATH=$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk 'gsub("\\\\","\\\\");{print}' | gawk '!a[$0]++ {print}')

                fi

                if [ -n "$(find "$SRB2BLDASSETPATH" 2> /dev/null | head -n1)" ]; then

                    FILETYPE=$(find "$SRB2BLDASSETPATH" 2> /dev/null | gawk -F'.' '{print $NF}' | head -n1)
                    $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Copying assets. Please wait..."
                    sleep 1

                    # Copy directory with assets to script's data path.
                    if [ "$(file -b "$SRB2BLDASSETPATH" 2> /dev/null)" = "directory" ]; then

                        if [ "$OS" = "Darwin" ]; then

                            cp -rf "$SRB2BLDASSETPATH/"* "$BUILD/assets/installer"

                        else

                            cp -rf "$SRB2BLDASSETPATH/"* "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"

                        fi

                    # Copy archived file of assets to script's data path.
                    else

                        if [ "$FILETYPE" = "pk3" ] || [ "$FILETYPE" = "dta" ] || [ "$FILETYPE" = "wad" ] || [ "$FILETYPE" = "kart" ]; then

                            cp -f "$SRB2BLDASSETPATH" "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDASSETPATH" | gawk -F'/' '{print $NF}')"

                        else

                            cp -f "$SRB2BLDASSETPATH" "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')-$GITVER.$FILETYPE"

                        fi

                    fi

                fi

            fi

        fi

        if [ -z "$SRB2BLDEXTRAASSETPATH" ] && [ "$(dirname $BUILD)" = "$BUILDPATH/srb2-custom" ]; then

            $PRINTF "\n$PROMPT==> $MESSAGE%s\e[0m" "Please enter $BUILDNAME's extra assets path, or just press enter, if you want to skip this part. Supported links/paths:
        	- websites with direct link to file, for example, \"https://github.com/STJr/SRB2/releases/download/SRB2_release_2.2.10/SRB2-v2210-Full.zip\",
        	- mega.nz,
        	- drive.google.com,
        	- dropbox.com,
        	- full path to downloaded single asset file in format .pk3, .kart, etc. or archived file in formats supported by p7zip (https://www.7-zip.org) or full path to directory with build's assets, for example $HOME/Downloads/SRB2.zip for Linux and macOS or C:\Downloads\SRB2.zip for Windows.
        "
            $PRINTF "$PROMPT\n%s\e[0m" "> "
            read -r SRB2BLDEXTRAASSETPATH

        fi

        # Set to custom asset's path locally or remotely.
        if [ -n "$SRB2BLDEXTRAASSETPATH" ] || [ -n "$UPGRADEBUILD" ]; then

            # Fixing Windows path to source code to be found by script.
            if [ "$OS" = "Windows" ]; then

                SRB2BLDEXTRAASSETPATH=$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk 'gsub("\\\\","\\\\");{print}' | gawk '!a[$0]++ {print}')

            fi

            if [ -n "$(find "$SRB2BLDEXTRAASSETPATH" 2> /dev/null | head -n1)" ]; then

                FILETYPE=$(find "$SRB2BLDEXTRAASSETPATH" 2> /dev/null | gawk -F'.' '{print $NF}' | head -n1)
                $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Copying assets. Please wait..."
                sleep 1

                # Copy directory with assets to script's data path.
                if [ "$(file -b "$SRB2BLDEXTRAASSETPATH" 2> /dev/null)" = "directory" ]; then

                    if [ "$OS" = "Darwin" ]; then

                        if [ "$(gawk -F'\"' '/SRB2APPLICATION/ {gsub(" ",""); print $2}' "$BUILD/src/doomdef.h" 2> /dev/null)" = "RingRacers" ]; then

                            mkdir -p "$BUILD/assets/installer/data"
                            cp -rf "$SRB2BLDEXTRAASSETPATH/"* "$BUILD/assets/installer/data"

                        else

                            cp -rf "$SRB2BLDEXTRAASSETPATH/"* "$BUILD/assets/installer"

                        fi

                    else

                        cp -rf "$SRB2BLDEXTRAASSETPATH/"* "$BUILD/build/AppDir/usr/games/$ASSETAPPDIR"

                    fi

                # Copy archived file of assets to script's data path.
                else

                    if [ "$FILETYPE" = "pk3" ] || [ "$FILETYPE" = "dta" ] || [ "$FILETYPE" = "wad" ] || [ "$FILETYPE" = "kart" ]; then

                        cp -f "$SRB2BLDEXTRAASSETPATH" "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$SRB2BLDEXTRAASSETPATH" | gawk -F'/' '{print $NF}')"

                    else

                        cp -f "$SRB2BLDEXTRAASSETPATH" "$SRB2BLDROOT/assets/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')-$GITVER.$FILETYPE"

                    fi

                fi

            fi

        fi

    fi
}

preparecontainer() {
    # If podman is installed, this will be used instead of docker.
    if [ -x "$(command -v podman 2> /dev/null)" ]; then

        if [ "$OS" = "Linux" ] && [ "$WINOS" != "1" ]; then

            if [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u -| -u$| --user -| --user$/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk 'match($0, /\/home\/'$USER'\/.local/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$ISREADONLY" ]; then

                if [ ! -d "$HOME/.config/containers" ]; then

                    mkdir -p "$HOME/.config/containers"

                fi

                # Setting insecureAcceptAnything in case of missing this policy in file /etc/containers/policy.json.
                if [ ! -f "$HOME/.config/containers/policy.json" ]; then

                    cat > "$HOME/.config/containers/policy.json" << NIX
{
"default": [
        {
            "type": "insecureAcceptAnything"
        }
    ]
}
NIX

                fi

            else

                if [ ! -d /etc/containers ]; then

                    $SUDO mkdir -p /etc/containers

                fi

                # Setting insecureAcceptAnything in case of missing this policy in file /etc/containers/policy.json.
                if [ ! -f "/etc/containers/policy.json" ] || [ -z "$(gawk '/insecureAcceptAnything/ {print}' /etc/containers/policy.json 2> /dev/null)" ]; then

                    $SUDO podman image trust set -t accept default

                fi

            fi

            if [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u -| -u$| --user -| --user$/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk 'match($0, /\/home\/'$USER'\/.local/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$ISREADONLY" ]; then

                OSVIRT="podman --root $HOME/.local/share/containers/storage"

            else

                OSVIRT="$SUDO podman --root /var/lib/containers/storage"

            fi

        else

            if [ -x "$(command -v winpty 2> /dev/null)" ]; then

                OSVIRT="winpty -Xallow-non-tty podman"

            elif [ "$WINOS" != "1" ]; then

                OSVIRT="$SUDO podman --root /var/lib/containers/storage"

            else

                OSVIRT="podman"

            fi

        fi

    else

        if [ -x "$(command -v winpty 2> /dev/null)" ]; then

            OSVIRT="winpty -Xallow-non-tty docker"

        else

            OSVIRT="docker"

        fi

    fi
}

removeduplicate() {
    # Removing previously installed files before installing the latest one.
    if [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u -| -u$| --user -| --user$/) {print substr($0, RSTART, RLENGTH)}')" ] && [ -z "$UPGRADEBUILD" ]; then

        if [ -x "$(command -v doas 2> /dev/null)" ]; then

            SUDO="doas"

        else

            SUDO="sudo"

        fi

    fi

    if [ "$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk 'match($0, /\/nix\/store|\/usr\/local|\/home\/'$USER'\/.local|\/home\/'$USER'\/Local/) {print substr($0, RSTART, RLENGTH)}')" != "$(gawk 'match($0, /\/nix\/store|\/usr\/local|\/home\/'$USER'\/.local|\/home\/'$USER'\/Local/) {print substr($0, RSTART, RLENGTH)}' "$SRB2BLDROOT/installed/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')" 2> /dev/null | head -n1)" ] && [ -f "$SRB2BLDROOT/installed/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')" ] && [ -z "$UPGRADEBUILD" ]; then

        BUILDINSTALLED="$SRB2BLDROOT/installed/$($PRINTF "%s\n" "$BUILD" | gawk -F'/' '{print $NF}')"
        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Removing previously installed build. Please wait..."
        sleep 1
        gawk -i inplace -v RS= '{gsub("---------------\n[A-Z]*=1|---------------",""); print}' "$BUILDINSTALLED"

        if [ "$OS" = "Windows" ]; then

            while read -r FILE; do
                rm -rfv "$FILE"
            done < "$BUILDINSTALLED"

        elif [ "$LNXOSNAME" = "NixOS" ]; then

            if [ "$($SUDO nix profile list --extra-experimental-features 'nix-command flakes' | gawk '/'$(head -n1 "$BUILDINSTALLED" | gawk '{gsub("/","\\/"); print}')'/ {print $NF}')" ]; then

                $SUDO nix profile remove $(head -n1 "$BUILDINSTALLED") --extra-experimental-features 'nix-command flakes'

            else

                nix profile remove $(head -n1 "$BUILDINSTALLED") --extra-experimental-features 'nix-command flakes'

            fi

        else

            while read -r FILE; do
                $SUDO rm -rfv "$FILE"
            done < "$BUILDINSTALLED"

        fi

        rm -rfv "$BUILDINSTALLED"

    fi

    if [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u -| -u$| --user -| --user$/) {print substr($0, RSTART, RLENGTH)}')" ] && [ -z "$UPGRADEBUILD" ]; then

        unset SUDO

    fi
}

setsudo() {
    if [ -n "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u -| -u$| --user -| --user$/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk 'match($0, /\/home\/'$USER'\/.local/) {print substr($0, RSTART, RLENGTH)}')" ] || [ -n "$ISREADONLY" ]; then

        unset SUDO

    else

        if [ -x "$(command -v doas 2> /dev/null)" ]; then

            SUDO="doas"

        else

            SUDO="sudo"

        fi

    fi
}

settrap() {
    # Trigger certain commands with trap signals.
    if [ "$WINOS" = "1" ] || [ "$CROSS" = "1" ]; then

        if [ "$SRB2BLDDEVMODE" = "1" ]; then

            trap '$PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m" "Exiting shell script. Please wait..." ; kill -9 0' 0 1 2 3 6 15

        else

            trap '$PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m" "Cleaning up $BUILDNAME'\''s source code and exiting shell script. Please wait..." ; cleansource ; kill -9 0' 0 1 2 3 6 15

        fi

    elif [ "$OS" = "Darwin" ]; then

        if [ "$SRB2BLDDEVMODE" = "1" ]; then

            trap '[ $? != 0 ] && $PRINTF "\n\n$PROMPT==> $FAILURE%s\n\e[0m" "ERROR: Build didn'\''t finish due to error or cancelling process. Try \"srb2bld -i -t\" to compile and install tagged/release version of build." ; $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m" "Exiting shell script. Please wait..." ; kill -9 0' 0 1 2 3 6 15

        else

            trap '[ $? != 0 ] && $PRINTF "\n\n$PROMPT==> $FAILURE%s\n\e[0m" "ERROR: Build didn'\''t finish due to error or cancelling process. Try \"srb2bld -i -t\" to compile and install tagged/release version of build." ; $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m" "Cleaning up $BUILDNAME'\''s source code and exiting shell script. Please wait..." ; cleansource ; kill -9 0' 0 1 2 3 6 15

        fi

    elif [ "$OS" = "Linux" ]; then

        if [ "$SRB2BLDDEVMODE" = "1" ]; then

            trap '$PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m" "Exiting shell script. Please wait..." ; sudo_ping stop ; exit' 0 1 2 3 6 15

        else

            trap '$PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m" "Cleaning up $BUILDNAME'\''s source code and exiting shell script. Please wait..." ; cleansource ; sudo_ping stop ; exit' 0 1 2 3 6 15

        fi

    fi
}

sudo_ping() {
    if [ -x "$(command -v sudo 2> /dev/null)" ] && ([ "$WINOS" != "1" ] && [ -z "$($PRINTF "%s\n" "$ARGS" | gawk 'match($0, / -u -| -u$| --user -| --user$/) {print substr($0, RSTART, RLENGTH)}')" ] && [ -z "$($PRINTF "%s\n" "$SRB2BLDPREFIX" | gawk 'match($0, /\/home\/'$USER'\/.local/) {print substr($0, RSTART, RLENGTH)}')" ] && [ -z "$ISREADONLY" ] && [ -z "$ISPASSWORDLESS" ]); then

        # Make sudo to extend password timeout.
        if [ -n "$SUDO_PID" ]; then

            if [ "$1" = stop ]; then

                kill "$SUDO_PID"
                return

            else

                return

            fi

        fi

        sudo -v

        if [ $? -eq 1 ]; then

            return

        fi

        while true; do

            sudo -v
            sleep 30

        done &
        SUDO_PID=$!

    fi
}

upgrade() {
    clear

    UPGRADE=1

    checkuseropt

    checkuserid

    if [ -z "$(find "$BUILDPATH" -mindepth 1 -maxdepth 1 -type d 2> /dev/null | gawk -F'/' '{print $NF}' | sort)" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Can't find installed builds."
        exit

    fi

    ISNET=$(curl -vI https://github.com 2>&1 | gawk '/> Host:/ {gsub("\r",""); print $NF}')

    # Make a loop to find the SRB2 source code directories and then update them one by one.
    for u in $(find "$BUILDPATH" -mindepth 1 -maxdepth 1 -type d ! -name "*android*" 2> /dev/null | gawk -F'/' '{print $NF}' | sort -u); do

        unset GITVERCONF

        if [ "$u" = "srb2-custom" ]; then

            for d in $(find "$BUILDPATH/$u" -mindepth 1 -maxdepth 1 -type d ! -name "*android*" 2> /dev/null | gawk -F'/' '{print $NF}' | sort -u); do

                unset CONF CUSTOMDIR UPGRADEBUILD
                export BUILD="$BUILDPATH/$u/$d"
                export GITURL=$(git -C "$BUILD" remote -v 2> /dev/null | gawk '/fetch/ {print $2}')
                export GITDEFVER=$(gawk -F'/' '{print $NF}' "$BUILD/.git/refs/remotes/origin/HEAD" 2> /dev/null)

                if [ "$(tail -n+2 "$BUILD/.comrev" 2> /dev/null)" != "$GITDEFVER" ]; then

                    export GITVER=$(tail -n+2 "$BUILD/.comrev" 2> /dev/null)
                    export GITVERCONF="$GITVER"

                else

                    unset GITVER

                fi

                export CUSTOMDIR="$d"
                upgradetasks

            done

        else

            unset CONF CUSTOMDIR UPGRADEBUILD
            export BUILD="$BUILDPATH/$u"
            export GITURL=$(git -C "$BUILD" remote -v 2> /dev/null | gawk '/fetch/ {print $2}')
            export GITDEFVER=$(gawk -F'/' '{print $NF}' "$BUILD/.git/refs/remotes/origin/HEAD" 2> /dev/null)
            export GITVER=$(tail -n+2 "$BUILD/.comrev" 2> /dev/null)
            export GITVERCONF="$GITVER"
            upgradetasks

        fi

    done && $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Upgrading is finished."

    # Making sure to kill sudo_ping function process after finishing upgrade.
    if [ -n "$SUDO_PID" ]; then

        trap '$PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m" "Exiting shell script. Please wait..." ; kill $SUDO_PID ; exit' 0 1 2 3 6 15

    else

        trap '$PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m" "Exiting shell script. Please wait..." ; exit' 0 1 2 3 6 15

    fi
}

upgradetasks() {
    buildvar

    fetchupdatebuild

    if [ -f "$BUILD/.comrev" ] && [ "$(git -C "$BUILD" rev-parse --short HEAD)" != "$(head -n1 "$BUILD/.comrev")" ]; then

        export UPGRADEBUILD="$u"

        # Checking installation prefix for to be upgraded build.
        if [ -n "$UPGRADEBUILD" ] && [ -z "$CUSTOMDIR" ] && [ -f "$SRB2BLDROOT/installed/$UPGRADEBUILD" ]; then

            SRB2BLDPREFIX="$(gawk 'match($0, /\/usr\/local\/opt\/srb2-apps|\/usr\/local|\/home\/'$USER'\/.local|\/home\/'$USER'\/Local|\/home\/'$USER'\/SRB2 Games|\/home\/'$USER'\/SRB2 Software/) {print substr($0, RSTART, RLENGTH)}' "$SRB2BLDROOT/installed/$UPGRADEBUILD" | head -n1)"

        elif [ -n "$UPGRADEBUILD" ] && [ -n "$CUSTOMDIR" ] && [ -f "$SRB2BLDROOT/installed/$CUSTOMDIR" ]; then

            SRB2BLDPREFIX="$(gawk 'match($0, /\/usr\/local\/opt\/srb2-apps|\/usr\/local|\/home\/'$USER'\/.local|\/home\/'$USER'\/Local|\/home\/'$USER'\/SRB2 Games|\/home\/'$USER'\/SRB2 Software/) {print substr($0, RSTART, RLENGTH)}' "$SRB2BLDROOT/installed/$CUSTOMDIR" | head -n1)"

        fi

        if [ -z "$SRB2BLDPREFIX" ]; then

            if [ "$OS" = "Darwin" ]; then

                SRB2BLDPREFIX="/usr/local/opt/srb2-apps"

            else

                SRB2BLDPREFIX="/usr/local"

            fi

        fi

        $PRINTF "\n$PROMPT==> $MESSAGE%s\n\e[0m" "Upgrading $BUILDNAME. Please wait..."

        preparebuild

        setsudo

        settrap

        if [ "$OS" = "Darwin" ]; then

            installtomacos

            installtolist

        else

            preparecontainer

            containerentry

            if [ "$OS" = "Linux" ] && [ -z "$SUDO_PID" ]; then

                sudo_ping

            fi

            containerrun

        fi

        if [ "$?" != "0" ]; then

            $PRINTF "\n\n$PROMPT==> $FAILURE%s\n\e[0m" "ERROR: Build didn't finish due to error or cancelling process. Cleaning up $BUILDNAME's source code. Please wait..."
            cleansource

        else

            if [ "$OS" = "Windows" ] && ([ -f "$(find "$BUILD/bin" -name "*.exe" 2> /dev/null | head -n1)" ] || [ -f "$(find "$BUILD/build" -mindepth 1 -maxdepth 1 -executable -type f 2> /dev/null | head -n1)" ] || [ -f "$(find "$BUILD" -mindepth 1 -maxdepth 1 -executable -type f 2> /dev/null | head -n1)" ]); then

                installtowindows

                installtolist

            elif [ "$OS" = "Linux" ] && ([ -f "$(find "$BUILD/build/AppDir/usr/bin" -mindepth 1 -maxdepth 1 2> /dev/null | head -n1)" ] || [ -f "$(find $BUILD/build -mindepth 1 -maxdepth 1 -executable -type f 2> /dev/null | head -n1)" ] || [ -f "$(find "$BUILD" -mindepth 1 -maxdepth 1 -executable -type f 2> /dev/null | head -n1)" ]); then

                installtolinux

            fi && $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m" "Cleaning up $BUILDNAME's source code. Please wait..." && cleansource

        fi

    fi
}

usage() {
    clear

    $PRINTF "%s\n" "
Build and install SRB2/SRB2Kart/Ring Racers from source.

Usage: srb2bld [OPTIONS]
  OPTIONS:
     -h, --help                             Show this help text.
     -ab, --appbundle                       Compile and create distributable App Bundle of SRB2/SRB2Kart/Ring Racers build, which is packaged in DMG file (macOS only).
     -ad, --android                         Compile and create distributable APK file of SRB2 build (Linux and Windows only).
     -ai, --appimage                        Compile and create distributable AppImage of SRB2/SRB2Kart/Ring Racers build (Linux only).
     -c, --compatibility                    Display compatibility table of compiling SRB2/SRB2Kart/Ring Racers builds for each operating system.
     -x, --crosscompile                     Compile and create distributable cross-compiled bundle of SRB2/SRB2Kart/Ring Racers build (Linux and Windows only).
     -f, --flatpak                          Compile and create distributable Flatpak of SRB2/SRB2Kart/Ring Racers build (Linux only).
     -i, --install                          Compile and install SRB2/SRB2Kart/Ring Racers build.
     -la, --listasset                       List downloaded SRB2/SRB2Kart/Ring Racers assets.
     -lb, --listbuild                       List downloaded SRB2/SRB2Kart/Ring Racers builds.
     -lc, --listconfig                      List compilation flags of installed SRB2/SRB2Kart/Ring Racers builds.
     -ld, --listdep                         List compiled and installed dependencies for builds.
     -li, --listinstalled                   List installed SRB2/SRB2Kart/Ring Racers builds.
     -ra, --removeasset                     Remove downloaded asset for SRB2/SRB2Kart/Ring Racers build.
     -rb, --removebuild                     Remove downloaded source code for SRB2/SRB2Kart/Ring Racers build.
     -rd, --removedep                       Remove compiled and installed dependencies for builds.
     -t, --tag                              Compile and install build with chosen tag instead of branch (only works with -i/--install, -ab/--appbundle, -ai/--appimage, -f/--flatpak).
     -u, --user                             Set installation path to user's home directory (only works with -i/--install, -ui/--uninstall, -rd/--removedep).
     -ui, --uninstall                       Uninstall SRB2/SRB2Kart/Ring Racers/Software build.
     -up, --upgrade                         Upgrade installed SRB2/SRB2Kart/Ring Racers build.
     -w, --winportable                      Compile and create distributable Windows portable bundle of SRB2/SRB2Kart/Ring Racers build (Windows only).

  EXAMPLES:
     1. Compile and install SRB2/SRB2Kart/Ring Racers build to system:
            srb2bld --install

     2. Compile and install SRB2/SRB2Kart/Ring Racers build to user's home directory:
            srb2bld --install --user

     3. Compile and install SRB2/SRB2Kart/Ring Racers build to system with chosen tag:
            srb2bld --install --tag

     4. Compile and create AppImage of SRB2/SRB2Kart/Ring Racers build (Linux only):
            srb2bld --appimage

     5. List installed SRB2/SRB2Kart/Ring Racers builds:
            srb2bld --listinstalled

     6. Uninstall SRB2/SRB2Kart/Ring Racers build:
            srb2bld --uninstall

     7. Display compatibility table of compiling SRB2/SRB2Kart/Ring Racers builds for each operating system:
            srb2bld --compatibility

  NOTES:
     1. Old builds like SRB2 v2.0, SRB2 Final Demo, SRB2 JTE may not build/run properly on modern Linux distributions/macOS/Windows.

     2. WARNING for macOS users! This script makes changes from rpath to absolute paths within some libraries installed from Homebrew, MacPorts or compiled (mostly should affects libraries compiled by user), that are associated with SRB2 binary, so installing or making App Bundles would be successful. In the future this could make unexpected results with apps or SRB2 builds, that depend on those libraries.

     3. If you want to compile some builds with DiscordRPC support (SRB2 Uncapped Plus, SRB2 NetPlus, SRB2 Kart, SRB2 Kart Galaxy and SRB2 Kart VR), then type \"HAVE_DISCORDRPC=1\" (Linux/Windows) or \"-DSRB2_CONFIG_HAVE_DISCORDRPC=ON\" (macOS), when the script asks about optional compilation flags (using \"srb2bld --install\" command).

     4. If on Linux you get error with \"/dev/fuse\" or FUSE when running script, then load fuse module with \"sudo modprobe fuse\". You can write \"fuse\" in configuration file, usually in file \"/etc/modules\" or \"/etc/modules-load.d/fuse.conf\" or \"/etc/conf.d/modules/fuse.conf\", to automatically load this module at boot.

     5. If 64-bit Linux system has issues with creating or loading \"Sonic Robo Blast 2 Final Demo\" (AppImage or installed), make sure you have installed 32-bit versions of FUSE and glibc:

         - Debian/Ubuntu/Debian based/Ubuntu based: \"sudo dpkg --add-architecture i386 && sudo apt update && sudo apt install libfuse2:i386 libc6:i386 zlib1g:i386 libglx-mesa0:i386 libgl1:i386 libglvnd0:i386\",

         - Arch/Arch based: uncomment the [multilib] section in /etc/pacman.conf and do \"sudo pacman -Su --needed lib32-fuse2 lib32-glibc lib32-gcc-libs lib32-zlib lib32-mesa lib32-libglvnd\" or use one of the AUR helpers that you
have installed - \"pikaur -Su --needed lib32-fuse2 lib32-glibc lib32-gcc-libs lib32-zlib lib32-mesa lib32-libglvnd\" or \"paru -Su --needed lib32-fuse2 lib32-glibc lib32-gcc-libs lib32-zlib lib32-mesa lib32-libglvnd\" or \"yay -Su --needed lib32-fuse2 lib32-glibc lib32-gcc-libs lib32-zlib lib32-mesa lib32-libglvnd\",

         - Gentoo/Gentoo based: \"ABI_X86=32 sudo -E emerge -av sys-fs/fuse:0 sys-libs/glibc sys-libs/zlib media-libs/mesa media-libs/libglvnd\",

         - Fedora/Fedora based: \"sudo dnf install fuse-libs.i686 glibc.i686 libgcc.i686 zlib-ng-compat.i686 mesa-dri-drivers.i686 libglvnd-glx.i686\",

         - Fedora Silverblue/Fedora Kinoite/Universal Blue (Bazzite, Aurora): \"rpm-ostree install -A --allow-inactive fuse-libs.i686 glibc.i686 libgcc.i686 zlib-ng-compat.i686 mesa-dri-drivers.i686 libglvnd-glx.i686\",

         - RHEL/RHEL based: \"sudo dnf install fuse-libs.i686 glibc.i686 libgcc.i686 zlib.i686 mesa-dri-drivers.i686 libglvnd-glx.i686\",

         - Mageia/Mageia based: \"sudo dnf config-manager --set-enabled mageia-i586 updates-i586 && sudo dnf install libfuse2.i586 libzlib1.i586 mesa.i586 libglvnd.i586\",

         - openSUSE/openSUSE based: \"sudo zypper in libfuse2-32bit glibc-32bit libgcc_s1-32bit libz1-32bit Mesa-libGL1-32bit Mesa-32bit libglvnd-32bit\",

         - openSUSE MicroOS/openSUSE MicroOS based: \"sudo transactional-update pkg in libfuse2-32bit glibc-32bit libgcc_s1-32bit libz1-32bit Mesa-libGL1-32bit Mesa-32bit libglvnd-32bit && sudo transactional-update apply\",

         - Void/Void based: \"sudo xbps-install -S void-repo-multilib && sudo xbps-install -Su fuse-32bit glibc-32bit libgcc-32bit zlib-32bit mesa-32bit libglvnd-32bit\",

         - Solus/Solus based: \"sudo eopkg it glibc-32bit libgcc-32bit zlib-32bit mesalib-32bit libglvnd-32bit\",

         - NixOS/NixOS based: \"sudo nix profile install nixpkgs#pkgsi686Linux.fuse nixpkgs#pkgsi686Linux.glibc nixpkgs#pkgsi686Linux.libgcc nixpkgs#pkgsi686Linux.zlib nixpkgs#pkgsi686Linux.mesa nixpkgs#pkgsi686Linux.libglvnd --extra-experimental-features 'nix-command flakes'\" or set those packages in \"environment.systemPackages = with pkgs;\".

     6. If Linux system has issue with running build from command-line or desktop menu because of not found compiled libraries, even though they are installed, set: export LD_LIBRARY_PATH=\"/usr/local/lib:$HOME/.local/lib:\$LD_LIBRARY_PATH\" in \"~/.bash_profile\" or \"~/.zshrc\" and then logout or reboot the system.

     7. There are couple of patches applied within source code of games. Their purpose is to prevent conflicts of installing/running of multiple builds overlapping each other with the same names of directories for storing assets and configuration/saves. Other patches include fixing compilation for some builds on particular systems.

     8. If you choose branch other than default, configuration directory's name will be changed, for example \".srb2\" will become \".srb2udmf\", if \"udmf\" was chosen. Still remember to make backup of configuration/save files, before upgrading to next release of SRB2/SRB2Kart/Ring Racers build, if you chose default branch or kept previously chosen different branch.

     9. If you have error \"invalid file system type on '/sys/fs/cgroup'\", while running script, issue could be with not running cgroups service \"sudo systemctl enable cgconfig && sudo systemctl start cgconfig\" or \"sudo systemctl enable cgmanager && sudo systemctl start cgmanager\" or \"sudo rc-update add cgroups && sudo rc-service cgroups start\" and reboot system.

     10. Other cgroup errors like: \"Failed to add conmon to cgroupfs sandbox cgroup: creating cgroup for pids: mkdir /sys/fs/cgroup/pids: no such file or directory. Error: OCI runtime error: runc: runc create failed: no cgroup mount found in mountinfo\"\" can be solved with \"sudo mount -t cgroup cgroup /sys/fs/cgroup\" for temporarily mounting or put \"cgroup /sys/fs/cgroup cgroup defaults 0 0\" at /etc/fstab for mounting at OS boot.

     11. If you receive permission issues or errors related to /etc/subuid, /etc/subgid, UID and GID, please check if you have set UIDs/GIDs for user in path /etc/subuid and /etc/subgid. For example \"testuser:231072:65536\" will assign 65,536 subordinate UIDs/GIDs (231072-296607) to user called \"testuser\", so configure to user you are logged to. If you still have permission errors, increase range for user you are logged to in files /etc/subuid and /etc/subgid, for example \"testuser:231072:200000\". Additionally, if you have podman installed, enter \"podman system migrate\".

     12. If you encounter issue for example \"cp: missing destination file operand after '/home/[username]/.local/share/srb2bld/builds/srb2-2.0/build/AppDir/usr/lib'\", while installing 32-bit old SRB2 build or building AppImage/Flatpak, please set \"sudo setsebool -P allow_execstack 1\" to adjust activated SELinux for allowing executable stacks globally on host OS or create SELinux rules for specific executable stack with recent AVC denial \"sudo ausearch -m avc -ts recent | audit2allow -M my_execstack_policy\", \"sudo semodule -i my_execstack_policy.pp\".

     13. If docker fails to run despite following installation/configuration instructions and notes from srb2bld's README, consider switching to \"podman\".

     14. If you get \"unhandled exception\" when running Ultimate Zone Builder or High Voltage Ring, uninstall mono in your system.

     15. To deal with out of memory errors, for example \"g++: fatal error: Killed signal terminated program cc1plus\", decrease number of CPU threads using variable \"SRB2BLDNCPU=[number of CPU threads]\".

     16. Building Android APKs requires gradlew script and Gradle files in the directory \"android\" for SRB2 Custom.

     17. For built Flatpak bundles for 32-bit builds, you need to install Flatpak \"org.freedesktop.Platform.Compat.i386\" with command \"flatpak --user install org.freedesktop.Platform.Compat.i386\".

     18. Sometimes fixup_bundle function, when building and installing bundle for macOS, fails due to missing library, but the path for it exists. Recommendation is to completely close terminal, reopen it again and run again srb2bld. Other way is to free RAM with \"sudo purge\".

     19. In case of sound issues with bundled OpenAL32.dll, install OpenAL from https://www.openal.org/downloads or enter winget command \"winget install --verbose --interactive --exact --id CreativeTechnology.OpenAL\".

     20. For full OpenGL support in SRB2 builds (especially SRB2CB) from Linux distribution with hybrid graphics it is recommended to apply to shell these environment variables:

          - Proprietary NVIDIA GPU drivers: \"export __NV_PRIME_RENDER_OFFLOAD=1\" and \"export __GLX_VENDOR_LIBRARY_NAME=nvidia\",

          - AMD, NVIDIA and Intel open source drivers: \"export DRI_PRIME=1\".

     21. In order to compile and install custom SRB2/SRB2Kart/Ring Racers build (assuming it is not a very old one) from local or remote repository, write environment variables in shell's configuration file, like \".bash_profile\" or \".zshrc\", which are:

          - SRB2BLDGITPATH - path to local or remote repository,

          - SRB2BLDGITVER - chosen branch to download build from remote repository,

          - SRB2BLDASSETPATH - path to assets from local or remote path (supported links/paths:
               - websites with direct link to file, for example, \"https://github.com/STJr/SRB2/releases/download/SRB2_release_2.2.10/SRB2-v2210-Full.zip\",
               - mega.nz,
               - drive.google.com,
               - dropbox.com,
               - full path to downloaded single asset file in format .pk3, .kart, etc. or archived file in formats supported by p7zip (https://www.7-zip.org) or full path to directory with build's assets, for example $HOME/Downloads/SRB2.zip for Linux and macOS or C:\Downloads\SRB2.zip for Windows.)

          - SRB2BLDEXTRAASSETPATH - path to extra assets from local or remote path, in case build requires it. The same supported links/paths applies as SRB2BLDASSETPATH.

          EXAMPLES:
               1. export SRB2BLDGITPATH=\"https://github.com/STJr/SRB2\"

               2. export SRB2BLDGITPATH=\"https://git.do.srb2.org/TehRealSalt/SRB2\"

               3. export SRB2BLDGITPATH=\"\$HOME/Builds/SRB2\"

               4. export SRB2BLDGITPATH=\"C:\Builds\SRB2\"

               5. export SRB2BLDGITVER=\"udmf\"

               6. export SRB2BLDGITVER=\"master\"

               7. export SRB2BLDASSETPATH=\"https://github.com/STJr/SRB2/releases/download/SRB2_release_2.2.10/SRB2-v2210-Full.zip\"

               8. export SRB2BLDASSETPATH=\"https://mega.nz/file/JQswBDAA#IPXWeTmrXrI9YZx6zUznJQ2uIAHryv_WP1JxWfnKbts\"

               9. export SRB2BLDASSETPATH=\"https://drive.google.com/file/d/1Vc-lHph8MxlnfaBZnv0NNpoFKhehmce6\"

               10. export SRB2BLDASSETPATH=\"https://www.dropbox.com/s/5neoderzan6mbh3/SRB2PERSONA%20v1.3.3%20Full%20Installer.exe\"

               11. export SRB2BLDASSETPATH=\"\$HOME/Downloads/SRB2-Full.zip\"

               12. export SRB2BLDASSETPATH=\"C:\Downloads\SRB2-Full.zip\"

               13. export SRB2BLDASSETPATH=\"\$HOME/Downloads/SRB2-Full\"

               14. export SRB2BLDASSETPATH=\"C:\Downloads\SRB2-Full\"

          Then choose \"Build SRB2 Custom\", when running script.

     22. Other environment variables to use. To activate them with value \"1\", do for example \"export SRB2BLDDEBUG=1\":

         - SRB2BLDDEBUG - Getting verbose output from script. Useful for reporting issues at https://github.com/bijman/srb2bld/issues.

         - SRB2BLDDEVMODE - For developers, that want to modify build's source code. Disables cleaning and resetting changes to build's source code.

         - SRB2BLDNOCCACHE - Disable ccache.

         - SRB2BLDNOGRADLECACHE - Disable gradle cache, when building Android APK.

         - SRB2BLDNCPU - Determine number of CPU threads to compile build. Useful in case of out of memory errors, for example \"g++: fatal error: Killed signal terminated program cc1plus\".

         - GITHUB_TOKEN - Increase hourly limit of request to GitHub API. Useful, if connecting to SRB2/SRB2Kart/Ring Racers assets and downloading is blocked after many attempts. Current default number of requests without GitHub personal access token is 60 requests per hour and with GitHub personal access token - 5000 requests per hour. For more details and how to, please read https://docs.github.com/en/rest/using-the-rest-api/rate-limits-for-the-rest-api and https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens. You need GitHub account to do this.
"
}

winportable() {
    clear

    # Blocking access to this option for users that have OS other than Windows.
    if [ "$OS" != "Windows" ]; then

        $PRINTF "$FAILURE%s\n\e[0m" "ERROR: Currently building Windows portable bundle is only available for Windows. Exiting."
        exit

    fi

    # We have to set this in order to make Windows portable bundle in Docker/Podman container.
    WINPORTABLE=1

    checkuseropt

    # Set current working directory.
    LNXPWD="$(pwd)"

    choosebuild

    buildvar

    fetchupdatebuild

    choosebranchcommit

    preparebuild

    setsudo

    preparecontainer

    containerentry

    sudo_ping

    settrap

    containerrun

    # Export commit revision name before creating Windows portable bundle.
    VERSION="$GITVER-$(git -C "$BUILD" rev-parse --short HEAD)"

    # Move created bundle to working directory.
    WINPORTABLEBUILDNAME="$($PRINTF "%s\n" "$BUILDNAME" | gawk '{gsub(" ","_"); print}')-$VERSION-Windows-$ARCH.zip"

    mv -f "$BUILDPATH/package.zip" "$LNXPWD/$WINPORTABLEBUILDNAME"

    $PRINTF "\n$PROMPT==> $SUCCESS%s\n\e[0m\a" "Windows portable bundle for $BUILDNAME is done. Look for \"$WINPORTABLEBUILDNAME\" in \"$LNXPWD\" path."
}

case "$1" in

    -h | --help)

        usage

        ;;

    "")

        defaultmessage

        ;;

    -ab | --appbundle)

        appbundle

        ;;

    -ad | --android)

        android

        ;;

    -ai | --appimage)

        appimage

        ;;

    -c | --compatibility)

        compatibility

        ;;

    -x | --crosscompile)

        crosscompile

        ;;

    -f | --flatpak)

        flatpak

        ;;

    -i | --install)

        chooseinstall

        ;;

    -la | --listasset)

        listasset

        ;;

    -lb | --listbuild)

        listbuild

        ;;

    -lc | --listconfig)

        listconfig

        ;;

    -ld | --listdep)

        listdep

        ;;

    -li | --listinstalled)

        listinstalled

        ;;

    -ra | --removeasset)

        chooseremoveasset

        ;;

    -rb | --removebuild)

        chooseremovebuild

        ;;

    -rd | --removedep)

        chooseremovedep

        ;;

    -ui | --uninstall)

        chooseuninstall

        ;;

    -up | --upgrade)

        upgrade

        ;;

    -w | --winportable)

        winportable

        ;;

esac
